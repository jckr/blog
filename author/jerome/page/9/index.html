<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="HandheldFriendly" content="True" />
<meta name="MobileOptimized" content="320" />

<title>jerome | jeromecukier.net | Page 9</title>

<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="/xmlrpc.php">
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="jeromecukier.net &raquo; Feed" href="/feed/" />
<link rel="alternate" type="application/rss+xml" title="jeromecukier.net &raquo; Comments Feed" href="/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="jeromecukier.net &raquo; Posts by jerome Feed" href="/author/jerome/feed/" />
<!-- This site uses the Google Analytics by MonsterInsights plugin v7.0.5 - Using Analytics tracking - https://www.monsterinsights.com/ -->
<!-- Note: MonsterInsights is not currently configured on this site. The site owner needs to authenticate with Google Analytics in the MonsterInsights settings panel. -->
<!-- No UA code set -->
<!-- / Google Analytics by MonsterInsights -->
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/localhost:8888\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.10"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='YoutubeShortcodeMargenn-css'  href='/wp-content/plugins/youtube-shortcode/youtube-shortcode.css?ver=4.6.10' type='text/css' media='all' />
<link rel='stylesheet' id='casper-google-fonts-css'  href='//fonts.googleapis.com/css?family=Noto+Serif%3A400%2C700%2C400italic%7COpen+Sans%3A700%2C400&#038;ver=4.6.10' type='text/css' media='all' />
<link rel='stylesheet' id='casper-style-css'  href='/wp-content/themes/casper/style.css?ver=4.6.10' type='text/css' media='all' />
<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.6.10" />

   	<style type="text/css">
					.blog-title a, .blog-description, .social-icons a { color: #ffffff; }
		
						                
		
							.main-navigation a { color: ; }
		                                            </style>
    		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
		<style type="text/css" id="syntaxhighlighteranchor"></style>
</head>

<body class="archive paged author author-jerome author-1 paged-9 author-paged-9 group-blog">

<header id="masthead" role="banner" class="site-head site-header" >
    <nav id="site-navigation" class="main-navigation" role="navigation">
        <div>
            <h1 class="menu-toggle">
                <a class="icon-bars" href="#">
                    <span class="hidden">Menu</span>
                </a>
            </h1>
            <a class="skip-link screen-reader-text" href="#content">Skip to content</a>
            <div class="menu"><ul><li ><a href="/">Home</a></li><li class="page_item page-item-6"><a href="/about/">About</a></li><li class="page_item page-item-1073"><a href="/data-stories/">Data with stories workshop &#8211; examples</a></li><li class="page_item page-item-437"><a href="/proofs-of-concept/">Private section</a></li><li class="page_item page-item-2"><a href="/sample-page/">Sample Page</a></li></ul></div>
        </div>
    </nav><!-- #site-navigation -->

    <div class="vertical-row">
        <div class="vertical">
            <div class="site-head-content inner">
                
                <div class="social-icons">
                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                <h1 class="blog-title"><a class="blog-logo" href='/' rel='home'>jeromecukier.net</a></h1>
                <h2 class="blog-description">Just another WordPress site</h2>
            </div>
        </div>
    </div>
</header><!-- #masthead -->

<main id="content" class="content" role="main">

	<section id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">
					Author: <span class="vcard">jerome</span>				</h1>
							</header><!-- .page-header -->

						
				
<article id="post-550" class="post-550 post type-post status-publish format-standard hentry category-charts category-data-visualization category-protovis category-tips tag-grammar-of-graphics tag-nesting tag-protovis tag-tableau tag-tutorial">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2011/02/11/working-with-data-in-protovis-interlude-protovis-nesting-vs-tableau/" rel="bookmark"><time class="entry-date published" datetime="2011-02-11T02:40:48+00:00">February 11, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/charts/" rel="category tag">charts</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/protovis/" rel="category tag">protovis</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2011/02/11/working-with-data-in-protovis-interlude-protovis-nesting-vs-tableau/" rel="bookmark">Working with data in protovis &#8211; interlude: protovis nesting vs tableau</a></h1>
         
    </header>
	<section class="post-content">

		<p>Protovis, like Tableau, are based on the grammar of graphics framework. In a nutshell, in both environments, a chart designer can map visual attributes (such as x or y dimension, color, shape, etc.) to dimensions of data. </p>
<p>The flat file which <a href="http://vis.stanford.edu/protovis/ex/barley.html">Becker&#8217;s Barley</a> is based on can be used in Tableau public nearly as is.<br />
Here&#8217;s a size-by-size comparison of the results:</p>
<table>
<tr>
<td><a href="http://www.jeromecukier.net/wp-content/uploads/2011/02/protovisBarley.png"><img src="http://www.jeromecukier.net/wp-content/uploads/2011/02/protovisBarley.png" alt="" title="protovisBarley" width="350" height="830" class="aligncenter size-full wp-image-551" /></a></td>
<td><script type="text/javascript" src="http://public.tableausoftware.com/javascripts/api/viz_v1.js"></script><object class="tableauViz" width="356" height="901" style="display:none;"><param name="name" value="barley/Dashboard1" /><param name="toolbar" value="no" /><param name="tabs" value="no" /></object><noscript>Dashboard 1 <br /><a href="#"><img alt="Dashboard 1 " src="http://public.tableausoftware.com/static/images/ba/barley/Dashboard1/1_rss.png" height="100%" /></a></noscript></td>
</tr>
</table>
<h2>How it&#8217;s done in Protovis</h2>
<p>In protovis, the flat file is nested several times, so that its various elements can be called in a hierarchy from series of dots per variety, to panel per sites to a grander panel. Legend and ticks are added by hand for a perfect finish. Still, some careful planning is required to prepare the data file and to adjust the various elements (choice of colors, sizes, etc.)</p>
<h2>How it&#8217;s done in Tableau</h2>
<p><a href="http://www.jeromecukier.net/wp-content/uploads/2011/02/tableauBarley.png"><img src="http://www.jeromecukier.net/wp-content/uploads/2011/02/tableauBarley.png" alt="" title="tableauBarley" width="665" height="497" class="aligncenter size-full wp-image-554" /></a><br />
The data file, unsurprisingly, has 4 dimensions: site, variety, year and yield. In tableau terms, yield is a measure (a numerical dimension) while the other 3 are categorical dimensions. With a few clicks, it is possible to get a result which is similar to the original vis in Protovis. We assign yield to column (horizontal attribute), site and variety to row in that order. We also untick aggregate measures in Analysis, so we get little circles and not big bars. Here, I&#8217;ve manually sorted the sites and the varieties. </p>
<h2>Conclusion</h2>
<p>It is much, much easier to achieve a similar result with Tableau, however using protovis provides a finer control. </p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-494" class="post-494 post type-post status-publish format-standard hentry category-charts category-data-visualization category-protovis category-tips tag-arrays tag-javascript tag-protovis tag-tutorial">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2011/02/09/working-with-data-in-protovis-part-3-of-5/" rel="bookmark"><time class="entry-date published" datetime="2011-02-09T19:08:57+00:00">February 9, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/charts/" rel="category tag">charts</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/protovis/" rel="category tag">protovis</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2011/02/09/working-with-data-in-protovis-part-3-of-5/" rel="bookmark">Working with data in protovis – part 3 of 5</a></h1>
         
    </header>
	<section class="post-content">

		<p>Previous : <a href="http://www.jeromecukier.net/?p=479">Multi-dimensional arrays, inheritance and hierarchy</a></p>
<h2>Short interlude: what can be done with arrays in javascript?</h2>
<p>Now that we have a grasp on how arrays work and how they can be used in protovis, let’s take a step back and look at some very useful methods for working with arrays in standard javascript.</p>
<h3>Sorting arrays</h3>
<p>Using a method called, well, sort(), javascript arrays can be reordered in a variety of ways.</p>
<pre class="brush: jscript; title: ; notranslate" title="">var a = [1, 1.2, 1.7, 1.5, .7, .3];
a.sort();</pre>
<p>Without any argument, this will sort the array in ascending order: [0.3, 0.7, 1, 1.2, 1.5, 1.7].</p>
<p>However, we can reorder the array differently with a comparison function, such as:</p>
<pre class="brush: jscript; title: ; notranslate" title="">a.sort(function(a,b) b-a)</pre>
<p>Note that this is protovis notation. In traditional javascript, you’d have written a.sort(function(a,b) {return b-a;});</p>
<p>This would sort a in descending order ([1.7, 1.5, 1.2, 1, 0.7, 0.3]). Here is how it works.</p>
<p>The comparison function takes 2 elements in the array. If the first element (corresponding to the first argument, a) should appear first, the function must return a negative number. If the result is positive, the second element is appearing first. With our example, b-a is negative when the first element is greater than the second. So, this function sorts an array in descending order.</p>
<p>Sort also works with arrays of associative arrays. For instance:</p>
<pre class="brush: jscript; title: ; notranslate" title="">var data = [
  {key:&quot;a&quot;, value:1},
  {key:&quot;b&quot;, value:1.2},
  {key:&quot;c&quot;, value:1.7}, 
  {key:&quot;d&quot;, value:1.5},
  {key:&quot;e&quot;, value:.7},
  {key:&quot;f&quot;, value:.3}
];

data.sort(function(a,b) b.value-a.value);
</pre>
<p>Here, we have to specify which criterion is used to sort the array. In this example, we sort it in descending order by value. But we could have sorted it in ascending order by key, for instance.</p>
<p>The method reverse() turns an array upside down.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
var a = [1, 1.2, 1.7, 1.5, .7, .3];

a.reverse(); // gives [0.3, 0.7, 1.5, 1.7, 1.2, 1]
</pre>
<p>So, a.sort().reverse() will also sort that array in decreasing order.</p>
<h3>Extracting sub-arrays</h3>
<p>The method slice() will extract a sub-array out of an array, in other words, it will retrieve certain elements. It works with one or two arguments. If you only give one argument, it will give you the last elements from the index you specified.</p>
<p>For instance,</p>
<pre class="brush: jscript; title: ; notranslate" title="">[1, 1.2, 1.7, 1.5, .7, .3].slice(3) // it's [1.5, 0.7, 0.3]</pre>
<p>The index 3 corresponds to the 4<sup>th</sup> element of the array (0,1,2,3) so slice(3) will return the 4<sup>th</sup>, 5<sup>th</sup> and 6<sup>th</sup> elements.</p>
<p>With 2 arguments, you get a sub-array that starts at the first index but ends just before the 2<sup>nd</sup> one. For instance,</p>
<pre class="brush: jscript; title: ; notranslate" title="">[1, 1.2, 1.7, 1.5, .7, .3].slice(0,3) // gives [1, 1.2, 1.7]</pre>
<p>It is also possible to use negative arguments. Instead of counting from the beginning of the array, it means counting from the end.</p>
<pre class="brush: jscript; title: ; notranslate" title="">[1, 1.2, 1.7, 1.5, .7, .3].slice(-1) // result: [0.3]</pre>
<h3>Turning a string into an array</h3>
<p>This can be done via the split() method.</p>
<p>split() normally works with a separator, for instance &#8220;07/04/1975&#8221;.split(&#8220;/&#8221;) is [&#8220;07&#8221;, &#8220;04&#8221;, &#8220;1975&#8221;], but if an empty string is used, then each character becomes an element of the new array. For instance,</p>
<pre class="brush: jscript; title: ; notranslate" title="">&quot;ABCDEFGHIJ&quot;.split(&quot;&quot;) // result: [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;G&quot;, &quot;H&quot;, &quot;I&quot;, &quot;J&quot;] </pre>
<p>This can be very useful to generate data on the go.</p>
<h2>And what methods does protovis has for working with arrays and data?</h2>
<p>Many.</p>
<p>Some simple, some very elaborate. In addition to visualization functions protovis has impressive data processing capabilities.</p>
<h3>The workhorse: pv.range()</h3>
<p>pv.range() is a method that creates an array of numbers.</p>
<p>pv.range(10), for instance, is [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], or the 10 first integers starting from 0.<br />
(this is the method I referred to in the example of the previous part).</p>
<p>By using the other arguments, it is possible to generate arrays of numbers that go from one specific index to another, or to change the step. For instance:</p>
<pre class="brush: jscript; title: ; notranslate" title="">pv.range(5,10) // is [5, 6, 7, 8, 9]
pv.range(5,21,5) // is [5, 10, 15, 20]</pre>
<p>While this may not look incredible at first sight, pv.range() really shines when associated with other functions or methods such as map().</p>
<p>map()  is an array method that creates a new array by applying a function to each of the element of the array it’s run against. For instance,</p>
<pre class="brush: jscript; title: ; notranslate" title="">var data = pv.range(100).map(Math.random) // creates an array of 100 random numbers.

var data = pv.range(1000).map(function(a) Math.cos(a/1000)) // stores into data 1000 values 
// of cos(x) for all the numbers between 0 and 0.999 by increment of 0.001.</pre>
<p>In other words, pv.range() and map() can quickly create very interesting datasets for protovis to visualize.</p>
<h3>Simple statistical functions that make life easier</h3>
<h4>pv.min(), pv.max()</h4>
<p>Protovis has functions that extract the maximum or the minimum value of an array.</p>
<p>pv.min([1, 1.2, 1.7, 1.5, .7, .3]) will return the value of the smallest element of the array, in that case 0.3.</p>
<p>Likewise, pv.max returns the value of the greatest element of the array.</p>
<p>Both of these can be used with an accessor function to help retrieve what will be compared.</p>
<p>For instance:</p>
<pre class="brush: jscript; title: ; notranslate" title="">
var data = [
  {key:&quot;a&quot;, value:1},
  {key:&quot;b&quot;,value:1.2},
  {key:&quot;c&quot;, value:1.7}, 
  {key:&quot;d&quot;, value:1.5},
  {key:&quot;e&quot;, value:.7},
  {key:&quot;f&quot;, value:.3}
];

pv.max(data, function(a) a.value); // should return 1.7</pre>
<h4>pv.sum(), pv.mean(), pv.median()</h4>
<p>Likewise, protovis has aptly-named methods that return the sum, the mean and the median of the elements of an array. Note that it&#8217;s pv.mean() and not pv.average(), though.</p>
<pre class="brush: jscript; title: ; notranslate" title="">pv.sum([1, 1.2, 1.7, 1.5, .7, .3]) // gives  6.4.
pv.mean([1, 1.2, 1.7, 1.5, .7, .3]) // gives 1.0666666666666667
pv.median([1, 1.2, 1.7, 1.5, .7, .3]) // gives 1.1.</pre>
<p>Similarly to pv.min() you can use an optional accessor function.</p>
<pre class="brush: jscript; title: ; notranslate" title="">pv.median(data, function(a) a.value);</pre>
<h4>pv.normalize()</h4>
<p>pv.normalize() is a handy method that divides all elements in an array by a factor, so that the sum of all these elements is 1.</p>
<pre class="brush: jscript; title: ; notranslate" title="">pv.normalize([1, 1.2, 1.7, 1.5, .7, .3])
// [0.15625, 0.18749999999999997, 0.265625, 0.234375, 0.10937499999999999, 0.04687499999999999]

pv.sum(pv.normalize([1, 1.2, 1.7, 1.5, .7, .3])) // result: 1.</pre>
<h3>Combining arrays</h3>
<h4>pv.blend()</h4>
<p>pv.blend() simply turns an array of arrays into a simpler array where all elements follow each other.</p>
<pre class="brush: jscript; title: ; notranslate" title="">pv.blend([[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;], [1,2,3]]) // gives  [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, 1, 2, 3]</pre>
<p>One benefit is that it is possible to run methods on this new array that wouldn’t work on an array of arrays.</p>
<p>For instance:</p>
<pre class="brush: jscript; title: ; notranslate" title="">pv.max([[1,2],[3,4],[5,6]]) // result : NaN
// protovis cannot guess how to compare [1,2], [3,4] or [5,6] without any further instruction.
pv.max(pv.blend([[1,2],[3,4],[5,6]])) // result: 6.
pv.max([[1,2],[3,4],[5,6]], function(a) pv.max(a)) // also returns 6.</pre>
<h4>pv.cross()</h4>
<p>Given two arrays a and b, pv.cross(a,b) returns an array of all possible pairs of elements.</p>
<pre class="brush: jscript; title: ; notranslate" title="">pv.cross([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;], [1,2,3]) // returns 
//[[“a”,1],[“a”,2],[“a”,3],[“b”,1],[“b”,2],[“b”,3],[“c”,1],[“c”,2],[“c”,3]]</pre>
<h4>pv.transpose()</h4>
<p>pv.transpose() flips an array of arrays.</p>
<p>In our previous example –</p>
<pre class="brush: jscript; title: ; notranslate" title="">pv.cross([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;], [1,2,3])</pre>
<p>The result was a 9&#215;2 array. [[“a”,1],[“a”,2],[“a”,3],[“b”,1],[“b”,2],[“b”,3],[“c”,1],[“c”,2],[“c”,3]]</p>
<p>If we apply pv.transpose, we get a 2&#215;9 array:</p>
<pre class="brush: jscript; title: ; notranslate" title="">pv.transpose(pv.cross([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;], [1,2,3])); // result:
//[[&quot;a&quot;,&quot;a&quot;,&quot;a&quot;,&quot;b&quot;,&quot;b&quot;,&quot;b&quot;,&quot;c&quot;,&quot;c&quot;,&quot;c&quot;]
//[1,2,3,1,2,3,1,2,3]]</pre>
<h3>Putting it all together</h3>
<p>This short example will show how one can work from an unprepared dataset.<br />
For the purpose of this example, I&#8217;m retrieving GDP per capita data of OECD countries. I have a table of 34 countries on 10 years from 2000 to 2009. The countries are in alphabetical order.<br />
I would like to do a bar chart showing the top 12 countries ranked by their GDP per capita. How complex can this be? With the array methods, not so difficult.</p>
<pre class="brush: jscript; highlight: [40,50]; title: ; notranslate" title="">var data=[
[&quot;Country&quot;,2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009],
[&quot;Australia&quot;,28045.6566279103, 29241.289462815, 30444.7839453338, 32079.5610505727, 33494.6654789274, 35091.7414600449, 37098.3968669994, 39002.0335375021, 39148.4759391917, 39660.1953738791],
[&quot;Austria&quot;,28769.5911274323, 28799.1968990511, 30231.0955219759, 31080.6122212092, 32598.0698959222, 33409.3453751649, 36268.9604225683, 37801.7320979073, 39848.9481928628, 38822.6960085478],
[&quot;Belgium&quot;,27624.4454637489, 28488.7963954409, 30013.7570016445, 30241.724380444, 31151.6315179167, 32140.9239149283, 34159.4723388042, 35597.2980660662, 36878.9710906881, 36308.4784216699],
[&quot;Canada&quot;,28484.9776553362, 29331.8223245112, 29911.3226371905, 31268.5521058006, 32845.6267954986, 35105.9892865177, 36853.5554314586, 38353.0812084648, 38883.0700787846, 37807.5259929247],
[&quot;Chile&quot;,9293.72322249492, 9712.95685376592, 9973.25946014534, 10475.6486664294, 11299.9329380664, 12194.1443507847, 13036.1285137662, 13896.6946083854, 14577.5715215544, 14346.4648487517],
[&quot;Czech Republic&quot;,14992.3582327884, 16173.6387263985, 16872.3146139754, 17991.9331910401, 19303.9208098529, 20365.7571142986, 22349.7033747705, 24578.7151794413, 25845.0252652635, 25530.2001372786],
[&quot;Denmark&quot;,28822.3343389384, 29437.5232757263, 30756.3323835463, 30427.5149228283, 32301.3394496912, 33195.8834383121, 36025.8628586246, 37730.736916861, 39494.1216134705, 37688.2516868117],
[&quot;Estonia&quot;,9861.80346448344, 10693.0362387373, 11966.6746413277, 13370.127724177, 14758.4181995435, 16530.7311083966, 19134.4130457855, 21262.1415030861, 21802.2185996096, 19880.2786070771],
[&quot;Finland&quot;,25651.0005450286, 26518.293212524, 27509.1023963486, 27592.2031438268, 29855.387224753, 30689.9753400459, 33095.030855128, 36149.32963148, 37795.237097856, 35236.9462175119],
[&quot;France&quot;,25272.4127936247, 26644.8404266553, 27776.4225007831, 27399.5459524877, 28273.6330332193, 29692.129719144, 31551.3458452695, 33300.5367942194, 34233.0770304046, 33697.9698933558],
[&quot;Germany&quot;,25949.0588445755, 26855.1296905696, 27587.1573355486, 28566.8930562768, 29900.6507502683, 31365.576121107, 33713.1689185469, 35623.4147543745, 37170.693412872, 36339.9009091421],
[&quot;Greece&quot;,18410.2161113813, 19928.6672542964, 21597.5997816753, 22701.7754699285, 24088.2202877303, 24571.6085727425, 26917.7358531616, 28059.5724529461, 29919.6385697499, 29121.8306842272],
[&quot;Hungary&quot;,12134.0140204384, 13576.4413471795, 14765.2333755651, 15424.3926636975, 16316.8885518624, 16937.9383138957, 18329.1579647528, 19187.2829138188, 20699.9056965458, 20279.5060192879],
[&quot;Iceland&quot;,28840.4899286393, 30443.907492292, 31083.7723760522, 30768.0910155965, 33697.6723843766, 35025.1338769129, 35807.880160537, 37178.9762849327, 39029.2396691797, 36789.0728215933],
[&quot;Ireland&quot;,28695.0931156375, 30524.3712319885, 33052.4517849575, 34525.4148515126, 36511.518217243, 38622.5520655621, 42267.9784043449, 45293.6482834027, 42643.6362934458, 39571.204030073],
[&quot;Israel&quot;,23496.1573531847, 23455.1048827219, 23534.8524310529, 22270.5507137525, 23650.3373360675, 23390.3809761211, 24960.0508863672, 26583.387317862, 27679.3777353666, 27661.1271269539],
[&quot;Italy&quot;,25594.3456589799, 27127.4298830414, 26803.97019843, 27137.5365317475, 27416.0961790796, 28144.0379218171, 30224.2469223694, 31897.7434207435, 33270.7464832409, 32407.5033618371],
[&quot;Japan&quot;,25607.7204586644, 26156.1615068187, 26804.9303541079, 27487.123875677, 29020.8955443678, 30311.5281317716, 31865.2733339475, 33577.1846704038, 33902.3807335349, 32476.7736535378],
[&quot;Korea&quot;,17197.0800334388, 18150.876787578, 19655.5961579558, 20180.932195274, 21630.1629926488, 22783.2288432845, 24286.1803272315, 26190.6122298674, 26876.6422899926, 27099.9481192024],
[&quot;Luxembourg&quot;,53645.7229595775, 53932.4594967082, 57559.2104243171, 60723.9861616145, 65021.6940738929, 68372.258619455, 78523.2988291034, 84577.2190776183, 89732.070876649, 84802.9716853677],
[&quot;Mexico&quot;,10046.1268819126, 10135.7265293228, 10397.8915415223, 10883.8643666506, 11535.0108530091, 12460.5385178945, 13672.6034191998, 14581.5178679935, 15290.896575069, 14336.6153896301],
[&quot;Netherlands&quot;,29405.5490140191, 30788.2508953647, 31943.4974056501, 31702.5798119046, 33208.8592768987, 35110.6577619843, 38063.6877336725, 40744.3819227526, 42887.4361825772, 40813.047575264],
[&quot;New Zealand&quot;,21113.9167562199, 22128.8483527737, 23115.0676326844, 23826.8007737809, 24775.7827578032, 25460.2942993256, 27277.7654223562, 28701.3328788203, 29231.151567007, 29097.307061683],
[&quot;Norway&quot;,36125.7036078917, 37091.7150478501, 37051.9473705873, 38298.8631304819, 42257.5943785044, 47318.7844737929, 53287.9750020125, 55042.2093246253, 60634.9819502298, 55726.7456848212],
[&quot;Poland&quot;,10567.0016558591, 10950.4739587211, 11562.6245018264, 11985.0042955849, 13014.5996003514, 13785.7656450352, 15067.4402978586, 16762.2045951617, 18062.1834289945, 18928.8205162032],
[&quot;Portugal&quot;,17748.6930918065, 18464.7472033934, 19088.1764760703, 19392.2862101711, 19796.1891048601, 21294.1660710906, 22869.9272824917, 24122.9886840593, 24962.2959136026, 24980.061318413],
[&quot;Slovak Republic&quot;,10980.1169029929, 12070.70145551, 12965.6228450353, 13597.9556337584, 14659.0096334623, 16174.4605836956, 18397.5822518716, 20916.5438777989, 23241.0972994031, 22870.8998469728],
[&quot;Slovenia&quot;,17468.5101911515, 18342.8685005009, 19702.0589885459, 20448.2040741134, 22200.7770986247, 23493.9370882038, 25432.3240768864, 27228.3376725332, 29240.5471362484, 27535.6540786883],
[&quot;Spain&quot;,21320.0690041202, 22591.3855327033, 24066.5003000439, 24748.2819467008, 25958.1017090553, 27376.7644983649, 30347.9357063518, 32251.8469529105, 33173.3334547015, 32254.0895139806],
[&quot;Sweden&quot;,27948.4749835611, 28231.3958224236, 29277.7736264795, 30418.0441004337, 32505.646687298, 32701.4327422078, 35680.1787996674, 38339.6698693908, 39321.3014501815, 36996.1394001578],
[&quot;Switzerland&quot;,31618.0958082618, 32103.4812665805, 33390.9169108411, 33266.3042144918, 34536.8476164193, 35478.0395058126, 39116.3945212067, 42755.5569054368, 45516.5601956426, 44830.3719226918],
[&quot;Turkey&quot;,9169.71780977686, 8613.21159842998, 8666.90348260238, 8790.01048446305, 10166.0963401732, 11391.3768057053, 12886.6195973915, 13897.3820310325, 14962.4944915831, 14242.7276329837],
[&quot;United Kingdom&quot;,26071.3066882302, 27578.2857038985, 28887.5850874466, 29848.7319363944, 31790.9933025905, 32724.4057819337, 34970.5193042987, 35719.2060247462, 36817.493156774, 35158.8005888247],
[&quot;United States&quot;,35050.1738557741, 35866.2624634202, 36754.5543204007, 38127.524970345, 40246.0630591955, 42466.1326203714, 44594.9199470326, 46337.2237397566, 46901.0697730874, 45673.7445647402]
];

var year=10;
var rows = data.slice(1,data.length);

var x = pv.Scale.ordinal(pv.range(12)).splitBanded(0, 240, 4/5);
var y = pv.Scale.linear(0, 80000).range(0, 170);

var vis = new pv.Panel()
    .width(250)
    .height(200)
    ;
	vis.add(pv.Bar)
		.data(rows.sort(function(a,b) b[year]-a[year]).slice(0,12))
		.bottom(10)
		.width(x.range().band)
		.height(function(d) y(d[year]))
		.left(function() 5+x(this.index))
		.anchor(&quot;bottom&quot;).add(pv.Label).textAngle(Math.PI/2).text(function(d) d[0]).textBaseline(&quot;middle&quot;).textAlign(&quot;right&quot;)
		;
vis.render();</pre>
<p>here, in the data variable, I&#8217;ve put my 2-dimensional table as I got it. The first row contains headers which I won&#8217;t need. So, in line 40, I create rows which just removes that 1st line with a slice function. data.slice(1,data.length) effectively keeps all the lines but the first.<br />
In the next few lines I create two scales for placing my bars, a standard vis panel and a bar chart. Now, what kind of data will I pass to the bar chart?<br />
I want to sort the rows by the value of the latest year (which happens to be the 11th column, so 10). This is what the rows.sort(function(a,b) b[year]-a[year]) part of the statement does. I&#8217;ve simply assigned 10 to the variable year, so if I want to display other years (with an HTML form for instance) it wouldn&#8217;t be difficult to modify.<br />
And, since I only want the top 12 values, I just write .slice(0,12) after that. </p>
<p>In line 55, I just add a label. pv.Label inherits the data of its parent. The data item is the whole row of my 2-dimensional table, so if I write function(d) d[0], I am referring to the left-most item which will be the country name. </p>
<p>So, with the use of simple array functions, I can easily rework an unprepared dataset in protovis, rather than having to tailor my dataset with manual (and error-prone) manipulations in external programs. Here is the result:<br />
<a href="http://www.jeromecukier.net/wp-content/uploads/2011/02/sortedBar.png"><img src="http://www.jeromecukier.net/wp-content/uploads/2011/02/sortedBar.png" alt="" title="sortedBar" width="250" height="200" class="aligncenter size-full wp-image-589" /></a><br />
Next: <a href="http://www.jeromecukier.net/?p=502">reshaping complex arrays</a></p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-479" class="post-479 post type-post status-publish format-standard hentry category-charts category-data-visualization category-protovis category-tips category-uncategorized tag-hierarchy tag-inheritance tag-protovis tag-tutorial">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2011/02/08/working-with-data-in-protovis-part-2-of-5/" rel="bookmark"><time class="entry-date published" datetime="2011-02-08T19:51:01+00:00">February 8, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/charts/" rel="category tag">charts</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/protovis/" rel="category tag">protovis</a>, <a href="/category/tips/" rel="category tag">tips</a>, <a href="/category/uncategorized/" rel="category tag">Uncategorized</a>			</span>
		        <h1 class="post-title"><a href="/2011/02/08/working-with-data-in-protovis-part-2-of-5/" rel="bookmark">Working with data in protovis – part 2 of 5</a></h1>
         
    </header>
	<section class="post-content">

		<p>Previous post: <a href="http://www.jeromecukier.net/?p=429">simple arrays</a></p>
<h2>Multi-dimensional arrays, associative arrays and protovis</h2>
<p>Even for a simple chart, chances are that you’ll have more than a single series of numbers to represent. For instance, you could have labels to describe what they mean, several series, and so on and so forth.<br />
So, let’s say we want to add these labels to our original examples, so we know what those bars represent.</p>
<table>
<tbody>
<tr>
<td>
<pre class="brush: jscript; title: ; notranslate" title="">var categories = [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;,&quot;f&quot;];
var vis = new pv.Panel()
  .width(150)
  .height(150);

vis.add(pv.Bar)
  .data([1, 1.2, 1.7, 1.5, .7, .3])
  .width(20)
  .height(function(d) d * 80)
  .bottom(0)
  .left(function() this.index * 25)
  .anchor(&quot;bottom&quot;).add(pv.Label)
    .text(function() categories[this.index]);

vis.render();
</pre>
</td>
<td><a href="http://www.jeromecukier.net/wp-content/uploads/2011/02/categories.png"><img src="http://www.jeromecukier.net/wp-content/uploads/2011/02/categories.png" alt="" title="categories" width="144" height="135" class="aligncenter size-full wp-image-483" /></a></td>
</tr>
</tbody>
</table>
<p>While this did the trick, nothing guarantees that the data proper and the category name will stay coordinated. If one data point is deleted or removed and this is not replicated on the categories, they will no longer match. A more integrated way to proceed would be to group category and data information, like this:</p>
<pre class="brush: jscript; highlight: [16,20]; title: ; notranslate" title="">var data = [
  {key:&quot;a&quot;, value:1},
  {key:&quot;b&quot;, value:1.2},
  {key:&quot;c&quot;, value:1.7}, 
  {key:&quot;d&quot;, value:1.5},
  {key:&quot;e&quot;, value:.7},
  {key:&quot;f&quot;, value:.3}
];
var vis = new pv.Panel()
  .width(150)
  .height(150);

vis.add(pv.Bar)
  .data(data)
  .width(20)
  .height(function(d) d.value * 80)
  .bottom(0)
  .left(function() this.index * 25)
  .anchor(&quot;bottom&quot;).add(pv.Label)
    .text(function(d) d.key);

vis.render();</pre>
<p>This time, we group the values and the category names in a single variable, an array of associative arrays.<br />
When drawing the bar chart, protovis will go through this array and retrieve an associative array for each bar.<br />
We have to change the way the height function is written. The data element being accessed is no longer of the form 1 or 1.7, but {key:”a”, value:1} or {key:”c”, value:1.7}. So to get the number part of it, we must write <strong>d.value</strong>.</p>
<p>Likewise, instead of accessing an array of categories for the text part, we can use the current data element via an accessor function, and write <strong>d.key</strong>.</p>
<h2>Hierarchy and inheritance</h2>
<p>So we’ve seen that arrays, or associative arrays, can have several levels and can be nested one into another.<br />
Interestingly, protovis elements, like panels, charts, mark etc. also work in a <em>hierarchy</em>. For instance, when you start working with protovis you create a panel object. Then, you add other objects to that panel, like a bar chart (our example), or another panel. You can add other objects to your new objects, or attach them to your first panel.<br />
This diagram shows the hierarchy between elements in the previous example.</p>
<table>
<tr>
<td>
<pre class="brush: jscript; title: ; notranslate" title="">var categories = [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;,&quot;f&quot;];
var vis = new pv.Panel()
  .width(150)
  .height(150)

var bar = vis.add(pv.Bar)
  .data([1, 1.2, 1.7, 1.5, .7, .3])
  .width(20)
  .height(function(d) d * 80)
  .bottom(0)
  .left(function() this.index * 25)
  .anchor(&quot;bottom&quot;).add(pv.Label)
  .text(function() categories[this.index]);

vis.render();</pre>
</td>
<td><a href="http://www.jeromecukier.net/wp-content/uploads/2011/02/hierarchy.png"><img src="http://www.jeromecukier.net/wp-content/uploads/2011/02/hierarchy.png" alt="" title="hierarchy" width="220" height="170" class="aligncenter size-full wp-image-485" /></a></td>
</tr>
</table>
<p>The bar object is considered to be the child of vis, who is its parent.</br><br />
You may know that in protovis, children objects inherit properties of their parents.</br><br />
For instance, if width wasn’t specified for the bar object, it would have the width of its parent, 150. Each mark would cover the whole screen.</p>
<p>For data, when a new object is added, data is either specified at that level, or obtained from the parent element of this object.</p>
<p>Let’s take our example and tweak it a bit.<br />
<table>
<tr>
<td>
<pre class="brush: jscript; highlight: [5]; title: ; notranslate" title="">var vis = new pv.Panel().width(150).height(150);
var bar = vis.add(pv.Bar)
  .data([1, 1.2, 1.7, 1.5, .7, .3]).width(20) .bottom(0)
  .height(function(d) d * 80).left(function() this.index * 25)
  .anchor(&quot;top&quot;).add(pv.Label)
vis.render();</pre>
<td>
<td><a href="http://www.jeromecukier.net/wp-content/uploads/2011/02/part3.png"><img src="http://www.jeromecukier.net/wp-content/uploads/2011/02/part3.png" alt="" title="part3" width="154" height="154" class="aligncenter size-full wp-image-487" /></a></td>
</tr>
</table>
<p>Here, I didn’t specify a data or a text value for the labels I added. They just took the value of its parent element – the marks of the pv.Bar object.<br />
Here’s another variation:</p>
<table>
<tr>
<td>
<pre class="brush: jscript; highlight: [4]; title: ; notranslate" title="">
var vis = new pv.Panel().width(150).height(150);
vis.add(pv.Panel)
  .data([1, 1.2, 1.7, 1.5, .7, .3]) .left(function() this.index * 25)
  .add(pv.Bar).width(20) .bottom(0)
  .height(function(d) d * 80)
  .anchor(&quot;top&quot;).add(pv.Label)
vis.render();</pre>
</td>
<td><a href="http://www.jeromecukier.net/wp-content/uploads/2011/02/part4.png"><img src="http://www.jeromecukier.net/wp-content/uploads/2011/02/part4.png" alt="" title="part4" width="154" height="154" class="aligncenter size-full wp-image-488" /></a></td>
</tr>
</table>
<p>Here, I’m adding panels, then a bar in each panel.<br />
From the root panel, I’m adding a group of panel with this data: [1, 1.2, 1.7, 1.5, .7, .3].<br />
Since there are 6 elements here, I’m adding 6 panels.<br />
Here, the left method applies to each of the panel. The first one is to the left, the next one is 25 pixels further, etc.<br />
I’m then adding a bar object to each panel. Is that one group of bar? Technically yes, but each has only one element! Each pv.Bar <em>implicitly</em> gets the data element of its parent, so the first bar gets [1], the next one gets [1.2], etc. The height of each bar is determined by multiplying the value of that element by 80.<br />
Note that since the fillStyle properties are not defined for the bars, they get the ones which are attributed by default, which explains the color changes.</p>
<p>Further refinement: accessing the data of its parent!</p>
<table>
<tr>
<td>
<pre class="brush: jscript; highlight: [5]; title: ; notranslate" title="">
var vis = new pv.Panel().width(150).height(150);
vis.add(pv.Panel)
  .data([1, 1.2, 1.7, 1.5, .7, .3]) .left(function() this.index * 25)
  .add(pv.Bar).width(20) .bottom(0)
  .height(function(a,b) b * 80)
  .anchor(&quot;top&quot;).add(pv.Label)
vis.render();
</pre>
</td>
<td><a href="http://www.jeromecukier.net/wp-content/uploads/2011/02/part4.png"><img src="http://www.jeromecukier.net/wp-content/uploads/2011/02/part4.png" alt="" title="part4" width="154" height="154" class="aligncenter size-full wp-image-488" /></a></td>
</tr>
</table>
<p>Well, the output is exactly the same, but how I obtained the data is different. Instead of getting the data using the standard accessor function, I passed two arguments: function(a, b).<br />
What this does is that the first argument corresponds to the current data element of this object, and the second, to that of its parent.</p>
<p>In this example, they happen to be the same, but this is how you can access the data of the parent objects.</p>
<h2>Putting it all together</h2>
<p>Let&#8217;s see how we can use protovis and the properties of hierarchy! This example is less trivial than the ones we&#8217;ve seen so far but with what we&#8217;ve seen it is quite accessible.<br />
The challenge: re-create <a href="http://eagereyes.org/communication/Engaging-readers-with-square-pie-waffle-charts.html">square pie charts</a>.<br />
How it&#8217;s done: </p>
<pre class="brush: jscript; title: ; notranslate" title="">var data=[36,78,63,24],  // arbitrary numbers
cellSize = 16,
cellPadding = 1,
squarePadding=5,
colors=pv.Colors.category20().range()
;

var vis=new pv.Panel()
    .width(4*(10*cellSize+squarePadding))
    .height(10*cellSize)
    ;

var square = vis.add(pv.Panel)
    .data(data)
    .width(10*cellSize)
    .height(10*cellSize)
    .left(function() this.index*(cellSize*10+squarePadding))
    ;

var row = square.add(pv.Panel)
	.data([0,1,2,3,4,5,6,7,8,9])
	.height(cellSize)
	.bottom(function(d) d*cellSize)
	;

var cell = row.add(pv.Panel)
    .data([0,1,2,3,4,5,6,7,8,9])
    .height(cellSize-2*cellPadding)
    .width(cellSize-2*cellPadding)
    .top(cellPadding)
    .left(function(d) d*cellSize+cellPadding)
    .fillStyle(function(a,b,c) (b*10+a)&lt;c?colors[this.parent.parent.index].color:&quot;lightGrey&quot;)
;

square.anchor(&quot;center&quot;)
  .add(pv.Label)
    .text(function(d) d)
    .textStyle(&quot;rgba(0,0,0,.1)&quot;)
    .font(&quot;100px sans-serif&quot;);

vis.render();</pre>
<p>First, we initiate the data (4 arbitrary numbers from 1 to 100), and various parameters which will help size the square pie &#8211; size of the cells, space between them, space between the square pie charts. We also initiate a color palette.<br />
Then, we are going to create 4 panels or groups of panels, each a child of the previous one.<br />
First comes the <strong>vis</strong> panel, which groups everything,<br />
Then the <strong>square </strong>panels, which correspond to each square pie. This is to this panel that our data is assigned.<br />
Then come the <strong>row </strong>panels, and, finally, the <strong>cell </strong>panels.<br />
The numbers which we want to represent are assigned to the square panel. So, what data are we passing to the row and the cell panels? The only thing we want is to have 10 rows and 10 cells per row. So, we can use an array with 10 items. We are going to use [0,1,2,3,4,5,6,7,8,9] so the data value of the row and that of the cell will correspond to the coordinate of the row and the cell, respectively. In other words, the 5th row will be assigned the data value of 4, and the 7th cell in that row will get the data value of 6. We could retrieve the same numbers using &#8220;this.index&#8221; but this can lead to obfuscated formulas.</p>
<p>Note that in the next part of the tutorial, we&#8217;ll see that in Protovis, there is a more elegant way to write [0,1,2,3,4,5,6,7,8,9] or similar series of numbers. But, we&#8217;ll leave this more explicit form for now.</p>
<p>Back to our row panel. We position it with bottom(function(d) d*cellSize). Here, again, d represents the rank of the row, so the 1st row will get 0, and its bottom value will be 0, the next row will get 1, and its bottom value will be 1*cellSize or 16, etc. </p>
<p>Likewise, in the cell panel, the cells are positioned with left(function(d) d*cellSize+cellPadding). This is the same principle. (here, cellPadding is just used to fine-tune the position of the cell).</p>
<p>This is in the final line that we are really going to use hierarchy.</p>
<pre class="brush: jscript; title: ; notranslate" title="">.fillStyle(function(a,b,c) (b*10+a)&lt;c?colors[this.parent.parent.index].color:&quot;lightGrey&quot;)</pre>
<p>here, a represents the data value of the cell &#8211; in other words, the column number.<br />
b, the data value of the cell&#8217;s parent, the row. This is the row number.<br />
and c is the data value of the parent of the parent of the row, the square &#8211; this is the number that we are trying to represent.</p>
<p>so, what we are going to determine is whether b*10+a&lt;c. If that&#8217;s the case, we color the cell, else, we leave it in pale grey. To get the color we need, we go back to the palette that we defined at the beginning, and take the color corresponding to the square number (0 to 3 from left to right).<br />
The square number can be obtained by this.parent.parent.index.</p>
<p>Finally, we add the numbers in large transparent gray digits on top of the squares.</p>
<p>Here is the result:<br />
<a href="http://www.jeromecukier.net/wp-content/uploads/2011/02/squarePies.png"><img src="http://www.jeromecukier.net/wp-content/uploads/2011/02/squarePies.png" alt="" title="squarePies" width="660" height="160" class="aligncenter size-full wp-image-559" /></a></p>
<p>Next: <a href="http://www.jeromecukier.net/?p=49">Javascript and protovis array functions</a></p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-429" class="post-429 post type-post status-publish format-standard hentry category-data-visualization category-protovis category-tips tag-arrays tag-data tag-protovis tag-tutorial">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2011/02/07/working-with-data-in-protovis-part-1-of-5/" rel="bookmark"><time class="entry-date published" datetime="2011-02-07T19:41:46+00:00">February 7, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/protovis/" rel="category tag">protovis</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2011/02/07/working-with-data-in-protovis-part-1-of-5/" rel="bookmark">Working with data in protovis &#8211; part 1 of 5</a></h1>
         
    </header>
	<section class="post-content">

		<p>When I started using <a href="http://www.protovis.org/">protovis </a>I had only a very basic knowledge of javascript, which in theory isn’t a problem as protovis is meant to be learned by example, and as it has its own logic and structure which is different from typical javascript code. So I started by looking and modifying examples which was enough to do basic stuff.<br />
But I soon felt limited by what hid behind a single property: <strong>data</strong>. I knew that protovis had lots of features to manipulate and process data but they were not obvious from the examples.</p>
<p>I mean,</p>
<table border="0" cellpadding="0" width="640">
<tbody>
<tr>
<td>
<pre class="brush: jscript; title: ; notranslate" title="">var vis = new pv.Panel()
.width(150)
.height(150);

vis.add(pv.Bar)
.data([1, 1.2, 1.7, 1.5, .7, .3])
.width(20)
.height(function(d) d * 80)

vis.render();</pre>
</td>
<td><a href="http://www.jeromecukier.net/wp-content/uploads/2011/01/basic-example1.png"><img class="aligncenter size-full wp-image-433" title="basic example" src="http://www.jeromecukier.net/wp-content/uploads/2011/01/basic-example1.png" alt="" width="150" height="150" /></a></td>
</tr>
</tbody>
</table>
<p>Here, it’s pretty obvious that the bars represent the values 1, 1.2, 1.7, 1.5, 0.7 and 0.3 respectively. One can infer that the sizes of bars are 25 pixels wide and 80 times their value long.</p>
<p>But protovis doesn’t usually look like this “hello world” kind of example, but rather like this:</p>
<pre class="brush: jscript; title: ; notranslate" title="">
/* Compute yield medians by site and by variety. */
function median(data) pv.median(data, function(d) d.yield);
var site = pv.nest(barley).key(function(d) d.site).rollup(median);
var variety = pv.nest(barley).key(function(d) d.variety).rollup(median);
/* Nest yields data by site then year. */
barley = pv.nest(barley)
    .key(function(d) d.site)
    .sortKeys(function(a, b) site[b] - site[a])
    .key(function(d) d.year)
    .sortValues(function(a, b) variety[b.variety] - variety[a.variety])
    .entries();
[. . .]
/* A panel per site-year. */
var cell = vis.add(pv.Panel)
    .data(barley)
    .height(h)
    .top(function() this.index * h)
    .strokeStyle(&quot;#999&quot;);</pre>
<p>What just happened? <a href="http://vis.stanford.edu/protovis/jsdoc/symbols/pv.Nest.html">pv.nest</a>, key, rollup, sortKeys, entries – what could that do?</p>
<p>To go beyond merely touching up examples, and do your own visualizations from scratch, it is important to get a good grip on how to feed protovis with data. In order to do so, you need a few javascript notions.</p>
<h2>Arrays, arrays, how do they work?</h2>
<p>In javascript, an array is an ordered list of stuff.</p>
<p>In our initial example, we had one such list:</p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">[1, 1.2, 1.7, 1.5, .7, .3]</pre>
<p>Anything can be put in an array: numbers, strings, Booleans (true/false values), objects … including other arrays. All elements of an array don’t have to be of the same type. Arrays can be assigned to a variable.</p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">var a = [1, 1.2, 1.7, 1.5, .7, .3];</pre>
<p>Elements of the array can be accessed using the [] notation. In javascript, indices start at 0, so the first element of an array can be obtained so:</p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">a[0];</pre>
<p>This returns 1. Javascript has many functions to create and manipulate arrays, which we will talk about later. For the time being, let’s look at arrays of arrays. If we wrote instead:</p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">var a = [[1, 1.2], [1.7, 1.5], [.7, .3]];</pre>
<p>a is now an array of arrays, or “multi-dimensional array”.</p>
<p>a[0] is now worth [1, 1.2]. To access the first number of the array, one has to write a[0][0], which will return the first element (1) of the first element ([1, 1.2]) of a.</p>
<p>Javascript also has another type of array called associative arrays, where values are assigned to keys instead of an index. For instance,</p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">var a = {yield: 27.00000, variety: &quot;Manchuria&quot;, year: 1931, site: &quot;University Farm&quot;};</pre>
<p>is an associative array. To access a value, one can use a . operator:</p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">a.yield</pre>
<p>will retun 27.</p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">a[&quot;yield&quot;]</pre>
<p>also works.</p>
<p>Like other variable types, it is possible to have an array of associative arrays. In fact, this is used quite often in protovis.</p>
<h2>Protovis and arrays – deconstructing the first example</h2>
<p>The reason why I introduced javascript arrays is that the data property <span style="text-decoration: underline;">requires an array</span>. Protovis then loops through that array, performing operations on each of its elements. To that end, it uses things such as accessor functions and properties of an object called this.</p>
<p>To explain all of this let’s go back to the first example and analyse it line by line.</p>
<pre class="brush: jscript; title: ; notranslate" title="">var vis = new pv.Panel()
  .width(150)
  .height(150);
vis.add(pv.Bar)
  .data([1, 1.2, 1.7, 1.5, .7, .3])
  .width(20)
  .bottom(0)
  .height(function(d) d * 80)
  .left(function() this.index * 25);
vis.render();</pre>
<p>The first 3 lines create a panel, which is like the sheet of paper on which protovis will draw the chart. Its width and height properties must be filled, as they are 0 by default which would make the whole visualization invisible.</p>
<p>The next line adds a bar chart to this panel we’ve just created.</p>
<p>The line after specifies the data on which to work: here comes our array. Here, we have written the array literally in the data property, but nothing prevents us to assign it to a variable first and to pass the variable instead.</p>
<p>The next line, and the line with the bottom property, assign constant numbers to these properties. It means that all the bars will have a width of 20 pixels, and they will all be aligned with the bottom of the panel – that’s what</p>
<pre class="brush: jscript; first-line: 7; title: ; notranslate" title="">bottom(0)</pre>
<p>does.</p>
<p>Now let’s look at the two remaining lines:</p>
<pre class="brush: jscript; first-line: 8; title: ; notranslate" title="">.height(function(d) d * 80)
.left(function() this.index * 25);</pre>
<p>The first line uses an accessor function. What this does is that it looks at the current element, and perform an operation on it, the result of which will be the height of that element.</p>
<p>In proper javascript, we would have written:</p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">function(d) {return d*80;}</pre>
<p>but protovis uses a shorthand notation that allows us to omit curly braces and the return statement. By the way, d in the function is completely arbitrary, and could be any variable name –</p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">function(a) a*80</pre>
<p>also works. It’s just that the name of the variable between parentheses will represent the value of the current element.</p>
<p>The second line uses the this object. this represents what protovis is working on at the moment, and it has properties that can be used. The most commonly used is index: this.index returns the position of the current element in its array, so it is going to be: 0 for the first bar, 1 for the next one, etc.</p>
<p>So this line specifies that each new bar should start every 25 pixels from the left border of the panel.</p>
<p>You may wonder, why not write</p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">.left(this.index * 25);</pre>
<p>and omit the function()? Well, function() means that the content of the property gets re-evaluated. If we had omitted it, this.index * 25 would have been computed once (for a result of 0) and that value would have been used for all the bars.</p>
<p>By the way, instead of writing the height property as it is, we could have written:</p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">.height(function()[1, 1.2, 1.7, 1.5, .7, .3][this.index] * 80)</pre>
<p>Using an accessor function is shorter and clearer.</p>
<p>Next: <a href="http://www.jeromecukier.net/?p=479">Multi-dimensional arrays, inheritance and hierarchy</a></p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-426" class="post-426 post type-post status-publish format-standard hentry category-uncategorized">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2011/02/07/working-with-data-in-protovis/" rel="bookmark"><time class="entry-date published" datetime="2011-02-07T19:31:44+00:00">February 7, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/uncategorized/" rel="category tag">Uncategorized</a>			</span>
		        <h1 class="post-title"><a href="/2011/02/07/working-with-data-in-protovis/" rel="bookmark">Working with data in protovis</a></h1>
         
    </header>
	<section class="post-content">

		<p>For the past year or so I have been dabbling with <a href="http://www.protovis.org/">protovis</a>. I don&#8217;t have a heavy CS background but protovis is supposedly easy to pick up for people like me, who are vaguely aware that computers can make calculations but who need to check the manual for the most mundane programming instructions.</p>
<p>I found was while it&#8217;s reasonnably easy to modify the most basic examples to make stuff happen, it is much harder to understand or adapt the more complex ones, let alone to create a fairly complex visualization.</p>
<p>The stumbling block for me was the use of the method <strong>data</strong>. Data is used to feed all the other protovis methods with, well, data. In the simplest examples, the data which is passed is very plain and simple and so easy to understand. But, for slightly more advanced uses, the shape of data is increasingly complex and the very powerful methods that protovis uses to process and reshape data are just out of reach for a noob.</p>
<p>So I started documenting my struggle with data, first for my own use, and eventually realized I could share what I learned. This is it.</p>
<p>I split this tutorial in 5 parts.</p>
<ol>
<li>First, we&#8217;ll look at the humble <a href="http://www.jeromecukier.net/?p=429">arrays</a> and how protovis works with them.</li>
<li>Then, we&#8217;ll talk about <a href="http://www.jeromecukier.net/?p=479">multi-dimensional arrays, associative arrays, hierarchy and inheritance</a>.</li>
<li>Third, we&#8217;ll take a break from protovis and look at the <a href="http://www.jeromecukier.net/?p=494">javascript methods to work with arrays</a>, such as sorting.</li>
<li>[update] Since I first published the array part I wrote a <a href="http://www.jeromecukier.net/?p=699">supplement</a></li>
<li>We&#8217;ll then check out the powerful <a href="http://www.jeromecukier.net/?p=502">protovis data processing methods</a>, such as those who reshape complex arrays.</li>
<li>Finally, we&#8217;ll see how data must be prepared to work with the <a href="http://www.jeromecukier.net/?p=623">built-in layouts</a>, such as treemaps, force-directed layouts etc.</li>
</ol>
<p>And as a bonus, I have also deconstructed several interesting (but not immediately accessible) examples from the gallery:</p>
<ul>
<li><a href="http://www.jeromecukier.net/?p=534">Becker&#8217;s Barley</a></li>
<li><a href="http://www.jeromecukier.net/?p=573">Map projections</a></li>
</ul>
<p>To make the best use of this material, it would be helpful to know a bit about <a href="http://www.protovis.org/">protovis</a>. The best ways to get started are:</p>
<ul>
<li>The protovis documentation. First, the <a href="http://vis.stanford.edu/protovis/docs/start.html">tutorial</a>, then the thematic <a href="http://vis.stanford.edu/protovis/docs/">overviews</a>.</li>
<li><a href="http://www.eagereyes.org/">Eagereyes&#8217;s</a> protovis primer: <a href="http://eagereyes.org/tutorials/protovis-primer-part-1">part 1</a>, <a href="http://eagereyes.org/tutorials/protovis-primer-part-2">part 2</a>, <a href="http://eagereyes.org/tutorials/protovis-primer-part-3">part 3</a>.</li>
<li>Len de Groot&#8217;s protovis <a href="http://www.google.com/url?sa=D&amp;q=http://multimedia.journalism.berkeley.edu/media/upload/tutorials/protovis/protovis-cheat-sheet.pdf">cheat sheet</a>, which may not get you started but which will keep you going.</li>
</ul>
<p>Now that&#8217;s said, en route for the 1st part!</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-449" class="post-449 post type-post status-publish format-standard hentry category-charts category-data-visualization tag-education tag-good tag-protovis tag-scatterplot">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2011/01/29/are-the-richest-americans-the-best-educated/" rel="bookmark"><time class="entry-date published" datetime="2011-01-29T01:38:34+00:00">January 29, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/charts/" rel="category tag">charts</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>			</span>
		        <h1 class="post-title"><a href="/2011/01/29/are-the-richest-americans-the-best-educated/" rel="bookmark">Are the richest Americans the best educated?</a></h1>
         
    </header>
	<section class="post-content">

		This all started from <a href="http://awesome.good.is/transparency/web/1101/census-data/flat.html">this map</a> from GOOD magazine. It went viral on Twitter, which puzzled the data vis community. <a href="http://well-formed-data.net/">Moritz Stefaner</a> notably asked others for advice and input, and <a href="http://www.visualisingdata.com/index.php/2011/01/discussing-are-the-richest-americans-also-the-best-educated/">Andy Kirk</a>, then <a href="http://fellinlovewithdata.com/reflections/demystifying-cargo-cult-visualization-you-cannot-visualize-3-variables-by-mixing-3-colors">Enrico Bertini</a> answered in some detail. <a href="/2011/01/29/are-the-richest-americans-the-best-educated/#more-449" class="more-link">&hellip;&nbsp;<span class="meta-nav">&rarr;</span></a>	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-420" class="post-420 post type-post status-publish format-standard hentry category-uncategorized tag-conference tag-ieee tag-infovis tag-salt-lake-city tag-vast tag-vis tag-visweek">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2010/11/04/visweek-2010-the-one-minute-edition/" rel="bookmark"><time class="entry-date published" datetime="2010-11-04T17:19:46+00:00">November 4, 2010</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/uncategorized/" rel="category tag">Uncategorized</a>			</span>
		        <h1 class="post-title"><a href="/2010/11/04/visweek-2010-the-one-minute-edition/" rel="bookmark">VisWeek 2010: the one-minute edition.</a></h1>
         
    </header>
	<section class="post-content">

		<div id="__ss_5667704" style="width: 425px;"><strong><a title="Vis week 2010" href="http://www.slideshare.net/vozome/vis-week-2010-5667704">Vis week 2010</a></strong><object id="__sse5667704" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="425" height="355" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="allowFullScreen" value="true" /><param name="allowScriptAccess" value="always" /><param name="src" value="http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=visweek2010-101104100223-phpapp01&amp;stripped_title=vis-week-2010-5667704&amp;userName=vozome" /><param name="name" value="__sse5667704" /><param name="allowfullscreen" value="true" /><embed id="__sse5667704" type="application/x-shockwave-flash" width="425" height="355" src="http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=visweek2010-101104100223-phpapp01&amp;stripped_title=vis-week-2010-5667704&amp;userName=vozome" name="__sse5667704" allowscriptaccess="always" allowfullscreen="true"></embed></object></p>
<div style="padding:5px 0 12px">View more <a href="http://www.slideshare.net/">presentations</a> from <a href="http://www.slideshare.net/vozome">Jérôme Cukier</a>.</div>
</div>
<p><a href="http://vis.computer.org/VisWeek2010/">Visweek 2010</a> is just over.</p>
<p>With lectures and presentations going on in up to 4  rooms simultaneously for 6 straight and very full days, it&#8217;s impossible to see everything let alone to describe it. And even that would be ignoring all exchanges and social interactions which are precisely the point of visweek.</p>
<p>So instead, I&#8217;m showing what I liked best,  one image per day.</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-410" class="post-410 post type-post status-publish format-standard hentry category-charts category-data-visualization tag-aid tag-chart tag-extreme-charts tag-illegible-charts tag-pie-charts">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2010/04/21/there-are-virtues-to-an-illegible-chart/" rel="bookmark"><time class="entry-date published" datetime="2010-04-21T18:54:12+00:00">April 21, 2010</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/charts/" rel="category tag">charts</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>			</span>
		        <h1 class="post-title"><a href="/2010/04/21/there-are-virtues-to-an-illegible-chart/" rel="bookmark">There are virtues to an illegible chart</a></h1>
         
    </header>
	<section class="post-content">

		<h2>It all started with an extreme pie chart</h2>
<p>A few weeks back, there&#8217;s been a <a href="http://aidwatchers.com/2010/03/worst-in-aid-the-grand-prize/">chart on aid</a> who&#8217;s made the rounds of the internet:</p>
<p><div id="attachment_411" style="width: 460px" class="wp-caption aligncenter"><a href="http://www.jeromecukier.net/wp-content/uploads/2010/04/US_aid_graph4501.png"><img class="size-full wp-image-411" title="All US ODA by recipient, 2004-2008, OECD data" src="http://www.jeromecukier.net/wp-content/uploads/2010/04/US_aid_graph4501.png" alt="" width="450" height="309" /></a><p class="wp-caption-text">All US ODA by recipient, 2004-2008, OECD data, taken from USAidWatchers.com</p></div>
<p>What this chart shows is that US aid is concentrated in a few countries. The <a href="http://aidwatchers.com/2010/03/worst-in-aid-the-grand-prize/">article explains that this is a result of the 3D doctrine</a>, which ties development with diplomacy and defense. This is why US gives so much to strategic countries like Afghanistan, Iraq, or Sudan, but relatively little to India &#8211; highlighted in the chart, which has &#8220;a huge chunk of the world&#8217;s poor&#8221;.</p>
<p>When I saw that chart I was planning to create a chart or a data visualization <a href="https://community.oecd.org/community/factblog/blog/2010/04/16/aid-for-fragile-states">on the same subject for my work</a>. The original chart was being heavily criticized for its form, because half of it is not legible. Chart purists don&#8217;t like pie charts for that very reason &#8211; they are difficult to read, especially if you add more items. But I found the chart interesting. It states in a very striking way that more than a hundred countries in the world get next to nothing from the USA.</p>
<h2>An apology of  extreme charts</h2>
<p><strong>There are virtues to an illegible chart</strong>. In fact, I don&#8217;t believe that a chart should give equal prominence to each and every of its datapoints. <strong>In most cases</strong>, it&#8217;s here to support a story, so <strong>all it should do is bear a message</strong>. Tufte popularized the notion of <a href="http://www.infovis-wiki.net/index.php/Data-Ink_Ratio">data-ink ratio</a>, which states that a chart designer should use the largest share of ink to represent data, not everything else. I feel this is taken too literally by many.</p>
<p>There is a tradition of <em>extreme charts</em> which purposely break presentation rules because of the very nature of the subject they are plotting. A famous example is Al Gore on his lift &#8211; if CO2 emissions hadn&#8217;t increased so much, he wouldn&#8217;t need that lift to show his chart.</p>
<p> </p>
<p><div id="attachment_412" style="width: 310px" class="wp-caption aligncenter"><a href="http://www.jeromecukier.net/wp-content/uploads/2010/04/blog_inconvenient_truth.jpg"><img class="size-medium wp-image-412" title="blog_inconvenient_truth" src="http://www.jeromecukier.net/wp-content/uploads/2010/04/blog_inconvenient_truth-300x200.jpg" alt="" width="300" height="200" /></a><p class="wp-caption-text">Al Gore on his lift, the most memorable image of An Inconvenient Truth</p></div>
<p>Another one &#8211; from the NY Times, one of the charts that Matthew Ericson showed in his <a href="http://www.ericson.net/content/2007/10/infovis/">Infovis 2007 keynote speech:</a></p>
<p><div id="attachment_413" style="width: 393px" class="wp-caption aligncenter"><a href="http://www.jeromecukier.net/wp-content/uploads/2010/04/NYTcasualties.png"><img class="size-large wp-image-413" title="NYTcasualties" src="http://www.jeromecukier.net/wp-content/uploads/2010/04/NYTcasualties-639x1024.png" alt="In perspective: America's conflicts. NY Times" width="383" height="614" /></a><p class="wp-caption-text">Click to see the full image - it is big. I really like this chart.</p></div>
<p style="text-align: left;">Again, if the number of US soldiers killed per month had not been so high in WWII, the 2nd group of bars wouldn&#8217;t overwrite the text above and sky-rocket to the top of the page. The logical thing to do would have been to scale the chart so that the maximum values would fit in a well-delimited space, and maybe use a logarithmic scale so that the values for other wars would remain legible. That&#8217;s how we would have done it if we had to plot that kind of series in an OECD book. The fact that the NYT designers chose, on the contrary, to let the data rise all the way to the top of  the page expresses in a very powerful way the extreme nature of the WWII casualties.</p>
<p style="text-align: left;">&#8220;A conventional chart couldn&#8217;t hold all that horror&#8221;, the chart seems to say. Likewise, if CO2 emissions had grown more steadily over the past couple of centuries, Al Gore wouldn&#8217;t have needed a lift. By the same token, if aid values to about 100 countries were more than negligible, they could be seen on that chart. So granted, there could be more academic ways to show that, like a giant bar chart with values too small to see for all but a handful of states. But all in all I think <strong>the original pie chart does a good job</strong> in communicating that in a nutshell,  <em>ad absurdum</em> if you will.</p>
<h2>My take on the chart</h2>
<p style="text-align: left;">I wanted to work on a specific subset of aid data, that which goes to fragile states, which are, simply put, the 43 countries in the greatest need of aid. Now official aid from developed countries, like US aid, is very concentrated, meaning that only 10 of these countries got more than $1b in 2008. Only 10 countries got more than $100 per capita in that year.</p>
<p style="text-align: left;">Another interesting aspect of the data is that for many of these countries, aid only mostly from one or two donors, so they are vulnerable to a policy change in that country. That&#8217;s what I wanted to show in the representation.</p>
<p> </p>
<p> </p>
<p><script type="text/javascript" src="http://public.tableausoftware.com/javascripts/api/viz_v1.js"></script><object class="tableauViz" width="654" height="918" style="display:none;"><param name="name" value="fragilestates/dash" /><param name="toolbar" value="yes" /></object><noscript>dash <br /><a href="#"><img alt="dash " src="http://public.tableausoftware.com/static/images/fragilestates-dash_rss.png" height="100%" /></a></noscript>
<div style="width:654px;height:22px;padding:0px 10px 0px 0px; margin-top: -6px; color:black;font:normal 8pt verdana,helvetica,arial,sans-serif;">
<div style="padding-left: 538px;"><a href="http://www.tableausoftware.com/public?ref=http://public.tableausoftware.com/views/fragilestates/dash" target="_blank">Powered by Tableau</a></div>
</div>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-397" class="post-397 post type-post status-publish format-standard hentry category-uncategorized">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2010/04/04/playing-with-tableau-contest-datasets/" rel="bookmark"><time class="entry-date published" datetime="2010-04-04T21:05:45+00:00">April 4, 2010</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/uncategorized/" rel="category tag">Uncategorized</a>			</span>
		        <h1 class="post-title"><a href="/2010/04/04/playing-with-tableau-contest-datasets/" rel="bookmark">Playing with Tableau contest datasets</a></h1>
         
    </header>
	<section class="post-content">

		<p>I&#8217;ve played a bit with the other 3 datasets of the Tableau Public contest. When I get to see what others have done, it will be easier to take something from that after having manipulated them. The one I&#8217;ve spent most time with is the US budget spending one. Here&#8217;s the sheet I came up with:</p>
<p><script type="text/javascript" src="http://public.tableausoftware.com/javascripts/api/viz_v1.js"></script><object class="tableauViz" width="804" height="920" style="display:none;"><param name="name" value="contest2/Sheet2" /><param name="toolbar" value="yes" /></object><noscript>Sheet 2 <br /><a href="#"><img alt="Sheet 2 " src="http://public.tableausoftware.com/static/images/contest2-Sheet2_rss.png" height="100%" /></a></noscript>
<div style="width:804px;height:22px;padding:0px 10px 0px 0px; margin-top: -6px; color:black;font:normal 8pt verdana,helvetica,arial,sans-serif;">
<div style="padding-left: 688px;"><a href="http://www.tableausoftware.com/public?ref=http://public.tableausoftware.com/views/contest2/Sheet2" target="_blank">Powered by Tableau</a></div>
</div>
<p>(if the viz doesn&#8217;t show in the blog, here&#8217;s the <a href="http://public.tableausoftware.com/views/contest2/Sheet2">direct link</a>)</p>
<p>a few explanations:</p>
<h3>Unit: % of GDP</h3>
<p>The dataset covers almost 40 years, and includes a notion of inflation. But even with that it&#8217;s too difficult to compare spending over time. Instead of trying to convert everything to 2009 constant dollars, it&#8217;s easier (and it makes more sense) to compare everything as percentage of GDP.</p>
<h3>Filter: by function</h3>
<p>The original dataset lists over 30 departments. I don&#8217;t think they are immediately comparable as is, some being much bigger than others. Besides, it&#8217;s just too complicated to ask people to choose between 30 items to make comparisons. So, instead, I grouped several departments by function, as defined by the COFOG (classifications of functions of government, a UN classification). To be honest I wasn&#8217;t extra careful when I assigned some departments to a function, for instance Veteran Affairs could have been assigned to Defense or to Social Protection (I chose the latter).  But the assignments are fair. The added bonus is that using functions enables us to make international comparisons:</p>
<h3>Comparing with OECD values</h3>
<p>Not too long ago I made a <a href="https://community.oecd.org/community/factblog/blog/2009/12/03/where-your-money-goes">chart </a>comparing OECD countries&#8217; budget expenditures. So what I didn&#8217;t like about this dataset is that it didn&#8217;t give a way to determine whether US spendings in such or such area were high or low. From the dataset proper, one can tell that, for instance, that social protection expenses were never as high as in 2009. But are they really &#8220;high&#8221;? Or &#8211; defense expenditure were at an all-time low in 1999. But were they really low?</p>
<p>Comparing with other values help answer those questions. To continue on these 2 examples, social protection expenditure, in 2009, was 7.2% &#8211; a much higher share than in 1965 (3.9%) but still very low compared to OECD countries &#8211; the average being 15.2%. Conversely, defense, in 1999, only represented 3.1% of GDP &#8211; it was as high as 9% during Viet-Nam, and it&#8217;s almost 5% today. Meanwhile, the OECD average is 1.4%.</p>
<p>Again, that comparison is not very scientific, because the <a href="http://dx.doi.org/10.1787/723501646741">numbers used for those OECD averages</a> include other levels of government (states, cities&#8230;) which are not included here. But still, they help putting the dataset in the context.</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-389" class="post-389 post type-post status-publish format-standard hentry category-uncategorized">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2010/03/29/tableau-contest-additional-views/" rel="bookmark"><time class="entry-date published" datetime="2010-03-29T17:07:28+00:00">March 29, 2010</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/uncategorized/" rel="category tag">Uncategorized</a>			</span>
		        <h1 class="post-title"><a href="/2010/03/29/tableau-contest-additional-views/" rel="bookmark">Tableau contest, additional views</a></h1>
         
    </header>
	<section class="post-content">

		<p>For the tableau contest, I had prepared many other views which I didn&#8217;t include in the final dashboard. Here&#8217;s a couple: </p>
<p><script type="text/javascript" src="http://public.tableausoftware.com/javascripts/api/viz_v1.js"></script><object class="tableauViz" width="804" height="669" style="display:none;"><param name="name" value="contest/Residualobesitymap" /><param name="toolbar" value="yes" /></object><noscript>Residual obesity map <br /><a href="#"><img alt="Residual obesity map " src="http://public.tableausoftware.com/static/images/contest-Residualobesitymap_rss.png" height="100%" /></a></noscript>
<div style="width:804px;height:22px;padding:0px 10px 0px 0px; margin-top: -6px; color:black;font:normal 8pt verdana,helvetica,arial,sans-serif;">
<div style="padding-left: 688px;"><a href="http://www.tableausoftware.com/public?ref=http://public.tableausoftware.com/views/contest/Residualobesitymap" target="_blank">Powered by Tableau</a></div>
</div>
<p>This here is the number of points in the adult obesity rates which are not explained by the median income of the county. In other words, marks that appear very green are counties where people are less obese than counties with similar incomes, and conversely, red marks show counties where obesity is more widespread than expected by income alone.<br />
This suggests that there could be some cultural/regional explanations to the health situation. People in the mountains area, especially Colorado, show as very green, while people in the old South are very red. Mid West and North West are average, New England and Florida tend to be better than average. Yesterday, there was a show on French TV calling Houston the fat capital of the USA, explaining that by cultural reasons. But the fact is, obesity rates in Harris county are lower than average, and on this map the corresponding mark is green,  showing that factors other than income play a positive, not negative role. I love it when facts and numbers get in the way of a nice story.</p>
<p><script type="text/javascript" src="http://public.tableausoftware.com/javascripts/api/viz_v1.js"></script><object class="tableauViz" width="804" height="669" style="display:none;"><param name="name" value="contest/Sheet9" /><param name="toolbar" value="yes" /></object><noscript>Sheet 9 <br /><a href="#"><img alt="Sheet 9 " src="http://public.tableausoftware.com/static/images/contest-Sheet9_rss.png" height="100%" /></a></noscript>
<div style="width:804px;height:22px;padding:0px 10px 0px 0px; margin-top: -6px; color:black;font:normal 8pt verdana,helvetica,arial,sans-serif;">
<div style="padding-left: 688px;"><a href="http://www.tableausoftware.com/public?ref=http://public.tableausoftware.com/views/contest/Sheet9" target="_blank">Powered by Tableau</a></div>
</div>
<p>and this is put together, say, just for aesthetic purposes. it categorizes counties by their median income (in increments of 1000$, X-axis) and their obesity rates (by chunks of 0.5%, Y-axis) and plots the total population of the counties that fill both criteria. Then again, it doesn&#8217;t show the actual number of people who are in a specific income and obesity bracket, it just adds the population of whole counties. </p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				<nav class="pagination navigation paging-navigation" role="navigation">
		<div class="nav-links">
						<div class="older-posts"><a href="/author/jerome/page/10/" >Older Posts <span class="meta-nav">&rarr;</span></a></div>
							<div class="page-number">Page 9 of 12</div>
						<div class="newer-posts"><a href="/author/jerome/page/8/" ><span class="meta-nav">&larr;</span> Newer Posts</a></div>
			
		</div><!-- .nav-links -->
	</nav><!-- .navigation -->
	
		
		</main><!-- #main -->
	</section><!-- #primary -->

	<div id="secondary" class="widget-area" role="complementary">
		<aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form></aside>		<aside id="recent-posts-2" class="widget widget_recent_entries">		<h1 class="widget-title">Recent Posts</h1>		<ul>
					<li>
				<a href="/2018/04/09/hello-world/">Hello world!</a>
						</li>
					<li>
				<a href="/2016/08/17/the-big-leagues/">The big leagues</a>
						</li>
					<li>
				<a href="/2016/08/17/creating-a-react-visualization-web-app/">Creating a React visualization web app</a>
						</li>
					<li>
				<a href="/2016/08/13/beyond-rendering/">Beyond rendering</a>
						</li>
					<li>
				<a href="/2016/08/11/react-components/">React components</a>
						</li>
				</ul>
		</aside>		<aside id="recent-comments-2" class="widget widget_recent_comments"><h1 class="widget-title">Recent Comments</h1><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link"><a href='https://wordpress.org/' rel='external nofollow' class='url'>A WordPress Commenter</a></span> on <a href="/2018/04/09/hello-world/#comment-1">Hello world!</a></li><li class="recentcomments"><span class="comment-author-link"><a href='http://omeraz.wordpress.com/' rel='external nofollow' class='url'>עומר עזריאל</a></span> on <a href="/2016/08/17/the-big-leagues/#comment-567">The big leagues</a></li><li class="recentcomments"><span class="comment-author-link">Carlos Ayres</span> on <a href="/2012/05/28/manipulating-data-like-a-boss-with-d3/#comment-312">Manipulating data like a boss with d3</a></li><li class="recentcomments"><span class="comment-author-link"><a href='https://migrate.powertripanalytics.com/game-of-thrones-interactions-among-the-top-30-characters/' rel='external nofollow' class='url'>Game of ThronesInteractions Among the Top 30 Characters &#8211; PowerTrip Analytics</a></span> on <a href="/2013/05/13/making-the-game-of-thrones-visualization/#comment-466">Making the game of thrones visualization</a></li><li class="recentcomments"><span class="comment-author-link"><a href='https://abgoswam.wordpress.com/2016/10/08/d3-getting-started/' rel='external nofollow' class='url'>D3 &#8211; Getting Started | abgoswam&#039;s tech blog</a></span> on <a href="/2012/09/04/getting-to-hello-world-with-d3/#comment-419">Getting to &#8220;Hello world&#8221; with d3</a></li></ul></aside><aside id="archives-2" class="widget widget_archive"><h1 class="widget-title">Archives</h1>		<ul>
			<li><a href='/2018/04/'>April 2018</a></li>
	<li><a href='/2016/08/'>August 2016</a></li>
	<li><a href='/2015/05/'>May 2015</a></li>
	<li><a href='/2015/02/'>February 2015</a></li>
	<li><a href='/2014/10/'>October 2014</a></li>
	<li><a href='/2013/11/'>November 2013</a></li>
	<li><a href='/2013/05/'>May 2013</a></li>
	<li><a href='/2013/03/'>March 2013</a></li>
	<li><a href='/2013/01/'>January 2013</a></li>
	<li><a href='/2012/12/'>December 2012</a></li>
	<li><a href='/2012/11/'>November 2012</a></li>
	<li><a href='/2012/10/'>October 2012</a></li>
	<li><a href='/2012/09/'>September 2012</a></li>
	<li><a href='/2012/07/'>July 2012</a></li>
	<li><a href='/2012/06/'>June 2012</a></li>
	<li><a href='/2012/05/'>May 2012</a></li>
	<li><a href='/2012/04/'>April 2012</a></li>
	<li><a href='/2012/01/'>January 2012</a></li>
	<li><a href='/2011/11/'>November 2011</a></li>
	<li><a href='/2011/10/'>October 2011</a></li>
	<li><a href='/2011/09/'>September 2011</a></li>
	<li><a href='/2011/08/'>August 2011</a></li>
	<li><a href='/2011/07/'>July 2011</a></li>
	<li><a href='/2011/06/'>June 2011</a></li>
	<li><a href='/2011/05/'>May 2011</a></li>
	<li><a href='/2011/04/'>April 2011</a></li>
	<li><a href='/2011/03/'>March 2011</a></li>
	<li><a href='/2011/02/'>February 2011</a></li>
	<li><a href='/2011/01/'>January 2011</a></li>
	<li><a href='/2010/11/'>November 2010</a></li>
	<li><a href='/2010/04/'>April 2010</a></li>
	<li><a href='/2010/03/'>March 2010</a></li>
	<li><a href='/2010/02/'>February 2010</a></li>
	<li><a href='/2010/01/'>January 2010</a></li>
	<li><a href='/2009/12/'>December 2009</a></li>
	<li><a href='/2009/10/'>October 2009</a></li>
	<li><a href='/2009/09/'>September 2009</a></li>
	<li><a href='/2009/08/'>August 2009</a></li>
	<li><a href='/2009/07/'>July 2009</a></li>
	<li><a href='/2009/06/'>June 2009</a></li>
	<li><a href='/2009/05/'>May 2009</a></li>
	<li><a href='/2008/12/'>December 2008</a></li>
	<li><a href='/2008/11/'>November 2008</a></li>
	<li><a href='/2008/10/'>October 2008</a></li>
		</ul>
		</aside><aside id="categories-2" class="widget widget_categories"><h1 class="widget-title">Categories</h1>		<ul>
	<li class="cat-item cat-item-2"><a href="/category/book-review/" >book review</a>
</li>
	<li class="cat-item cat-item-3"><a href="/category/charts/" >charts</a>
</li>
	<li class="cat-item cat-item-4"><a href="/category/conferences/" >conferences</a>
</li>
	<li class="cat-item cat-item-5"><a href="/category/d3/" >d3</a>
</li>
	<li class="cat-item cat-item-6"><a href="/category/dashboards/" >dashboards</a>
</li>
	<li class="cat-item cat-item-7"><a href="/category/data-publishing/" >data publishing</a>
</li>
	<li class="cat-item cat-item-8"><a href="/category/data-visualization/" >data visualization</a>
</li>
	<li class="cat-item cat-item-9"><a href="/category/francais/" >français</a>
</li>
	<li class="cat-item cat-item-10"><a href="/category/javascript/" >javascript</a>
</li>
	<li class="cat-item cat-item-11"><a href="/category/presentation/" >presentation</a>
</li>
	<li class="cat-item cat-item-12"><a href="/category/protovis/" >protovis</a>
</li>
	<li class="cat-item cat-item-13"><a href="/category/react/" >react</a>
</li>
	<li class="cat-item cat-item-14"><a href="/category/tips/" >tips</a>
</li>
	<li class="cat-item cat-item-1"><a href="/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-15"><a href="/category/web-sites/" >web sites</a>
</li>
		</ul>
</aside><aside id="meta-2" class="widget widget_meta"><h1 class="widget-title">Meta</h1>			<ul>
						<li><a href="/wp-login.php">Log in</a></li>
			<li><a href="/feed/">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="/comments/feed/">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>			</ul>
			</aside>		<div class="clear">&nbsp;</div>
	</div><!-- #secondary -->
	<footer id="colophon" class="site-footer" role="contentinfo">
	    <a class="subscribe icon-feed" href="/feed/"><span class="tooltip">Subscribe!</span></a>
		<div class="site-info inner">
		    <section class="copyright">
		    			    		<a href="https://github.com/lacymorrow/casper" rel="home">Casper WP</a> by Lacy Morrow		    			    </section>
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</main><!-- /#content -->

<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.9b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.9b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://localhost:8888/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://localhost:8888/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<script type='text/javascript' src='/wp-content/themes/casper/js/main.js?ver=1.0.0'></script>
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.10'></script>
<!--stats_footer_test--></body>
</html>
