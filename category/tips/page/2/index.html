<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="HandheldFriendly" content="True" />
<meta name="MobileOptimized" content="320" />

<title>tips | jckr.github.io/blog | Page 2</title>

<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="/xmlrpc.php">
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="jckr.github.io/blog &raquo; Feed" href="/feed/" />
<link rel="alternate" type="application/rss+xml" title="jckr.github.io/blog &raquo; Comments Feed" href="/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="jckr.github.io/blog &raquo; tips Category Feed" href="/category/tips/feed/" />
<!-- This site uses the Google Analytics by MonsterInsights plugin v7.0.5 - Using Analytics tracking - https://www.monsterinsights.com/ -->
<!-- Note: MonsterInsights is not currently configured on this site. The site owner needs to authenticate with Google Analytics in the MonsterInsights settings panel. -->
<!-- No UA code set -->
<!-- / Google Analytics by MonsterInsights -->
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/localhost:8888\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.10"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='YoutubeShortcodeMargenn-css'  href='/wp-content/plugins/youtube-shortcode/youtube-shortcode.css?ver=4.6.10' type='text/css' media='all' />
<link rel='stylesheet' id='casper-google-fonts-css'  href='//fonts.googleapis.com/css?family=Noto+Serif%3A400%2C700%2C400italic%7COpen+Sans%3A700%2C400&#038;ver=4.6.10' type='text/css' media='all' />
<link rel='stylesheet' id='casper-style-css'  href='/wp-content/themes/casper/style.css?ver=4.6.10' type='text/css' media='all' />
<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.6.10" />

   	<style type="text/css">
					.blog-title a, .blog-description, .social-icons a { color: #222222; }
		
						                
		
							.main-navigation a { color: ; }
		                                            </style>
    		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
			<style type="text/css">
			.site-title a,
		.site-description {
			color: #222222;
		}
		</style>
	<style type="text/css" id="syntaxhighlighteranchor"></style>
</head>

<body class="archive paged category category-tips category-14 paged-2 category-paged-2 group-blog">

<header id="masthead" role="banner" class="site-head site-header" style="background-image: url(/wp-content/uploads/2018/04/Screenshot-2018-04-09-19.38.59.png);">
    <nav id="site-navigation" class="main-navigation" role="navigation">
        <div>
            <h1 class="menu-toggle">
                <a class="icon-bars" href="#">
                    <span class="hidden">Menu</span>
                </a>
            </h1>
            <a class="skip-link screen-reader-text" href="#content">Skip to content</a>
            <div class="menu"><ul><li ><a href="/">Home</a></li></ul></div>
        </div>
    </nav><!-- #site-navigation -->

    <div class="vertical-row">
        <div class="vertical">
            <div class="site-head-content inner">
                
                <div class="social-icons">
                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                <h1 class="blog-title"><a class="blog-logo" href='/' rel='home'>jckr.github.io/blog</a></h1>
                <h2 class="blog-description">Just another WordPress site</h2>
            </div>
        </div>
    </div>
</header><!-- #masthead -->

<main id="content" class="content" role="main">

	<section id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">
					tips				</h1>
							</header><!-- .page-header -->

						
				
<article id="post-1608" class="post-1608 post type-post status-publish format-standard hentry category-dashboards category-data-visualization category-tips">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2015/02/07/dashboards-ahoy/" rel="bookmark"><time class="entry-date published" datetime="2015-02-07T02:56:12+00:00">February 7, 2015</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/dashboards/" rel="category tag">dashboards</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2015/02/07/dashboards-ahoy/" rel="bookmark">Dashboards ahoy!</a></h1>
         
    </header>
	<section class="post-content">

		<p>During my time at Facebook, I worked almost exclusively on one problem: dashboards. More specifically, how to present frequently-updated data in the most efficient way to business users. And so today, I am starting a series of blog posts / tutorials about dashboards.</p>
<h2>Why talk about dashboards?</h2>
<p>Legit questions. Dashboards are so uncool and boring! I could make more advanced tutorials on d3 or canvas or processing (which is also&#8230; in the plans). Or update new cool visualizations.</p>
<p>But the interest of discussing dashboards is <em>precisely </em>because they are not cool. In the first part to his <a href="%20http://amzn.com/1938377001">Information Dashboard Design</a>, Stephen Few presents a lengthy gallery of terrible dashboards he collected over years. Most of these dashboards exhibit a serious and obvious production flaws: they are often gaudy, using 3d columns or pie charts, when not taking the dashboard metaphor too literally with replicas of gauges and meters. Here&#8217;s a typical dashboard from the early 2000s:</p>
<p><img class="alignnone" src="http://jckr.github.io/blog/projects/dashboards/old dashboard.jpg" alt="" width="640" height="481" /></p>
<p>In the past 5 years though, these problems have largely been solved. The overall <a href="http://www.perceptualedge.com/files/GraphDesignIQ.html">&#8220;Graph Design IQ&#8221;</a>, to borrow another Stephen Few concept, has greatly increased. People who make charts are increasingly aware that there are some best practices to build them and that there are a variety of forms beyond the core &#8220;Excel&#8221; chart types such as bar charts, line charts, pie charts and scatterplots. Besides, anyone who had to code a chart from scratch realized that, as opposed to Excel or similar software where users can rely on defaults, every detail of a chart needs decisions: not only how to encode the data (ie bars, lines etc.) but also whether to have gridlines or not and if so how, how to format axes, how to present legends, and so on and so forth. Oftentimes, having to make these decisions implies taking the time to think about these choices which makes the overall chart quality stronger. Also, in products like Tableau (and to be honest in every version of Excel) the default choices are much more robust than they used to be.</p>
<h2>Down with the old, up with the new</h2>
<p>While these old problems are as good as solved, dashboards are still not awesome because they are plagued with a set of new problems.</p>
<p>First, the <strong><a href="http://jckr.github.io/blog/blog/2015/02/07/charts-in-the-age-of-the-web/">rules and best practices for charts</a> </strong>that we keep perpetuating were thought for an old world of printed or otherwise static charts,  not the interactive environments such as web or mobile. As such, some recommendations of the 90s have become myths that need to be busted (I&#8217;m looking squarely at you, data-ink ratio).</p>
<p>Second, dashboard design is <strong><a href="http://jckr.github.io/blog/blog/2015/02/07/dashboards-versus-data-visualization/">neither a data visualization problem, nor a visual design problem.</a></strong> By this I mean that thinking strictly as a designer or as a data visualization specialist might provide a textbook answer to some well-identified problems that arise with dashboards, but neither of these approaches is optimal.</p>
<p>The not-so-secret secret to dashboards is to apply <a href="http://jckr.github.io/blog/blog/2015/02/07/dashboards-as-products/"><strong>product thinking</strong>. </a>How will people use the dashboard? That should guide what you try to accomplish.</p>
<p>Finally, it&#8217;s really critical to realize that dashboards are<strong><a href="http://jckr.github.io/blog/blog/2015/02/07/charts-assemble/"> not collection of individual charts, but an ensemble.</a> </strong>Components of a dashboard should not be thought individually but as pieces that fit with one another.</p>
<p>Each of these themes will be the subject of an individual article!</p>
<h2>Follow me on Pinterest</h2>
<p>On <a href="http://pinterest.com/jcukier">Pinterest</a>, I maintain two dashboard-related boards you may find interesting.</p>
<p>The first is called &#8220;<a href="http://www.pinterest.com/jcukier/dashboards/">Dashboards</a>&#8221; (duh) and is examples of complete dashboards, with no judgment on quality, most often found in the wild.</p>
<p>The second, <a href="http://www.pinterest.com/jcukier/data-vis-dashboard-ui-elements/">data vis / dashboard UI elements</a>, is centered around lower-level problems such as charts, parts of dashboards and their visual design. Virtually every dashboard example found on a visual design platform like dribbble or beyance is not so much a true dashboard than a collection of individual charts, not that it&#8217;s not interesting.</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-1572" class="post-1572 post type-post status-publish format-standard hentry category-d3 category-data-visualization category-tips">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2013/11/20/getting-beyond-hello-world-with-d3/" rel="bookmark"><time class="entry-date published" datetime="2013-11-20T07:26:33+00:00">November 20, 2013</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/d3/" rel="category tag">d3</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2013/11/20/getting-beyond-hello-world-with-d3/" rel="bookmark">Getting beyond hello world with d3</a></h1>
         
    </header>
	<section class="post-content">

		<p>About a year ago I proposed a <a href="http://jckr.github.io/blog/blog/2012/09/04/getting-to-hello-world-with-d3/">very simple template</a> to start working with d3. But is that the way I actually work? Of course not. Because, though you and I know that displaying hello world in d3 is not exactly trivial, this is not a highly marketable skill either. That said, I just can&#8217;t afford to start each of my projects from scratch.</p>
<p>So in this article I will present you the template I actually use. I won&#8217;t go in as much detail as last time because the exact instructions matter less than the general idea.</p>
<p>My template is a set of two files, an html file and a js file. Of course, extra files can be used as needed.</p>
<p>There&#8217;s not much to the html file &#8211; its role is really to call the javascript code. There is a little twist though. This is also where the interface elements (ie buttons and other controls) may be. Another thing is that I don&#8217;t load a css file through the html. The reason is that when I work with svg, I may export the svg proper to a file to have it reworked in Adobe Illustrator etc. and so having style inside the file makes things easier. So I would instead load a style sheet into the svg through javascript.</p>
<p>The javascript file is written with the following assumptions:</p>
<ul>
<li>there could be other scripts called by the same page, so let&#8217;s try to avoid conflict as much as possible.</li>
<li>some variables need not to be accessed by other scripts.</li>
<li>the execution of my visualization is divided into several phases:
<ul>
<li><strong>initialize: </strong>assigning initial values to variables, if needed forecasting interaction,</li>
<li><strong>loading data: </strong>acquiring and processing external data,</li>
<li><strong></strong><strong>drawing: </strong>this is where the visualization will be actually rendered or updated</li>
</ul>
<p>In addition to these three phases which always occur in my visualizations, there are several optional operations which I may or may not use which are included in the template.</p>
<ul>
<li><strong>reshaping data:<em> </em></strong>operations like filtering or sorting the initial dataset after certain choices of the user. Following such an operation, the visualization has to be re-rendered.</li>
<li><strong>self-playing animation</strong>: when this is required, then the visualization should be able to update itself at given intervals of time. If that is the case, then the html will include controls such as a start and stop button and a slider that can be used to move to an arbitrary time. Then, the javascript includes functions to start and stop the animation, and the drawing function is done so it can be called with a time argument, and not assuming that it will always just show the next step (because the slider can be used to jump ahead or back).</li>
<li><strong>helper functions </strong>which can make me gain time but which don&#8217;t need to be accessed by other scripts.</li>
</ul>
</li>
</ul>
<p>To address the first concern, I wrap all my code in an anonymous function, like so:</p>
<pre class="brush: jscript; title: ; notranslate" title="">
(function() {
// ... my code
})();
</pre>
<p>within that function, any variable which is declared using the var keyword is not accessible to other scripts. Variables which are declared without the var keyword, however, can be accessed. So in order to minimize the footprint of my code, I create one single object, vis, so I can store the functions and values I will need to call as properties of that object. </p>
<pre class="brush: jscript; title: ; notranslate" title="">
(function() {
vis = {}
vis.init = function() {
// code for my init function ...
}
vis.height = 100;
var local = 50;
})();
</pre>
<p>So outside of that anonymous function, I can call vis.init(), I can access and change the value of vis.height, but I cannot access local.</p>
<p>One step further:</p>
<pre class="brush: jscript; title: ; notranslate" title="">
(function() {
vis = {}
vis.init = function(params) {
  // code for my init function ...
  vis.loaddata(params);
}
vis.loaddata = function(params) {
  // code for loading data ...
  vis.draw(params);
}
vis.draw = function(params) {
  // code for drawing stuff ...
}
})();
</pre>
<p>This gets a bit closer to how the code actually works. From the HTML, I would call vis.init and pass it parameters. vis.init will do its thing (assigning values to variables, creating the svg object, preparing interactions etc.) then call vis.loaddata, passing the same parameters. vis.loaddata will fill its purpose (namely, load the data and perhaps do a little data processing on the side) then call the drawing function.</p>
<p>Any of these functions can be called from the outside (from the HTML, ot from the console for debugging). The nice thing about it is that nothing really happens unless there&#8217;s an explicit instruction to start the visualization.</p>
<p>Let&#8217;s go a step deeper:</p>
<pre class="brush: jscript; title: ; notranslate" title="">
(function() {
vis = {}
var chart, svg, height, width;
vis.init = function(params) {
  if (!params) {params = {};}
  chart = d3.select(params.chart || &quot;#chart&quot;);
  height = params.height || 500;
  width = params.width || 960;
  chart.selectAll(&quot;svg&quot;).data([{height: height, width: width}]).enter().append(&quot;svg&quot;);
  svg = chart.select(&quot;svg&quot;);
  svg
   .attr(&quot;height&quot;, function(d) {return d.height;})
   .attr(&quot;width&quot;, function(d) {return d.width;})
  vis.loaddata(params);
}
vis.loaddata = function(params) {
  if (!params) {params = {};}
  d3.csv((params.data || &quot;data.csv&quot;) + (params.refresh ? (&quot;#&quot; + Math.random()) : &quot;&quot;), function(error, csv) {
    vis.csv = csv;
    vis.draw(params);
  })
}
vis.draw = function(params) {
  // code for drawing stuff ...
}
})();
</pre>
<p>Now we&#8217;re much closer to how it actually works. After we create our publicly accessible object vis, we create a bunch of local variables. Again, these can be used freely by the functions within our anonymous function, but not outside of it (notably in the console). I&#8217;m assuming that the code can be called without passing parameters, in which case within the functions I am testing if params actually exists, failing that I give it an empty object value. This is because down the road, if it is undefined and I try to access its properties, that would cause a reference error. If params has a value, even that of an empty object, if a property is not assigned, its value is &#8220;undefined&#8221;. So let&#8217;s take a look at the first 2 lines of vis.init:</p>
<pre class="brush: jscript; title: ; notranslate" title="">
if(!params) {params = {};}
chart = d3.select(params.chart || &quot;#chart&quot;);
</pre>
<p>if params is not passed to vis.init, it gets an empty object value (that&#8217;s the first line). So, all of its properties have an undefined value. So the value of (params.chart || &#8220;#chart&#8221;) will be &#8220;#chart&#8221;. Likewise, if params is passed to vis.init, but without a chart property, params.chart will also be undefined, and (params.chart || &#8220;#chart&#8221;) will also be &#8220;#chart&#8221;. However, if params is passed to vis.init and a chart property is defined (i.e. vis.init({chart: &#8220;#mychart&#8221;}), then params.chart will be worth &#8220;#mychart&#8221; and (params.chart || &#8220;#chart&#8221;) will also be &#8220;#mychart&#8221;.<br />
So that construct of assigning an empty object value to params then using || is like giving default values which can be overridden.</p>
<p>Within vis.init, we use local variables for things like height, width etc. so we can redefine them with parameters, and they can be easily accessed by anything within the anonymous function, but not outside of it.<br />
I&#8217;ve also fleshed out the vis.loaddata function.<br />
Likewise, we use the same construct as above: instead of hardcoding a data file name, we allow it to be overridden by a parameter, but if none is specified, then we can use a default name.<br />
The part with params.refresh is a little trick.<br />
When developing/debugging, if your data is stored in a file, you are going to load that file many times. Soon enough your browser will use the cached version and not reload it each time. That&#8217;s great for speed, but not so great if you edit your file as part as your debugging process: changes would be ignored! By adding a hash and a random string of character at the end of the file name, you are effectively telling your browser to get your file from a different url, although it is the same file. What this does is that it will force your browser to reload the file each time. Once you&#8217;re happy with the shape of your file, you can stop doing that (by omitting the refresh parameter) and the browser may use a cached version of your file.<br />
In the vis.loaddata function, the most important part is that d3.csv method. As you may remember this is what loads your csv file (and btw if your data is not in csv form, d3 provides <a href="https://github.com/mbostock/d3/wiki/Requests">other methods to load external files</a> &#8211; d3.json, d3.text etc.). How this method works is that the associated function (i.e the bit that goes: function(error, csv) {}) is executed [em]once the file is loaded[/em].<br />
So since loading the file, even from cache, always take some time, what&#8217;s inside that function will be executed [em]after[/em] whatever could be written after the d3.csv method. This is why in the loaddata function, nothing is written after the d3.csv method, as there is no reliable way of knowing when that would be executed. The code continues inside the function. At the very end of that function, we call vis.draw, passing parameters along.<br />
If I need to load several files, I would nest the d3.csv functions like this:</p>
<pre class="brush: jscript; title: ; notranslate" title="">
d3.csv((params.data || &quot;data.csv&quot;), function(error, csv) {
  // .. do things with this first file
  d3.csv((params.otherfile || &quot;otherfile.csv&quot;), function (error, csv) {
    // .. and then things with that other file. repeat if necessary..

    // the end of the innermost function is when all files are loaded, so this is when we pass control to vis.draw
    vis.draw(params);
  })
})
</pre>
<p>Another way to do this is using <a href="https://github.com/mbostock/d3/wiki/Upgrading-to-3.0">queue.js</a> which I would recommend if the nesting becomes too crazy. For just 2 small files it&#8217;s a matter of personal preferences.</p>
<p>It&#8217;s difficult to write anything inside the code of vis.draw in a template, because this will have to be overwritten for every project. But here is the general idea though.<br />
vis.draw can be called initially to, well, draw the visualization a first time when nothing exists but an empty svg element. But it can also be called further down the road, if the user presses a button that changes how it should be displayed, etc.<br />
So, if the external context doesn&#8217;t change, running vis.draw once more should do nothing. As such, I avoid using constructs like &#8220;svg.append(&#8220;rect&#8221;) &#8221; and instead use &#8220;svg.selectAll(&#8220;rect&#8221;).data(vis.data).enter().append(&#8220;rect&#8221;)&#8221; systematically.<br />
The difference between the two is that using append without enter will add elements unconditionally. Using it after enter would only add new elements if there are new data items.<br />
But what if I need to draw just one element? well, instead of writing &#8220;svg.append(&#8220;rect&#8221;)&#8221;, I would write something like &#8220;svg.selectAll(&#8220;rect.main&#8221;).data([{}]).enter().append(&#8220;rect&#8221;).classed(&#8220;main&#8221;, 1)&#8221;.<br />
Let me explain what&#8217;s happening there.<br />
What I want is the function to create one single rectangle if it doesn&#8217;t exist already. To differentiate that rectangle from any other possible rectangles I am going to give it a class: &#8220;main&#8221;. Why a class and not an id if it is unique to my visualization? Well, I may want to have several of these visualizations in my page and ids should really be unique. So I never use ids in selections, to the exception of specifying the div where the svg element will sit.<br />
If there is already one rect element with the class &#8220;main&#8221;, svg.selectAll(&#8220;rect.main&#8221;).data([{}]).enter() will return an empty selection and so nothing will happen. No new rect element will be appended. This is great because we can run this as often as we want and what&#8217;s supposed not to change will not change.<br />
However, if there is no such rect element, since there is one item in the array that I pass via data, svg.selectAll(&#8220;rect.main&#8221;).data([{}]).enter().append(&#8220;rect&#8221;) will create one single rect element. The classed(&#8220;main&#8221;, 1) at the end will give it the &#8220;main&#8221; class, so that running that statement again will not create new rectangles. Using [{}] as default, one-item array is a convention, but it&#8217;s better than using, say [0] or [&#8220;&#8221;] because when manipulating our newly-created element, we can add properties to the data element (i.e. d3.selectAll(&#8220;rect.main&#8221;).attr(&#8220;width&#8221;, function(d) {d.width = 100; return d.width;}) ) which you couldn&#8217;t do if the data elements were not objects. (try this for yourself).</p>
<p>That being said, the general outline of the vis.draw function is so:</p>
<ul>
<li>remove all elements that need to be deleted,</li>
<li>create all elements that need to be added, including a bunch of one-off elements that will only be created once (ie legend, gridlines&#8230;)</li>
<li>select all remaining elements and update them (using transitions as needed).</li>
</ul>
<p>One last thing: how to call vis.init() in the first place? Well, the call would have to happen in the HTML file.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
&lt;script&gt;
var params = {data: &quot;data.csv&quot;, width:1400,height:800};
var query = window.location.search.substring(1);

var vars = query.split(&quot;&amp;&quot;);
vars.forEach(function(v) {
	var p = v.split(&quot;=&quot;);
	params[p[0]] = p[1]
})
vis.init(params);
&lt;/script&gt;
</pre>
<p>What&#8217;s going on there?<br />
First, I initiate the params variable with some values I want to pass in most cases.<br />
Then, the next line is going to look at the url of the page, and more specifically at the search part, that is, whatever happens after the ?. (I use .substring(1) as to not include the &#8220;?&#8221;).<br />
The idea is that when I would like to pass parameters via the browser, like so: &#8230;/vis.html?mode=1&#038;height=500&#038;data=&#8221;anotherfile.csv&#8221;<br />
The two splits (first by &#038;, then by =) allow to get the parameters passed by url, and add them to params, possibly overriding the existing ones.<br />
Then we pass the resulting params variable to vis.init. </p>
<p>Wihtout further ado, here are the two files in their entirety. </p>
<pre class="brush: xml; title: ; notranslate" title="">
&lt;!DOCTYPE html&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;head&gt;
	&lt;title&gt;&lt;/title&gt;
	&lt;style&gt;

	&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;script src=&quot;http://d3js.org/d3.v3.min.js&quot;&gt;
&lt;/script&gt;
&lt;div id=&quot;chart&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;template.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
var params = {data: &quot;data.csv&quot;, width:960,height:500};
var query = window.location.search.substring(1);

var vars = query.split(&quot;&amp;&quot;);
vars.forEach(function(v) {
	p=v.split(&quot;=&quot;);
	params[p[0]]=p[1]
})
vis.init(params);
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
<pre class="brush: jscript; title: ; notranslate" title="">
(function() {
	vis={};
	var width,height;
	var chart,svg;
	var defs, style;
	var slider, step, maxStep, running;
	var button;

	vis.init=function(params) {
		if (!params) {params = {}}
		chart = d3.select(params.chart||&quot;#chart&quot;); // placeholder div for svg
		width = params.width || 960;
		height = params.height || 500;
		chart.selectAll(&quot;svg&quot;)
			.data([{width:width,height:height}]).enter()
			.append(&quot;svg&quot;);
		svg = d3.select(&quot;svg&quot;).attr({
			width:function(d) {return d.width},
			height:function(d) {return d.height}
		}); 
		// vis.init can be re-ran to pass different height/width values 
		// to the svg. this doesn't create new svg elements. 

		style = svg.selectAll(&quot;style&quot;).data([{}]).enter() 
			.append(&quot;style&quot;)
			.attr(&quot;type&quot;,&quot;text/css&quot;); 
		// this is where we can insert style that will affect the svg directly.

		defs = svg.selectAll(&quot;defs&quot;).data([{}]).enter()
			.append(&quot;defs&quot;); 
		// this is used if it's necessary to define gradients, patterns etc.

		// the following will implement interaction around a slider and a 
		// button. repeat/remove as needed. 
		// note that this code won't cause errors if the corresponding elements 
		// do not exist in the HTML.  
		
		slider = d3.select(params.slider || &quot;.slider&quot;);
		
		if (slider[0][0]) {
			maxStep = slider.property(&quot;max&quot;);
			step = slider.property(&quot;value&quot;);
			slider.on(&quot;change&quot;, function() {
				vis.stop(); 
				step = this.value; 
				vis.draw(params);})
			running = params.running || 0; // autorunning off or manually set on
		} else {
			running = -1; // never attempt auto-running
		}
		button = d3.select(params.button || &quot;.button&quot;);
		if(button[0][0] &amp;&amp; running&gt; -1) {
			button.on(&quot;click&quot;, function() {
				if (running) {
					vis.stop();
				} else {
					vis.start();
				}
			})
		};
		vis.loaddata(params);
	}
		
	vis.loaddata = function(params) {
		if(!params) {params = {}}
		d3.text(params.style||&quot;style.txt&quot;, function (error,txt) {
			// note that execution won't be stopped if a style file isn't found
			style.text(txt); // but if found, it can be embedded in the svg. 
			d3.csv(params.data || &quot;data.csv&quot;, function(error,csv) {
				vis.data = csv;
				if(running &gt; 0) {vis.start();} else {vis.draw(params);}
			})
		})
	}
	
	vis.play = function() {
		if(i === maxStep &amp;&amp; !running){
			step = -1; 
			vis.stop();
		}
		if(i &lt; maxStep) {
			step = step + 1; 
			running = 1;
			d3.select(&quot;.stop&quot;).html(&quot;Pause&quot;).on(&quot;click&quot;, vis.stop(params));
			slider.property(&quot;value&quot;,i);
		vis.draw(params);} else {vis.stop();}	
	}

	vis.start = function(params) {
		timer = setInterval(function() {vis.play(params)}, 50);
	}

	vis.stop = function (params) {
		clearInterval(timer);
		running = 0;
		d3.select(&quot;.stop&quot;).html(&quot;Play&quot;).on(&quot;click&quot;, vis.start(params));
	}

	vis.draw = function(params) {
		// make stuff here! 
	}
})();
</pre>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-1548" class="post-1548 post type-post status-publish format-standard hentry category-d3 category-data-visualization category-tips tag-append tag-d3 tag-enter tag-exit tag-insert tag-remove tag-select tag-selectall tag-selections tag-tutorial">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2013/03/05/d3-tutorial-at-strata-redux/" rel="bookmark"><time class="entry-date published" datetime="2013-03-05T12:20:55+00:00">March 5, 2013</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/d3/" rel="category tag">d3</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2013/03/05/d3-tutorial-at-strata-redux/" rel="bookmark">Selections in d3 &#8211; the long story</a></h1>
         
    </header>
	<section class="post-content">

		<p>This past week, Scott Murray and I presented a tutorial at Strata on d3 (of all things!)<br />
First things first, you probably want to get <a href="http://amzn.com/1449339735">Scott&#8217;s book on the subject</a> when it&#8217;s out. I should be translating it into French eventually.<br />
You&#8217;re also welcome to the slides and examples of the tutorial which can be found on <a href="https://github.com/alignedleft/strata-d3-tutorial">https://github.com/alignedleft/strata-d3-tutorial</a>. That include my <a href="https://github.com/alignedleft/strata-d3-tutorial/blob/master/d3%20Cheat%20Sheet.pdf">d3 cheat sheet</a>.</p>
<p>We had done a d3 workshop a few months back at Visweek with Jeff Heer. This time around, we changed our approach: we covered less ground, went at a slower pace, but targeted what is in our opinion the most troublesome aspects of learning d3: selecting, creating and removing elements. </p>
<p>I have learned d3 from deciphering script examples and in the earliest ones one ubiquitous construct was this sequence : select / selectAll / data / enter / append.<br />
It does the work, so like everyone else I&#8217;ve copied it and reused very often. It happens to be the most proper way of adding new elements in most cases, but the point is, while learning d3, I (and many people before and after me) have copy/pasted it without understanding it deeply. Though, copy pasting something you don&#8217;t understand thoroughly is the best way to get errors you don&#8217;t understand any better, and it would prevent you from accessing the rest of the potential of the library. Conversely, once this is cleared, you can be &#8220;thinking in d3&#8221; and easily do many things you might have thought impossible before.</p>
<p>We did the tutorial hands-on, live coding most of the time. To follow through, I invite you to create or open an empty page with d3 loaded (such as <a href="http://jckr.github.io/blog/projects/template.html" title="d3 template" target="_blank">this one</a> &#8211; the link opens a new tab) and then open the &#8220;console&#8221; or &#8220;web developer tools&#8221; which allow you to type javascript statements directly, without having to write and load scripts. Here are the shortcuts to the console: </p>
<ul>
<li>Chrome: Ctrl-J (windows), ⌥ ⌘+j (Mac)</li>
<li>Firefox: Ctrl+Shift+k (windows), ⌥ ⌘+k (Mac)</li>
<li>Safari: Ctrl+Alt+c (windows), ⌥ ⌘+c (Mac)</li>
<li>IE9+: F12</li>
</ul>
<p>To make the best of this tutorial, please type the examples. Some tutorials show you impressive stuff and show you step by step how to do it. That&#8217;s not one of them. I&#8217;ve sticked to very, very basic and mundane things. We&#8217;ll be only manipulating HTML elements such as paragraphs, which I assume you have seen earlier (plot twist: you are reading one at this very moment)<br />
Some of the code snippets don&#8217;t work. That&#8217;s the idea! I think you can&#8217;t progress by merely copying code that works. It&#8217;s important that you try out code that looks reasonable but that doesn&#8217;t produce the expected result or that causes an error, but then understand why. </p>
<h2>Adding simple stuff</h2>
<h3>Creating elements</h3>
<p>Our empty page is, well, empty, so we are going to add stuff.<br />
to create elements, we need the <strong>append</strong> method in d3, which takes as an argument the type of element that needs to be created, while the <strong>html</strong> method at the end allow us to specify a text.</p>
<p>so let&#8217;s go ahead and type: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.append(&quot;h1&quot;).html(&quot;My beautiful text&quot;)</pre>
<p> and see what happens.</p>
<p>what do we get? and why is that?<br />
In d3, every element which is created cannot appear out of thin air, and must be <strong>added to a container</strong>. If we don&#8217;t specify a container element, we just can&#8217;t create anything.<br />
In HTML, most elements can be containers, that is, it&#8217;s usually possible to add elements to almost everything. Then again, our template is fairly empty, so we can select the <body> tag and take it from there.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).append(&quot;h1&quot;).html(&quot;My beautiful text&quot;)</pre>
<p>we&#8217;re in business! as long as there is a sensible place to put them, you can create as much stuff as you like. Since we&#8217;re on a roll, why won&#8217;t we throw in a few paragraphs (<strong>p</strong> element in HTML):</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).append(&quot;p&quot;).html(&quot;Look at me, I'm a paragraph.&quot;)
d3.select(&quot;body&quot;).append(&quot;p&quot;).html(&quot;And I'm another paragraph!&quot;)
d3.select(&quot;body&quot;).append(&quot;p&quot;).html(&quot;Woohoo! number 3 baby&quot;)</pre>
<p>and lo and behold, all our paragraphs appear in sequence. Simply beautiful.<br />
But wait! paragraphs are containers, too. Why don&#8217;t we try to add a <strong>span</strong> element to one paragraph? For those of you with no HTML knowledge, span elements are like paragraphs, except there is no line break by default at the end. </p>
<p>So let&#8217;s try this:</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;p&quot;).append(&quot;span&quot;).html(&quot;and I'm a span!&quot;)</pre>
<p>Before typing it, take a minute to think where you expect it to go.<br />
Then go ahead and type it.</p>
<p>Surprised?<br />
you may have guessed that our new bit of text could go on a line of its own at the end of the document, or at the end of the last paragraph. But instead, it goes at the end of the first paragraph.<br />
Why is that? well, our select method stops the first instance of whatever it tries to find. In our case, since we asked it to find paragraphs &#8211; p, it stopped at the first p element it found, and added the span at the end of it (app<em>end</em>).</p>
<h3>Beyond creating new things</h3>
<p>adding new elements to a page programmatically is kind of useful, but if d3 stopped at that you probably wouldn&#8217;t be so interested in this tutorial to begin with. You can also modify and manipulate elements. We&#8217;ve done that to some extent with the html method. But we can also modify the <em>style</em> of the elements, their <em>attributes</em> and their <em>properties</em>. For the time being, don&#8217;t bother too much about the difference between these three things. Style refers to the appearance of elements, attributes, to their structure, and properties, to what can be changed in realtime, like values in a form. But again, let&#8217;s not worry about that for now and let&#8217;s just follow along. Look at this code snippet:</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;p&quot;).style(&quot;color&quot;,&quot;red&quot;)</pre>
<p>this will select the first paragraph and change its style, so that the text color is changed to red.<br />
But wait! our first paragraph, isn&#8217;t that the one with a span at the end of it? What will happen to that bit of text? Well, type the statement to find out.<br />
All the paragraph, including its children (that is, everything added to it, in our case the span) is turned to red.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;span&quot;).style(&quot;color&quot;,&quot;blue&quot;)</pre>
<p>That singles out our span and writes it in blue. Can this be overturned?</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;p&quot;).style(&quot;color&quot;,&quot;red&quot;)</pre>
<p>That won&#8217;t change a thing. Our first paragraph is, in fact, already red. But its child, the span, has a style which overrides that of its parent. To have it behave like the rest, we can remove its style like so: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;span&quot;).style(&quot;color&quot;,null)</pre>
<p>then </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;p&quot;).style(&quot;color&quot;,&quot;green&quot;)</pre>
<p>it will behave like its parent, the paragraph.<br />
But let&#8217;s try something else: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;span&quot;).style(&quot;color&quot;,&quot;blue&quot;)</pre>
<p>we write our span in blue, </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;span&quot;).style(&quot;color&quot;,&quot;green&quot;)</pre>
<p>and now back in green, like its parent.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;p&quot;).style(&quot;color&quot;,&quot;red&quot;)</pre>
<p>What will happen?<br />
well, the paragraph turns red, but the span doesn&#8217;t. It&#8217;s still following its specific instruction to be written in green.</p>
<p>That goes to illustrate that children behave like their parents, unless they are given specific instructions. </p>
<p>For HTML elements, we can play with styles, not so much with attributes or properties. One thing worth noting though is that an element can be given a class or an id.</p>
<p>Classes and ids can be used to style elements using a cascading style sheet (CSS). Knowing how CSS works is entirely facultative in learning d3, since d3 by itself can take care of all styling needs. Though, knowing basic CSS is not the most useless of endeavors, and some sensible CSS statements can save a lot of tedious manipulation in d3.<br />
The other use of classes and ids is that they can be used to select elements.</p>
<p>Let&#8217;s reload our page so we start from scratch.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).append(&quot;p&quot;).html(&quot;First paragraph&quot;);
d3.select(&quot;body&quot;).append(&quot;p&quot;).html(&quot;Second paragraph&quot;).attr(&quot;class&quot;,&quot;p2&quot;);
d3.select(&quot;body&quot;).append(&quot;p&quot;).html(&quot;Third paragraph&quot;).attr(&quot;id&quot;,&quot;p3&quot;);
</pre>
<p>without the use of classes and ids, it&#8217;s still possible to select and manipulate the 2nd or 3rd instance of an element, but it&#8217;s a chore. You have to use <em>pseudo-classes</em> like d3.select(&#8220;p:nth-of-type(2)&#8221;) to select the 2nd instance of a paragraph, for instance.<br />
Personally, I&#8217;d rather avoid this and prefer using simpler statements. With classes and IDs set, we can write instead: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;.p2&quot;).html(&quot;I'm classy&quot;);
d3.select(&quot;#p3&quot;).html(&quot;I've got ideas&quot;);</pre>
<p>To select things of a given class, you must use a period before the name of the class. To select things of a certain id, you must use the hash sign.<br />
Here, we are looking for the first element of the p2 class. This happens to be our 2nd paragraph. When you know you will have to manipulate elements which are not easily accessible, you may as well give them classes which will make this easier down the road.</p>
<p>In theory, there should only be one element of a given ID in one page, so I recommend not using them dynamically unless you can be 100% sure that there will not be duplicates. And, in case you were wandering, one element can have several (even many) classes. </p>
<h2>Two birds, one stone</h2>
<h3>Introducing selectAll</h3>
<p>So far, we&#8217;ve changed properties of one element at a time. The exception was when we changed the colors of both a paragraph and a span, but even then, we were still technically only changing the characteristics of one paragraph, which its child, the span, just happened to inherit. </p>
<p>For a complex document, that can be super tedious, especially since we&#8217;ve seen that it&#8217;s not easy to retrieve an element which is not the first of its kind.</p>
<p>so let&#8217;s go ahead and type:</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).style(&quot;font-weight&quot;,&quot;bold&quot;);</pre>
<p>(for a little variety. I mean, changing text color is so 1994.)<br />
What was that? Everything turned to bold!</p>
<p>Indeed: while the select method returns the first element that matches the clause, selectAll matches them all.<br />
Let&#8217;s do more.<br />
We&#8217;re going to add a span to our first paragraph. </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;p&quot;).append(&quot;span&quot;)
.html(&quot;I'm a rebel child.&quot;)
.style(&quot;background-color&quot;,&quot;firebrick&quot;)</pre>
<p>we&#8217;re adding a gratuitous styling command.<br />
Now, let&#8217;s change the background color of all the paragraphs.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).style(&quot;background-color&quot;,&quot;aliceblue&quot;)</pre>
<p>As could be expected, the span doesn&#8217;t change its background color, and so it appears differently from its parent (which could be a desired effect &#8211; this gives us flexibility).<br />
but what if we wanted to change the background color of everything? can we do better?</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;*&quot;).style(&quot;background-color&quot;,&quot;whitesmoke&quot;)</pre>
<p> (quite fitting in these times of papal conclave)</p>
<p>Well &#8211; everything gets a background color of &#8220;white smoke&#8221; (which is a fine background color btw.). Including the &#8220;body&#8221; element &#8211; that is, everything on the page!<br />
selectAll(&#8220;*&#8221;) matches everything. With it, you can grab all the children, their children etc. (&#8220;descendants&#8221;. I know&#8230;) of a selection, or, if used directly like so: d3.selectAll(&#8220;*&#8221;), everything on the page.<br />
So we&#8217;ve seen we can select moaar. But can we be finer? Can we select the paragraphs and the spans only, without touching the rest?</p>
<p>we sure can!</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p, span&quot;).style(&quot;background-color&quot;,&quot;lawngreen&quot;)</pre>
<p>The outcome of that one statement probably won&#8217;t make it to our web design portfolio, but it does the trick: you can select as much as you like, or as little as you like. </p>
<h3>Nested selections</h3>
<p>To illustrate the next situation, let&#8217;s add a span to our document.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).append(&quot;span&quot;).html(&quot;select me if you can&quot;)</pre>
<p>Well, just like there is a way to select directly the 2nd paragraph using pseudo classes, there&#8217;s also a (complicated) way to select directly that last span (namely: selectAll(&#8220;span:not(p)&#8221;) )<br />
there&#8217;s also a simpler way which is what we&#8217;re interested in.<br />
let&#8217;s suppose we want to turn it to bold:<br />
we can just do</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;span&quot;).style(&quot;font-weight&quot;,&quot;bold&quot;);</pre>
<p>then change the first one: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;p&quot;).select(&quot;span&quot;).style(&quot;font-weight&quot;,null);</pre>
<p>Admittedly, the complicated way is more compact. But conceptually, the &#8220;simple&#8221; way is easier to follow: we can do a selection, and within that selection perform a newer selection, and so on and so forth. That way, we can get away with just using super simple selectors, as opposed to master the intricacies of CSS3 syntax. Do it for the people who will read your source code 🙂</p>
<p><strong>At this point: </strong></p>
<ul>
<li>You know how to dynamically create content. Pretty cool!</li>
<li>More! you can dynamically change every property of every element of the page. woot!</li>
<li>Bonus! you&#8217;re equipped with tactics to easily reach any element you want to change.</li>
</ul>
<p>You should also have a good grasp of d3.select, d3.selectAll and the difference between the two.<br />
what more could you possibly want? Well, since this is about data visualization, how about a way to tie our elements to data? This is what d3 is really about.</p>
<h2>Putting the data in data visualization</h2>
<h3>Introducing data: passing values to many elements at once</h3>
<p>So far, we&#8217;ve entered &#8220;hard coded&#8221; values for all of our variables. That&#8217;s fine, but we can&#8217;t really set our elements one by one. I mean, we could, but it&#8217;s no way to &#8220;industrialize&#8221; the way elements are created.<br />
Fortunately, d3 provides. Its more interesting characteristic is the ability to &#8220;bind&#8221; elements with data.</p>
<p>If you&#8217;ve followed the instructions step by step, you should have 3 paragraphs in the page. Plus a span afterwards, but whatever.<br />
Let&#8217;s introduce the data method. This will match an array of values to a selection of elements in the page. Let&#8217;s go: </p>
<pre class="brush: jscript; title: ; notranslate" title="">var fs=[&quot;10px&quot;,&quot;20px&quot;,&quot;30px&quot;];
d3.selectAll(&quot;p&quot;).data(fs).style(&quot;font-size&quot;,function(d) {return d;})
</pre>
<p>wow wow wow what just happened?<br />
First, we create an array of values which we intelligently call fs (for font size).<br />
Then, right after the selectAll(&#8220;p&#8221;) which gathers a selection of elements (3 &#8220;p&#8221; elements to be exact), we specify a dataset using the data method.<br />
It just happens that our dataset has just the same number of items as our selection of elements!</p>
<p>finally, we use style, like we used to, with a twist: instead of providing one fixed value, which would affect our 3 p elements in the same way, we specify a function.<br />
This function will parse the dataset, and for each element, it will return the result of an operation in the corresponding data point: the result of the function on the first item for the first p element, the result on the 2nd item for our 2nd paragraph, and lastly the result on the last item for our last paragraph.<br />
We write the function with an argument: d. What is d? it&#8217;s nothing but a convention. We can call it anything. d is standard fare in d3 code because that&#8217;s the writing style of Mike Bostock, the author of the framework and of many of its examples.<br />
This function is nothing special, it returns the element itself, so we are passing &#8220;10px&#8221; for the font-size of our first paragraph, and so on and so forth (20px, 30px).<br />
As an aside, we can use the String function, which converts any element into a string, instead of writing function(d) {return d;}. So: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).data(fs).style(&quot;font-size&quot;,String)</pre>
<p> would also work and is shorter to write.</p>
<p>Let&#8217;s recap what just happened here, because this is important.<br />
We want to apply a dynamic transformation to a bunch of existing elements, as opposed to finding a way to select each individual element, and passing it a hard-coded value.<br />
What&#8217;s more, we want to apply a transformation of the same nature, but of a different magnitude, on each of these items. </p>
<p>How to proceed?<br />
well, first we create an array of values. That&#8217;s our fs boy over there.</p>
<pre class="brush: jscript; title: ; notranslate" title="">var fs=[&quot;10px&quot;,&quot;20px&quot;,&quot;30px&quot;];</pre>
<p>Then, we will first select all of the elements we want to modify, then we&#8217;ll tie our dataset to that selection. This is what selectAll, then data does.</p>
<pre class="brush: jscript; title: ; notranslate" title="">var selection=d3.selectAll(&quot;p&quot;).data(fs);</pre>
<p>By the way, I&#8217;ve stored the result of the selectAll then data in a variable. In the original example, I just &#8220;chained&#8221; the methods, that is, I followed each method by a period and another one. The two syntaxes are equivalent. Chaining works, because each of these methods returns a value which is itself a selection on which further operations can be done. This syntax works well through most of d3 with some exceptions which will be duly noted.</p>
<p>Then, we are going to change the style of the selection, using a function on our data.</p>
<pre class="brush: jscript; title: ; notranslate" title="">selection.style(&quot;font-size&quot;,function(d) {return d;})</pre>
<p> (or
<pre class="brush: jscript; title: ; notranslate" title="">selection.style(&quot;font-size&quot;,String)</pre>
<p>That function will run on each value of our dataset, and return one result per value, which will be passed to all elements in sequence.</p>
<p>At this stage you may have two questions:</p>
<ul>
<li>Can we use more sophisticated functions, because this one is kind of meh?</li>
<li>What happens if there is not the same number of items in the dataset and of elements?</li>
</ul>
<p>The second question is actually more complicated than the first, but we&#8217;ll answer it in painstaking detail.<br />
So let&#8217;s take care of the question on functions first.<br />
Yes, obviously, we can use the function not just to return the element, but to do any kind of calculation that a language such as javascript is capable of, which is nearly everything.<br />
To illustrate that, here are some variations of our initial code which will return the same result, but with a different form.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
var fs=[10,20,30]; // no more px
d3.selectAll(&quot;p&quot;).data(fs).style(&quot;font-size&quot;,function(d) {return d+&quot;px&quot;;})
</pre>
<p>Here, instead of returning just the element, we append &#8220;px&#8221; at its end. Sadly, style(&#8220;font-size&#8221;,10) doesn&#8217;t work, but style(&#8220;font-size&#8221;,10+&#8221;px&#8221;) &#8211; which is the same as style(&#8220;font-size&#8221;,&#8221;10px&#8221;) is valid. </p>
<p>Here is yet another way.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).style(&quot;font-size&quot;,function(d,i) {return 10*(i+1)+&quot;px&quot;;})</pre>
<p>function(d,i) ? what is this devilry?<br />
Here, i (or anything we want to call it, as long as it&#8217;s the 2nd argument of this function) represents the order of the element in the selection, so the first gets a 0, the second a 1, etc. (well, in our example it goes to 3 elements, so the last one gets a 2).<br />
This may be a bit abstract to say here, but even if we haven&#8217;t passed data, this would still work &#8211; i represent the order of the element, not the data item. so, if no data had been passed, within this function call, d would be undefined, but i would still be equal to 0,1,2, &#8230; </p>
<p>The answer to the second question is the last great mystery of d3. Once you get this, you&#8217;re golden.</p>
<h3>Creating or removing the right number of elements depending on data</h3>
<p>Before we get further, let&#8217;s quickly introduce append&#8217;s reckless cousin, remove(). Writing remove at the end of a selection deletes all the corresponding elements from the document object model.<br />
so,
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).remove()</pre>
<p> would remove our 3 paragraphs. Let&#8217;s do it and get rid of our paragraphs.<br />
Actually, let&#8217;s do
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).selectAll(&quot;*&quot;).remove()</pre>
<p> and remove everything below the body.</p>
<p>Now, earlier, we were alluding to what could happen if we didn&#8217;t have the same number of elements as of items in our dataset.</p>
<p>That means that we should be able to do the following: </p>
<ul>
<li>If there are fewer elements than items in a dataset, create the missing elements</li>
<li>If there are fewer elements than items in a dataset, disregard the extra data items</li>
<li>If there are more elements than items in a dataset, remove the extra elements</li>
<li>If there are more elements than items in a dataset, don&#8217;t change the extra elements/li>
<li>As data are updated, keep some elements, remove some, add some</li>
</ul>
<p>Why would we want to do all of this?<br />
The first case is the most common. When we start a data visualization script, chances are that there are no elements yet but there is data, so you&#8217;ll want to add elements based on the data.<br />
Then, if you have interaction or animation, your dataset may be updated, and depending on what you intend to do you may just want to update the existing elements, create new ones, remove old ones, etc. That&#8217;s when you may want to do 2, 3 or 4.<br />
The last (5th case) is more complicated, but don&#8217;t worry, we&#8217;ve got you covered.</p>
<p>Right now, we should have 0 p elements on our page (and if for some reason this is not the case, feel free to reload it).</p>
<p>let&#8217;s create a variable like so: </p>
<pre class="brush: jscript; title: ; notranslate" title="">var text=[&quot;first paragraph&quot;,&quot;second paragraph&quot;,&quot;third paragraph&quot;];</pre>
<p>somewhat uninspired, I know, but let&#8217;s keep typing to a minimum, if you want to go all lyrical please go ahead.</p>
<p>We are smack in case 1: we&#8217;d like to create 3 paragraphs, we have 3 items in our dataset, but 0 elements yet.<br />
Here&#8217;s what we&#8217;ll type: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).selectAll(&quot;p&quot;).data(text).enter().append(&quot;p&quot;).html(String)</pre>
<p>A-ha! we meet again, select selectAll data enter append.<br />
After all we&#8217;ve done, select selectAll should make some sense, even though, at this stage, this selection returns 0 p elements. There are none yet.<br />
Then we pass data as we&#8217;ve done before. Note that there are 3 items in our dataset.</p>
<p>Then, we use the enter() statement. What it does is that it prepares one new element for every unmatched data item. We&#8217;ll expand a bit later on the true meaning of unmatched, but for the time being, let&#8217;s focus on the difference. We have 0 elements, but 3 data items. 3 &#8211; 0 = 3, so the enter() selection will prepare 3 new elements.<br />
What does prepare means? the elements are not created yet at this stage, but they will with the next command. Right after enter(), think of what&#8217;s created as placeholders for future element (Scott&#8217;s vocabulary), or buds that will eventually blossom into full-fledge elements (mine).<br />
After enter(), we specify an append(&#8220;p&#8221;) command. Previously, when we had used the append method, we created one element at a time. But in this case, we are going to create as many as there are placeholders returned by enter(). So, in our case, 3.<br />
You may legitimately wonder why we needed a select statement to begin with &#8211; after all, enter() works on the difference between selectAll and data. But when we are going to append elements, we will need to create them somewhere, to build them upon a container. This is what the first select does. Omit it, and you&#8217;ll have an error, because the system will be asked to create something without knowing where.<br />
The final method, html, will populate our paragraphs with text. The String function, which we have already seen, simply returns the content of each item in our dataset. </p>
<p>We&#8217;re using select > selectAll > data > enter > append, but hopefully you will see why (and if you don&#8217;t, hang on to the end of the article, and feel free to ask questions).</p>
<p>But let&#8217;s recap once more. Actually, let&#8217;s see the many ways to get this wrong (or, surprisingly, right)</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).data(text).enter().append(&quot;p&quot;).html(String)</pre>
<p>We&#8217;ve alluded to that: without a container to put them in, p elements can&#8217;t be created. This will result in a DOM error.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).selectAll(&quot;p&quot;).data(text).append(&quot;p&quot;).html(String)</pre>
<p>No enter statement. After the selectAll, the selection has 0 items. This doesn&#8217;t change after the data method. As such, append creates 0 new elements, and nothing changes in the document. (but no error though)</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).data(text).selectAll(&quot;p&quot;).enter().append(&quot;p&quot;).html(String)</pre>
<p>In many cases in d3, it&#8217;s ok to switch the order of chained methods, but that&#8217;s not true here. selectAll must come before data. We bind data to elements. The other way round would have made sense, but that&#8217;s the way it is. First selectAll, then data. Here, we get an error, because enter() can&#8217;t be fired directly from selectAll. </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).selectAll(&quot;wootwoot&quot;)
.data(text).enter().append(&quot;p&quot;).html(String)</pre>
<p>This actually works. Why?<br />
There are actually 0 elements of type &#8220;wootwoot&#8221; in our document, which may or may not surprise you. There are still 3 items in the dataset, so enter() returns space for 3 new elements. the next append subsequently creates 3 p elements, which are populated by the html method.<br />
It usually makes more sense to use the same selector in the selectAll and the append methods, but that&#8217;s not always the case. Sometimes, you will be selecting elements of a specific class, but in an append method, you have to specify the name of an element, not any selector. So you&#8217;d go </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).selectAll(&quot;.myClass&quot;)
.data(text).enter().append(&quot;p&quot;).html(String).attr(&quot;class&quot;,&quot;myClass&quot;)</pre>
<p>Now that we&#8217;ve seen a few variations on the subject, here is a really cool use of enter. Check this out: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).selectAll(&quot;h1&quot;).data([{}]).enter().insert(&quot;h1&quot;).html(&quot;My title&quot;)</pre>
<p>ok there are 3 things here worth mentioning. 2 are just for show, though it doesn&#8217;t hurt to know them, but the 3rd one is really neat and useful.<br />
In data, we&#8217;ve passed: [{}]. This is an array of one object which is empty. There are two interesting things with that construct, one is that there&#8217;s only one element, the other one is that it&#8217;s an object. When you pass objects, the functions you run on them (like in the attr or style methods) can be used to add properties to them or change them. If that doesn&#8217;t make sense yet, just accept for now that it gives you more flexibility than using, say, [0].<br />
We&#8217;ve used insert instead of append. What this means is that we&#8217;re adding things before the first child of our container, not at the end (ie after the last child). In other words, our h1 (a title) will go at the top of the body element &#8211; fitting.</p>
<p>But what&#8217;s really interesting is what would happen if you were to run that statement again &#8211; nothing. try it. See?<br />
Why is that? Well, on your first go, at a point where there are no h1 elements yet, it works the standard way &#8211; you do a selectAll that returns nothing, you bind a dataset with more elements, then enter prepares space for the unmatched elements &#8211; 1 in our case &#8211; and then append creates that element. You may notice that the html part doesn&#8217;t use the data.<br />
When you run it again, the selectAll finds one h1 element, there&#8217;s still one item in the dataset, so enter won&#8217;t find any unmatched element, so the subsequent append is ignored. </p>
<p>So, you can run this kind of thing in a loop safely, it will only do what it&#8217;s supposed to do on the first go, it will be ignored afterwards. Don&#8217;t be afraid to use this construct for all the unique parts of your visualization, so you won&#8217;t have to worry about creating them multiple times.</p>
<h3>Other cases of mismatch between data items and elements</h3>
<p>All right, so now we have 3 p elements and 3 items in our dataset.<br />
What happens if we do this: </p>
<pre class="brush: jscript; title: ; notranslate" title="">text2=[&quot;hello world&quot;]
d3.selectAll(&quot;p&quot;).data(text2).html(String)</pre>
<p> ?</p>
<p>There is now one item in the data set, versus 3 p elements. Try to make a guess before you type this in. At the tutorial, the audience made a few reasonable guesses, namely: the last 2 paragraphs will be removed, only &#8220;hello world&#8221; will remain. Or: all paragraphs will be changed to &#8220;hello world&#8221;.<br />
Either could happen if d3 was trying to be smart and guess your intent. Fortunately, d3 is no excel here and behaves consistently even if that means extra work for you. When you do that (and please try this now) what happens is that the first paragraph of text is changed and the other two are untouched.</p>
<p>We are in the case, change the matched elements, ignore the others. </p>
<p>By the way, by now you should be able to guess what would have happened if there had been an enter() right after the data. Do I hear&#8230; nothing? almost! There would be no unmatched data element, so enter() would not return anything. Besides, enter() would require an append afterwards to make anything. This is why you&#8217;ll get an error: html can&#8217;t work directly after enter(). you would need an append. </p>
<p>Now what if we want to remove the extra 2 elements? This is where the exit() method comes into play.<br />
exit() is pretty much to enter() what remove() is to append(). Kind of.</p>
<p>let&#8217;s see how this work by example.</p>
<p>let&#8217;s recreate our 3 p paragraphs just in case: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).remove();
d3.select(&quot;body&quot;).selectAll(&quot;p&quot;).data(text).enter().append(&quot;p&quot;).html(String);</pre>
<p>Now we pass the new dataset:</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).data(text2).html(String)</pre>
<p> &#8211; remember that only the first paragraph has changed, the other two are untouched.<br />
Now, while all the items in the dataset are matched with elements, there are elements which are not matched with an item in the dataset: the last two. This is where exit() comes into play. exit() will select those two paragraphs, so they can be manipulated. Typically, what happens then is a remove(), but you could think of other options.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).data(text2).exit().style(&quot;color&quot;,&quot;red&quot;);</pre>
<p>That will flag them instead of removing them.<br />
But typically, you do: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).data(text2).exit().remove();</pre>
<p>. </p>
<p>note that even though you have already matched a one item dataset to that selection, to use exit(), you will need to use data before. selectAll(&#8220;p&#8221;).exit() won&#8217;t work. You&#8217;ll have to re-specify the data match. </p>
<p>So that takes care of the case when you want to remove extraneous data items.<br />
This leaves us with only one simple case: where you have more items in your dataset than you have elements and you don&#8217;t want to create elements for the extra data items.<br />
That&#8217;s the simplest syntax, really.</p>
<p>Here, for instance, we have only one paragraph left, but there are 3 items in the text variable.<br />
so let&#8217;s do: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).data(text).html(String)</pre>
<p> (no enter, no exit, no append).<br />
The paragraph text will now come from the new dataset (from its first item to be precise), no extra paragraphs will be created, none will be deleted.</p>
<h3>Data joins</h3>
<p>the last case (pass a new dataset, create new elements as needed, make some elements stay and make some elements go) requires more complexity and actually I won&#8217;t cover it in detail here, instead I will explain the principle and refer you to this tutorial on <a href="http://bost.ocks.org/mike/constancy/">object constancy</a> by Mike Bostock.<br />
In the general case, when you try to match your dataset to your elements, you count them and deal with the difference. So you have 5 data items and 3 elements: you can make 2 extra elements appear by using enter. With the concept of data joins, you can assign precisely each data item to one given element, so the first data item doesn&#8217;t have to be that of the first element, etc. Well, the first time it will be, and each element will receive a key, a unique identifier from the dataset. If the dataset is subsequently updated, the element will only be matched if there is an item in the dataset with the same key. Else, it will be found by an exit() method. </p>
<p>And that&#8217;s the general gist of it.<br />
At Strata, we went further &#8211; we discussed interaction and transition, but that is downward trivial once you have understood &#8211; and by that, really understood, with all the implications and nuances &#8211; the selections.</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-1488" class="post-1488 post type-post status-publish format-standard hentry category-conferences category-d3 category-data-visualization category-presentation category-tips tag-d3 tag-jeff-heer tag-scott-murray tag-tutorial tag-visweek">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2012/10/15/d3-tutorial-at-visweek-2012/" rel="bookmark"><time class="entry-date published" datetime="2012-10-15T21:11:32+00:00">October 15, 2012</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/conferences/" rel="category tag">conferences</a>, <a href="/category/d3/" rel="category tag">d3</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/presentation/" rel="category tag">presentation</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2012/10/15/d3-tutorial-at-visweek-2012/" rel="bookmark">d3 tutorial at visWeek 2012</a></h1>
         
    </header>
	<section class="post-content">

		<p>Jeff Heer, Scott Murray and myself have done a d3 tutorial at visWeek 2012. You probably gathered that from the title of the post.</p>
<p>Here is a link to all the slides and code examples that we have presented:</p>
<p><a href="http://jckr.github.io/blog/d3_tutorial.zip">d3 tutorial</a></p>
<p>For the purpose of the tutorial I have compiled a d3 cheat sheet, on 4 pages it groups some of the most common d3 functions. When I was learning d3 my number one problem was figuring out which property should be set using .attr, and which required .style. And also: which svg element support which property? All of this is addressed in the cheat sheet. It&#8217;s part of the link above, but if you want it directly without downloading a 13Mb file, here it is: </p>
<p><a href="http://jckr.github.io/blog/wp-content/uploads/2012/10/d3-cheat-sheet.pdf">d3 cheat sheet</a></p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-1419" class="post-1419 post type-post status-publish format-standard hentry category-d3 category-tips tag-beginner tag-browser tag-css tag-d3 tag-data tag-easyphp tag-first-steps tag-html tag-introduction tag-javascript tag-sublimetext2 tag-text-editor tag-tutorial tag-web-server">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2012/09/04/getting-to-hello-world-with-d3/" rel="bookmark"><time class="entry-date published" datetime="2012-09-04T17:20:53+00:00">September 4, 2012</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/d3/" rel="category tag">d3</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2012/09/04/getting-to-hello-world-with-d3/" rel="bookmark">Getting to &#8220;Hello world&#8221; with d3</a></h1>
         
    </header>
	<section class="post-content">

		<p>Back when I started learning programming, it was always fairly simple to achieve the canonical first step of accomplishments, that is, to get the system to announce that you are ready to do more by displaying &#8220;hello world&#8221; on the screen.</p>
<p>In most systems then, there was a command prompt somewhere that would usually do that when you would type, say:</p>
<pre class="brush: jscript; title: ; notranslate" title="">PRINT &quot;hello world&quot;</pre>
<p>.</p>
<p>Things have changed a lot since the early 80s. In some fields like fashion, I would argue it&#8217;s a good thing, but we&#8217;re definitely not going in the way of less complexity.</p>
<p>Now if you&#8217;re interested in web-oriented visualization and want to do it with d3.js, it&#8217;s still fairly simple, but it is built upon a number of technologies that you&#8217;re supposed to know a little. Front-end developers live and breathe the web and have been exposed to all things javascript, HTML, CSS, you name it, in enormous doses. Many developers probably have, at some point, tried to interface with the web and know enough of that to get started. So for this crowd, the amount of things you need to know to crack d3 code seems negligible, because they know all that and they are very familiar with it, just as well as people knew the first names of Friends characters by the end of the tenth season.</p>
<p>But what about those who didn&#8217;t? and the people who don&#8217;t see themselves as developers ? do they have to reimmerse themselves in 10 -odd years of web development history to get started? It turns out that this sum of knowledge, while not insurmountable, is certainly not trivial.</p>
<p>So without further ado, let&#8217;s get started</p>
<h1>We&#8217;re cooking an omelette</h1>
<p>And when we do, we need a few things: a pan, a recipe, eggs and stuff, a stove and then plates, knives and forks, etc.</p>
<h2>The pan: a text editor</h2>
<p>The first thing is really the pan. If you don&#8217;t have one when cooking eggs, you borrow one or go buy one. In our analogy the pan is the text editor. This is the tool with which you are going to make the files that will constitute your visualization.</p>
<p>There was a time when it was ok to use notepad (textedit if you are of the apple persuasion). And it&#8217;s still possible, but you are not making your life easier. What I recommend instead is that you get a hold of a copy of SublimeText2. (<a href="http://www.sublimetext.com/2">http://www.sublimetext.com/2</a>). There are windows versions. And Mac versions. And linux versions. For windows users, there is a mobile version so you don&#8217;t need administrator access to install it. There is a free, unlimited evaluation version,  but unless you can&#8217;t spend $69, I strongly recommend that you buy it. Sublime Text 2 has a nearly infinite amount of niceties built in. And unlike some other powerful text editors, where the best features are only understandable by the tech masters, what&#8217;s really nice about Sublime Text 2 is that it would make you gain time even if you are an absolute beginner. One such nice things that it does is detect what language you are working with, automatically color and format the words as you type them depending on the category they fall in, and when possible, suggesting the word you are trying to type, automatically format and indent your code, all in a very unobtrusive and pleasant way. This will really help you troubleshoot problems like strings not closed properly or loose closing bracket which typically consume a lot of time.</p>
<p><div id="attachment_1434" style="width: 423px" class="wp-caption aligncenter"><a href="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST0.png"><img class="size-full wp-image-1434" title="ST0" src="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST0.png" alt="" width="413" height="253" /></a><p class="wp-caption-text">Let&#8217;s type a fairly common d3 statement to see how SublimeText2 can help. First, it recognized the var keyword as such and writes it in italics and cyan. Second, when I type my opening parenthesis, it adds a closing one, and as long as my cursor touches either it underlines them both.</p></div></p>
<p><div id="attachment_1435" style="width: 423px" class="wp-caption aligncenter"><a href="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST1.png"><img class="size-full wp-image-1435" title="ST1" src="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST1.png" alt="" width="413" height="253" /></a><p class="wp-caption-text">Let&#8217;s carry on. The function keyword is highlighted in italics cyan too &#8211; useful. The opening/closing thing works for curly braces too.</p></div></p>
<p><div id="attachment_1426" style="width: 564px" class="wp-caption aligncenter"><a href="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST2.png"><img class="size-full wp-image-1426" title="ST2" src="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST2.png" alt="" width="554" height="253" /></a><p class="wp-caption-text">The return statement is highlighted in red. With the cursor on the closing parenthesis, we are starting to get a feel that the underlining function is a useful safety net</p></div></p>
<p><div id="attachment_1427" style="width: 564px" class="wp-caption aligncenter"><a href="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST3.png"><img class="size-full wp-image-1427" title="ST3" src="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST3.png" alt="" width="554" height="253" /></a><p class="wp-caption-text">New line. Joy! the indentation is aligned with the line above.</p></div></p>
<p><div id="attachment_1428" style="width: 564px" class="wp-caption aligncenter"><a href="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST4.png"><img class="size-full wp-image-1428" title="ST4" src="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST4.png" alt="" width="554" height="253" /></a><p class="wp-caption-text">We now have four consecutive opening or closing curly braces and parentheses. Typically, this is where errors sneak in, and where sublime text 2 really shines.</p></div></p>
<p><div id="attachment_1429" style="width: 564px" class="wp-caption aligncenter"><a href="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST5.png"><img class="size-full wp-image-1429" title="ST5" src="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST5.png" alt="" width="554" height="253" /></a><p class="wp-caption-text">And we now have 5 consecutive closing curly braces and parentheses. This is fairly common in d3 code. Is the order correct? Thank you Sublime Text 2!</p></div></p>
<p><div id="attachment_1430" style="width: 564px" class="wp-caption aligncenter"><a href="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST6.png"><img class="size-full wp-image-1430" title="ST6" src="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST6.png" alt="" width="554" height="253" /></a><p class="wp-caption-text">we finish up writing the statement.</p></div></p>
<p><div id="attachment_1431" style="width: 564px" class="wp-caption aligncenter"><a href="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST7.png"><img class="size-full wp-image-1431" title="ST7" src="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST7.png" alt="" width="554" height="253" /></a><p class="wp-caption-text">When moving the cursor to the left side, where the line numbers are, we notice down-pointing arrows. We know our code is correct, and we don&#8217;t want to see it again, so&#8230;</p></div></p>
<p><div id="attachment_1432" style="width: 564px" class="wp-caption aligncenter"><a href="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST8.png"><img class="size-full wp-image-1432" title="ST8" src="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST8.png" alt="" width="554" height="253" /></a><p class="wp-caption-text">we just click on the top one to collapse this section. If we need to edit it again we can expand it.</p></div></p>
<p><div id="attachment_1433" style="width: 564px" class="wp-caption aligncenter"><a href="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST9.png"><img class="size-full wp-image-1433" title="ST9" src="http://jckr.github.io/blog/wp-content/uploads/2012/09/ST9.png" alt="" width="554" height="253" /></a><p class="wp-caption-text">Finally, we add a comment above. Notice the syntax highlighting, comments are colored with an unobtrusive dark grey.</p></div></p>
<h2>The recipe: a basic file structure</h2>
<p>In d3, you can&#8217;t really type a &#8220;print&#8221; command from a prompt. You need to write some files, which are loaded by a browser (that&#8217;s your &#8220;plate&#8221; in the metaphor, but let&#8217;s not get ahead of ourselves).</p>
<p>You are going to need up to 5 types of files.</p>
<p>First, <strong>an html file</strong>. This will be the file that your browser will read, either locally, or uploaded on a website. We&#8217;ll get to cover this in detail in a minute.</p>
<p>Second, believe it or not, you are going to need the <strong>d3 library</strong>, which is also a file. You may link to the version on the <a href="http://d3js.org/d3.vs.min.js">d3js.org</a> site, and so not worry about having the actual file handy. That has advantages (like the one we just said, also, you&#8217;re pretty sure to always have the latest version on hand), and two problems. First, you always need to have a live internet connection, so there&#8217;s no working in the park outside of free wifi space (for example), and also, it will probably be slower than having the file locally or on your own web space. And if having your own web server seems kind of scary, I&#8217;ll show you in a short while that it&#8217;s not.</p>
<p>The three next kind of files are optional, but hey.</p>
<p>The third file is a <strong>javascript .js file </strong>which would be where you put your code. Some people would rather put all their code in the html file, which is an option, especially for short programs. Personally, I prefer having a separate file. So to make d3 work, you <em>need</em> some script, but it doesn&#8217;t have to be in a separate file.</p>
<p>The fourth file is a <strong>style sheet</strong>, or <strong>css</strong> file. This can be used to define some formatting options, for instance to make all your circles blue by default, or some circles that meet some pre-defined criterion. Like the javascript file, any style information can be contained within the html file, but unlike the script, it is completely optional. I also like to keep it separate from the html.</p>
<p>Finally, you may want a <strong>data file</strong>, you know, with data (csv, txt, json, xml&#8230;). If you have lots of data to visualize, it&#8217;s easier to keep it in separate files than in variables within the script. But it doesn&#8217;t have to be that way. And you could also use d3 without data.</p>
<h2>The ingredients: contents of the files</h2>
<h3>The HTML file</h3>
<p>So let&#8217;s see how this articulates by looking at a typical d3 html file. I am using templates which I try to change as little as possible from project to project.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
 &lt;head&gt;
   &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;
   &lt;title&gt;My project&lt;/title&gt;
   &lt;script type=&quot;text/javascript&quot; src=&quot;../d3.v2.js&quot;&gt;&lt;/script&gt;
   &lt;link href=&quot;style.css&quot; rel=&quot;stylesheet&quot;&gt;
 &lt;/head&gt;
 &lt;body&gt;
   &lt;div id=&quot;chart&quot;&gt;
   &lt;/div&gt;
   &lt;script type=&quot;text/javascript&quot; src=&quot;script.js&quot;&gt;&lt;/script&gt;
 &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>Well. That is certainly longer than the BASIC one-liner (and we haven&#8217;t <em>even</em> printed &#8220;hello world&#8221; yet).</p>
<p>Let&#8217;s take this piece by piece.</p>
<p>The first line is a doctype declaration. What this does is that it tells your browser that what follows should be interpreted as standard, HTML5-compliant HTML (standards mode). If you omit the doctype documentation, your browser will read the html in &#8220;<a href="https://developer.mozilla.org/en/Mozilla%2527s_Quirks_Mode">quirks mode</a>&#8220;, i.e. by replicating the non-standard behavior of Nescape 4 or IE5. You can still try to run d3 under quirks mode, but don&#8217;t be surprised if your HTML doesn&#8217;t behave as expected.</p>
<p>The doctype declaration doesn&#8217;t have to be more complicated than &lt;!DOCTYPE html&gt;.</p>
<p>The second line opens the html document proper. Technically, it&#8217;s ok to omit &lt;html&gt;, &lt;head&gt; and &lt;body&gt; tags in HTML5. The document will still be considered valid by tools like the <a href="http://validator.w3.org/">W3C validator</a>. But it seems that some browsers, in some complex cases, don&#8217;t like that so much, and I as a person find it more convenient to find those tags when reading code.</p>
<p>The next line opens the header section of the document. Again, it&#8217;s not absolutely necessary, but I consider it helpful to explicitly differentiate the header from the rest of the document.</p>
<p>The next line, which goes</p>
<pre class="brush: jscript; title: ; notranslate" title="">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;</pre>
<p>is not absolutely required either. It specifies the encoding of the page, that is, what kind of characters will be seen in the page. Since I use non-ascii characters often, being French and all, I make sure to use it all the time. After all, this is a template, not something I type from beginning to end each time.</p>
<p>Next, we specify a title. This is what will appear in the title area of your browser, or, more likely, as the name of your tab.</p>
<p>In the next line, we load the d3 library. This is my preferred syntax. This is how my files are set up:</p>
<p>I have a directory where all my d3 projects are, and in this directory, I am also keeping (and maintaining reasonably up-to-date) a version of the d3 library, a file called d3.v2.min.js. (min stands for minified, which means that it&#8217;s not meant to be read by persons, but it&#8217;s faster to load). All my projects proper are in folders within that directory. So my html files are one level down from where the d3.v2.min.js file is kept. This is why the src attribute reads &#8220;../d3.v2.min.js&#8221;: the ../ part means, look one level up. If the d3.v2.min.js file were on the same directory where I keep my html, I would write src=&#8221;d3.v2.min.js&#8221;, if I kept it within a specific directory like &#8220;d3&#8243;, I could write src=&#8221;../d3/d3.v2.min.js&#8221;, and finally, there is always the option of getting it from the website, src=&#8221;https://d3js.org/d3.v2.min.js&#8221;.</p>
<p>I don&#8217;t have to load the d3 library then. I could have done it at the end of the page. The only requirement is that it should be before the script that will use it. But honestly, the file is so small that it doesn&#8217;t make much of a difference (9ms on my machine).</p>
<p>Next, I link to a style sheet. With this syntax, I am assuming that my style is specified in a file called style.css which will be in the same directory as this html page. And if there is no such file, it&#8217;s not a problem. It doesn&#8217;t prevent the page to load.</p>
<p>Instead of using this syntax, I could have written:</p>
<pre class="brush: jscript; title: ; notranslate" title="">

&lt;style&gt;

... // my style definitions

&lt;/style&gt;

</pre>
<p>in the html file. And frankly, it is sometimes more convenient. But again, for the general case, it&#8217;s just as well to leave it like this.</p>
<p>Note that style information should always be in the header part of the file.</p>
<p>And that concludes the header, as noted by the closing tag &lt;/head&gt;. Even if we use the &lt;head&gt; tag to mark the beginning of the header section, we may omit the closing tag &lt;/head&gt;, and still get away with a valid (and slightly shorter) document, but I keep it for clarity&#8217;s sake.</p>
<p>The next part starts with &lt;body&gt;, and is where the content proper, which will get displayed on the screen, is described. &lt;body&gt; and &lt;/body&gt;, just like &lt;html&gt; and &lt;head&gt;, are not mandatory, but do help, somewhat, to make the document easier to read.</p>
<p>So what do we find in the body section? Here, I&#8217;ve kept it very simple but also close to the conventions I use.</p>
<p>There is one &lt;div&gt; element, which is the basic building block of HTML, and with an id attribute &#8211; a document-wide, unique identifier &#8211; called &#8220;chart&#8221;.</p>
<p>Then, there is the &lt;script&gt; element, which is calling the javascript code we are going to use to create our visualization. It&#8217;s at the very bottom of the page, actually just before the closing tags (which, again, could be omitted, but let&#8217;s not).</p>
<p>Like for the style element, it is possible to leave the script inside the html document. Instead of using a src attribute &#8211; which, incidentally, assumes that the script is within the same directory as the html document with this syntax -, we can write:</p>
<pre class="brush: jscript; title: ; notranslate" title="">&lt;script&gt;

// all our javascript instructions

&lt;/script&gt;</pre>
<p>And that&#8217;s it for the html document! A final word about the contents of the &lt;body&gt; element. In most of my projects, there is an interface such as buttons or controls which is also done in HTML. In that case, the contents of the &lt;body&gt; element get more complex. I would add a button to tweet the page, copyright notices, and other stuff. But I almost always have a &lt;div&gt; element with an identifier named &#8220;chart&#8221;.</p>
<p>ok, so now that you&#8217;re finished with writing your html file, you must save it under any name and use the &#8220;.html&#8221; extension (or .htm, but why no love for the l? why?)</p>
<h3>The javascript file</h3>
<p>In this section I will walk you through a very, very basic file, which includes things I do for every project.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
var w=960,h=500,
svg=d3.select(&quot;#chart&quot;)
.append(&quot;svg&quot;)
.attr(&quot;width&quot;,w)
.attr(&quot;height&quot;,h);

var text=svg
.append(&quot;text&quot;)
.text(&quot;hello world&quot;)
.attr(&quot;y&quot;,50);

</pre>
<p>I like to define variables that describe the width and length of the visualization that I am creating. By putting these in variables, at the beginning of the file, I can easily modify them in case I need to. 960 and 500 work well for visualizations that should appear on their own page, by the way. No scrolling should be necessary.</p>
<p>The next statement use the d3.select construct. Here, it indicates that we are going to build something <em>on top </em> of the element that meets the criterion that is described between the parentheses. The syntax used by that is that of <a href="https://developer.mozilla.org/en/CSS/Getting_Started/Selectors">css selectors</a>, but long story short, #chart refers to whatever has an &#8220;id&#8221; attribute of &#8220;chart&#8221;. This is our lone &lt;div&gt; element in the html file. Then, we are going to add an svg element, which is what will hold the visualization proper in svg form, and give it a width of w and a height of h.</p>
<p>I always use that syntax, an &#8220;svg&#8221; variable that holds the top-level svg container, which resides in a &lt;div&gt; element which has an id of &#8220;chart&#8221;.</p>
<p>The final part of the file writes, finally, hello world proper. Note that I specify a y attribute (vertical position) else the text have its lower-left corner in the top-left corner of the browser window and will be effectively invisible.</p>
<p>Now, the HTML file we just created expect this file to be called &#8220;script.js&#8221;, so let&#8217;s save it under this name.</p>
<p>In this most simple example, we will not need a css file nor a data file. But, for the sake of discussion, let&#8217;s create a css file nonetheless.</p>
<pre class="brush: jscript; title: ; notranslate" title="">

text:{font-size:36px;}

</pre>
<p>and let&#8217;s save this under style.css (the name that, again, our HTML file expects). What this does is that it changes the size of the font to whatever the default was to a more massive 36 pixels.</p>
<h2>The stove: a web server</h2>
<p>As far as writing hello world, we&#8217;re done. You can load the html file you created in a browser, you should see the encouraging inscription. Congratulations!</p>
<p>Many visualizations can be seen in a browser directly, just by opening a local file. However, this won&#8217;t be the case for some, for instance, those who require external data. In that case, you need a web server. If you have web hosting, you may upload the files to your (remote) server, via FTP for instance, and see your visualization by typing the address of your site in the browser url bar. That said, it is a good idea to have a local web server, that is, one that runs on your computer, so you can view your files as if they were served by a web server, but with the added bonus that you can edit them and see the modifications directly without having to upload them each time you change them.</p>
<p>On Macs, you&#8217;re pretty much all set. All you have to do is <a href="http://pagekite.net/wiki/Howto/Mac/PersonalWebServer/">enable web-sharing</a> in your system preferences. Then, http://localhost/~YOURNAME will point to /Users/YOURNAME/Sites where YOURNAME is your user name. Just put your files there and go at it.</p>
<p>For windows, there are a bunch of solutions. The &#8220;Professional&#8221; versions of windows include the IIS web server, so, there. But beyond that, there is a lot of web server software available. I personally use <a href="http://www.easyphp.org/">EasyPHP</a>. EasyPHP comes up with a web server (Apache), a mySql database, a PHP preprocessor and other niceties. And, as an aside, it doesn&#8217;t require administrator rights, for you corporate users.</p>
<p>EasyPHP installation is a breeze. When it&#8217;s on, by default, http://localhost/ points to the www/ directory in the install directory of EasyPHP, so you may want to install it in a place that suits you. Alternatively, you can create aliases in the admin panel of EasyPHP (<a href="http://localhost/home/index.php">http://localhost/home/index.php</a>), in other words to give a name to any part of your hard drive. This is what I do, I put all my projects there and have a shortcut to that name in my browser, so whenever I want to see a project I use that shortcut and I can see the visualization as if it were on the web.</p>
<p><div id="attachment_1436" style="width: 787px" class="wp-caption aligncenter"><a href="http://jckr.github.io/blog/wp-content/uploads/2012/09/easyPHPalias.png"><img class="size-full wp-image-1436" title="easyPHPalias" src="http://jckr.github.io/blog/wp-content/uploads/2012/09/easyPHPalias.png" alt="" width="777" height="526" /></a><p class="wp-caption-text">This is how you create aliases in EasyPHP.</p></div></p>
<h2>The plate: a browser</h2>
<p>We&#8217;ve talked browsers before, and chances are you have one (or several) on your computer.</p>
<p>Now I wish that by browsers, we could just skip it and mean &#8220;the latest version of chrome&#8221;, but it turns out that there are slight differences in the way that browsers handle d3 code so you should really test your work in at least chrome and firefox. As of this writing, Chrome + Firefox (version 5 and up) represent just under 50% of the browser market share. If you add all browsers that are d3-capable (Safari, earlier versions of Firefox, Opera, IE9) you reach about 75% of the market. Sadly, IE8 and IE7 which account for slightly over 20% of the market are not d3-compatible, though they can use the Google <a href="http://www.google.com/chromeframe?hl=en&amp;quickenable=true">ChromeFrame</a> free plug-in and do pretty much all that chrome does.</p>
<h2>Knives and forks: the console</h2>
<p>At the beginning of my dad&#8217;s engineering career, code came on a punch card. People then, allegedly, thought it through. You didn&#8217;t want to be the kid who didn&#8217;t follow your algorithm carefully enough to forecast an avoidable bug and waste a perfectly good card and oh-so precious computing time.</p>
<p>But now? no code is perfect by the time it hits the browser. You may want to launch incomplete code to get a feel for where you&#8217;re going. You may not be too sure of whether that should be a plus or a minus in that equation and just try either because it would be quicker to correct an unexpected outcome than to troubleshoot the formula on paper. You may want to iterate, to bring newer, more complex ideas to your visualization with each change to the code. Or just try out different aesthetic options.</p>
<p>Not too long ago, debugging javascript was really a pain. You&#8217;d have to fire those annoying alert boxes to understand what was the value of the variables, and dispatch them manually. Fortunately, that time is gone and now is the age of the Console.</p>
<p>There are console functionalities for Chrome, Firefox and Safari, and while the interface slightly varies, the idea is the same. The console allows you to do three main things:</p>
<p>&#8211; first, to see if your code executed without errors or warning. Some of those messages can be generated by javascript, and some can be added by you if certain unfortunate conditions are met. You get the position of the error in your code, which helps you to understand what went wrong and fix it.</p>
<p><div id="attachment_1437" style="width: 661px" class="wp-caption aligncenter"><a href="http://jckr.github.io/blog/wp-content/uploads/2012/09/consoleError.png"><img class="wp-image-1437" title="consoleError" src="http://jckr.github.io/blog/wp-content/uploads/2012/09/consoleError.png" alt="" width="651" height="469" /></a><p class="wp-caption-text">I have planted an error at the end of the code and it&#8217;s been picked up by the console which explains what&#8217;s wrong and when. Notice the red cross in the lower-right corner which counts errors. If there were warning, they would be indicated by a yellow triangle.</p></div></p>
<p>&#8211; second, to inspect elements, that is to find out all the information about the elements displayed on screen, even if (especially if) they have been generated at runtime. So you can see if those elements you really wanted to create have been indeed added, and if the right attributes have been passed.  third, to interact with the code after it&#8217;s run (or while it runs, if you manage to pause if with breakpoints). The most common use of this is, IMO, is to check the value of variables, which you can do simply by typing their name at the console command prompt. But you can also type in one-liner javascript statements, even if they are quite complicated. So it&#8217;s a way to test your code before you write it in your script file.</p>
<p><div id="attachment_1439" style="width: 661px" class="wp-caption aligncenter"><a href="http://jckr.github.io/blog/wp-content/uploads/2012/09/consoleInspect.png"><img class="wp-image-1439" title="consoleInspect" src="http://jckr.github.io/blog/wp-content/uploads/2012/09/consoleInspect.png" alt="" width="651" height="469" /></a><p class="wp-caption-text">What a relief! all those paths elements that were supposed to be created in the code have been added as expected.</p></div></p>
<p>&#8211; third, it can be used to interact with the code after it&#8217;s run (or even during run-time, because you can pause the code with breakpoints using the console, but we won&#8217;t go into that). The most common use for that IMO is to check the value of variables, which can be changed during the code execution, but it can also be used to enter one-liner statements, which can be quite complicated. Such a use allows you to test and preview code hypothesis before you write it down in your script file, or to troubleshoot a problem that you could have difficulties seeing outside of the context.</p>
<p><div id="attachment_1438" style="width: 661px" class="wp-caption aligncenter"><a href="http://jckr.github.io/blog/wp-content/uploads/2012/09/consoleInteract.png"><img class="wp-image-1438" title="consoleInteract" src="http://jckr.github.io/blog/wp-content/uploads/2012/09/consoleInteract.png" alt="" width="651" height="469" /></a><p class="wp-caption-text">Here, I am using the console to check the value of one variable, and to enter a statement that turns all the shapes orange.</p></div></p>
<p>Voilà! the last thing you need when you cook food is people to share it with, same goes for visualizations!</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-1351" class="post-1351 post type-post status-publish format-standard hentry category-d3 category-tips tag-animations tag-d3 tag-transitions tag-tutorial">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2012/07/16/animations-and-transitions/" rel="bookmark"><time class="entry-date published" datetime="2012-07-16T11:44:09+00:00">July 16, 2012</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/d3/" rel="category tag">d3</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2012/07/16/animations-and-transitions/" rel="bookmark">animations and transitions</a></h1>
         
    </header>
	<section class="post-content">

		<p><strong>That post originally appeared on <a href="/category/tips/page/2/blog.visual.ly/creating-animations-and-transitions-with-d3-js/">visual.ly</a>, I&#8217;m reproducing it here for clarity and ease of retrieval</strong></p>
<p>In interactive visualisation, there is the word reactive. Well, maybe not literally, but close enough.<br />
The fact is that reactivity, or the propension of a visualisation to respond to user actions, can really help engage the user in a visualisation, and help them understand its results. Both of which are usually good things. And how can this reactivity be achieved? Through animations. </p>
<p>So I&#8217;ll go ahead and state that <strong>animation, if done right, can make any interactive data visualization better.</strong>.<br />
How is that?</p>
<ul>
<li>When coupled with interaction, it&#8217;s a very useful way to give feedback to the user. What has changed since their last command? If what&#8217;s on screen animates from one state to another, it&#8217;s obvious, it stands out and it makes sense. Or, when showing any form of real-time data, animation is pretty much required.</li>
<li>Animation can bring focus on the important things as a chart loads. Our vision is very sensitive to movement, so using these <em>introduction transitions</em> sensibly helps a lot to ease the effort required to get the right information off a chart.<br />
Compare these two charts:<br />
<iframe src="http://jckr.github.io/blog/stuff/transitions.html#15" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
<iframe src="http://jckr.github.io/blog/stuff/transitions.html#16" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
Which is better at getting the viewer&#8217;s attention on the last bar?<br />
<em>[side note on examples: they all use the same model. Click on the button to start an animation. If there is nothing on the chart, clicking the button will make something appear.]</em>
</li>
<li>animation works well with metaphors, like growing, expanding, moving, dwindling, etc. so it can really enhance the expressiveness of a visualization that tries to convey any of these ideas (those and many others)	</li>
</ul>
<p>That&#8217;s said, animation can definitely ruin your visualization, too. Here are three general problems. </p>
<ul>
<li>Animation is very prominent. That can be good to call attention to a specific, unambiguous part of your chart. But what happens when there is too much animation? without other cues it gets difficult for a viewer to determine where to focus their attention.</li>
<li> Animation across many states (like a video of animated data) make them difficult to compare to one another, as opposed to showing still images of various states side by side. (see <a href="http://www.cc.gatech.edu/~john.stasko/papers/infovis08-anim.pdf" title="Effectiveness of Animation in Trend Visualization"></a> for more on this.</li>
<li>If the animation is not continuous, if the chart is somehow wiped out during it, this caused <a href="http://nivea.psycho.univ-paris5.fr/Mudsplash/Nature_Supp_Inf/Movies/Movie_List.html">change blindness</a> which pretty much negates any benefit you may have hoped to reap from animation.<br />
Look at this example.<br />
<iframe src="http://jckr.github.io/blog/stuff/transitions.html#17" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
When animated, the line goes through a blank state which makes is close to impossible to track changes between the original and final state. The only way to detect change is to focus on one given point and memorize its original position, but this is very ineffective.
</li>
</ul>
<h3>Now how to do it?</h3>
<p>So we&#8217;ve seen how animation is helpful in data visualization. Now, let&#8217;s do it!<br />
For this purpose, let&#8217;s use <a href="http://d3-js.org/">d3</a>. d3 has many, many possibilities when it comes to data animation which are relatively painless to implement.</p>
<h4>The principle</h4>
<p>If you know how to draw in d3, you almost know how to animate. (and if you don&#8217;t know yet, <a href="http://alignedleft.com/tutorials/">Alignedleft</a> has a splendid collection of tutorials to get you started, and the <a href="https://github.com/mbostock/d3/wiki/Tutorials">d3 site</a> lists more including some by <a href="http://jckr.github.io/blog/blog/category/d3/">yours truly</a>.)<br />
Animations are called transitions in d3 for a reason. A technical definition of animation can be that over a certain lapse of time, one or more characteristics of an object would <i>transition</i> from one value to another. </p>
<p>And what do we mean by characteristics? Well, just about anything that can be expressed numerically. </p>
<h4>A few examples of transitions</h4>
<p><iframe src="http://jckr.github.io/blog/stuff/transitions.html#0" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
Unsuprisingly, when you update the position of an item smoothly over time, it moves. In svg, position is determined for most shapes, such as our blue rectangle here, by the x and y attributes, which correspond to the top-left corner of the shape. For circles, you use cx and cy, or the coordinates of the center. For paths, such as our red triangle, you actually specify the position of all of the points in the &#8220;d&#8221; attribute.</p>
<p><iframe src="http://jckr.github.io/blog/stuff/transitions.html#1" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
Likewise, when you change size, your object grows (or shrinks!). You can use width and height for shapes like rectangles, or r for circles. </p>
<p><iframe src="http://jckr.github.io/blog/stuff/transitions.html#2" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
Color is really a numerical attribute too, and it&#8217;s indeed possible (and very useful) to transition from one color to another. In svg, color is a style attribute that is defined by fill or stroke.</p>
<p><iframe src="http://jckr.github.io/blog/stuff/transitions.html#3" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
Not unlike color, it&#8217;s very useful to be able to vary opacity. When opacity is set to 0, the corresponding object is completely transparent. So transitioning on opacity is very useful to make objects fade in or out. </p>
<h4>How this is done</h4>
<p>Now that we&#8217;ve seen what transitions can do, let&#8217;s see how to code this in d3.<br />
Let&#8217;s go back to our first example. In fact, let&#8217;s make it even simpler.</p>
<p><iframe src="http://jckr.github.io/blog/stuff/transitions.html#4" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
To create a square like this in d3, we would write something like:</p>
<pre class="brush: jscript; title: ; notranslate" title="">
var mySquare=svg.append(&quot;rect&quot;)
  .attr(&quot;x&quot;,60)
  .attr(&quot;y&quot;,60)
  .attr(&quot;width&quot;,60)
  .attr(&quot;height&quot;,60);
</pre>
<p>4 attributes. Simple enough.<br />
so if we want to make it move to the right, we are going to update the x attribute. That&#8217;s how we do it: </p>
<pre class="brush: jscript; title: ; notranslate" title="">
mySquare
  .transition()
  .attr(&quot;x&quot;,320);
</pre>
<p>It&#8217;s that simple: use the transition method, then specify all you want to see changed just as if you were creating a new item. And using that one principle, we can easily reproduce any of the above examples.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
mySquare
  .transition()
  .attr(&quot;width&quot;,120); // will make it bigger

mySquare
  .style(&quot;fill&quot;,&quot;white&quot;) // if the fill is originally left blank and comes
                         //  from a style sheet, it will start as black 
  .transition()
  .style(&quot;fill&quot;,&quot;blue&quot;);

mySquare
  .transition()
  .style(&quot;opacity&quot;,0);
</pre>
<p>Now, in our simple examples, this is not exactly what happens. The transitions occur after an event, namely, when the user clicks on the button. And indeed, transitions are most useful when linked to events and interaction. But this doesn&#8217;t add a whole new layer of complexity.<br />
We can just write: </p>
<pre class="brush: jscript; title: ; notranslate" title="">
button.on(&quot;click&quot;, function() {
  mySquare.transition().attr(&quot;x&quot;,320);
})
</pre>
<p>And now, our animation only starts when the button is clicked. Obviously, since the transition is within a function, we could even determine where the square should go programmatically, but let&#8217;s keep it simple for the examples. </p>
<h4>Animation 102</h4>
<p>So far, we&#8217;ve seen how we can do simple animations in d3 and even throw in a little interaction. We&#8217;ve seen that it&#8217;s really as simple as creating elements in the same place. But here are some good news. Transitions in d3 are extremely versatile and can be customized with a lot of finesse without getting overly complex to write. It&#8217;s more a matter of knowing what to do.</p>
<p><iframe src="http://jckr.github.io/blog/stuff/transitions.html#5" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
After using the transition() method, it&#8217;s possible to specify a value for duration and delay. Duration is the number of milliseconds the transition will last, while delay is the number of milliseconds the system will wait before launching it.<br />
The syntax is: </p>
<pre class="brush: jscript; title: ; notranslate" title="">
mySquare.transition()
  .attr(&quot;x&quot;,320)
  .duration(1000) // this is 1s
  .delay(100)     // this is 0.1s
</pre>
<p>The default is a 250ms duration, and no delay.<br />
I find 250ms to be a bit harsh. In most cases, transitions should be noticeable, so I oftentimes find myself increasing the duration to 500 or 1000. But unless there is a very good reason for that, durations should not be too long. If you use them to support your data, you don&#8217;t want the transition to take center stage by having them take several seconds.<br />
Consider the following two examples (which you&#8217;ll have to start with the button)<br />
<iframe src="http://jckr.github.io/blog/stuff/transitions.html#13" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
<iframe src="http://jckr.github.io/blog/stuff/transitions.html#14" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
Isn&#8217;t the second one simply atrocious? You may find hard to believe that it only wasted 25 seconds of your time. </p>
<p><iframe src="http://jckr.github.io/blog/stuff/transitions.html#6" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
Easing is the technical name of the actual function that turns time into attribute changes. From the previous examples, you may have noticed that the values change slowly first, and then faster, then slowly at the end? Well, it turns out that you can use different functions to get different results. In my practice, I&#8217;ve only seen the use for the 3 displayed here although there are <a href="https://github.com/mbostock/d3/wiki/Transitions#wiki-d3_ease">many others</a>. And yes, you can write your own, although we are not going to cover this here.<br />
The syntax is similar to the above: </p>
<pre class="brush: jscript; title: ; notranslate" title="">
mysquare.transition()
  .attr(&quot;x&quot;,320)
  .ease(&quot;elastic&quot;)
</pre>
<p>(and by the way, the order in which you change attributes or specify animation parameters has no effect, so feel free to use .ease first then .attr).</p>
<p><iframe src="http://jckr.github.io/blog/stuff/transitions.html#7" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
For path objects, through transitions you can update the position of each point. This allows you to effectively turn one shape into another.<br />
This can be especially interesting for line charts (or any chart which is a path)<br />
<iframe src="http://jckr.github.io/blog/stuff/transitions.html#8" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
Like this, if the values that you are plotting change, you can spot these changes very efficiently. If, instead, you just erase your chart redraw your data if would be very difficult to spot where the data has changed.<br />
For both of these examples, the &#8220;d&#8221; attribute of the path is updated (so they are not intrinsically different from the simplest example).</p>
<p><iframe src="http://jckr.github.io/blog/stuff/transitions.html#9" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
Sometimes (and actually: often), you want to fire a transition right after another transition.<br />
But in case you were wondering, the following doesn&#8217;t work: </p>
<pre class="brush: jscript; title: ; notranslate" title="">
mysquare.transition()
  .attr(&quot;x&quot;,320);
mysquare.transition()
  .attr(&quot;y&quot;,200);
</pre>
<p>You may think that this will move the square right, then down. But no: it will start to move the square right, then fire the second transition which will move it down. Since they have the same duration and no delay, what will happen is that only the second will have a visible effect.<br />
If the second transition had a delay, smaller than the first transition&#8217;s duration, the first one will be in effect for a while until the delay expires. Then, the second transition will take over. However, chances are you don&#8217;t want to do that, because how much of the first transition will have been accomplished depends on the users machine, browser etc. and is therefore unpredictable.<br />
So how about giving the second transition a delay which corresponds exactly to the duration of the first one? This will usually work, however, the delays and durations are not extremely accurate. Firing the transition proper takes a certain time (which is roughly 15ms on my machine and which may vary) so it is difficult to chain two transitions very precisely this way.<br />
In more complex programs than our simplistic examples, sometimes, several events try to trigger transitions on the same object. When this happens, the first transaction is fired, and runs its course unless another transition starts. That second transition would interrupt, then replace the first one. What this means is that the attributes that were in the process of being changed by the first transition will remain as they were when the second transition starts, somewhere between their start and target value.<br />
If you want to make sure that all your transitions update their attribute up to the value they are supposed to reach, you may want to re-specify the attributes of the first transition in subsequent ones, like so:</p>
<pre class="brush: jscript; title: ; notranslate" title="">
mysquare.transition()
  .attr(&quot;x&quot;,320);
mysquare.transition()
  .delay(250)
  .attr(&quot;y&quot;,200)
  .attr(&quot;x&quot;,320); // even if the first transition doesn't complete, 
                  // this one will and will update x to 320.
</pre>
<p>There is a more certain way to chain two transitions. With the following syntax, another event will start exactly at the end of a transition. That other event can be another transition (which is the case in the above example).</p>
<pre class="brush: jscript; title: ; notranslate" title="">
mysquare
 .transition() 

 ...

 .each(&quot;end&quot;, function() { ... });
</pre>
<p>here, what&#8217;s in the callback function on the last line, introduced by .each(&#8220;end&#8221;, will be fired exactly as the transition ends. </p>
<p>What can be done then? Here are 3 common scenarios.</p>
<p><iframe src="http://jckr.github.io/blog/stuff/transitions.html#9" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
(btw, if you&#8217;re wondering what&#8217;s the difference between this and the previous example, there is none &#8211; it&#8217;s just to save you some scrolling).<br />
One possibility is to launch another transition on the same item. Here, the square moves right, then down.<br />
Here&#8217;s how it&#8217;s done: </p>
<pre class="brush: jscript; title: ; notranslate" title="">
mysquare
  .transition()
  .attr(&quot;x&quot;,320)
  .each(&quot;end&quot;,function() { // as seen above
    d3.select(this).       // this is the object 
      transition()         // a new transition!
        .attr(&quot;y&quot;,180);    // we could have had another
                           // .each(&quot;end&quot; construct here.
   });
</pre>
<p>Another possibility is to delete the object after the transition has run its course. This is super useful, especially when you are creating a lot of temporary objects. An interesting combo is when you decrease opacity all the way to 0, making it invisible, then using remove() if you don&#8217;t need it anymore.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
mysquare
  .transition()
  .attr(&quot;x&quot;,320)
  .each(&quot;end&quot;,function() { 
    d3.select(this).       // so far, as above
      remove();            // we delete the object instead 
   });
</pre>
<p>Finally, we can create a new object. That can be a nice way to add a special effect. Here&#8217;s an example: </p>
<p><iframe src="http://jckr.github.io/blog/stuff/transitions.html#10" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
Here, at the end of the transition, a circle is created, a transition is started on that circle, which decreases opacity to 0, then the circle is removed. </p>
<p><iframe src="http://jckr.github.io/blog/stuff/transitions.html#11" width=502px height=202px scrolling=no style="border:0px"></iframe><br />
And here is a last example with several effects combined.</p>
<h4>Going further</h4>
<p>Believe it or not, we barely scratched the surface of what can be achieved with animations in d3.<br />
There are two other uses of transition that we haven&#8217;t seen because they are slightly more complex, so I&#8217;ll just mention them here.<br />
Up to now, we have always seen transitions based on the properties of one specific object. We make the x property of that one square vary from what it was to 200.<br />
Sometimes, though, you want many parts of your visualization to be updated according to the changes in one variable.<br />
That is possible, too, by using the .tween and .interpolate methods. All of this is explained in the <a href="https://github.com/mbostock/d3/wiki/Transitions#wiki-tween">d3 documentation</a>.<br />
Another possibility is the use of the <a href="https://github.com/mbostock/d3/wiki/Transitions#wiki-d3_timer">d3 timer</a> method, which allows to call a function repeatedly, which can also be used to create animation.</p>
<p>The point I was hoping to make was that it&#8217;s possible to do a lot with relatively simple code and technique if you know what you are trying to do. Especially, chaining transitions, particularly when adding and removing objects when appropriate, goes a long way in creating powerful effects.</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-1395" class="post-1395 post type-post status-publish format-standard hentry category-d3 category-data-visualization category-tips tag-d3 tag-embedding tag-tableau tag-wordpress">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2012/07/02/embedding-tableau-visualizations-on-the-web/" rel="bookmark"><time class="entry-date published" datetime="2012-07-02T19:42:13+00:00">July 2, 2012</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/d3/" rel="category tag">d3</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2012/07/02/embedding-tableau-visualizations-on-the-web/" rel="bookmark">Embedding tableau visualizations on the web</a></h1>
         
    </header>
	<section class="post-content">

		<p>I&#8217;m writing this short post because I see that exact phrase come up in the search engine terms of the blog now and again (along with &#8220;<a href="http://thazing.com/hello-this-is-bathtub/#.T_HYBsXxqGM">Hello this is bathtub</a>&#8221; but I can&#8217;t really help there).</p>
<p>Long story short. I run into problems all the time trying to properly embed Tableau vis into wordpress blog posts. Does it happen outside of wordpress, I don&#8217;t know, because I don&#8217;t really try to embed Tableau vis outside of wordpress. That said, I have the same problem with d3 vis in wordpress and I&#8217;ve been asked several times how do I do it.</p>
<h3>iframes.</h3>
<p>That&#8217;s how.</p>
<p>Here is what I did <a href="http://jckr.github.io/blog/blog/2012/06/30/tableau-2012-sports-visualization-contest-entry/">last time</a>.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
&lt;iframe
  style=&quot;border: 0px;&quot;
  src=&quot;http://public.tableausoftware.com/views/champions/champions?:embed=y&amp;amp;:from_wg=true&quot;
  scrolling=&quot;no&quot;
  width=&quot;652px&quot;
  height=&quot;756px&quot;&gt;
&lt;/iframe&gt;
</pre>
<p>so you&#8217;ll have to go to HTML mode and type it out. When it&#8217;s done, you can safely go back to visual mode if you feel like it.<br />
Let&#8217;s go through these lines one by one (btw, they don&#8217;t have to appear one line at a time, it&#8217;s just for presentation purposes).</p>
<p>Most important, what in on src. That&#8217;s simply the link to the page of your tableau vis. And if that&#8217;s not clear enough, it goes like this:<br />
http://public.tableausoftware.com/views/ + <em>name of your workbook</em> + / + <em>name of your dashboard or sheet</em>.</p>
<p>Since I want to show a dashboard called champions in a workbook called champions as well, that&#8217;s http://public.tableausoftware.com/views/champions/champions.</p>
<p>I&#8217;m not sure whether what&#8217;s after the dashboard name is important. I&#8217;ll leave that as an exercise to figure it out. I&#8217;m pretty confident things work without it.</p>
<p>Then the rest.</p>
<p>style=&#8221;border: 0px&#8221; Yes, because you don&#8217;t want an ugly border around your iframe. or do you?</p>
<p>scrolling=&#8221;no&#8221;. So there&#8217;s no scrollbar. Look. Scrollbars in iframes were pretty rad in 1996, but if you want to give that embed feeling, you have to do without them.</p>
<p>height=&#8230;px, width=&#8230;px. Here&#8217;s the tricky part. You have to manually set the size of your visualisation and add a couple of pixels for good measure.</p>
<p>In tableau, when creating dashboards, I have always used the option to size them <em>exactly </em>at a precise size and I recommend you do that too. Then add 2-6 px to each dimension and use that as width and height.</p>
<p>In my experience going through these steps is really less painful than using the &#8220;native&#8221; embed functionality of tableau vis which sometimes work and sometimes doesn&#8217;t. The added bonus is that the resulting html is much more legible than what Tableau generates, which, for the record, is:</p>
<pre>&lt;script type="text/javascript" src="http://public.tableausoftware.com/javascripts/api/viz_v1.js"&gt;&lt;/script&gt;&lt;div style="width:654px; height:799px;"&gt;&lt;noscript&gt;&lt;a href="http:&amp;#47;&amp;#47;www.jckr.github.io/blog&amp;#47;blog&amp;#47;2012&amp;#47;06&amp;#47;30&amp;#47;tableau-2012-sports-visualization-contest-entry&amp;#47;"&gt;&lt;img alt="champions " src="http:&amp;#47;&amp;#47;public.tableausoftware.com&amp;#47;static&amp;#47;images&amp;#47;ch&amp;#47;champions&amp;#47;champions&amp;#47;1_rss.png" style="border: none" /&gt;&lt;/a&gt;&lt;/noscript&gt;&lt;object width="654" height="799" style="display:none;"&gt;&lt;param name="host_url" value="http%3A%2F%2Fpublic.tableausoftware.com%2F" /&gt;&lt;param name="site_root" value="" /&gt;&lt;param name="name" value="champions&amp;#47;champions" /&gt;&lt;param name="tabs" value="no" /&gt;&lt;param name="toolbar" value="yes" /&gt;&lt;param name="static_image" value="http:&amp;#47;&amp;#47;public.tableausoftware.com&amp;#47;static&amp;#47;images&amp;#47;ch&amp;#47;champions&amp;#47;champions&amp;#47;1.png" /&gt;&lt;param name="animate_transition" value="yes" /&gt;&lt;param name="display_static_image" value="yes" /&gt;&lt;param name="display_spinner" value="yes" /&gt;&lt;param name="display_overlay" value="yes" /&gt;&lt;param name="display_count" value="yes" /&gt;&lt;param name="from_wg" value="true" /&gt;&lt;/object&gt;&lt;/div&gt;&lt;div style="width:654px;height:22px;padding:0px 10px 0px 0px;color:black;font:normal 8pt verdana,helvetica,arial,sans-serif;"&gt;&lt;div style="float:right; padding-right:8px;"&gt;&lt;a href="http://www.tableausoftware.com/public?ref=http://public.tableausoftware.com/views/champions/champions" target="_blank"&gt;Powered by Tableau&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;</pre>
<p>Yeah. You say &amp;#47; i say %2F. anyway, this is a bit difficult to troubleshoot.</p>
<p>The drawback when using iframes is that you lose the nice static image which is generated for RSS flows and other environments without interactivity. If you don&#8217;t know what I&#8217;m talking about (if you&#8217;re not familiar with that large orange arrow at the center) you&#8217;ll have no regrets.</p>
<h3>Bonus: d3.</h3>
<p>It turns out that the iframe is the simplest solution to have d3 work within wordpress, too. Sure, in theory it is possible to upload a js file as a media file, so you get a url with the date in it or something, which you can link to from the&#8230; whatever. It just never works and it&#8217;s a pain to maintain.</p>
<p>so instead, use iframes. Make your d3 visualisation into an html file which will have all the necessary links. Then upload the file to a location you know (and possibly dependencies) and you&#8217;re all set! set an iframe with the same guidelines as above. To make the process even less painful, I use a plug-in called <a href="http://wordpress.org/extend/plugins/wp-filemanager/">FileManager</a> which lets me upload and manage files from within my dashboard environment. On another server I use another app also called <a href="http://www.gerd-tentler.de/tools/filemanager/">FileManager</a> (quite a catchy name, apparently) which runs outside of the wordpress environment.</p>
<p>Happy embedding!</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-1246" class="post-1246 post type-post status-publish format-standard hentry category-d3 category-data-visualization category-tips">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2012/05/28/manipulating-data-like-a-boss-with-d3/" rel="bookmark"><time class="entry-date published" datetime="2012-05-28T03:27:24+00:00">May 28, 2012</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/d3/" rel="category tag">d3</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2012/05/28/manipulating-data-like-a-boss-with-d3/" rel="bookmark">Manipulating data like a boss with d3</a></h1>
         
    </header>
	<section class="post-content">

		<p>Updates:<br />
1) I&#8217;ve put all the code examples in http://codepen.io/collection/njzYxo/<br />
2) I will rewrite this post after I&#8217;m done publishing my <a href="/2016/08/09/visualization-with-react/">Visualization with React</a> series, because it&#8217;s 4 years old and there are other ways to do this now.</p>
<p>Data is the first D in d3 (or possibly the 3rd, but it&#8217;s definitely one of these).</p>
<p>Anyway. Putting your data in the right form is crucial to have concise code that runs fast and is easy to read (and, later, troubleshoot).</p>
<p>So what shape should your data be in?<br />
You undoubtedly have many options. </p>
<p>To follow through this tutorial, let&#8217;s assume you want to plot the relationship between R&#038;D expenditure and GDP growth for a number of countries. You have got <a href="http://jckr.github.io/blog/stuff/data%20example/data.csv">this file</a>, full of tabular data, which lists for every country a name, a continent, the gross R&#038;D expenditure as a percentage of GDP, GDP growth, and for context population and GDP per capita.</p>
<p>So one very basic approach would be to put each of these variables into one independent array.</p>
<pre class="brush: jscript; title: ; notranslate" title="">var GERD=[2.21367, 2.74826, 1.96158, 1.80213, 0.39451, 1.52652, 3.01937, 1.44122, 3.84137, 2.20646, 2.78056, 0.5921, 1.14821, 2.64107, 1.78988, 4.2504, 1.26841, 3.33499, 3.3609, 1.67862, 0.41322, 1.81965, 1.13693, 1.75922, 0.67502, 1.65519, 1.24252, 0.48056, 1.85642, 0.92523, 1.38357, 3.61562, 2.99525, 0.84902, 1.82434, 2.78518];
var growth=[2.48590317, 3.10741128, 1.89308521, 3.21494841, 5.19813626, 1.65489834, 1.04974368, 7.63563272, 2.85477157, 1.47996142, 2.99558644, -6.90796403, 1.69192342, -3.99988322, -0.42935239, 4.84602001, 0.43108032, 3.96559062, 6.16184325, 2.67806902, 5.56185685, 1.18517739, 2.33052515, 1.59773989, 4.34962928, -1.60958484, 4.03428262, 3.34920254, -0.17459255, 2.784, -0.06947685, 3.93555895, 2.71404473, 9.00558548, 2.09209263, 3.02171711];
var GDPcap=[40718.78167, 42118.46375, 38809.66436, 39069.91407, 15106.73205, 25956.76492, 40169.83173, 22403.02459, 37577.71225, 34147.98907, 39389.25874, 26878.00015, 21731.55484, 35641.55402, 40457.94273, 28595.68799, 32580.06572, 33751.23348, 29101.34563, 86226.3276, 15200.22119, 43455.30129, 29870.67748, 57230.89, 19882.99226, 25425.59561, 19833, 24429.61828, 27559.75186, 10497.583, 32779.3288, 41526.2995, 46621.77334, 15666.18783, 35715.4691, 46587.61843];
var population=[22319.07, 8427.318, 10590.44, 33909.7, 17248.45, 10286.3, 5495.246, 1335.347, 5366.482, 62747.78, 82852.47, 11312.16, 9993.116, 308.038, 4394.382, 7623.6, 59059.66, 126912.8, 48988.83, 483.701, 109219.9, 16480.79, 4291.9, 4789.628, 37725.21, 10684.97, 142822.5, 5404.493, 2029.418, 50384.55, 44835.48, 9276.365, 7889.345, 73497, 62761.35, 313232];
var country=[&quot;Australia&quot;, &quot;Austria&quot;, &quot;Belgium&quot;, &quot;Canada&quot;, &quot;Chile&quot;, &quot;Czech Republic&quot;, &quot;Denmark&quot;, &quot;Estonia&quot;, &quot;Finland&quot;, &quot;France&quot;, &quot;Germany&quot;, &quot;Greece&quot;, &quot;Hungary&quot;, &quot;Iceland&quot;, &quot;Ireland&quot;, &quot;Israel&quot;, &quot;Italy&quot;, &quot;Japan&quot;, &quot;Korea&quot;, &quot;Luxembourg&quot;, &quot;Mexico&quot;, &quot;Netherlands&quot;, &quot;New Zealand&quot;, &quot;Norway&quot;, &quot;Poland&quot;, &quot;Portugal&quot;, &quot;Russian Federation&quot;, &quot;Slovak Republic&quot;, &quot;Slovenia&quot;, &quot;South Africa&quot;, &quot;Spain&quot;, &quot;Sweden&quot;, &quot;Switzerland&quot;, &quot;Turkey&quot;, &quot;United Kingdom&quot;, &quot;United States&quot;];
var continent=[&quot;Oceania&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;America&quot;, &quot;America&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Asia&quot;, &quot;Europe&quot;, &quot;Asia&quot;, &quot;Asia&quot;, &quot;Europe&quot;, &quot;America&quot;, &quot;Europe&quot;, &quot;Oceania&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Africa&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;Europe&quot;, &quot;America&quot;];</pre>
<p>(don&#8217;t bother scrolling, it&#8217;s more of the same 🙂 )<br />
Then, you can just create marks for each data item and fetch each attribute independently.<br />
Let&#8217;s do a bubble chart for instance.<br />
(small aside: in the post I won&#8217;t go through the code to set up the svg container or the scales, instead focusing on the data structures. That code, which is really nothing special, can be found in the source code of the examples).</p>
<p>So to create our circles we would write something like: </p>
<pre class="brush: jscript; title: ; notranslate" title="">svg.selectAll(&quot;circle&quot;).data(country).enter()
  .append(&quot;circle&quot;)
  .attr(&quot;cx&quot;,function(d,i) {return x(GERD[i]);})
  .attr(&quot;cy&quot;,function(d,i) {return y(growth[i]);})
  .attr(&quot;r&quot;,function(d,i) {return r(Math.sqrt(population[i]));})

  .style(&quot;fill&quot;,function(d,i) {return c(continent[i]);})
  .style(&quot;opacity&quot;,function(d,i) {return o(GDPcap[i]);})

    .append(&quot;title&quot;)
    .text(String)</pre>
<p>and this works:<br />
<iframe src="http://jckr.github.io/blog/stuff/data%20example/data-example0.html" width=512px height=520px scrolling=no style="border:0px"></iframe><br />
<a href="http://jckr.github.io/blog/stuff/data%20example/data-example0.html">See example in its own tab or window</a><br />
but this is hell to maintain. If for some reason there is an error in one of the values, for instance due to a cat or a small child in the proximity of the computer, the error will be very difficult to troubleshoot.<br />
Another problem is that it&#8217;s very difficult to apply any kind of subsequent treatment to the data. For instance, you will notice that there are smaller bubbles entirely within the large orange bubble which happens to be on top of them. So it&#8217;s not possible to mouseover the smaller bubbles. One way to address that would be to sort data in order of decreasing population (the size of the bubbles) so that it would be impossible to have this kind of situation. Now while it is possible sorting 6 arrays according to the values of one, it&#8217;s very messy.</p>
<p><strong>Ideally, you should have all the values that will be translated graphically within one, single object.</strong> You want to have an array of these objects that you will pass to the data method, and be able to write something like: </p>
<pre class="brush: jscript; title: ; notranslate" title="">svg.selectAll(&quot;circle&quot;).data(data).enter()
  .append(&quot;circle&quot;)
  .attr(&quot;cx&quot;,function(d) {return x(+d.GERD);})
  .attr(&quot;cy&quot;,function(d) {return y(+d.growth);})
  .attr(&quot;r&quot;,function(d) {return r(Math.sqrt(+d.population));})

  .style(&quot;fill&quot;,function(d) {return c(d.continent);})
  .style(&quot;opacity&quot;,function(d) {return o(+d.GDPcap);})</pre>
<p>Here, you have just one data source, which is much safer. </p>
<p>So if you&#8217;re thinking: I know, I should create a variable like this: </p>
<pre class="brush: jscript; title: ; notranslate" title="">var data=[
  {&quot;country&quot;:&quot;Australia&quot;,&quot;continent&quot;:&quot;Oceania&quot;,&quot;population&quot;:22319.07,&quot;GDPcap&quot;:40718.78167,&quot;GERD&quot;:2.21367,&quot;growth&quot;:2.48590317},
  {&quot;country&quot;:&quot;Austria&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:8427.318,&quot;GDPcap&quot;:42118.46375,&quot;GERD&quot;:2.74826,&quot;growth&quot;:3.10741128},
  {&quot;country&quot;:&quot;Belgium&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:10590.44,&quot;GDPcap&quot;:38809.66436,&quot;GERD&quot;:1.96158,&quot;growth&quot;:1.89308521},
  {&quot;country&quot;:&quot;Canada&quot;,&quot;continent&quot;:&quot;America&quot;,&quot;population&quot;:33909.7,&quot;GDPcap&quot;:39069.91407,&quot;GERD&quot;:1.80213,&quot;growth&quot;:3.21494841},
  {&quot;country&quot;:&quot;Chile&quot;,&quot;continent&quot;:&quot;America&quot;,&quot;population&quot;:17248.45,&quot;GDPcap&quot;:15106.73205,&quot;GERD&quot;:0.39451,&quot;growth&quot;:5.19813626},
  {&quot;country&quot;:&quot;Czech Republic&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:10286.3,&quot;GDPcap&quot;:25956.76492,&quot;GERD&quot;:1.52652,&quot;growth&quot;:1.65489834},
  {&quot;country&quot;:&quot;Denmark&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:5495.246,&quot;GDPcap&quot;:40169.83173,&quot;GERD&quot;:3.01937,&quot;growth&quot;:1.04974368},
  {&quot;country&quot;:&quot;Estonia&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:1335.347,&quot;GDPcap&quot;:22403.02459,&quot;GERD&quot;:1.44122,&quot;growth&quot;:7.63563272},
  {&quot;country&quot;:&quot;Finland&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:5366.482,&quot;GDPcap&quot;:37577.71225,&quot;GERD&quot;:3.84137,&quot;growth&quot;:2.85477157},
  {&quot;country&quot;:&quot;France&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:62747.78,&quot;GDPcap&quot;:34147.98907,&quot;GERD&quot;:2.20646,&quot;growth&quot;:1.47996142},
  {&quot;country&quot;:&quot;Germany&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:82852.47,&quot;GDPcap&quot;:39389.25874,&quot;GERD&quot;:2.78056,&quot;growth&quot;:2.99558644},
  {&quot;country&quot;:&quot;Greece&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:11312.16,&quot;GDPcap&quot;:26878.00015,&quot;GERD&quot;:0.5921,&quot;growth&quot;:-6.90796403},
  {&quot;country&quot;:&quot;Hungary&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:9993.116,&quot;GDPcap&quot;:21731.55484,&quot;GERD&quot;:1.14821,&quot;growth&quot;:1.69192342},
  {&quot;country&quot;:&quot;Iceland&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:308.038,&quot;GDPcap&quot;:35641.55402,&quot;GERD&quot;:2.64107,&quot;growth&quot;:-3.99988322},
  {&quot;country&quot;:&quot;Ireland&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:4394.382,&quot;GDPcap&quot;:40457.94273,&quot;GERD&quot;:1.78988,&quot;growth&quot;:-0.42935239},
  {&quot;country&quot;:&quot;Israel&quot;,&quot;continent&quot;:&quot;Asia&quot;,&quot;population&quot;:7623.6,&quot;GDPcap&quot;:28595.68799,&quot;GERD&quot;:4.2504,&quot;growth&quot;:4.84602001},
  {&quot;country&quot;:&quot;Italy&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:59059.66,&quot;GDPcap&quot;:32580.06572,&quot;GERD&quot;:1.26841,&quot;growth&quot;:0.43108032},
  {&quot;country&quot;:&quot;Japan&quot;,&quot;continent&quot;:&quot;Asia&quot;,&quot;population&quot;:126912.8,&quot;GDPcap&quot;:33751.23348,&quot;GERD&quot;:3.33499,&quot;growth&quot;:3.96559062},
  {&quot;country&quot;:&quot;Korea&quot;,&quot;continent&quot;:&quot;Asia&quot;,&quot;population&quot;:48988.83,&quot;GDPcap&quot;:29101.34563,&quot;GERD&quot;:3.3609,&quot;growth&quot;:6.16184325},
  {&quot;country&quot;:&quot;Luxembourg&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:483.701,&quot;GDPcap&quot;:86226.3276,&quot;GERD&quot;:1.67862,&quot;growth&quot;:2.67806902},
  {&quot;country&quot;:&quot;Mexico&quot;,&quot;continent&quot;:&quot;America&quot;,&quot;population&quot;:109219.9,&quot;GDPcap&quot;:15200.22119,&quot;GERD&quot;:0.41322,&quot;growth&quot;:5.56185685},
  {&quot;country&quot;:&quot;Netherlands&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:16480.79,&quot;GDPcap&quot;:43455.30129,&quot;GERD&quot;:1.81965,&quot;growth&quot;:1.18517739},
  {&quot;country&quot;:&quot;New Zealand&quot;,&quot;continent&quot;:&quot;Oceania&quot;,&quot;population&quot;:4291.9,&quot;GDPcap&quot;:29870.67748,&quot;GERD&quot;:1.13693,&quot;growth&quot;:2.33052515},
  {&quot;country&quot;:&quot;Norway&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:4789.628,&quot;GDPcap&quot;:57230.89,&quot;GERD&quot;:1.75922,&quot;growth&quot;:1.59773989},
  {&quot;country&quot;:&quot;Poland&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:37725.21,&quot;GDPcap&quot;:19882.99226,&quot;GERD&quot;:0.67502,&quot;growth&quot;:4.34962928},
  {&quot;country&quot;:&quot;Portugal&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:10684.97,&quot;GDPcap&quot;:25425.59561,&quot;GERD&quot;:1.65519,&quot;growth&quot;:-1.60958484},
  {&quot;country&quot;:&quot;Russian Federation&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:142822.5,&quot;GDPcap&quot;:19833,&quot;GERD&quot;:1.24252,&quot;growth&quot;:4.03428262},
  {&quot;country&quot;:&quot;Slovak Republic&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:5404.493,&quot;GDPcap&quot;:24429.61828,&quot;GERD&quot;:0.48056,&quot;growth&quot;:3.34920254},
  {&quot;country&quot;:&quot;Slovenia&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:2029.418,&quot;GDPcap&quot;:27559.75186,&quot;GERD&quot;:1.85642,&quot;growth&quot;:-0.17459255},
  {&quot;country&quot;:&quot;South Africa&quot;,&quot;continent&quot;:&quot;Africa&quot;,&quot;population&quot;:50384.55,&quot;GDPcap&quot;:10497.583,&quot;GERD&quot;:0.92523,&quot;growth&quot;:2.784},
  {&quot;country&quot;:&quot;Spain&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:44835.48,&quot;GDPcap&quot;:32779.3288,&quot;GERD&quot;:1.38357,&quot;growth&quot;:-0.06947685},
  {&quot;country&quot;:&quot;Sweden&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:9276.365,&quot;GDPcap&quot;:41526.2995,&quot;GERD&quot;:3.61562,&quot;growth&quot;:3.93555895},
  {&quot;country&quot;:&quot;Switzerland&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:7889.345,&quot;GDPcap&quot;:46621.77334,&quot;GERD&quot;:2.99525,&quot;growth&quot;:2.71404473},
  {&quot;country&quot;:&quot;Turkey&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:73497,&quot;GDPcap&quot;:15666.18783,&quot;GERD&quot;:0.84902,&quot;growth&quot;:9.00558548},
  {&quot;country&quot;:&quot;United Kingdom&quot;,&quot;continent&quot;:&quot;Europe&quot;,&quot;population&quot;:62761.35,&quot;GDPcap&quot;:35715.4691,&quot;GERD&quot;:1.82434,&quot;growth&quot;:2.09209263},
  {&quot;country&quot;:&quot;United States&quot;,&quot;continent&quot;:&quot;America&quot;,&quot;population&quot;:313232,&quot;GDPcap&quot;:46587.61843,&quot;GERD&quot;:2.78518,&quot;growth&quot;:3.02171711}
]</pre>
<p>and get this done, and furthermore if you are thinking &#8220;Hey, I can do this in Excel from my csv file, with one formula that I will copy across the rows&#8221;, <strong>you need to stop right now in the name of all that is good and holy</strong>.<br />
Even though it works: </p>
<p><iframe src="http://jckr.github.io/blog/stuff/data%20example/data-example1.html" width=512px height=520px scrolling=no style="border:0px"></iframe><br />
<a href="http://jckr.github.io/blog/stuff/data%20example/data-example1.html">See example in its own tab or window</a></p>
<p>This approach has a number of flaws which you can all avoid if you read on.<br />
First, the execution of your program will be stopped while your browser reads the source code that contains the &#8220;data&#8221; variable. This is negligible for 36 rows, but as objects get bigger and more complex, an equivalent variable may take seconds or even minutes to load. And now we have a problem.<br />
That&#8217;s a problem for your users. Now to you: creating a JSON variable from tabular data is tedious and error prone. The formula editing interface in Excel doesn&#8217;t really help you spot where you have misplaced a quote or a colon. As a result, this is very time-consuming. </p>
<p>Don&#8217;t do that: there is a much simpler way.</p>
<p>Enters the d3.csv function.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.csv(&quot;data.csv&quot;,function(csv) {
  // we first sort the data

  csv.sort(function(a,b) {return b.population-a.population;});

  // then we create the marks, which we put in an initial position

  svg.selectAll(&quot;circle&quot;).data(csv).enter()
    .append(&quot;circle&quot;)
    .attr(&quot;cx&quot;,function(d) {return x(0);})
    .attr(&quot;cy&quot;,function(d) {return y(0);})
    .attr(&quot;r&quot;,function(d) {return r(0);})

    .style(&quot;fill&quot;,function(d) {return c(d.continent);})
    .style(&quot;opacity&quot;,function(d) {return o(+d.GDPcap);})

      .append(&quot;title&quot;)
      .text(function(d) {return d.country;})
  
  // now we initiate - moving the marks to their position

  svg.selectAll(&quot;circle&quot;).transition().duration(1000)
    .attr(&quot;cx&quot;,function(d) {return x(+d.GERD);})
    .attr(&quot;cy&quot;,function(d) {return y(+d.growth);})
    .attr(&quot;r&quot;,function(d) {return r(Math.sqrt(+d.population));})
})</pre>
<p>Here&#8217;s how it works.<br />
You tell your d3.csv function the location of a csv file, (which we had all along) and a function that must run on the array of objects (what we always wanted) created by using the first row as keys.<br />
In other words, once inside the d3.csv function, the &#8220;csv&#8221; variable will be worth exactly what we assigned to &#8220;data&#8221; earlier, with one major difference, it&#8217;s that we didn&#8217;t have to manufacture this variable or do any kind of manual intervention: we are certain it corresponds to the file exactly. </p>
<p>One nice thing with this method is that since your variable is not explicitly in the source code, your browser can read it much faster. The data is only read when the d3.csv function is called, as opposed to the previous approach where the entirety of the source code (including the data) had to be read before the first statement could be executed. Of course, it only makes a difference when the data size is significant. But using the d3.csv approach would let you display a &#8220;loading data&#8221; warning somewhere on your page, and remove it when inside d3.csv. Much better than a blank page.</p>
<p>Three caveats with this method.</p>
<ul>
<li>This will no longer work in a local file system (ie opening a file in the browser). The resulting file can only run on a webserver, which can be local (ie the page has a url). </li>
<li>whatever happens within the d3.csv function is no longer in the global scope of the program. This means that after the program has run its course you cannot open the javascript console and inspect the value of &#8220;csv&#8221;, for instance. This makes these programs slightly more difficult to debug (there are obviously ways, though).</li>
<li>Everything read from the file is treated as strings. Javascript does a lot of type conversion but be mindful of that or you will have surprises. This is why I wrote x(+d.GERD) for instance (+ before a string converts it to a number).</li>
</ul>
<p>To celebrate this superior way of aquiring data, we&#8217;ve thrown in animated data entry: the circles are initiated at a default value and move towards their position. You may want to check the link to see the transition effect.</p>
<p><iframe src="http://jckr.github.io/blog/stuff/data%20example/data-example2.html" width=512px height=520px scrolling=no style="border:0px"></iframe><br />
<a href="http://jckr.github.io/blog/stuff/data%20example/data-example2.html">See example in its own tab or window</a></p>
<p>So, at the level of the mark (ie our circles) the most comfortable form of data is an object with at least as many keys as there will be graphical properties to change dynamically.<br />
One flat array of data is fine if we have just one series of data. But what if we have several series? Indeed, most visualizations have a structure and a hierarchy.<br />
So let&#8217;s proceed with our data but now let&#8217;s assume that we want to show values for different continents as different little scatterplots (&#8220;small multiples&#8221;).<br />
Intuitively:
<ul>
<li>we&#8217;ll want to add 5 &#8220;g&#8221; groups to our svg container, one for each continent,</li>
<li>and then add one dots per country in each continent to those groups.</li>
</ul>
<p>Our flat array won&#8217;t work so well then. What to do?</p>
<p>The d3 answer to this problem is the d3.nest() set of methods.<br />
d3.nest() turns a flat array of objects, which thanks to d3.csv() is a very easily available format, in an array of arrays with the hierarchy you need.<br />
Following our intuition, wouldn&#8217;t it be nice if our data would be: </p>
<ul>
<li>An array of 5 items, one for each continent, so we could create the &#8220;g&#8221; groups, </li>
<li>And if each of these 5 items contained an array with the data of all the corresponding countries, still in that object format that we love? </li>
</ul>
<p>This is exactly what d3.nest() does. d3.nest(), go!</p>
<pre class="brush: jscript; title: ; notranslate" title="">var data=d3.nest()
  .key(function(d) {return d.continent;})
  .sortKeys(d3.ascending)
  .entries(csv);</pre>
<p>With the .key() method, we are indicating what we will be using to create the hierarchy. We want to group those data by continent, so we use this syntax.<br />
.sortKeys is used to sort the keys in alphabetical order, so our panels appear in the alphabetical order of the continents. If we omit that, the panels will show up in the order of the data (ie Oceania first as Australia is the first country). We could have avoided that by sorting the data by continent first before nesting it, but it&#8217;s easier like this.<br />
Here, we just have one level of grouping, but we could have several by chaining several .key() methods.<br />
The last part of the statement, .entries(csv), says that we want to do that operation on our csv variable.</p>
<p>Here is what the data variable will look like: </p>
<pre class="brush: jscript; title: ; notranslate" title="">[
  {&quot;key&quot;:&quot;Africa&quot;,&quot;values&quot;:[...]},
  {&quot;key&quot;:&quot;America&quot;,&quot;values&quot;:[
    {&quot;country&quot;:&quot;United States&quot;,&quot;continent&quot;:&quot;America&quot;,&quot;population&quot;:&quot;313232&quot;,&quot;GDPcap&quot;:&quot;46587.61843&quot;,&quot;GERD&quot;:&quot;2.78518&quot;,&quot;growth&quot;:&quot;3.02171711&quot;},
     {&quot;country&quot;:&quot;Mexico&quot;,&quot;continent&quot;:&quot;America&quot;,&quot;population&quot;:&quot;109219.9&quot;,&quot;GDPcap&quot;:&quot;15200.22119&quot;,&quot;GERD&quot;:&quot;0.41322&quot;,&quot;growth&quot;:&quot;5.56185685&quot;},
      {&quot;country&quot;:&quot;Canada&quot;,&quot;continent&quot;:&quot;America&quot;,&quot;population&quot;:&quot;33909.7&quot;,&quot;GDPcap&quot;:&quot;39069.91407&quot;,&quot;GERD&quot;:&quot;1.80213&quot;,&quot;growth&quot;:&quot;3.21494841&quot;},      {&quot;country&quot;:&quot;Chile&quot;,&quot;continent&quot;:&quot;America&quot;,&quot;population&quot;:&quot;17248.45&quot;,&quot;GDPcap&quot;:&quot;15106.73205&quot;,&quot;GERD&quot;:&quot;0.39451&quot;,&quot;growth&quot;:&quot;5.19813626&quot;}
  ]
}, 
  {&quot;key&quot;:&quot;Asia&quot;,&quot;values&quot;:[...]},
  {&quot;key&quot;:&quot;Europe&quot;,&quot;values&quot;:[...]},
  {&quot;key&quot;:&quot;Oceania&quot;,&quot;values&quot;:[...]},
]</pre>
<p>Now that we have our data in an ideal form let&#8217;s draw those marks: </p>
<pre class="brush: jscript; title: ; notranslate" title="">  // One cell for each continent
  var g=svg.selectAll(&quot;g&quot;).data(data).enter()
    .append(&quot;g&quot;)
    .attr(&quot;transform&quot;,function(d,i) {return &quot;translate(&quot;+(100*i)+&quot;,0)&quot;;});
  // we add a rect element with a title element
  // so that mousing over the cell will tell us which continent it is
  g
    .append(&quot;rect&quot;)
    .attr(&quot;x&quot;,cmargin)
    .attr(&quot;y&quot;,cmargin)
    .attr(&quot;width&quot;,cwidth-2*cmargin)
    .attr(&quot;height&quot;,cheight-2*cmargin)
      .append(&quot;title&quot;)
      .text(function(d) {return d.key;})
  // we also write its name below.
  g
    .append(&quot;text&quot;)
    .attr(&quot;y&quot;,cheight+10)
    .attr(&quot;x&quot;,cmargin)
    .text(function(d) {return d.key;})
  
  // now marks, initiated to default values
  g.selectAll(&quot;circle&quot;)
  // we are getting the values of the countries like this:
  .data(function(d) {return d.values}) 
  .enter()
      .append(&quot;circle&quot;)
      .attr(&quot;cx&quot;,cmargin)
      .attr(&quot;cy&quot;,cheight-cmargin)
      .attr(&quot;r&quot;,1)
      // throwing in a title element
      .append(&quot;title&quot;)
        .text(function(d) {return d.country;});

  // finally, we animate our marks in position
  g.selectAll(&quot;circle&quot;).transition().duration(1000)
      .attr(&quot;r&quot;,3)
      .attr(&quot;cx&quot;,function(d) {return x(+d.GERD);})
      .attr(&quot;cy&quot;,function(d) {return y(+d.growth);})
      .style(&quot;opacity&quot;,function(d) {return o(d.population)})
      .style(&quot;opacity&quot;,function(d) {return o(+d.GDPcap);})</pre>
<p>(you may want to click on the link to see the transition effect and read the full source).<br />
<iframe src="http://jckr.github.io/blog/stuff/data%20example/data-example3.html" width=512px height=122px scrolling=no style="border:0px"></iframe><br />
<a href="http://jckr.github.io/blog/stuff/data%20example/data-example3.html">See example in its own tab or window</a></p>
<p>This is all very nice but wouldn&#8217;t it be better if we could characterize some aggregate information from the continents? Let&#8217;s try to find out the average values for R&#038;D expenditure and GDP growth. </p>
<p>Can it be done easily? This is a job for the other main d3.nest method, rollup.</p>
<p>rollup is the aggregating function. Here&#8217;s an example.</p>
<pre class="brush: jscript; title: ; notranslate" title="">var avgs=d3.nest()
    .key(function(d) {return d.continent;})
    .sortKeys(d3.ascending)
    .rollup(function(d) {
      return {
        GERD:d3.mean(d,function(g) {return +g.GERD;}),
        growth:d3.mean(d,function(g) {return +g.growth})
      };
    })
    .entries(csv);
</pre>
<p>Remember how the combination of .key() and .entries() rearranges an array into arrays of smaller arrays, depending on these keys? well, the value that is being passed to the function inside the rollup method is each of these arrays (ie an array of all the objects corresponding to countries in America, then an array of all the objects corresponding to countries in Europe, etc.)<br />
Also, if we use sortKeys in our previous nesting effort we&#8217;d better use it here too.<br />
Here is what the variable will look like: </p>
<pre class="brush: jscript; title: ; notranslate" title="">[
  {
    &quot;key&quot;:&quot;Africa&quot;,
    &quot;values&quot;:{
      &quot;GERD&quot;:0.92523,
      &quot;growth&quot;:2.784
    }
  },  
  {
    &quot;key&quot;:&quot;America&quot;,
    &quot;values&quot;:{
      &quot;GERD&quot;:1.34876,
      &quot;growth&quot;:4.2491646575
    }
  },
  {
    &quot;key&quot;:&quot;Asia&quot;,
    &quot;values&quot;:{
      &quot;GERD&quot;:3.6487633333333336,
      &quot;growth&quot;:4.991151293333334
    }
  },
  {
    &quot;key&quot;:&quot;Europe&quot;,
    &quot;values&quot;:{
      &quot;GERD&quot;:1.8769234615384616,
      &quot;growth&quot;:1.7901778096153846
    }
  },
  {
    &quot;key&quot;:&quot;Oceania&quot;,
    &quot;values&quot;:{
      &quot;GERD&quot;:1.6753,
      &quot;growth&quot;:2.40821416
    }
  }
]</pre>
<p>Incredible! just the values we need.<br />
Now it&#8217;s just a matter of adding them to the sketch. Two little additions here: </p>
<pre class="brush: jscript; title: ; notranslate" title="">// we add 2 lines for the average. They will start at a default value.
  g
    .append(&quot;line&quot;).classed(&quot;growth&quot;,1)
    .attr(&quot;x1&quot;,cmargin).attr(&quot;x2&quot;,cwidth-cmargin)
    .attr(&quot;y1&quot;,cheight-cmargin)
    .attr(&quot;y2&quot;,cheight-cmargin)
    // we give these lines a title for mouseover interaction.
      .append(&quot;title&quot;).text(function(d,i) {
        return &quot;Average growth:&quot;+avgs[i].values.growth
      });
  g.append(&quot;line&quot;).classed(&quot;GERD&quot;,1)
    .attr(&quot;y1&quot;,cmargin)
    .attr(&quot;y2&quot;,cheight-cmargin)
    .attr(&quot;x1&quot;,cmargin)
    .attr(&quot;x2&quot;,cmargin)
      .append(&quot;title&quot;).text(function(d,i) {
        return &quot;Average GERD:&quot;+avgs[i].values.GERD
      });

 ...
  // we also animate the lines
  g.select(&quot;.growth&quot;).transition().duration(1000)
    .attr(&quot;y1&quot;,function(d,i) {return y(avgs[i].values.growth);})
    .attr(&quot;y2&quot;,function(d,i) {return y(avgs[i].values.growth);})
  g.select(&quot;.GERD&quot;).transition().duration(1000)
    .attr(&quot;x1&quot;,function(d,i) {return x(avgs[i].values.GERD);})
    .attr(&quot;x2&quot;,function(d,i) {return x(avgs[i].values.GERD);})</pre>
<p>This is the final example &#8211; again you may want to click on the link to see the transition and get the entirety of the source.<br />
<iframe src="http://jckr.github.io/blog/stuff/data%20example/data-example4.html" width=512px height=122px scrolling=no style="border:0px"></iframe><br />
<a href="http://jckr.github.io/blog/stuff/data%20example/data-example4.html">See example in its own tab or window</a></p>
<p>To wrap up:</p>
<ul>
<li>At the mark level, you want to have objects with as many properties as you need graphical variables (like x,y, fill, etc.)</li>
<li>using d3.csv() and a flat file will make this easy (d3 also provides functions like d3.json or d3.xml to process data in another format).</li>
<li>d3.nest can help you group your entries to structure your data and create more sophisticated visualizations</li>
<li>rollup can be used to aggregate the data grouped using d3.nest</li>
</ul>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-1297" class="post-1297 post type-post status-publish format-standard hentry category-d3 category-data-visualization category-tips">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2012/05/24/making-of-the-map-of-congress-equality/" rel="bookmark"><time class="entry-date published" datetime="2012-05-24T12:36:37+00:00">May 24, 2012</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/d3/" rel="category tag">d3</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2012/05/24/making-of-the-map-of-congress-equality/" rel="bookmark">Making-of: the map of congress equality</a></h1>
         
    </header>
	<section class="post-content">

		<p><div id="attachment_1290" style="width: 620px" class="wp-caption aligncenter"><a href="http://jckr.github.io/blog/projects/elections/parite.html"><img class="size-full wp-image-1290" title="La parité, c'est maintenant" src="http://jckr.github.io/blog/wp-content/uploads/2012/05/parite.png" alt="" width="610" height="572" /></a><p class="wp-caption-text">It&#39;s all about this map (click for interactive version)</p></div></p>
<p>To my datavis readers, sorry for that string of posts in French but what better data to visualize than political data, and what better time to visualize political data than election time, and what better audience for such visualizations than the folks who are asked to vote?</p>
<p><a href="http://jckr.github.io/blog/blog/2012/05/15/making-of-cutting-paris-in-voting-districts/">Like last time</a>, though, I am writing a follow-up technical post about how I dealt with the issues of this visualization.</p>
<p>So anyone who ever tried to make data visualizations knows that you can hardly start without <strong>data</strong>.</p>
<p>My ingredients for the recipe were:</p>
<p>2012 presidential election results <a href="http://www.data.gouv.fr/donnees/view/Pr%C3%A9sidentielle-2012%2C-r%C3%A9sultats-par-circonscriptions-l%C3%A9gislatives%2C-2%C3%A8me-tour-551768?xtmc=presidentielle+circonscription&amp;xtcr=4">by circonscription</a>, plus those <a href="http://www.data.gouv.fr/donnees/view/R%C3%A9sultats-par-circonscription-%C3%A9lection-pr%C3%A9sidentielle-2007---Tours-1-et-2-30379819?xtmc=presidentielle+circonscription&amp;xtcr=1">of 2007</a>.</p>
<p>Results of the <a href="http://www.data.gouv.fr/donnees/view/R%C3%A9sultats-par-circonscription-%C3%A9lections-l%C3%A9gislatives-2007---Tour-1-383529">previous</a> <a href="http://www.data.gouv.fr/donnees/view/R%C3%A9sultats-par-circonscription-%C3%A9lections-l%C3%A9gislatives-2007---Tour-2-383531">congressional </a>election. There were 2 files, one per round, as opposed to a flat file of <em>députés </em>in place (I didn&#8217;t find one that didn&#8217;t required some significant editing to be of use). Most importantly, I needed their political orientation which required some tweaking.</p>
<p>Matching tables between <a href="http://www.data.gouv.fr/donnees/view/Table-de-correspondance-des-communes-et-des-cantons-avec-les-circonscriptions-l%C3%A9gislat-551418?xtmc=communes+circonscription&amp;xtcr=1">circonscriptions and cities</a>.  From a previous project, presidential election data at the city level. Also, <a href="http://professionnels.ign.fr/ficheProduitCMS.do?idDoc=5323862">geo coordinates of the cities</a>.</p>
<p>The data which was most painful to extract was the list of candidates. In all fairness, UMP made it easier than PS as they had them all on <a href="http://www.u-m-p.org/actualites/a-la-une/candidats-investis-ou-soutenus-par-le-conseil-national-de-lump-du-4982102">a page</a>. For PS, they had a google fusion table which had <a href="https://www.google.com/fusiontables/DataSource?docid=14Nu51pqxD4PmZd8FlcSqQNruHR1yfZgg0QJwe_A">this</a> as a data source. That file required a lot of massaging. Eventually local pages of the PS site would list the candidates missing from the map (or provide alternate names). When it was up, I also used the <a href="http://www.elections-legislatives.fr/">http://www.elections-legislatives.fr/</a> site to check for the missing names.</p>
<p>Finally, I figured out the genders of all the candidates by extracting their first name and looking up all the ones I wasn&#8217;t sure about (there are quite a few unisex first names in French).</p>
<p>Now <strong>calculations</strong>.</p>
<p>There is a pretty strong statistical link between the score of a party on an election in a certain territory, and the chances of a congress candidate of the same party of winning the district.</p>
<p>Predicting these chances is a well-known problem known as <em>classification </em> for which the textbook method is <em>logistic regression.</em></p>
<p>All we need was the 575 districts for which I had results. We then associate the score of a party at the 2nd round of the election to whether the corresponding congress candidate got elected (1 or 0). That gives us <a href="http://jckr.github.io/blog/projects/elections/deputes.txt">1150 pairs of values</a> which we throw in the mathematical cooking pot.</p>
<p>And what we get is the following formula:</p>
<p><a href="http://jckr.github.io/blog/wp-content/uploads/2012/05/equation.png"><img class="aligncenter size-full wp-image-1305" title="equation" src="http://jckr.github.io/blog/wp-content/uploads/2012/05/equation.png" alt="" width="297" height="66" /></a></p>
<p>where x is the score in the previous election (between 0 and 1).  As you can see when x gets close to 0, the denominator becomes a very large number and the probability quickly drops to virtually nothing, and converserly when x gets close to 1, the denominator becomes very close to 1 so the probability rises up to 1 equally fast.</p>
<p><iframe style="border: none;" src="http://jckr.github.io/blog/stuff/littlesigmoid.html" scrolling="no" width="502px" height="270px"></iframe></p>
<p>With this and that in place, it is possible to come up with a <a href="http://jckr.github.io/blog/projects/elections/pariteFM.csv">reasonable estimation</a> of the chances of any candidate based on the recent results. As an aside, the current Prime Minister has renewed the tradition started by his predecessor to ask ministers to seek office and to force them to step down if they fail to win their district. As a result, 24 out of the 37 ministers are campaigning. Out of those 24, 2 are taking very serious risks according to this model: Marie-Anne Carlotti and Benoît Hamon.</p>
<p>Finally, <strong>geography</strong>.</p>
<p>In an ideal world, there will be an abundance of geoJSON files describing France and its many administrative entities. Usable data must exist somewhere, because the maps on <a href="view-source:http://www.elections-legislatives.fr/candidats.asp">www.elections-legislatives.fr</a> have all been generated (by Raphael.js says the source code). If I&#8217;m doing another project on these elections I might reverse engineer the shape of the maps to extract the coordinates.</p>
<p>Without a dataset, the work of drawing the boundaries of 577 districts is just huge. However, accuracy is not required as I&#8217;m only putting the districts on a map so people can look up where they live or places they know. <a href="http://jckr.github.io/blog/blog/2012/05/15/making-of-cutt…ting-districts/">In my previous work</a> in order to let users change the composition of the districts, I wanted to be rigorous in the placement of everything but here we can live with imperfection.</p>
<p>So I am using the same <a href="http://jckr.github.io/blog/blog/2012/05/15/making-of-cutt…ting-districts/">principle as I did</a>: voronoi tesselation.</p>
<p>For each district I am picking the largest city, for which I have the coordinates. But most large cities belong to several districts. So I am adding random noise to each point. Then, I am drawing shapes around them.</p>
<p><iframe style="border: none;" src="http://jckr.github.io/blog/stuff/littlevoronoi.html" scrolling="no" width="502px" height="270px"></iframe></p>
<p>That would normally fill a rectangle, so in order to make it look like France, I have drawn a <a href="http://commons.oreilly.com/wiki/index.php/SVG_Essentials/Clipping_and_Masking">clipping mask</a> on top of it (that, I&#8217;ve done by hand, picking coordinates of the outline of France).</p>
<p>That about wraps it up!</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-1277" class="post-1277 post type-post status-publish format-standard hentry category-d3 category-data-visualization category-tips">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2012/05/15/making-of-cutting-paris-in-voting-districts/" rel="bookmark"><time class="entry-date published" datetime="2012-05-15T15:33:44+00:00">May 15, 2012</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/d3/" rel="category tag">d3</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2012/05/15/making-of-cutting-paris-in-voting-districts/" rel="bookmark">Making-of: cutting Paris in voting districts</a></h1>
         
    </header>
	<section class="post-content">

		<p>Hi, in my previous post I showcased <a href="http://jckr.github.io/blog/projects/elections/circonscriptions.html#">one of my recent projects</a>. I really enjoyed building it and so would like to share how this has been done.</p>
<p>First, getting the data. I already scraped the results of both rounds of the presidential election by city. The districts for the congress election are also known, but it&#8217;s not possible to do a match, because large cities are almost systematically broken down into several such districts. Paris, for instance, will be represented by no less than 18 <em>députés</em>.</p>
<p>So I needed the results by the finest possible unit, that is by individual polling station. During the election night these results are compiled by city and centralized, so you would assume that the raw data of each polling station is available somewhere. That is not the case, unfortunately. Although it seems that they will be made public eventually, that may not be the case before the June 2012 election.</p>
<p>Fortunately, <a href="http://opendata.paris.fr/opendata/jsp/site/Portal.jsp?document_id=133&amp;portlet_id=102">Open Data Paris</a> had the results by polling station. More: it had their address and matching of every inhabited building in Paris to its corresponding polling station.</p>
<p>To map the polling stations, my first intuition was to create a <a href="http://en.wikipedia.org/wiki/Voronoi_diagram">voronoi tesselation</a> of their projected, geocoded coordinates (I only had their addresses in the raw data file). In short, voronoi polygons can be generated for a certain number of control points and correspond to the area nearer to that control point than to any other. So it&#8217;s a good approximation of the areas  which correspond to a given polling station.</p>
<p><iframe style="border:none;" src="http://jckr.github.io/blog/stuff/littlevoronoi.html" scrolling="no" width="502px" height="270px"></iframe></p>
<p>Problem: several polling stations could be in the same address, and for the voronoi algorithm the control points have to be distinct. So I tried jittering them (adding random noise to each one). A tesselation could be done that kind of looked like Paris but voting districts will look messy as there were frequent inversions between neighboring districts.</p>
<p>So I had to come up with a better approximation of what part of the city corresponded to what voting district. So I used the address to polling station correspondance, and for each polling station I took the first and the last street number of any street that was covered by it. Then I geocoded the whole lot. That&#8217;s about 16000 points. It took some time.</p>
<p><div id="attachment_1280" style="width: 616px" class="wp-caption aligncenter"><a href="http://jckr.github.io/blog/wp-content/uploads/2012/05/centroids.png"><img class="wp-image-1280" title="centroids" src="http://jckr.github.io/blog/wp-content/uploads/2012/05/centroids.png" alt="" width="606" height="478" /></a><p class="wp-caption-text">Here&#39;s my polling station as an example.</p></div></p>
<p>Then, for each polling station area, I took the minimum and maximum longitude and latitude, which formed a bounding box, and assigned the polling station to the center of that box. Then, I used tesselation again.</p>
<p>I found a number of oddities in the geocoding that I had to correct manually, because if one address was not accurately coded, chances are it would change the shape of the bounding box drastically and so the position of its corresponding polling station. Sometimes the geocoding service wouldn&#8217;t find the street and/or would use a street of the same name in another city, sometimes they did find the street but the coordinates were way off&#8230; So the dataset required a lot of massaging before it got into shape.</p>
<p>The last geographic errand I had to do for this visualization was to create a perimeter of Paris to use as a clipping mask, else the tesselation would be done on a rectangular shape with the edge polygons being very large and very skewed. So I collected coordinates of points around Paris to create one polygon. Only what&#8217;s inside of this polygon is shown (.style(&#8220;clip-path&#8221;) in d3).</p>
<p>After the data has been acquired, the building of the rest of the datavis was nothing special. I have used extensively mouseover and click events to trigger transformations as I always do, although this time I did prepare a lot of rules.</p>
<p>Originally I wanted to make the whole of France like this, though it will be difficult: one, to get the data, and two, to get it into shape. As of today the location (i.e. street address) of most of the polling stations is not available online, so even if we got the number of votes for each of the polling stations (there should be about 40000 of them) the geographic part of the problem will remain unsolved. Though, it&#8217;s a worthy endeavour. While the election results have little interest at a macro-geographic level &#8211; by region or by <em>département &#8211; </em>they are very useful at a very fine level as strategies can be constructed.</p>
<p>For instance, it&#8217;s worthwhile to send heavyweights to conquer districts that are winnable, but it&#8217;s a waste to keep them in their respective fiefdoms if victory in these districts is already certain. Also, when districts would have to be redefined, having this kind of information can be invaluable to the political force which gets to draw their new limits, or to their opponents.</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				<nav class="pagination navigation paging-navigation" role="navigation">
		<div class="nav-links">
						<div class="older-posts"><a href="/category/tips/page/3/" >Older Posts <span class="meta-nav">&rarr;</span></a></div>
							<div class="page-number">Page 2 of 4</div>
						<div class="newer-posts"><a href="/category/tips/" ><span class="meta-nav">&larr;</span> Newer Posts</a></div>
			
		</div><!-- .nav-links -->
	</nav><!-- .navigation -->
	
		
		</main><!-- #main -->
	</section><!-- #primary -->

	<div id="secondary" class="widget-area" role="complementary">
		<aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form></aside>		<aside id="recent-posts-2" class="widget widget_recent_entries">		<h1 class="widget-title">Recent Posts</h1>		<ul>
					<li>
				<a href="/2016/08/17/the-big-leagues/">The big leagues</a>
						</li>
					<li>
				<a href="/2016/08/17/creating-a-react-visualization-web-app/">Creating a React visualization web app</a>
						</li>
					<li>
				<a href="/2016/08/13/beyond-rendering/">Beyond rendering</a>
						</li>
					<li>
				<a href="/2016/08/11/react-components/">React components</a>
						</li>
					<li>
				<a href="/2016/08/10/coding-with-react/">Coding with React</a>
						</li>
				</ul>
		</aside>		<aside id="recent-comments-2" class="widget widget_recent_comments"><h1 class="widget-title">Recent Comments</h1><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link"><a href='http://omeraz.wordpress.com/' rel='external nofollow' class='url'>עומר עזריאל</a></span> on <a href="/2016/08/17/the-big-leagues/#comment-567">The big leagues</a></li><li class="recentcomments"><span class="comment-author-link">Carlos Ayres</span> on <a href="/2012/05/28/manipulating-data-like-a-boss-with-d3/#comment-312">Manipulating data like a boss with d3</a></li><li class="recentcomments"><span class="comment-author-link"><a href='https://migrate.powertripanalytics.com/game-of-thrones-interactions-among-the-top-30-characters/' rel='external nofollow' class='url'>Game of ThronesInteractions Among the Top 30 Characters &#8211; PowerTrip Analytics</a></span> on <a href="/2013/05/13/making-the-game-of-thrones-visualization/#comment-466">Making the game of thrones visualization</a></li><li class="recentcomments"><span class="comment-author-link"><a href='https://abgoswam.wordpress.com/2016/10/08/d3-getting-started/' rel='external nofollow' class='url'>D3 &#8211; Getting Started | abgoswam&#039;s tech blog</a></span> on <a href="/2012/09/04/getting-to-hello-world-with-d3/#comment-419">Getting to &#8220;Hello world&#8221; with d3</a></li><li class="recentcomments"><span class="comment-author-link"><a href='https://plus.google.com/+BrotoBhattacharjee' rel='external nofollow' class='url'>Broto Bhattacharjee</a></span> on <a href="/2012/09/04/getting-to-hello-world-with-d3/#comment-418">Getting to &#8220;Hello world&#8221; with d3</a></li></ul></aside><aside id="archives-2" class="widget widget_archive"><h1 class="widget-title">Archives</h1>		<ul>
			<li><a href='/2016/08/'>August 2016</a></li>
	<li><a href='/2015/05/'>May 2015</a></li>
	<li><a href='/2015/02/'>February 2015</a></li>
	<li><a href='/2014/10/'>October 2014</a></li>
	<li><a href='/2013/11/'>November 2013</a></li>
	<li><a href='/2013/05/'>May 2013</a></li>
	<li><a href='/2013/03/'>March 2013</a></li>
	<li><a href='/2013/01/'>January 2013</a></li>
	<li><a href='/2012/12/'>December 2012</a></li>
	<li><a href='/2012/11/'>November 2012</a></li>
	<li><a href='/2012/10/'>October 2012</a></li>
	<li><a href='/2012/09/'>September 2012</a></li>
	<li><a href='/2012/07/'>July 2012</a></li>
	<li><a href='/2012/06/'>June 2012</a></li>
	<li><a href='/2012/05/'>May 2012</a></li>
	<li><a href='/2012/04/'>April 2012</a></li>
	<li><a href='/2012/01/'>January 2012</a></li>
	<li><a href='/2011/11/'>November 2011</a></li>
	<li><a href='/2011/10/'>October 2011</a></li>
	<li><a href='/2011/09/'>September 2011</a></li>
	<li><a href='/2011/08/'>August 2011</a></li>
	<li><a href='/2011/07/'>July 2011</a></li>
	<li><a href='/2011/06/'>June 2011</a></li>
	<li><a href='/2011/05/'>May 2011</a></li>
	<li><a href='/2011/04/'>April 2011</a></li>
	<li><a href='/2011/03/'>March 2011</a></li>
	<li><a href='/2011/02/'>February 2011</a></li>
	<li><a href='/2011/01/'>January 2011</a></li>
	<li><a href='/2010/11/'>November 2010</a></li>
	<li><a href='/2010/04/'>April 2010</a></li>
	<li><a href='/2010/03/'>March 2010</a></li>
	<li><a href='/2010/02/'>February 2010</a></li>
	<li><a href='/2010/01/'>January 2010</a></li>
	<li><a href='/2009/12/'>December 2009</a></li>
	<li><a href='/2009/10/'>October 2009</a></li>
	<li><a href='/2009/09/'>September 2009</a></li>
	<li><a href='/2009/08/'>August 2009</a></li>
	<li><a href='/2009/07/'>July 2009</a></li>
	<li><a href='/2009/06/'>June 2009</a></li>
	<li><a href='/2009/05/'>May 2009</a></li>
	<li><a href='/2008/12/'>December 2008</a></li>
	<li><a href='/2008/11/'>November 2008</a></li>
	<li><a href='/2008/10/'>October 2008</a></li>
		</ul>
		</aside><aside id="categories-2" class="widget widget_categories"><h1 class="widget-title">Categories</h1>		<ul>
	<li class="cat-item cat-item-2"><a href="/category/book-review/" >book review</a>
</li>
	<li class="cat-item cat-item-3"><a href="/category/charts/" >charts</a>
</li>
	<li class="cat-item cat-item-4"><a href="/category/conferences/" >conferences</a>
</li>
	<li class="cat-item cat-item-5"><a href="/category/d3/" >d3</a>
</li>
	<li class="cat-item cat-item-6"><a href="/category/dashboards/" >dashboards</a>
</li>
	<li class="cat-item cat-item-7"><a href="/category/data-publishing/" >data publishing</a>
</li>
	<li class="cat-item cat-item-8"><a href="/category/data-visualization/" >data visualization</a>
</li>
	<li class="cat-item cat-item-9"><a href="/category/francais/" >français</a>
</li>
	<li class="cat-item cat-item-10"><a href="/category/javascript/" >javascript</a>
</li>
	<li class="cat-item cat-item-11"><a href="/category/presentation/" >presentation</a>
</li>
	<li class="cat-item cat-item-12"><a href="/category/protovis/" >protovis</a>
</li>
	<li class="cat-item cat-item-13"><a href="/category/react/" >react</a>
</li>
	<li class="cat-item cat-item-14 current-cat"><a href="/category/tips/" >tips</a>
</li>
	<li class="cat-item cat-item-1"><a href="/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-15"><a href="/category/web-sites/" >web sites</a>
</li>
		</ul>
</aside><aside id="meta-2" class="widget widget_meta"><h1 class="widget-title">Meta</h1>			<ul>
						<li><a href="/wp-login.php">Log in</a></li>
			<li><a href="/feed/">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="/comments/feed/">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>			</ul>
			</aside>		<div class="clear">&nbsp;</div>
	</div><!-- #secondary -->
	<footer id="colophon" class="site-footer" role="contentinfo">
	    <a class="subscribe icon-feed" href="/feed/"><span class="tooltip">Subscribe!</span></a>
		<div class="site-info inner">
		    <section class="copyright">
		    			    		<a href="https://github.com/lacymorrow/casper" rel="home">Casper WP</a> by Lacy Morrow		    			    </section>
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</main><!-- /#content -->

<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.9b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.9b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.9b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<script type='text/javascript' src='/wp-content/themes/casper/js/main.js?ver=1.0.0'></script>
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.10'></script>
<!--stats_footer_test--></body>
</html>
