<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="HandheldFriendly" content="True" />
<meta name="MobileOptimized" content="320" />

<title>data visualization | jeromecukier.net | Page 5</title>

<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="/xmlrpc.php">
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="jeromecukier.net &raquo; Feed" href="/feed/" />
<link rel="alternate" type="application/rss+xml" title="jeromecukier.net &raquo; Comments Feed" href="/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="jeromecukier.net &raquo; data visualization Category Feed" href="/category/data-visualization/feed/" />
<!-- This site uses the Google Analytics by MonsterInsights plugin v7.0.5 - Using Analytics tracking - https://www.monsterinsights.com/ -->
<!-- Note: MonsterInsights is not currently configured on this site. The site owner needs to authenticate with Google Analytics in the MonsterInsights settings panel. -->
<!-- No UA code set -->
<!-- / Google Analytics by MonsterInsights -->
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/localhost:8888\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.10"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='YoutubeShortcodeMargenn-css'  href='/wp-content/plugins/youtube-shortcode/youtube-shortcode.css?ver=4.6.10' type='text/css' media='all' />
<link rel='stylesheet' id='casper-google-fonts-css'  href='//fonts.googleapis.com/css?family=Noto+Serif%3A400%2C700%2C400italic%7COpen+Sans%3A700%2C400&#038;ver=4.6.10' type='text/css' media='all' />
<link rel='stylesheet' id='casper-style-css'  href='/wp-content/themes/casper/style.css?ver=4.6.10' type='text/css' media='all' />
<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.6.10" />

   	<style type="text/css">
					.blog-title a, .blog-description, .social-icons a { color: #222222; }
		
						                
		
							.main-navigation a { color: ; }
		                                            </style>
    		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
			<style type="text/css">
			.site-title a,
		.site-description {
			color: #222222;
		}
		</style>
	<style type="text/css" id="syntaxhighlighteranchor"></style>
</head>

<body class="archive paged category category-data-visualization category-8 paged-5 category-paged-5 group-blog">

<header id="masthead" role="banner" class="site-head site-header" style="background-image: url(http://localhost:8888/wp-content/uploads/2018/04/Screenshot-2018-04-09-19.38.59.png);">
    <nav id="site-navigation" class="main-navigation" role="navigation">
        <div>
            <h1 class="menu-toggle">
                <a class="icon-bars" href="#">
                    <span class="hidden">Menu</span>
                </a>
            </h1>
            <a class="skip-link screen-reader-text" href="#content">Skip to content</a>
            <div class="menu"><ul><li ><a href="/">Home</a></li></ul></div>
        </div>
    </nav><!-- #site-navigation -->

    <div class="vertical-row">
        <div class="vertical">
            <div class="site-head-content inner">
                
                <div class="social-icons">
                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                <h1 class="blog-title"><a class="blog-logo" href='/' rel='home'>jeromecukier.net</a></h1>
                <h2 class="blog-description">Just another WordPress site</h2>
            </div>
        </div>
    </div>
</header><!-- #masthead -->

<main id="content" class="content" role="main">

	<section id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">
					data visualization				</h1>
							</header><!-- .page-header -->

						
				
<article id="post-906" class="post-906 post type-post status-publish format-standard hentry category-data-visualization tag-17 tag-contest tag-manhattan tag-real-estate tag-scatterplot tag-tableau tag-viz">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2011/06/03/tableau-contest-2011/" rel="bookmark"><time class="entry-date published" datetime="2011-06-03T02:17:19+00:00">June 3, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/data-visualization/" rel="category tag">data visualization</a>			</span>
		        <h1 class="post-title"><a href="/2011/06/03/tableau-contest-2011/" rel="bookmark">Tableau contest 2011</a></h1>
         
    </header>
	<section class="post-content">

		<p><script type="text/javascript" src="http://public.tableausoftware.com/javascripts/api/viz_v1.js"></script><object class="tableauViz" width="654" height="719" style="display:none;"><param name="host_url" value="http%3A%2F%2Fpublic.tableausoftware.com%2F" /><param name="name" value="contest2011&#47;Winning" /><param name="tabs" value="no" /><param name="toolbar" value="yes" /><param name="animate_transition" value="yes" /><param name="display_static_image" value="yes" /><param name="display_spinner" value="yes" /><param name="display_overlay" value="yes" /></object><noscript>Real-estate transactions in ManhattanResidential buildings, 2003-present <br /><a href="#"><img alt="Real-estate transactions in ManhattanResidential buildings, 2003-present " src="http:&#47;&#47;public.tableausoftware.com&#47;static&#47;images&#47;co&#47;contest2011&#47;Winning&#47;1_rss.png" height="100%" /></a></noscript>
<div style="width:654px;height:22px;padding:0px 10px 0px 0px;color:black;font:normal 8pt verdana,helvetica,arial,sans-serif;">
<div style="float:right; padding-right:8px;"><a href="http://www.tableausoftware.com/public?ref=http://public.tableausoftware.com/views/contest2011/Winning" target="_blank">Powered by Tableau</a></div>
</div>
<p>Here is my Tableau contest 2011 entry.<br />
The rules stipulated it had to be about business, real-estate or finance, so I chose real-estate. Since everyone loves New-York, and since the data for real-estate transaction is <a href="http://www.nyc.gov/html/dof/html/property/property_val_sales.shtml">relatively easy to get</a>, that&#8217;s what I show. In order to be within Tableau Public 100,000 row limit, I chose to show only the residential transactions (apartment buildings or buildings converted to apartment buildings), larger than 100 square foot and sold at at least $1. </p>
<p>Before I started, I wanted to create a Tableau that would be legible as a static image.<br />
We tableau tribe have seen a lot of interactive dashboards with sophisticated action. Here, I wanted to cater to the discriminate analyst who gets their kicks from seeing patterns emerge with a glance to 90k datapoints. </p>
<p>What does it show for instance? well, while the bulk of transactions are at a price close to the average there are a large part which are done considerably below that, and comparatively, very few which are markedly over that.<br />
The marks which are aligned show either many transactions at the same price (there are distinct $1, $10 and $100 lines for instance) or sales of similar properties. There were a string of sales of identical apartments at 1335 6th Avenue, for instance.</p>
<p>It&#8217;s possible to switch the function of the Y-axis of the scatterplot, which can either represent square feet or sale price. The largest transaction on the period was around $4 billion, and the largest in terms of area was just above 10m square feet.<br />
It is also possible to explore through the lists on the right. By selecting &#8220;other types&#8221; of buildings for instance you can see which apartment buildings once were yeshivas or fire stations or (what?) &#8220;detention houses for wayward girls&#8221; (there&#8217;s one in upper east side).<br />
You can also switch to a <a href="http://public.tableausoftware.com/views/contest2011/WMap">map-based version of this dashboard</a>. Speaking of maps, a right-click on any mark can open a google maps window centered on that address for you.</p>
<p>So here goes, enjoy the viz and good luck to all contestants</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-872" class="post-872 post type-post status-publish format-standard hentry category-data-visualization category-web-sites tag-better-life-index tag-data-visualization tag-development tag-infovis tag-moritz-stefaner tag-oecd tag-outsourcing tag-post-mortem tag-project-management tag-raureif">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2011/05/25/better-life-index-a-post-mortem/" rel="bookmark"><time class="entry-date published" datetime="2011-05-25T01:48:54+00:00">May 25, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/web-sites/" rel="category tag">web sites</a>			</span>
		        <h1 class="post-title"><a href="/2011/05/25/better-life-index-a-post-mortem/" rel="bookmark">Better life index &#8211; a post mortem</a></h1>
         
    </header>
	<section class="post-content">

		<p>Today, OECD launched the <a href="http://oe.cd/bli">Your better Life Index</a>, a project on which I had been involved for months.</p>
<h2><a href="http://jckr.github.io/blog/wp-content/uploads/2011/05/bli.png"><img class="aligncenter size-full wp-image-880" title="bli" src="http://jckr.github.io/blog/wp-content/uploads/2011/05/bli.png" alt="" /></a></h2>
<h2>The short</h2>
<p>I&#8217;m happy with the launch, the traffic has been really good, and there was <a href="http://flowingdata.com/2011/05/24/better-life-index-measures-well-being-across-countries/">some</a> <a href="http://infosthetics.com/archives/2011/05/oecd_better_life_index_comparing_the_national_well-being_by_flowers.html">great</a> <a href="http://www.economist.com/blogs/dailychart/2011/05/well-being_and_wealth?fsrc=scn/tw/te/dc/thepursuitofhappiness">coverage.</a></p>
<p>The three main lessons are:</p>
<ul>
<li><strong>Just because data is presented in an interactive way doesn&#8217;t make it interesting</strong>. The project is interesting because the design was well-suited to the project. That design may not have worked in other contexts, and other tools may not have worked in this one.</li>
<li><strong>The critical skill here was design</strong>. There are many able developers, but the added value of this project was the ability of the team to invent a form which is unique, excellent and well-suited for the project.</li>
<li><strong>Getting a external specialists to develop the visualization was the critical decision. </strong>Not only did we save time and money, but the quality of the outcome is incomparable. What we ended up with was far beyond the reach of what we could have done ourselves.</li>
</ul>
<h2>The less short</h2>
<p>Before going any further, I remind my kind readers that while OECD pays my bills, views are my own.</p>
<h3>Early history of the project</h3>
<p>OECD had been working on measuring progress for years and researching alternative ways to measure economy. In 2008-2009 it got involved in the <a href="http://www.stiglitz-sen-fitoussi.fr/en/index.htm">Stiglitz-Fitoussi-Sen commission</a> which came up with concrete recommendations on new indicators to develop. It was then that our communication managers started lobbying for a marketable OECD indicator, like the UN&#8217;s Human Development Index or the Corruption Perception Index from Transparency International.</p>
<p>The idea was to come up with some kind of Progress Index, which we could communicate once a year or something. Problem &#8211; this was exactly against the recommendations of the commission, which warned against an absolute, top-down ranking of countries.</p>
<p>Eventually, we came up with an idea. A ranking, yes, but not one definitive list established by experts. Rather, it would be a user&#8217;s index, where said user would get their own index, tailored to their preferences.</p>
<p>Still, the idea of publishing such an index encountered some resistance, some countries did not like the idea of being ranked&#8230; But at some point in 2010 those reserves were overcome and the idea was generally accepted.</p>
<h3>Our initial mission</h3>
<p>It was then that my bosses asked  a colleague and I to start working on what such a tool could look like, and we started working based on the data we had at hand. I&#8217;ll skip on the details of that but we first came up with something in Excel which was a big aggregation of many indicators. It was far from perfect (and further still from the final result) but it got the internal conversation going.</p>
<p>Meanwhile, our statistician colleagues were working on new models to represent inequality, and started collecting data  for a book on a similar project, which will come out later this year (&#8220;How is Life?&#8221;). It made sense to join forces, we would use their data and their models, but will develop an interactive tool while they write their book, each project supporting the other one.</p>
<h3>From prototypes to outsourcing</h3>
<p>It wasn&#8217;t clear then how the tool would be designed. Part of our job was to look at many similar attempts online. We also cobbled some interactive prototypes, I made one in processing, my colleague in flash. Those models were quite close to what we had seen, really. My model was very textbook stuff, one single screen, linked bar charts. Quite basic too.</p>
<p>I was convinced that in order to be marketable, our tool needed to be visually innovative. Different, yes, but not against the basic rules of infovis! No 3D glossy pie or that kind of stuff. Unique, but in a good way. There was also some pressure to use the existing infovis tools used by OECD. We have one, for instance, which we had introduced for <a href="http://stats.oecd.org/OECDregionalstatistics/">subnational statistics</a> and which was really good for that, and which we have used since then in other contexts, with mixed success. My opinion was that using that tool as is on this project would bury it.</p>
<p>That&#8217;s my <strong>1st lesson here</strong>. I&#8217;ll take a few steps back here.</p>
<p>In 2005, the world of public statistics was shaken by the introduction of <a href="http://www.gapminder.org/">gapminder</a>. The way that tool presented statistics, and the huge success of the original <a href="http://www.gapminder.org/videos/ted-talks/hans-rosling-ted-2006-debunking-myths-about-the-third-world/">TED talk</a> &#8211; which attracted tens of millions of viewers &#8211; prompted all statistical offices to consider using data visualization, or rather in our words to produce &#8220;dynamic charts&#8221;, as if the mere fact that gapminder was interactive was the essence of its success. The bulk of such initiatives was neither interesting nor successful. While interactivity opens new possibilities, it is a means and certainly not than an end in itself. Parenthese closed.</p>
<p>At this stage, the logical conclusion was that <strong>we needed to have a new tool developed from scratch</strong>, specifically suited for the project. Nothing less would give it the resonance that we intended. My colleague lobbied our bosses, who took it to their bosses, and all the way to the Secretary-General of OECD. This went surprisingly well, and soon enough we were granted with a generous envelope and tasked with finding the right talent to build the tool.</p>
<h3>Selecting talent</h3>
<p>So our job shifted from creating a tool and campaigning for the project to writing specifications that could be understood by external developers. We had to &#8220;unwrite&#8221; our internal notes describing our prototypes and rewrite them in a more abstract way, trying to describe functionality rather than how we thought we could implement it (i.e. &#8220;the user can select a country&#8221; rather than &#8220;and when they <em>click</em> on a country, the <em>middle pane</em> changes to bla bla bla&#8221;.)</p>
<p>Being a governmental organization we also had to go through a formal call for tenders process, where we&#8217;d have a minimum number of bidders and an explicit decision process that could justify our choices.</p>
<p>This process was both very difficult and very interesting. Difficult because we had many very qualified applicants and not only could we only choose one, but that choice had to be justified, vetted by our bosses, which would take time. And it was rewarding because all took a different approach to the project and to the selection process. What heavily influenced the decision process was (nod to the<strong> 2nd lesson I outlined</strong>) whether the developers showed potential to create something visually unique. We found that many people were able to answer functionally to what we had asked. But the outcome probably wouldn&#8217;t match the unspoken part of our specifications. We needed people who could take the project beyond technical considerations, and imbue it with the creative spirit that would make it appealing to the widest audience.</p>
<h3>Working with a developer</h3>
<p>When we officially started to work with the selected developer &#8211; a joint effort by <a href="http://moritz.stefaner.eu/">Moritz Stefaner</a> and <a href="http://www.raureif.net/">RauReif</a>, some time had passed since we had introduced the project to them. When Moritz started presenting some visual research (which by the way has very little to do with the final site) I was really surprised by how much this was different what we had been working on. And that&#8217;s my <strong>3rd lesson here</strong>.</p>
<p>We had become unable to start again from a blank sheet of paper and to re-imagine the project from scratch. We were too conditioned by the other projects we had seen and our past prototypes that we lacked that mental agility. Now that&#8217;s a predicament that just can&#8217;t affect an external team. Besides, even if we had the degree of mastery of our developers in flash or visual design (and we don&#8217;t), we still had our normal jobs to do, meetings to attend and all kind of office contingencies, and we just couldn&#8217;t be that productive. Even if we had equivalent talent inhouse, it would still had been more effective to outsource it.</p>
<p>What I found most interesting in our developers approach is that it underplayed the accuracy of the data. The scores of each country were not shown, nor the components of that score. That level of detail was initially hidden, which produced a nice, simple initial view. But added complexity could be revealed by selecting information, following links etc. At any time, the information load would remain manageable.</p>
<p>Two things happened in a second phase. On one hand, Moritz had that brilliant idea of a flower. I instantly loved it, so did the colleagues who worked with me since the start of the project. But it was a very hard sale to our management who would have liked something more traditional. Yet that flower form was exactly what we were after: visually unique, a nice match with the theme of the project, aesthetically pleasing, an interesting construction, many possibilities of variation&#8230; Looking back, it&#8217;s still not clear how we managed to impose that idea that almost every manager hated. The most surprising is that one month after everybody had accepted that as an evidence.</p>
<p>On the other, the written part of the web site, which was initially an afterthought of the project, really gained in momentum and importance, both in terms of contents and design. Eventually the web site would become half of the project. What&#8217;s interesting is that the project can cater to all kinds of depths of attention: it takes 10 seconds to create an index, 1 minute to play with various hypotheses and share the results on social networks, but one could spend 10 more minute reading the page of a country or of a topic, and several hours by checking the reference texts linked from these pages&#8230;</p>
<h3>Closing thoughts</h3>
<p>Fast forward to the launch. I just saw a note from Moritz that says that we got 60k unique visitors and 150k views. That&#8217;s about 12 hours after the site was launched (and, to be honest, it has been down during a couple of these 12 hours, but things are fine now)!! those numbers are very promising.</p>
<p>When we started on that project we had an ambition for OECD. But beyond that, I hoped to convince our organization and others of the interest of developing high-quality dataviz projects to support their messages. So I am really looking forward to see similar projects that this one might inspire.</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-826" class="post-826 post type-post status-publish format-standard hentry category-data-visualization category-francais category-protovis category-uncategorized tag-cantonales tag-duels tag-fn tag-politique tag-transferts-de-voix">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2011/04/08/cantonales-suite-et-fin-duels-et-transferts-de-voix/" rel="bookmark"><time class="entry-date published" datetime="2011-04-08T15:09:44+00:00">April 8, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/francais/" rel="category tag">français</a>, <a href="/category/protovis/" rel="category tag">protovis</a>, <a href="/category/uncategorized/" rel="category tag">Uncategorized</a>			</span>
		        <h1 class="post-title"><a href="/2011/04/08/cantonales-suite-et-fin-duels-et-transferts-de-voix/" rel="bookmark">Cantonales suite et fin: duels et transferts de voix</a></h1>
         
    </header>
	<section class="post-content">

		<p>[A note to my English readers &#8211; as you&#8217;d have probably guessed by the title in French, this post about French politics is in French again, but I&#8217;ll soon resume posting in English]<br />
Dimanche 27 a eu lieu le deuxième tour des élections cantonales, dont j&#8217;ai déjà un peu parlé <a href="http://jckr.github.io/blog/?p=764">ici</a> ou <a href="http://jckr.github.io/blog/?p=804">ici</a>. Et qui dit second tour dit duels :<br />
<script type="text/javascript" src="http://jckr.github.io/blog/wp-content/uploads/2011/04/deuxieme.js"></script><br />
<script type="text/javascript" src="http://jckr.github.io/blog/wp-content/uploads/2011/03/votes.js"></script><br />
<script type="text/javascript" src="http://jckr.github.io/blog/protovis_r3_2.js"></script></p>
<div style="width:500px;margin-left:auto;margin-right:auto;"><script type="text/javascript" src="http://jckr.github.io/blog/wp-content/uploads/2011/04/arc2.js"></script></div>
<p>Comme on peut le voir, le &#8220;classico&#8221; du second tour c&#8217;était le duel UMP-PS (336 cas). Mais ce qui intéressait tout le monde c&#8217;était plutôt les cas où le FN était présent: 403 scrutins. Alors que s&#8217;est-il passé? est-ce que les voix se sont <em>bien transférées</em>? </p>
<p>Ce que j&#8217;ai lu suite aux cantonales, c&#8217;est que si les électeurs de gauche avaient fait barrage au front national dans le cas des duels entre le FN et la droite, ce n&#8217;était pas trop le cas des électeurs de droite qui s&#8217;étaient souvent contentés de laisser gagner la gauche sans se mobiliser davantage. Alors voyons ce que disent les chiffres. </p>
<p>Sur les 403 cantons où le front national s&#8217;est maintenu, il y a eu 266 duels avec la gauche et 127 avec la droite. On va passer sur les 10 autres cas de figure (triangulaires, duel avec une autre formation etc.) parce que ce qui nous intéresse ici c&#8217;est de voir <strong>pour qui vote un électeur d&#8217;une grande faction qui ne se retrouve pas au second tour</strong>.</p>
<div style="width:490px;margin-left:auto;margin-right:auto;"><script type="text/javascript" src="http://jckr.github.io/blog/wp-content/uploads/2011/04/transfert11.js"></script></div>
</p>
<p>Dans le cas des duels droite-FN, il y a presque 240,000 électeurs qui avaient voté à gauche au premier tour et qui se sont fait confisquer leur vote. Bien plus que les voix supplémentaire récoltées par les candidats de droite (environ 150,000)! De même, il y a eu environ 280,000 électeurs de droite qui n&#8217;ont pas pu soutenir leur candidat au deuxième tour, alors que les candidats de gauche n&#8217;ont récupéré que 190,000 voix en plus. </p>
<p>Dans les deux cas, la participation a augmenté: environ 210,000 votants en plus. Pourtant, il y a eu une augmentation du nombre de votes nuls (plus de 150,000 supplémentaires) et surtout, un fort gain des voix du FN (presque 300,000).</p>
<h3>Qu&#8217;est ce qu&#8217;on peut en déduire?</h3>
<p>L&#8217;idée d&#8217;un <em>front républicain</em>, d&#8217;une mobilisation massive d&#8217;électeurs de tout bord qui empêcheraient systématiquement la victoire d&#8217;un candidat FN est bien mise à mal. Dans ces 403 cantons, la participation n&#8217;était que de 55.28%, pas très différente de la moyenne nationale. On a déjà vu plus mobilisé! </p>
<p>En plus, il n&#8217;y a pas de report systématique des voix vers l&#8217;adversaire du FN (et ce dans les deux cas, gauche/FN ou droite/FN). En fait, le FN est même capable de gagner des voix entre les deux tours et même beaucoup de voix! Bref, il n&#8217;y aura plus d&#8217;effet 5 mai 2002 et tout est désormais possible pour les candidats du FN.</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-804" class="post-804 post type-post status-publish format-standard hentry category-data-visualization category-protovis tag-cantonales tag-discrimination tag-elections tag-francais tag-nom tag-prenom">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2011/04/01/votre-prenom-est-il-de-droite/" rel="bookmark"><time class="entry-date published" datetime="2011-04-01T22:47:27+00:00">April 1, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/protovis/" rel="category tag">protovis</a>			</span>
		        <h1 class="post-title"><a href="/2011/04/01/votre-prenom-est-il-de-droite/" rel="bookmark">Votre prénom est-il de droite?</a></h1>
         
    </header>
	<section class="post-content">

		[another post in French. sorry for my English readers, but since it's again based on election data it really is only relevant to French people]</p>
Donner un prénom à ses enfants, c'est peut-être la décision qui va le plus influencer le regard des autres à son égard... surtout quand ils ne l'ont pas encore vu. Qu'est-ce qu'on peut s'imaginer d'un Édouard ou d'une Jacqueline avant de les connaître? sûrement pas la même chose. Est-ce qu'on peut deviner leur couleur politique? </p>
pour vérifier ça j'ai pris la liste de tous les candidats aux dernières élections cantonales,soit 10361 personnes avec 1247 prénoms différents qui ont rendu publiques leurs convictions politiques. </p>
Alors, est-ce que tous les Nicolas sont de droite? et les Jean-Marie? Tous les Jean-Luc et les Olivier sont-ils de gauche? Bon, Ségolène, on savait tous que ça faisait pas très socialiste. Mais Martine? Ou François?</p>

La taille des cercles représente le nombre de candidats qui portent tel ou tel prénom, et la couleur, où ils se situent sur une échelle gauche-droite. En cliquant sur un candidat, on peut voir tous les candidats qui portent son prénom, par parti. </p>

Quelques trouvailles: tous les Kévin sont au front national. Toutes les Arlette, aussi - les temps changent! J'ai laissé toutes les orthographes et tous les accents. Par exemple, Michaël est de gauche, mais Mickaël de droite. Et Mickael, de gauche. A quoi ça tient!</p>

Parmi les prénoms qu'on trouve plus de 5 fois, les plus marqués à gauche sont Mathilde, Marianne, Régine, Norbert et Aline. A droite, on trouve Laura, Edouard, Marie-Christine, Adrien et Thérèse.</p>

Et... si Jean-Marie est plutôt de droite, les Nicolas sont d'habitude à gauche, mais pas les François. On trouve plus de Jean-Luc, de Martine et de Dominique à gauche, mais pas d'Olivier!</p><hr/></p>
<script type="text/javascript" src="http://blog.oecdfactblog.org/wp-includes/js/protovis-r3.2.js"></script>
<script type="text/javascript" src="http://jckr.github.io/blog/wp-content/uploads/2011/04/candidats.js" charset="ISO-8859-1"></script>
<script type="text/javascript+protovis">
var re="", sp=-1;
partisDetails={
	EXG:{nom:"Extrême gauche", color:"red", order:0},
	COM:{nom:"Communistes", color:"firebrick",order:1},
	PG:{nom:"Parti de Gauche", color:"crimson",order:2},
	SOC:{nom:"Parti socialiste", color:"lightcoral",order:3},
	RDG:{nom:"Radicaux de gauche", color:"yellow",order:4},
	DVG:{nom:"Divers gauche", color:"pink",order:5},
	VEC:{nom:"Verts, Europe écologie", color:"limegreen",order:6},
	ECO:{nom:"Écologistes", color:"green",order:7},
	REG:{nom:"Régionalistes", color: "saddlebrown",order:8},
	AUT:{nom:"Autres", color: "grey",order:9},
	MODM:{nom:"MODEM", color: "gold",order:10},
	"M-NC":{nom:"Majorité présidentielle", color: "mediumblue",order:11},
	M:{nom:"Autres candidats majorité présidentielle", color: "blue",order:12},
	UMP:{nom:"Union pour un Mouvement Populaire", color:"royalblue",order:13},
	DVD:{nom:"Divers droite", color:"steelblue",order:14},
	FN:{nom:"Front National", color: "skyblue",order:15},
	EXD:{nom:"Extrême droite", color: "sienna",order:16}
};
partis=pv.keys(partisDetails);
partiScore={"EXG":-5, "COM":-5, "PG":-5, "SOC":-2, "RDG":-1, "DVG":-3, "VEC":-4, "ECO":-1, "REG":0, "AUT":0, "MODM":1, "M-NC":3, "M":3, "UMP":3, "DVD":3, "FN":5, "EXD":5}


candidats.forEach(function(c) {var n=c.name.split(" ");pre="";nom="";var inNom=false;n.forEach(function(s) {if(s.toUpperCase()==s){inNom=true;};if(inNom){nom+=s+" ";}else{pre+=s+" ";}});pre=pre.trim();nom=nom.trim();c["prenom"]=pre;c["nom"]=nom;})

//prenoms=pv.nest(candidats).key(function(c) {return c.prenom;}).rollup(function(prenom) {return pv.mean(prenom, function(d) {return partiScore[d.party];});})
prenoms=pv.values(pv.nest(candidats).key(function(c) {return c.prenom;}).rollup(function(prenom) {
return {prenom:prenom[0].prenom,
        score:pv.mean(prenom, function(d) {return partiScore[d.party];}),
        frequence:prenom.length}
;}))
prenoms.forEach(function(p) {p["partis"]=pv.nest(candidats.filter(function(c) {return c.prenom==p.prenom;})).key(function(d) {return d.party;}).rollup(function(d) {return d.length;});})

var prenomParti=[];

cScale=pv.Scale.linear(-5,0,5).range("red","#eee","blue")
//pf=prenoms.filter(function(p) {return p.frequence>1;}).sort(function(b,a) {return (a.frequence>b.frequence)-(b.frequence>a.frequence);});
pf=prenoms.sort(function(b,a) {return (a.frequence>b.frequence)-(b.frequence>a.frequence);});
pnode0=pv.nest(candidats).key(function(c) {return c.prenom;}).rollup(function(prenom) {return prenom.length;})
pnode={};pscore={};

pv.keys(pnode0).forEach(function(p,i) {
	if(p!="") {
		pnode[p]=pv.values(pnode0)[i];
		pscore[p]=pf.filter(function(d) {return d.prenom==p;})[0].score;
	}})
pv.keys(pnode).forEach(function(p,i) {pscore[pv.values(pf)[i].prenom]=pv.values(pf)[i].score;})
vis=new pv.Panel().width(600).height(600);

vis2=vis.add(pv.Panel).width(450).height(450).event("click", function() {sp=-1;prenom="";vis.render();});
var pack = vis2.add(pv.Layout.Pack)
    .nodes(pv.dom(pnode).root("prenoms").nodes())
    .size(function(d) {return d.nodeValue;})
    //.order(null)
    ;
pack.node.strokeStyle(null);
pack.node.add(pv.Dot)
    .fillStyle(function(d) {if(d.index) {return cScale(pscore[d.nodeName]);} else {return "white";}})
    .title(function(d) {if (d.index) {return d.nodeName;} else {return null;}})

    .event("click", function(d) {if(this.index) {
    	console.log(d.nodeName);
    	select(d.nodeName);
    } else {sp=-1;prenom="";vis.render();}
    smallP.render();})


    //.title(function(d) {if (d.index) {return d.nodeName+" "+pscore[d.nodeName];} else {return null;}})
    .strokeStyle(function(d) {return re?((d.nodeName).match(re) ? "#000" : null):null;})
    ;

function update(query) {
	if (query != re) {
	    re = new RegExp(query, "i");
	    vis2.render();
	}
}

var nameList, nameSlice, nameLength;
function select(prenom) {
	console.log(prenom);
	sp=1;
	prenomParti=prenoms.filter(function(p) {return p.prenom==prenom;})[0];
	nameList=candidats.filter(function(c) {return c.prenom==prenom;});
	nameSlice=0;
	nameLength=nameList.length;
	vis.render();
}

var partiScale=pv.Scale.linear()
	.domain(0,80)
	.range(0,100);

var smallP=vis.add(pv.Panel)
	.left(440).height(600)
	.visible(function() {return sp!=-1;});
var box=smallP.add(pv.Panel)
	.height(function() {return 30+12*pv.keys(prenomParti.partis).length;}).width(160)
	.fillStyle("#ddd");
box.add(pv.Label).top(1).left(5).textBaseline("top").text(function() {return prenomParti.prenom+" ("+prenomParti.frequence+")";})

var partyBars=box.add(pv.Panel).top(15).left(1).height(function() {return this.parent.height()-16;}).width(158).fillStyle("white")
		.add(pv.Bar)
			.data(function() {return pv.keys(prenomParti.partis)
				.sort(function(a,b) {return (partisDetails[a].order>partisDetails[b].order)-(partisDetails[a].order<partisDetails[b].order);})
			;})
			.top(function() {return 10+this.index*12;})
			.left(40)
			.height(10)
			.width(function(d) {return partiScale(prenomParti.partis[d]);})
			.fillStyle(function(d) {return partisDetails[d].color;})
			.title(function(d) {return partisDetails[d].nom;});

partyBars.anchor("left").add(pv.Label)
				.textAlign("right")
partyBars.anchor("right").add(pv.Label)
				.textAlign("left")
				.text(function(d) {return prenomParti.partis[d];})
				.textStyle("#ccc")

var box2=smallP.add(pv.Panel).top(270).height(330).fillStyle("#ddd");
var nameListing=box2.add(pv.Panel)
	.top(1)
	.height(328)
	.left(1)
	.width(158)
	.fillStyle("#fff")
	.add(pv.Panel)
		.data(function() {return nameList.slice(nameSlice,nameSlice+24);})
		.top(function() {return 5+this.index*12;})
		.left(10).height(10)
		.fillStyle("rgba(255,255,255,.01)")
		.title(function(d) {return d.name+" ("+((d.depId[0]==0)?"":d.depId[0])+d.depId.slice(1,3)+")";})
		.add(pv.Panel)
			.top(3).left(-8).width(7).height(7).fillStyle(function(d) partisDetails[d.party].color)
			.title(function(d) partisDetails[d.party].nom)
			.parent
		.add(pv.Label)
			.textBaseline("top").textAlign("left")
			.text(function(d) {return d.name+" ("+((d.depId[0]==0)?"":d.depId[0])+d.depId.slice(1,3)+")";})
	;

box2.add(pv.Panel).left(158).top(5).height(320).width(1).fillStyle("#fff");
box2.add(pv.Panel).left(159).top(5).height(320).width(1).fillStyle("#ddd");

var moreBox = smallP.add(pv.Panel)
	.fillStyle("#eee")
	.height(20)
	.left(90)
	.width(60)
	.top(570)
	.visible(function() {return nameSlice+24<=nameLength;})
	.event("click", function() {nameSlice+=24;box2.render();moreBox.render();lessBox.render();});
moreBox.anchor("center").add(pv.Label).text("suivants")
	;

var lessBox = smallP.add(pv.Panel)
	.fillStyle("#eee")
	.height(20)
	.left(10)
	.width(60)
	.top(570)
	.visible(function() {return nameSlice>=24;})
	.event("click", function() {nameSlice-=24;box2.render();moreBox.render();lessBox.render();});
lessBox.anchor("center").add(pv.Label).text("précédents")
	;


    vis.render();

</script>
<div class="protovis" style="float:left;"></div>
<div>
	<label for="search">Trouver un prénom : </label>
	<input type="text" id="search" onkeyup="update(this.value)">
</div>
<p/><hr/>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-799" class="post-799 post type-post status-publish format-standard hentry category-data-visualization category-protovis tag-budget tag-challenge tag-datavizchallenge tag-game-y-infographics tag-protovis tag-treemap">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2011/03/27/datavizchallenge-org-my-entry/" rel="bookmark"><time class="entry-date published" datetime="2011-03-27T16:03:12+00:00">March 27, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/protovis/" rel="category tag">protovis</a>			</span>
		        <h1 class="post-title"><a href="/2011/03/27/datavizchallenge-org-my-entry/" rel="bookmark">datavizchallenge.org: my entry</a></h1>
         
    </header>
	<section class="post-content">

		<p>I just posted my <a href="http://www.datavizchallenge.org/">www.datavizchallenge.org</a> <a href="http://jckr.github.io/blog/stuff/datavizchallenge/index.html">entry</a>!<br />
<a href="http://jckr.github.io/blog/stuff/datavizchallenge/index.html"><img src="http://jckr.github.io/blog/wp-content/uploads/2011/03/myEntry3.png" alt="" title="My  datavizchallenge.org entry" width="323" height="330" class="aligncenter size-full wp-image-801" /></a></p>
<p>So here&#8217;s a little explanation about what I&#8217;ve done, how and why. </p>
<p>The idea behind the data provider web site, <a href="http://www.whatwepayfor.com/">WhatWePayFor</a>, is that billions and millions don&#8217;t talk to the average citizen. This doesn&#8217;t help them understand where their money goes.</p>
<p>And in my work, I generally try to show as little data as possible to make a point. And I like to use interactivity to involve users. </p>
<p>I got my idea from thinking back to the presentation made by <a href="http://thevcl.com/storytelling/docs/nicholas_diakopoulos.pdf">Nick Diakopoulos</a> at last <a href="http://thevcl.com/storytelling/">Visweek</a>. We had that workshop on data storytelling and Nick showed how to get user attention on a subject by letting them play and guess first. So here goes.</p>
<p>First, I wanted to let users play with data, in this case try to establish their priorities for federal budget spending. Where <em>should</em> money go?</p>
<p>I&#8217;ve manipulated this kind of figures a few times, so I know that USA has extreme positions on some &#8220;functions of spending&#8221;, like defense, or culture. Some rich countries that spend up to 7% of their budget on culture, and some who spend less than 0.1% of their budget on defense. Hint, the USA is not one of them.</p>
<p>So I&#8217;m hoping that the users will see differences between their preferences and the choices that the government makes in their names, and that from the differences will be striking enough for them to understand the orders of magnitude and possibly inspire them to take action.</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-796" class="post-796 post type-post status-publish format-standard hentry category-data-visualization category-protovis tag-cartogram tag-dorling tag-france tag-map tag-protovis">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2011/03/27/building-the-france-dorling-cartogram/" rel="bookmark"><time class="entry-date published" datetime="2011-03-27T14:28:33+00:00">March 27, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/protovis/" rel="category tag">protovis</a>			</span>
		        <h1 class="post-title"><a href="/2011/03/27/building-the-france-dorling-cartogram/" rel="bookmark">Building the France Dorling cartogram</a></h1>
         
    </header>
	<section class="post-content">

		<p>This is a follow-up to <a href="http://jckr.github.io/blog/?p=764">the previous post</a> where I used a Dorling cartogram to show election results in France. So how did I come up with that?</p>
<h2>Step 1: the data</h2>
<p>Without data, there wouldn&#8217;t be much to plot, right? So the first order of business was to fetch the data, which is theoretically available from an <a href="http://elections.interieur.gouv.fr/CN2011/">official source.</a> Unfortunately, there is no way to download those results at once, instead they are presented in a myriad of formatted HTML pages &#8211; over 2000 in all. </br><br />
I used <a href="http://www.google.com/search?q=wget">wget</a> to download them all. wget allows for recursive download, that is, you can download a page, and all the links from that page, etc. You can also specify the depth of the recursive download, which is a good idea in that case because there are lots of duplicates of that information on the server, so trying to get everything will take a couple of hours vs about 10 minutes.</p>
<p>Once that&#8217;s done, I used python and <a href="http://www.crummy.com/software/BeautifulSoup/">Beautiful Soup</a> to turn the HTML pages into nice JSON objects. Fortunately the pages followed the same strict template, so I could run a relatively simple extraction script, like: look at the second HTML table of the page, get the number of registered voters who didn&#8217;t vote from the 2nd cell of the 2nd row, etc.<br />
Once that was done I came up with 2 files: <a href="http://jckr.github.io/blog/wp-content/uploads/2011/03/votes.js">one which listed the aggregate votes per county</a> and per party, and another one which listed all the candidates, their affiliation and their votes. I ended up using only the 1st one, actually at an even more aggregated level, but I may use the second one for further work.</p>
<h2>Next up: setting the geography</h2>
<p>A dorling cartogram is really a kind of <a href="http://en.wikipedia.org/wiki/Force-based_algorithms_(graph_drawing)">force-directed layout graph</a> where the nodes represent geographical entities, which are initially positioned at a place corresponding to their geography, but which are then resized by a variable, and whose movement is subject to several forces: each node is linked to its original geographical neighbors, which attract each other, but also cannot intersect with other nodes, so it pushes back its neighbors.</p>
<p>So for this to work I had to:
<ul>
<li>find the initial position of my geographical entities (French <em>départements</em>) and</li>
<li>list their neighbors.</li>
</ul>
<p>To get the initial position I fetched the list of all French towns and their lon-lat coordinates which I averaged for each département. That gave me a workable proxy of the centroid of that departement. Note that I didn&#8217;t need anything very accurate at this stage, since nodes are going to be pushing each other anyway.<br />
I listed the neighbors manually, since the number of départements is workable. Else, one possible way to do that from a shape file is look at every point of every shape and list all the entities that use it. If two entities use it they are neighbors. Again at this stage it&#8217;s not mandatory to be exhaustive. If an entity is surrounded by 8 others and we only use 4 the results will look sensibly the same.<br />
Anyone who wants to create dorling cartograms for France can <a href="http://jckr.github.io/blog/wp-content/uploads/2011/03/francedorling.js">reuse the file</a>. </p>
<h2>Putting it all together</h2>
<p>The rest is standard protovis fare. There is an example which uses <a href="http://vis.stanford.edu/protovis/ex/cartogram.html">Dorling cartograms</a> which I used as a basis. I prepared my data files so that I could aggregate the stuff I needed at the level of the département (which is about 20 counties). I never really considered showing anything at the county level because except for looking up specific results it is never too relevant. For instance, in most places there are some agreement between parties which don&#8217;t all present candidates in order to favor their allies. </p>
<p>An interesting parameter when building the visualization is choosing the constant by which to multiply the size of the nodes. If it is too high, the cartogram will look like a featureless cluster of circles. If it is too low, it will ressemble the map a lot, and circles won&#8217;t touch each other.</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-764" class="post-764 post type-post status-publish format-standard hentry category-data-visualization category-protovis tag-cantonales tag-cartogramme tag-dorling tag-elections tag-francais tag-france tag-politiques">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2011/03/26/la-carte-des-cantonales/" rel="bookmark"><time class="entry-date published" datetime="2011-03-26T21:05:36+00:00">March 26, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/protovis/" rel="category tag">protovis</a>			</span>
		        <h1 class="post-title"><a href="/2011/03/26/la-carte-des-cantonales/" rel="bookmark">La carte des cantonales</a></h1>
         
    </header>
	<section class="post-content">

		[I write this here post in French because it's more relevant for a French audience, a <a href="http://jckr.github.io/blog/?p=796">more technical post</a> with an explanation of how it's done follows in English].</p>

J'ai écrit que j'avais été déçu par les infographies des principaux médias au lendemain des cantonales.</p>

Si on prend la carte du Monde par exemple, on y voit la France nettemement découpée en départements, soit bien roses, soit bien bleus, ou à la rigueur gris si l'issue est incertaine. Mais ce n'est pas l'enjeu de ces élections. Ce sont les dernières élections avant la présidentielle, et on est donc attentif aux enseignements nationaux du scrutin au-delà de la composition des conseils généraux. Ce qu'on commente, c'est plus la percée de l'extrême droite ou le poids de l'abstention. C'est la capacité de la droite ou de la gauche à s'imposer. </p>
Dans cette optique, chaque département n'a pas le même poids. Le Nord par exemple, avec presque 900,000 électeurs, compte plus que la Lozère qui en compte juste un peu plus de 20,000. Donc, tracer une carte géographiquement exacte n'est pas très honnête, puisque cela cache ces différences qui peuvent être énormes.</p>
Comme je n'ai pas l'habitude de porter des critiques <a href="http://jckr.github.io/blog/?p=661">sans proposer autre chose</a>, j'ai fabriqué des cartogrammes de Dorling pour rendre compte de ce qui s'est vraiment passé dimanche dernier.</p>

Les cartogrammes, ce sont presque des cartes, sauf que le côté géographique n'est pas pris au sens strict. Leur forme dépend plus des données qu'elles représentent. Et dans la version de Dorling, on remplace les morceaux de la carte (ici, les départements) par des cercles, plus ou moins gros. Là, la taille des cercles dépend du nombre d'électeurs inscrits aux cantonales. Du coup, leur position sur la carte n'est pas exactement la même que celle des départements sur la carte de France mais elle est assez proche pour qu'on puisse les retrouver.</p>

Je propose 3 scénarios: une comparaison gauche-droite, l'importance de l'extrême-droite et celle de l'abstention.
</p><hr/></p>
<script type="text/javascript" src="http://blog.oecdfactblog.org/wp-includes/js/protovis-r3.2.js"></script>
<form>
<input type="radio" checked name="group1" value="0" onclick="sc=0;reinit() ;vis.render();">Gauche-droite
<input type="radio" name="group1" value="1" onclick="sc=1;reinit() ;vis.render();">Extrême-droite
<input type="radio" name="group1" value="2" onclick="sc=2;reinit() ;vis.render();">Abstention</form>
<script type="text/javascript" src="http://jckr.github.io/blog/wp-content/uploads/2011/03/votes.js"></script>
<script type="text/javascript" src="http://jckr.github.io/blog/wp-content/uploads/2011/03/francedorling.js"></script>
<script type="text/javascript" src="http://jckr.github.io/blog/wp-content/uploads/2011/03/cantonales.js"></script>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-573" class="post-573 post type-post status-publish format-standard hentry category-data-visualization category-protovis tag-arrays tag-data tag-map tag-projections tag-protovis">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2011/03/15/protovis-analysis-of-the-map-projections-example/" rel="bookmark"><time class="entry-date published" datetime="2011-03-15T18:17:31+00:00">March 15, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/protovis/" rel="category tag">protovis</a>			</span>
		        <h1 class="post-title"><a href="/2011/03/15/protovis-analysis-of-the-map-projections-example/" rel="bookmark">Protovis: analysis of the Map projections example</a></h1>
         
    </header>
	<section class="post-content">

		<h2>What is a map?</h2>
<p>before we start looking at the code it may be a good idea to think of the best way to represent a country.<br />
Countries are areas of land surrounded by borders, which are imaginary (or sometimes physical) <strong>lines</strong> going through a set of <strong>points</strong>.<br />
<a href="http://jckr.github.io/blog/wp-content/uploads/2011/03/square.png"><img src="http://jckr.github.io/blog/wp-content/uploads/2011/03/square.png" alt="" title="square" width="200" height="200" class="aligncenter size-full wp-image-748" /></a></p>
<p>Some countries are made of one of such surfaces, but many countries are not one contiguous territory (they may include islands for instance) so they could be made out of <strong>several disjointed polygons</strong>.<br />
<a href="http://jckr.github.io/blog/wp-content/uploads/2011/03/square1.png"><img src="http://jckr.github.io/blog/wp-content/uploads/2011/03/square1.png" alt="" title="square" width="200" height="200" class="aligncenter size-full wp-image-749" /></a>.</p>
<p>Now let&#8217;s put on our protovis hat. Let&#8217;s suppose we want to draw a map where each country could be colored differently (choropleth). What kind of data structure should be use to represent that?<br />
First there should be a sort of array of countries. Each country should be an item in that array, so they can be indexed and assigned an individual color and various data points.<br />
Then, at the lowest level, we would be drawing polygons, which are treated as pv.Line in protovis. For each polygon, we would require an array of coordinate pairs. To draw a country, we would need a list (array) of those polygons. </p>
<p>So the data structure we are looking at is: </p>
<pre class="brush: jscript; title: ; notranslate" title="">var world=[  // an array of countries
    [ // an array of polygons
        [ // an array of pairs of coordinates
            [x0, y0], // coordinates of the first point
            [x1, y1], // coordinates of the next one
                ... 
            [xn, yn],
            [x0, y0]  // coordinates of the first point to close the polygon
        ]
       ...              // another polygon, but maybe not.
   ], 
   [                    // next country
  ...
   ]
...
]</pre>
<h2>the map projections example</h2>
<p><a href="http://jckr.github.io/blog/wp-content/uploads/2011/03/projections.png"><img src="http://jckr.github.io/blog/wp-content/uploads/2011/03/projections.png" alt="" title="projections" width="600" height="360" class="aligncenter size-full wp-image-754" /></a></p>
<p>Can be found <a href="http://vis.stanford.edu/protovis/ex/projection.html">here: </a> http://vis.stanford.edu/protovis/ex/projection.html</p>
<pre class="brush: jscript; title: ; notranslate" title="">/*
 * A diverging color scale, using previously-computed quantiles of population
 * densities; in the future, we might use a quantile scale here to do this
 * automatically. Map colors based on www.ColorBrewer.org, by Cynthia A. Brewer,
 * Penn State.
 */
var fill = pv.Scale.linear()
    .domain(140, 650, 1900)
    .range(&quot;#91bfdb&quot;, &quot;#ffffbf&quot;, &quot;#fc8d59&quot;);

/* Precompute the country's population density and color. */
countries.forEach(function(c) {
  c.color = stats[c.code].area
      ? fill(stats[c.code].pop / stats[c.code].area)
      : &quot;#ccc&quot;; // unknown
});

var w = 860,
    h = 3 / 5 * w,
    geo = pv.Geo.scale(&quot;hammer&quot;).range(w, h);

var vis = new pv.Panel()
    .width(w)
    .height(h);

/* Countries. */
vis.add(pv.Panel)
    .data(countries)
  .add(pv.Panel)
    .data(function(c) c.borders)
  .add(pv.Line)
    .data(function(b) b)
    .left(geo.x)
    .top(geo.y)
    .title(function(d, b, c) c.name)
    .fillStyle(function(d, b, c) c.color)
    .strokeStyle(function() this.fillStyle().darker())
    .lineWidth(1)
    .antialias(false);

/* Latitude ticks. */
vis.add(pv.Panel)
    .data(geo.ticks.lat())
  .add(pv.Line)
    .data(function(b) b)
    .left(geo.x)
    .top(geo.y)
    .strokeStyle(&quot;rgba(128,128,128,.3)&quot;)
    .lineWidth(1)
    .interpolate(&quot;cardinal&quot;)
    .antialias(false);

/* Longitude ticks. */
vis.add(pv.Panel)
    .data(geo.ticks.lng())
  .add(pv.Line)
    .data(function(b) b)
    .left(geo.x)
    .top(geo.y)
    .strokeStyle(&quot;rgba(128,128,128,.3)&quot;)
    .lineWidth(1)
    .interpolate(&quot;cardinal&quot;)
    .antialias(false);

vis.render();
</pre>
<p>In addition there are two arrays of the following shape:<br />
First, stats which is an associative arrays of associative arrays, and which associate each 2-letter country code with values of population and area:</p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">
var stats = {
'AG': {pop:83039, area:44},
'DZ': {pop:32854159, area:238174},
...
'US': {pop:299846449, area:915896},
...
};
</pre>
<p>Then, countries, which is an array of associative arrays.</p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">
var countries = [
{code:'AG', name:&quot;Antigua and Barbuda&quot;, 
borders:[ // an array of one or several areas, 
  [ // an array of coordinates, 
    [ // a pair of the form longitude, lattitude
       ...
    ]
  ]
]}
...
]</pre>
<p>Now this second data structure looks a lot like the one we&#8217;ve drafted in the prologue. All the geographic information is tucked in a property called &#8220;borders&#8221;. The array has other properties for comfort.<br />
Because the data is put in the right shape and order, this script can produce a very good map with a remarkable economy of code.<br />
This example has been put together to showcase the various map projections of protovis (identity, mercator, and so on.). These projections have zero impact on the way data should be assembled for making maps, so we&#8217;ll just treat them as &#8220;magic&#8221;. </p>
<pre class="brush: jscript; title: ; notranslate" title="">/*
 * A diverging color scale, using previously-computed quantiles of population
 * densities; in the future, we might use a quantile scale here to do this
 * automatically. Map colors based on www.ColorBrewer.org, by Cynthia A. Brewer,
 * Penn State.
 */
var fill = pv.Scale.linear()
    .domain(140, 650, 1900)
    .range(&quot;#91bfdb&quot;, &quot;#ffffbf&quot;, &quot;#fc8d59&quot;);
</pre>
<p>This part creates a color scale which will return a color according to the value passed to it. The color returned will be somewhere between the ones specified in the range, depending on where the value is relatively to the values specified in the domain. So a value of 140 will result in a color of #91bfdb (bluish), it will go towards the grey as the value moves up to 650, and towards #fc8d59 (redish) as the value goes up to 1900.</p>
<pre class="brush: jscript; first-line: 11; title: ; notranslate" title="">/* Precompute the country's population density and color. */
countries.forEach(function(c) {
  c.color = stats[c.code].area
      ? fill(stats[c.code].pop / stats[c.code].area)
      : &quot;#ccc&quot;; // unknown
});</pre>
<p>As the remark says, this will precompute the country&#8217;s color once and for all.<br />
The <a href="http://jckr.github.io/blog/?p=494">forEach() method</a> goes to every element of the countries array.<br />
the c.color = statement will add a color key to each element of that array (which, as you may recall, already has values for the code, name and borders keys.<br />
What it does is that is retrieves the country code of that element of countries, c.code, and uses that to find out whether we have an area value for that country code (this is stats[/c].area?).<br />
If this is the case, we are going to compute the color that should be attributed to the country, by passing the population divided by the area to the color scale we just made. Else, we just use light grey.</p>
<p>The next few lines are standard constants that will shape the vis.<br />
Note however </p>
<pre class="brush: jscript; first-line: 20; title: ; notranslate" title="">geo = pv.Geo.scale(&quot;hammer&quot;).range(w, h)</pre>
<p>This is a geographic scale, which will be used to convert longitudes and latitudes to X and Y coordinates on the screen.</p>
<pre class="brush: jscript; first-line: 26; title: ; notranslate" title="">/* Countries. */
vis.add(pv.Panel)
    .data(countries)
  .add(pv.Panel)
    .data(function(c) c.borders)
  .add(pv.Line)
    .data(function(b) b)
    .left(geo.x)
    .top(geo.y)
    .title(function(d, b, c) c.name)
    .fillStyle(function(d, b, c) c.color)
    .strokeStyle(function() this.fillStyle().darker())
    .lineWidth(1)
    .antialias(false);</pre>
<p>This is where it all happens.<br />
First, we create a series of panels, one for each country. So, we pass the countries array as data.<br />
Then, we are going to create another series of panels for every country, that is, with as many panels as there are independent areas in the country. For instance, if there are islands, we are going to need extra panels to represent them. If the country is one contiguous mass of land, there will be just one panel here.<br />
This time, we use function(c) c.borders as data. That is, we go into the borders array.</p>
<p>Finally, we are going to create a filled polygon for each of these independent areas. This is achieved by adding a pv.Line to the previous panels. Likewise, we use (function(b) b) as data, meaning that we go yet another level into the borders array. Now, we are accessing the pairs of longitude + latitude numbers.</p>
<p>geo.x and geo.y convert this pair of numbers to X and Y coordinates on the screen.<br />
For the next two lines, title and fillStyle, we need to go back to the country level.<br />
so, we use a function of the form <a href="http://jckr.github.io/blog/?p=479">function(d,b,c)</a>. d is the current item (pair of longitude, latitude), b its parent (individual area) and c, its grand-parent (the country).<br />
so, function(d,b,c) c.name retrieves the country name, and function(d,b,c) c.color retrieves the color we had computed for that country to begin with.</p>
<p>For the color of the border, we wish to use a darker version of the fill color. This is what the this.fillStyle().darker() does.</p>
<p>The rest of the vis is longitude and latitude ticks, using the built-in properties of the scale.</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-737" class="post-737 post type-post status-publish format-standard hentry category-charts category-data-visualization tag-tableau tag-tableau-public">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2011/03/14/stuff-i-do-with-tableau/" rel="bookmark"><time class="entry-date published" datetime="2011-03-14T19:01:31+00:00">March 14, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/charts/" rel="category tag">charts</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>			</span>
		        <h1 class="post-title"><a href="/2011/03/14/stuff-i-do-with-tableau/" rel="bookmark">Stuff I do with Tableau</a></h1>
         
    </header>
	<section class="post-content">

		<p>I put together a list of some of the things I&#8217;ve done with Tableau public <a href="http://bit.ly/f9bfS3">there</a>. I had put the link on twitter last Friday, and I just saw the number of connections through bit.ly &#8211; never thought something posted just before the week-end could get so much attention! so thanks, twitter followers. I&#8217;m putting another link here on the blog for convenience.</p>
<p>I&#8217;ve been using Tableau public ever since its release (well actually a tad before).  Over time I&#8217;ve been trying to use it less as a visually pleasing and convenient way to shove a lot of data in a limited space (like <a href="http://public.tableausoftware.com/views/LabourForceStats/empag">here</a>), and more as a way to promote a certain angle when looking at a dataset (like <a href="http://public.tableausoftware.com/views/Africa_1/converging">here</a>), that is, as an invitation to the viewers to reach the same conclusions than us, but by giving them access to the data so they can see for themselves.</p>
<p><div style="width: 394px" class="wp-caption alignnone"><a href="http://public.tableausoftware.com/views/LabourForceStats/empag"><img title="Employment and age" src="http://public.tableausoftware.com/static/images/La/LabourForceStats/empag/1_rss.png" alt="" width="384" height="620" /></a><p class="wp-caption-text">One of my first vizzes - just a layer on top of the dataset</p></div></p>
<p><div style="width: 644px" class="wp-caption alignnone"><a href="http://public.tableausoftware.com/views/Africa_1/converging"><img title="Is Africa converging?" src="http://public.tableausoftware.com/static/images/Af/Africa_1/converging/1_rss.png" alt="" width="634" height="420" /></a><p class="wp-caption-text">This one is less neutral. I would like readers to embrace the opinion in the associated article, so I use Tableau to present the data in a way that supports this opinion.</p></div></p>
<p>That long list is still a subset of what I&#8217;ve done with Tableau, mostly because like many people in datavis I use Tableau at two stages.</p>
<p>I use it to communicate a finished visualization such as these, although I may use a static image or another interactive tool.</p>
<p>But I also almost systematically use it in the early stages, when I receive a dataset and I need to make sense of it before I can represent it. By manipulating a dataset in Tableau and testing various basic dimension combinations one can quickly see the points of interest in the data and come up with relevant questions to ask the data, to which a visualization is the answer. So while I can&#8217;t share these &#8220;drafts&#8221; they are very very helpful.</p>
<p>Also over time I got better (hopefully) at controlling dashboards so they look exactly the way I want them to and not how I manage to put them together. What helps is setting the size of the dashboard as exact dimensions (ie 600 by 400), not as a range, and, unsurprisingly, to draw the dashboard on paper first. Anyway, all the dashboards which are on that page are freely downloadable if you want to see how they are done</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-661" class="post-661 post type-post status-publish format-standard hentry category-data-visualization category-protovis tag-exports tag-france tag-maps tag-trade tag-treemaps">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2011/02/18/la-france-qui-exporte/" rel="bookmark"><time class="entry-date published" datetime="2011-02-18T20:10:38+00:00">February 18, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/protovis/" rel="category tag">protovis</a>			</span>
		        <h1 class="post-title"><a href="/2011/02/18/la-france-qui-exporte/" rel="bookmark">La france qui exporte</a></h1>
         
    </header>
	<section class="post-content">

		<p>This week, I was made aware of a new set of maps by French ministry of Foreign Trade, called <em>cartographie de la France qui exporte</em> (map of France exports) (<a href="http://www.exporter.gouv.fr/exporter/Pages.aspx?iddoc=1821&#038;pex=1-2-40-926-1821">link</a>). Since I&#8217;m interested in the topic and that I know that French public services have killer cartographers I was eager to see what was so exciting about the first set of online maps on French exports. </p>
<p>I was a little underwhelmed to be honest. Online here meant static pdf files, although this is a dataset that just begs to be explored and manipulated.<br />
On top of that, those where basic choropleth maps with markers such as this one here:<br />
<a href="http://jckr.github.io/blog/wp-content/uploads/2011/02/largemap.png"><img src="http://jckr.github.io/blog/wp-content/uploads/2011/02/largemap.png" alt="" title="largemap" width="626" height="631" class="size-full wp-image-662" /></a></p>
<p>Now this map has two problems. First, it&#8217;s a choropleth with a discrete scale, but the values of adjacent areas can vary a lot. So, if you look at this portion of the map, what can be deduced on the values? not much I&#8217;m afraid.<br />
<a href="http://jckr.github.io/blog/wp-content/uploads/2011/02/choropleth.png"><img src="http://jckr.github.io/blog/wp-content/uploads/2011/02/choropleth.png" alt="" title="choropleth" width="123" height="132" class="aligncenter size-full wp-image-663" /></a></p>
<p>Second, it&#8217;s difficult to compare the marks on the map. Which region has the biggest? the smallest? how do two specific regions compare? with this representation, this type of question is even more difficult to answer than with a table.<br />
<a href="http://jckr.github.io/blog/wp-content/uploads/2011/02/marks-only.png"><img src="http://jckr.github.io/blog/wp-content/uploads/2011/02/marks-only.png" alt="" title="marks only" width="313" height="316" class="aligncenter size-full wp-image-664" /></a></p>
<p>Also these charts answer one partial question. So this one, here, shows which region exports most food products. But to where? and how about the imports and balance? now if one given view was the most relevant and could illustrate some important finding, it can be highlighted but here the website gives us collections of many of such maps. As a citizen I&#8217;m leaving no more informed than I was.</p>
<p>Not being the one to criticize without proposing an alternative, I whipped out an <strong>interactive exploratory tool of France trade flows</strong>.<br />
<a href="http://jckr.github.io/blog/wp-content/uploads/2011/02/franceexport.html" target=”_blank”><img src="http://jckr.github.io/blog/wp-content/uploads/2011/02/treemap.png" alt="" title="treemap" width="561" height="443" class="aligncenter size-full wp-image-668" /></a><br />
(The interactive vis is too wide to conveniently fit in a blog, but clicking on the image will open it in a new tab).</p>
<p>I don&#8217;t have access to the same dataset so I can&#8217;t show a strict equivalent. My data comes from <a href="http://comtrade.un.org/">COMTRADE</a>, the UN database of trade flows, and shows all exports and imports to France in 2009. They are not broken down by region or by type of company, but I got the flows by partner country and product category.<br />
The idea is that one can select something on one treemap to update the other. Also, it&#8217;s possible to alternate between a categorical view (where all groups of products and continents look neatly separated) and a view of the balance, which quickly shows which products or which countries get the bulk of French trade. </p>
<hr>
(technical explanation follows for those interested in the code proper)<br />
Now following last week&#8217;s <a href="http://jckr.github.io/blog/?p=426">tutorial</a>, of course it had to be done in <a href="http://www.protovis.org/">protovis</a>.<br />
Actually it illustrates some interesting principles of working with arrays, trees, maps etc. </p>
<p>First, I want to do as much data manipulation as possible in protovis as opposed to manually. So, my source <a href="http://jckr.github.io/blog/wp-content/uploads/2011/02/data.js">data</a> for the treemap is stored as an array of associative arrays, which is probably the preferred form in protovis. This is no different than, for instance, <a href="http://jckr.github.io/blog/?p=534">Protovis&#8217;s barley example</a>.<br />
Now how do you get something of the shape &#8211;</p>
<pre class="brush: jscript; title: ; notranslate" title="">var data=
[{com:&quot;02&quot;,cat:0,cou:4,con:3,imp:0,exp:101421},
{com:&quot;03&quot;,cat:0,cou:4,con:3,imp:9716,exp:0},
{com:&quot;04&quot;,cat:0,cou:4,con:3,imp:0,exp:9272355},
{com:&quot;05&quot;,cat:0,cou:4,con:3,imp:531587,exp:0},
{com:&quot;07&quot;,cat:0,cou:4,con:3,imp:0,exp:83360},
...
{com:&quot;08&quot;,cat:0,cou:4,con:3,imp:0,exp:2779}</pre>
<p>to something shaped like a tree like:</p>
<pre class="brush: jscript; title: ; notranslate" title="">var tree=
{0: {
       02: 101421,
       03: 0,
       04: 9272355,
       05: 0,
       07:83360},
...</pre>
<p>The solution is to use the rollup method. </p>
<p>First, if you look at my individual records, they are of the shape: </p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">{com:&quot;04&quot;,cat:0,cou:4,con:3,imp:0,exp:9272355}</pre>
<p>where com is commodity code, cat is product category, cou is country, con is continent, imp is imports and exp is exports. </p>
<p>For any country + commodity combination, there will be <strong>only one record</strong>.<br />
What I&#8217;m interested to get in the tree I will use for the treemap are <strong>exports</strong>. That is what will determine the size of the leaves of the tree.</p>
<p>So&#8230;<br />
first I am going to nest my array:</p>
<pre class="brush: jscript; title: ; notranslate" title="">var byProduct=pv.nest(data) 
	.key(function(d) {return d.cou;})
	.key(function(d) {return d.cat;})
	.key(function(d) {return d.com;})</pre>
<p>once I have written this I could follow up with a .entries() statement which would return me a nested array, or with rollup() which could give me the tree I need.<br />
Since, again, there is only one record for a combination of country (cou) and commodity (com), I can use any aggregation I want. </p>
<p>I define this function: </p>
<pre class="brush: jscript; title: ; notranslate" title="">function rollup(data) {return pv.sum(data, function(d) {return d.exp;});} </pre>
<p>It returns the sum of all the export values. Since there is just one record, what it does is that it gives me the one export value I need in a tree form. </p>
<p>So the complete statement is:</p>
<pre class="brush: jscript; title: ; notranslate" title="">function rollup(data) {return pv.sum(data, function(d) {return d.exp;});} 

var byProduct=pv.nest(data) 
	.key(function(d) {return d.cou;})
	.key(function(d) {return d.cat;})
	.key(function(d) {return d.com;})
	.rollup(rollup)</pre>
<p>This creates a tree, nested by country, then by product category, then by commodity. The corresponding values are the exports.</p>
<p>now creating my treemap data dynamically saves me a ton of hassle compared to trying to come up with a data file of the right shape and size, not mentioning the calculation errors which creep in each manual manipulation !</p>
<p>Another point of interestingness: how I computed the data to create the bar charts on the side.<br />
For the left treemap (and left bar chart) the user has selected a country. (and for the right ones, it&#8217;s a given product, but let&#8217;s focus on the left side, the reasoning is the same for the other side anyway).</p>
<p>so first I am going to take the tree we made earlier and just look at the selected country. We can do that with a statement like: </p>
<pre class="brush: jscript; title: ; notranslate" title="">myProductTree=byProduct[selCountry];</pre>
<p>(so now we have a tree with just 2 levels, product category and commodity).</p>
<p>Now I can&#8217;t run pv.nest and all that on a tree. I need an array! so I have to use flatten to turn that section of the tree into a bona fide array which I will be able to further process. </p>
<pre class="brush: jscript; title: ; notranslate" title="">catsByCountry = pv.flatten(myProductTree).key(&quot;cat&quot;).key(&quot;com&quot;).key(&quot;exp&quot;).array(); </pre>
<p>Here, note that the arguments: &#8220;cat&#8221;, &#8220;com&#8221;, &#8220;exp&#8221; are completely arbitrary. But, since I&#8217;m recreating the array almost as it originally was, I might as well use the same names for the keys. </p>
<p>So now, I have like a little subset of my original dataset, only the records of the selected country.<br />
I can now proceed to sum exports by categories using a standard rollup method, just as <a href="http://jckr.github.io/blog/?p=502">we&#8217;ve seen here</a>. </p>
<pre class="brush: jscript; title: ; notranslate" title="">catsByCountry = pv.nest(catsByCountry).key(function(d) {return d.cat;}).rollup(rollup);</pre>
<p>Conveniently, the rollup function that I defined earlier sums the records! and here I do need summing, not any aggregation. </p>
<p>The problem is that the rollup() method creates an associative array, and if I need to use that in a bar chart I need a proper array! so, I use pv.values() which does just that, it creates an array out of the values of an associative array. </p>
<pre class="brush: jscript; title: ; notranslate" title="">catsByCountry = pv.values(catsByCountry);</pre>
<p>Now the values can vary a lot in absolute terms depending on the selected country. This is why in the actual bar chart, I use pv.normalize() to have only values from 0 to 1 which are much more convenient to plot. </p>
<pre class="brush: jscript; title: ; notranslate" title="">vis.add(pv.Bar)
	.data(function() pv.normalize(catsByCountry))</pre>
<p>one last thing, to save space in the data set (which means: bandwidth + loading time) I&#8217;ve used short keys in my data file, and I&#8217;ve used codes for countries, commodities and the like. </p>
<p>so I have this: </p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">{com:&quot;04&quot;,cat:0,cou:4,con:3,imp:0,exp:9272355}</pre>
<p>instead of </p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">{
    com:&quot;CEREALS,CEREAL PREPRTNS.&quot;,
    cat:&quot;Food and live animals&quot;,
    cou:&quot;Algeria&quot;,
    con:&quot;Africa&quot;,
    imp:0,exp:9272355}</pre>
<p>to get the names of the countries, categories etc. I have in my data file variables that associate, say, a country code to its long name, its continent etc.<br />
so I can have to write things like: </p>
<pre class="brush: jscript; title: ; notranslate" title="">countries[&quot;4&quot;].name+&quot; (&quot;+continents[countries[&quot;4&quot;].continent]+&quot;)&quot;</pre>
<p>instead of something simpler, but it&#8217;s a good trade-off because writing those names in full in the original dataset inflates the size of the file to megabytes (there are approx 10.000 records).</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				<nav class="pagination navigation paging-navigation" role="navigation">
		<div class="nav-links">
						<div class="older-posts"><a href="/category/data-visualization/page/6/" >Older Posts <span class="meta-nav">&rarr;</span></a></div>
							<div class="page-number">Page 5 of 8</div>
						<div class="newer-posts"><a href="/category/data-visualization/page/4/" ><span class="meta-nav">&larr;</span> Newer Posts</a></div>
			
		</div><!-- .nav-links -->
	</nav><!-- .navigation -->
	
		
		</main><!-- #main -->
	</section><!-- #primary -->

	<div id="secondary" class="widget-area" role="complementary">
		<aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form></aside>		<aside id="recent-posts-2" class="widget widget_recent_entries">		<h1 class="widget-title">Recent Posts</h1>		<ul>
					<li>
				<a href="/2016/08/17/the-big-leagues/">The big leagues</a>
						</li>
					<li>
				<a href="/2016/08/17/creating-a-react-visualization-web-app/">Creating a React visualization web app</a>
						</li>
					<li>
				<a href="/2016/08/13/beyond-rendering/">Beyond rendering</a>
						</li>
					<li>
				<a href="/2016/08/11/react-components/">React components</a>
						</li>
					<li>
				<a href="/2016/08/10/coding-with-react/">Coding with React</a>
						</li>
				</ul>
		</aside>		<aside id="recent-comments-2" class="widget widget_recent_comments"><h1 class="widget-title">Recent Comments</h1><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link"><a href='http://omeraz.wordpress.com/' rel='external nofollow' class='url'>עומר עזריאל</a></span> on <a href="/2016/08/17/the-big-leagues/#comment-567">The big leagues</a></li><li class="recentcomments"><span class="comment-author-link">Carlos Ayres</span> on <a href="/2012/05/28/manipulating-data-like-a-boss-with-d3/#comment-312">Manipulating data like a boss with d3</a></li><li class="recentcomments"><span class="comment-author-link"><a href='https://migrate.powertripanalytics.com/game-of-thrones-interactions-among-the-top-30-characters/' rel='external nofollow' class='url'>Game of ThronesInteractions Among the Top 30 Characters &#8211; PowerTrip Analytics</a></span> on <a href="/2013/05/13/making-the-game-of-thrones-visualization/#comment-466">Making the game of thrones visualization</a></li><li class="recentcomments"><span class="comment-author-link"><a href='https://abgoswam.wordpress.com/2016/10/08/d3-getting-started/' rel='external nofollow' class='url'>D3 &#8211; Getting Started | abgoswam&#039;s tech blog</a></span> on <a href="/2012/09/04/getting-to-hello-world-with-d3/#comment-419">Getting to &#8220;Hello world&#8221; with d3</a></li><li class="recentcomments"><span class="comment-author-link"><a href='https://plus.google.com/+BrotoBhattacharjee' rel='external nofollow' class='url'>Broto Bhattacharjee</a></span> on <a href="/2012/09/04/getting-to-hello-world-with-d3/#comment-418">Getting to &#8220;Hello world&#8221; with d3</a></li></ul></aside><aside id="archives-2" class="widget widget_archive"><h1 class="widget-title">Archives</h1>		<ul>
			<li><a href='/2016/08/'>August 2016</a></li>
	<li><a href='/2015/05/'>May 2015</a></li>
	<li><a href='/2015/02/'>February 2015</a></li>
	<li><a href='/2014/10/'>October 2014</a></li>
	<li><a href='/2013/11/'>November 2013</a></li>
	<li><a href='/2013/05/'>May 2013</a></li>
	<li><a href='/2013/03/'>March 2013</a></li>
	<li><a href='/2013/01/'>January 2013</a></li>
	<li><a href='/2012/12/'>December 2012</a></li>
	<li><a href='/2012/11/'>November 2012</a></li>
	<li><a href='/2012/10/'>October 2012</a></li>
	<li><a href='/2012/09/'>September 2012</a></li>
	<li><a href='/2012/07/'>July 2012</a></li>
	<li><a href='/2012/06/'>June 2012</a></li>
	<li><a href='/2012/05/'>May 2012</a></li>
	<li><a href='/2012/04/'>April 2012</a></li>
	<li><a href='/2012/01/'>January 2012</a></li>
	<li><a href='/2011/11/'>November 2011</a></li>
	<li><a href='/2011/10/'>October 2011</a></li>
	<li><a href='/2011/09/'>September 2011</a></li>
	<li><a href='/2011/08/'>August 2011</a></li>
	<li><a href='/2011/07/'>July 2011</a></li>
	<li><a href='/2011/06/'>June 2011</a></li>
	<li><a href='/2011/05/'>May 2011</a></li>
	<li><a href='/2011/04/'>April 2011</a></li>
	<li><a href='/2011/03/'>March 2011</a></li>
	<li><a href='/2011/02/'>February 2011</a></li>
	<li><a href='/2011/01/'>January 2011</a></li>
	<li><a href='/2010/11/'>November 2010</a></li>
	<li><a href='/2010/04/'>April 2010</a></li>
	<li><a href='/2010/03/'>March 2010</a></li>
	<li><a href='/2010/02/'>February 2010</a></li>
	<li><a href='/2010/01/'>January 2010</a></li>
	<li><a href='/2009/12/'>December 2009</a></li>
	<li><a href='/2009/10/'>October 2009</a></li>
	<li><a href='/2009/09/'>September 2009</a></li>
	<li><a href='/2009/08/'>August 2009</a></li>
	<li><a href='/2009/07/'>July 2009</a></li>
	<li><a href='/2009/06/'>June 2009</a></li>
	<li><a href='/2009/05/'>May 2009</a></li>
	<li><a href='/2008/12/'>December 2008</a></li>
	<li><a href='/2008/11/'>November 2008</a></li>
	<li><a href='/2008/10/'>October 2008</a></li>
		</ul>
		</aside><aside id="categories-2" class="widget widget_categories"><h1 class="widget-title">Categories</h1>		<ul>
	<li class="cat-item cat-item-2"><a href="/category/book-review/" >book review</a>
</li>
	<li class="cat-item cat-item-3"><a href="/category/charts/" >charts</a>
</li>
	<li class="cat-item cat-item-4"><a href="/category/conferences/" >conferences</a>
</li>
	<li class="cat-item cat-item-5"><a href="/category/d3/" >d3</a>
</li>
	<li class="cat-item cat-item-6"><a href="/category/dashboards/" >dashboards</a>
</li>
	<li class="cat-item cat-item-7"><a href="/category/data-publishing/" >data publishing</a>
</li>
	<li class="cat-item cat-item-8 current-cat"><a href="/category/data-visualization/" >data visualization</a>
</li>
	<li class="cat-item cat-item-9"><a href="/category/francais/" >français</a>
</li>
	<li class="cat-item cat-item-10"><a href="/category/javascript/" >javascript</a>
</li>
	<li class="cat-item cat-item-11"><a href="/category/presentation/" >presentation</a>
</li>
	<li class="cat-item cat-item-12"><a href="/category/protovis/" >protovis</a>
</li>
	<li class="cat-item cat-item-13"><a href="/category/react/" >react</a>
</li>
	<li class="cat-item cat-item-14"><a href="/category/tips/" >tips</a>
</li>
	<li class="cat-item cat-item-1"><a href="/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-15"><a href="/category/web-sites/" >web sites</a>
</li>
		</ul>
</aside><aside id="meta-2" class="widget widget_meta"><h1 class="widget-title">Meta</h1>			<ul>
						<li><a href="/wp-login.php">Log in</a></li>
			<li><a href="/feed/">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="/comments/feed/">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>			</ul>
			</aside>		<div class="clear">&nbsp;</div>
	</div><!-- #secondary -->
	<footer id="colophon" class="site-footer" role="contentinfo">
	    <a class="subscribe icon-feed" href="/feed/"><span class="tooltip">Subscribe!</span></a>
		<div class="site-info inner">
		    <section class="copyright">
		    			    		<a href="https://github.com/lacymorrow/casper" rel="home">Casper WP</a> by Lacy Morrow		    			    </section>
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</main><!-- /#content -->

<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.9b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.9b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://localhost:8888/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://localhost:8888/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<script type='text/javascript' src='/wp-content/themes/casper/js/main.js?ver=1.0.0'></script>
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.10'></script>
<!--stats_footer_test--></body>
</html>
