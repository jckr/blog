<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="HandheldFriendly" content="True" />
<meta name="MobileOptimized" content="320" />

<title>La france qui exporte | jckr.github.io/blog</title>

<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="/xmlrpc.php">
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="jckr.github.io/blog &raquo; Feed" href="/feed/" />
<link rel="alternate" type="application/rss+xml" title="jckr.github.io/blog &raquo; Comments Feed" href="/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="jckr.github.io/blog &raquo; La france qui exporte Comments Feed" href="/2011/02/18/la-france-qui-exporte/feed/" />
<!-- This site uses the Google Analytics by MonsterInsights plugin v7.0.5 - Using Analytics tracking - https://www.monsterinsights.com/ -->
<!-- Note: MonsterInsights is not currently configured on this site. The site owner needs to authenticate with Google Analytics in the MonsterInsights settings panel. -->
<!-- No UA code set -->
<!-- / Google Analytics by MonsterInsights -->
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/localhost:8888\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.10"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='YoutubeShortcodeMargenn-css'  href='/wp-content/plugins/youtube-shortcode/youtube-shortcode.css?ver=4.6.10' type='text/css' media='all' />
<link rel='stylesheet' id='casper-google-fonts-css'  href='//fonts.googleapis.com/css?family=Noto+Serif%3A400%2C700%2C400italic%7COpen+Sans%3A700%2C400&#038;ver=4.6.10' type='text/css' media='all' />
<link rel='stylesheet' id='casper-style-css'  href='/wp-content/themes/casper/style.css?ver=4.6.10' type='text/css' media='all' />
<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Working with data in protovis: part 5 of 5' href='/2011/02/11/working-with-data-in-protovis-part-5-of-5/' />
<link rel='next' title='The top TV earners are not found on tabloids.' href='/2011/02/22/the-top-tv-earners-are-not-found-on-tabloids/' />
<meta name="generator" content="WordPress 4.6.10" />
<link rel="canonical" href="/2011/02/18/la-france-qui-exporte/" />
<link rel='shortlink' href='http://wp.me/p-aF' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2Flocalhost%3A8888%2F2011%2F02%2F18%2Fla-france-qui-exporte%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2Flocalhost%3A8888%2F2011%2F02%2F18%2Fla-france-qui-exporte%2F&#038;format=xml" />

   	<style type="text/css">
					.blog-title a, .blog-description, .social-icons a { color: #222222; }
		
						                
		
							.main-navigation a { color: ; }
		                                            </style>
    		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
			<style type="text/css">
			.site-title a,
		.site-description {
			color: #222222;
		}
		</style>
	<style type="text/css" id="syntaxhighlighteranchor"></style>
</head>

<body class="single single-post postid-661 single-format-standard group-blog">

<header id="masthead" role="banner" class="site-head site-header" style="background-image: url(/wp-content/uploads/2018/04/Screenshot-2018-04-09-19.38.59.png);">
    <nav id="site-navigation" class="main-navigation" role="navigation">
        <div>
            <h1 class="menu-toggle">
                <a class="icon-bars" href="#">
                    <span class="hidden">Menu</span>
                </a>
            </h1>
            <a class="skip-link screen-reader-text" href="#content">Skip to content</a>
            <div class="menu"><ul><li ><a href="/">Home</a></li></ul></div>
        </div>
    </nav><!-- #site-navigation -->

    <div class="vertical-row">
        <div class="vertical">
            <div class="site-head-content inner">
                
                <div class="social-icons">
                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                <h1 class="blog-title"><a class="blog-logo" href='/' rel='home'>jckr.github.io/blog</a></h1>
                <h2 class="blog-description">Just another WordPress site</h2>
            </div>
        </div>
    </div>
</header><!-- #masthead -->

<main id="content" class="content" role="main">


		
			<article id="post-661" class="post-661 post type-post status-publish format-standard hentry category-data-visualization category-protovis tag-exports tag-france tag-maps tag-trade tag-treemaps">
    <header class="post-header">
                	<span class="post-meta">
        	    <span class="posted-on"><a href="/2011/02/18/la-france-qui-exporte/" rel="bookmark"><time class="entry-date published" datetime="2011-02-18T20:10:38+00:00">February 18, 2011</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> | <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/protovis/" rel="category tag">protovis</a> in <a href="/tag/exports/" rel="tag">exports</a>, <a href="/tag/france/" rel="tag">france</a>, <a href="/tag/maps/" rel="tag">maps</a>, <a href="/tag/trade/" rel="tag">trade</a>, <a href="/tag/treemaps/" rel="tag">treemaps</a>        	</span>
		        <h1 class="post-title"><a href="/2011/02/18/la-france-qui-exporte/" rel="bookmark">La france qui exporte</a></h1>
        
    </header>
    		<section class="post-content">
		    <p>This week, I was made aware of a new set of maps by French ministry of Foreign Trade, called <em>cartographie de la France qui exporte</em> (map of France exports) (<a href="http://www.exporter.gouv.fr/exporter/Pages.aspx?iddoc=1821&#038;pex=1-2-40-926-1821">link</a>). Since I&#8217;m interested in the topic and that I know that French public services have killer cartographers I was eager to see what was so exciting about the first set of online maps on French exports. </p>
<p>I was a little underwhelmed to be honest. Online here meant static pdf files, although this is a dataset that just begs to be explored and manipulated.<br />
On top of that, those where basic choropleth maps with markers such as this one here:<br />
<a href="http://jckr.github.io/blog/wp-content/uploads/2011/02/largemap.png"><img src="https://jckr.github.io/blog/wp-content/uploads/2011/02/largemap.png" alt="" title="largemap" width="626" height="631" class="size-full wp-image-662" /></a></p>
<p>Now this map has two problems. First, it&#8217;s a choropleth with a discrete scale, but the values of adjacent areas can vary a lot. So, if you look at this portion of the map, what can be deduced on the values? not much I&#8217;m afraid.<br />
<a href="http://jckr.github.io/blog/wp-content/uploads/2011/02/choropleth.png"><img src="https://jckr.github.io/blog/wp-content/uploads/2011/02/choropleth.png" alt="" title="choropleth" width="123" height="132" class="aligncenter size-full wp-image-663" /></a></p>
<p>Second, it&#8217;s difficult to compare the marks on the map. Which region has the biggest? the smallest? how do two specific regions compare? with this representation, this type of question is even more difficult to answer than with a table.<br />
<a href="http://jckr.github.io/blog/wp-content/uploads/2011/02/marks-only.png"><img src="https://jckr.github.io/blog/wp-content/uploads/2011/02/marks-only.png" alt="" title="marks only" width="313" height="316" class="aligncenter size-full wp-image-664" /></a></p>
<p>Also these charts answer one partial question. So this one, here, shows which region exports most food products. But to where? and how about the imports and balance? now if one given view was the most relevant and could illustrate some important finding, it can be highlighted but here the website gives us collections of many of such maps. As a citizen I&#8217;m leaving no more informed than I was.</p>
<p>Not being the one to criticize without proposing an alternative, I whipped out an <strong>interactive exploratory tool of France trade flows</strong>.<br />
<a href="http://jckr.github.io/blog/wp-content/uploads/2011/02/franceexport.html" target=‚Äù_blank‚Äù><img src="https://jckr.github.io/blog/wp-content/uploads/2011/02/treemap.png" alt="" title="treemap" width="561" height="443" class="aligncenter size-full wp-image-668" /></a><br />
(The interactive vis is too wide to conveniently fit in a blog, but clicking on the image will open it in a new tab).</p>
<p>I don&#8217;t have access to the same dataset so I can&#8217;t show a strict equivalent. My data comes from <a href="http://comtrade.un.org/">COMTRADE</a>, the UN database of trade flows, and shows all exports and imports to France in 2009. They are not broken down by region or by type of company, but I got the flows by partner country and product category.<br />
The idea is that one can select something on one treemap to update the other. Also, it&#8217;s possible to alternate between a categorical view (where all groups of products and continents look neatly separated) and a view of the balance, which quickly shows which products or which countries get the bulk of French trade. </p>
<hr>
(technical explanation follows for those interested in the code proper)<br />
Now following last week&#8217;s <a href="http://jckr.github.io/blog/?p=426">tutorial</a>, of course it had to be done in <a href="http://www.protovis.org/">protovis</a>.<br />
Actually it illustrates some interesting principles of working with arrays, trees, maps etc. </p>
<p>First, I want to do as much data manipulation as possible in protovis as opposed to manually. So, my source <a href="http://jckr.github.io/blog/wp-content/uploads/2011/02/data.js">data</a> for the treemap is stored as an array of associative arrays, which is probably the preferred form in protovis. This is no different than, for instance, <a href="http://jckr.github.io/blog/?p=534">Protovis&#8217;s barley example</a>.<br />
Now how do you get something of the shape &#8211;</p>
<pre class="brush: jscript; title: ; notranslate" title="">var data=
[{com:&quot;02&quot;,cat:0,cou:4,con:3,imp:0,exp:101421},
{com:&quot;03&quot;,cat:0,cou:4,con:3,imp:9716,exp:0},
{com:&quot;04&quot;,cat:0,cou:4,con:3,imp:0,exp:9272355},
{com:&quot;05&quot;,cat:0,cou:4,con:3,imp:531587,exp:0},
{com:&quot;07&quot;,cat:0,cou:4,con:3,imp:0,exp:83360},
...
{com:&quot;08&quot;,cat:0,cou:4,con:3,imp:0,exp:2779}</pre>
<p>to something shaped like a tree like:</p>
<pre class="brush: jscript; title: ; notranslate" title="">var tree=
{0: {
       02: 101421,
       03: 0,
       04: 9272355,
       05: 0,
       07:83360},
...</pre>
<p>The solution is to use the rollup method. </p>
<p>First, if you look at my individual records, they are of the shape: </p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">{com:&quot;04&quot;,cat:0,cou:4,con:3,imp:0,exp:9272355}</pre>
<p>where com is commodity code, cat is product category, cou is country, con is continent, imp is imports and exp is exports. </p>
<p>For any country + commodity combination, there will be <strong>only one record</strong>.<br />
What I&#8217;m interested to get in the tree I will use for the treemap are <strong>exports</strong>. That is what will determine the size of the leaves of the tree.</p>
<p>So&#8230;<br />
first I am going to nest my array:</p>
<pre class="brush: jscript; title: ; notranslate" title="">var byProduct=pv.nest(data) 
	.key(function(d) {return d.cou;})
	.key(function(d) {return d.cat;})
	.key(function(d) {return d.com;})</pre>
<p>once I have written this I could follow up with a .entries() statement which would return me a nested array, or with rollup() which could give me the tree I need.<br />
Since, again, there is only one record for a combination of country (cou) and commodity (com), I can use any aggregation I want. </p>
<p>I define this function: </p>
<pre class="brush: jscript; title: ; notranslate" title="">function rollup(data) {return pv.sum(data, function(d) {return d.exp;});} </pre>
<p>It returns the sum of all the export values. Since there is just one record, what it does is that it gives me the one export value I need in a tree form. </p>
<p>So the complete statement is:</p>
<pre class="brush: jscript; title: ; notranslate" title="">function rollup(data) {return pv.sum(data, function(d) {return d.exp;});} 

var byProduct=pv.nest(data) 
	.key(function(d) {return d.cou;})
	.key(function(d) {return d.cat;})
	.key(function(d) {return d.com;})
	.rollup(rollup)</pre>
<p>This creates a tree, nested by country, then by product category, then by commodity. The corresponding values are the exports.</p>
<p>now creating my treemap data dynamically saves me a ton of hassle compared to trying to come up with a data file of the right shape and size, not mentioning the calculation errors which creep in each manual manipulation !</p>
<p>Another point of interestingness: how I computed the data to create the bar charts on the side.<br />
For the left treemap (and left bar chart) the user has selected a country. (and for the right ones, it&#8217;s a given product, but let&#8217;s focus on the left side, the reasoning is the same for the other side anyway).</p>
<p>so first I am going to take the tree we made earlier and just look at the selected country. We can do that with a statement like: </p>
<pre class="brush: jscript; title: ; notranslate" title="">myProductTree=byProduct[selCountry];</pre>
<p>(so now we have a tree with just 2 levels, product category and commodity).</p>
<p>Now I can&#8217;t run pv.nest and all that on a tree. I need an array! so I have to use flatten to turn that section of the tree into a bona fide array which I will be able to further process. </p>
<pre class="brush: jscript; title: ; notranslate" title="">catsByCountry = pv.flatten(myProductTree).key(&quot;cat&quot;).key(&quot;com&quot;).key(&quot;exp&quot;).array(); </pre>
<p>Here, note that the arguments: &#8220;cat&#8221;, &#8220;com&#8221;, &#8220;exp&#8221; are completely arbitrary. But, since I&#8217;m recreating the array almost as it originally was, I might as well use the same names for the keys. </p>
<p>So now, I have like a little subset of my original dataset, only the records of the selected country.<br />
I can now proceed to sum exports by categories using a standard rollup method, just as <a href="http://jckr.github.io/blog/?p=502">we&#8217;ve seen here</a>. </p>
<pre class="brush: jscript; title: ; notranslate" title="">catsByCountry = pv.nest(catsByCountry).key(function(d) {return d.cat;}).rollup(rollup);</pre>
<p>Conveniently, the rollup function that I defined earlier sums the records! and here I do need summing, not any aggregation. </p>
<p>The problem is that the rollup() method creates an associative array, and if I need to use that in a bar chart I need a proper array! so, I use pv.values() which does just that, it creates an array out of the values of an associative array. </p>
<pre class="brush: jscript; title: ; notranslate" title="">catsByCountry = pv.values(catsByCountry);</pre>
<p>Now the values can vary a lot in absolute terms depending on the selected country. This is why in the actual bar chart, I use pv.normalize() to have only values from 0 to 1 which are much more convenient to plot. </p>
<pre class="brush: jscript; title: ; notranslate" title="">vis.add(pv.Bar)
	.data(function() pv.normalize(catsByCountry))</pre>
<p>one last thing, to save space in the data set (which means: bandwidth + loading time) I&#8217;ve used short keys in my data file, and I&#8217;ve used codes for countries, commodities and the like. </p>
<p>so I have this: </p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">{com:&quot;04&quot;,cat:0,cou:4,con:3,imp:0,exp:9272355}</pre>
<p>instead of </p>
<pre class="brush: jscript; light: true; title: ; notranslate" title="">{
    com:&quot;CEREALS,CEREAL PREPRTNS.&quot;,
    cat:&quot;Food and live animals&quot;,
    cou:&quot;Algeria&quot;,
    con:&quot;Africa&quot;,
    imp:0,exp:9272355}</pre>
<p>to get the names of the countries, categories etc. I have in my data file variables that associate, say, a country code to its long name, its continent etc.<br />
so I can have to write things like: </p>
<pre class="brush: jscript; title: ; notranslate" title="">countries[&quot;4&quot;].name+&quot; (&quot;+continents[countries[&quot;4&quot;].continent]+&quot;)&quot;</pre>
<p>instead of something simpler, but it&#8217;s a good trade-off because writing those names in full in the original dataset inflates the size of the file to megabytes (there are approx 10.000 records).</p>
		    			<div class="clear">&nbsp;</div>
		</section>
	
	<footer class="post-footer">

	    <section class="author">
	    	<img alt='' src='http://0.gravatar.com/avatar/9bb03f0a91eab52fe022450c323810f2?s=100&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/9bb03f0a91eab52fe022450c323810f2?s=200&amp;d=mm&amp;r=g 2x' class='avatar avatar-100 photo' height='100' width='100' />	        <h4>jerome</h4>
	        <p></p>
			<div class="clear">&nbsp;</div>
	    </section>
	</footer>
</article><!-- #post-## -->

				<nav class="pagination navigation post-navigation" role="navigation">
		<div class="nav-links">
			<div class="older-posts"><a href="/2011/02/11/working-with-data-in-protovis-part-5-of-5/" rel="prev">Working with data in protovis: part 5 of 5 <span class="meta-nav">&rarr;</span></a></div>				<div class="page-number">&bull;</div>
				<div class="newer-posts"><a href="/2011/02/22/the-top-tv-earners-are-not-found-on-tabloids/" rel="next"><span class="meta-nav">&larr;</span> The top TV earners are not found on tabloids.</a></div>		</div><!-- .nav-links -->
	</nav><!-- .navigation -->
	
			
<div id="comments" class="comments-area">

	
			<h2 class="comments-title">
			8 thoughts on &ldquo;<span>La france qui exporte</span>&rdquo;		</h2>

		
		<ol class="comment-list">
					<li id="comment-111" class="comment even thread-even depth-1 parent">
			<article id="div-comment-111" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='http://2.gravatar.com/avatar/8200dd3a4feceece7516f90db0f251ec?s=32&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/8200dd3a4feceece7516f90db0f251ec?s=64&amp;d=mm&amp;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' />						<b class="fn"><a href='http://www.janwillemtulp.com/' rel='external nofollow' class='url'>Jan Willem Tulp</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="/2011/02/18/la-france-qui-exporte/#comment-111">
							<time datetime="2011-02-18T22:01:27+00:00">
								February 18, 2011 at 10:01 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Hi Jerome, </p>
<p>again, an excellent tutorial!! I really enjoyed your analysis of the maps, and also your explanation of how you&#8217;ve implemented the treemap in Protovis is very clear. I also looked at your source code, and it&#8217;s really good to see that most of it is actual Protovis code, and not really much custom code. I also like the idea of 2 connected treemaps very much. I can&#8217;t remember seeing this anywhere before! So again, a great tutorial, I really enjoyed it.</p>
<p>I have a few suggestions though, so I hope you don&#8217;t mind:</p>
<p>&#8211; I saw in your source code that there were some out-commented alert statements. I don&#8217;t know which tools you use for creating this, but one thing that may ease the development is using FireFox, and especially use the FireBug plugin. This allows you to write statements like: console.log(&#8216;bla bla bla&#8217;) which gets written to the console window of FireBug. This will relieve you from alerts where you must always click a button to remove the alert. And, if you have a Mac, I highly recommend TextMate as a tool, because you can open a preview window that gets updated as you type. This is very very useful when creating a Protovis visualization: immediate feedback works great!!</p>
<p>&#8211; in your critique on the map you say that it is hard to say &#8216;which is the biggest, which the smallest?&#8217;. I think in your version these answers are easier to answer with the barcharts for each treemap, but I also think that these questions can be even more easily answered if you sort the barcharts on size, so that the biggest is always on top. </p>
<p>&#8211; I am not totally convinced by the way you use labels and bar charts. First, the readability of the labels is now dependent on the color of the barchart, and darker bar colors make the labels a little more difficult to read. Also, since both the labels and the barchart occupy the same space, the length of the text of a label somehow seems to be mixing with the length of the bars. So visually it is a little confusing to me.</p>
<p>&#8211; I wonder if the interaction / visual feedback could be improved if you could somehow see which of the areas in a treemap you have selected. Right now you can click on it, but afterwards you don&#8217;t see which one that was</p>
<p>&#8211; the number of digits in the labels are often very long (around 10 digits) and I find it a little hard to comprehend such a large number. I think it would be easier to comprehend if the labels showed the numbers in billion or something. I may be wrong, but the level of detail shown right now may not be relevant.</p>
<p>&#8211; finally, as someone from the Netherlands I tried to find the Netherlands of course. Although I don&#8217;t have a solution just yet, it is pretty hard to find a specific country. But this also depends on the purpose of your visualization of course. </p>
<p>I hope you find my suggestions useful, and I am looking forward to see your next post, tutorial or creation!! Great work, Jerome!!!</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/2011/02/18/la-france-qui-exporte/?replytocom=111#respond' onclick='return addComment.moveForm( "div-comment-111", "111", "respond", "661" )' aria-label='Reply to Jan Willem Tulp'>Reply</a></div>			</article><!-- .comment-body -->
<ol class="children">
		<li id="comment-113" class="comment byuser comment-author-jerome bypostauthor odd alt depth-2">
			<article id="div-comment-113" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='http://0.gravatar.com/avatar/9bb03f0a91eab52fe022450c323810f2?s=32&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/9bb03f0a91eab52fe022450c323810f2?s=64&amp;d=mm&amp;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' />						<b class="fn"><a href='http://jckr.github.io/blog/' rel='external nofollow' class='url'>jerome</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="/2011/02/18/la-france-qui-exporte/#comment-113">
							<time datetime="2011-02-18T23:18:31+00:00">
								February 18, 2011 at 11:18 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Hi JanWillem and thanks for your message.<br />
yes out-commented alert statements are shabby&#8230; I removed them ! so no one can see what you&#8217;re talking about now üôÇ<br />
I use chrome console mostly. I think console.log works there too! and &#8211; I&#8217;m a PC. </p>
<p>now on the substance, ok visually the solution is far from perfect. actually I wanted to show two things.<br />
when you try to do something complex in protovis, you&#8217;d better get your data in the shape: </p>
<p>[{key1:&#8230; , key2:&#8230;,     , keyn:&#8230;},<br />
{key1:&#8230; , key2:&#8230;,     , keyn:&#8230;},<br />
{key1:&#8230; , key2:&#8230;,     , keyn:&#8230;},<br />
&#8230;<br />
]</p>
<p>because from this shape you can do anything. from this I can do 2 different treemaps, bar charts with an interesting aggregation, etc.<br />
when I was starting with protovis I would have prepared different sets of datasets in excel, which is error-prone, time-consuming, and wastes a lot of space.</p>
<p>now bar charts, order them or not?<br />
I&#8217;m a devout follower of Stephen Few, so I usually like them ordered. But the basic idea was to use them as legend to show which color is what. now if I ordered them, well, their order would change from country to country so it would be more difficult to see the evolution of each bar. also, the aggregation formula which comes up with a single array would have to be slightly trickier to keep the color info. Here, I can get away with just having a simple array and use this.index to get the right color because the order of the bar is always the same as the order of the product categories. If I had them re-ordered, I would have to use a 2 dimensional array to keep the category information, which is not too difficult but was getting obfuscated.<br />
I agree, though, that the way the text gets in the way of the bars is not ideal, as the choice of colours etc. üôÅ</p>
<p>yes, there should have been a form of visual feedback on the treemap you click in. I&#8217;ve added something. I also changed how numbers are displayed, although the solution based on &#8220;title&#8221; is not ideal&#8230; </p>
<p>there could be a way to lookup countries like in the protovis treemap example using regular expressions etc. maybe for the next project üôÇ</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/2011/02/18/la-france-qui-exporte/?replytocom=113#respond' onclick='return addComment.moveForm( "div-comment-113", "113", "respond", "661" )' aria-label='Reply to jerome'>Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-112" class="pingback even thread-odd thread-alt depth-1">
			<div class="comment-body">
				Pingback: <a href='http://topsy.com/trackback?url=http%3A%2F%2Fwww.jckr.github.io/blog%2F%3Fp%3D661&#038;utm_source=pingback&#038;utm_campaign=L2' rel='external nofollow' class='url'>Tweets that mention Jerome Cukier ¬ª La france qui exporte -- Topsy.com</a> 			</div>
</li><!-- #comment-## -->
		<li id="comment-114" class="comment odd alt thread-even depth-1">
			<article id="div-comment-114" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='http://2.gravatar.com/avatar/8200dd3a4feceece7516f90db0f251ec?s=32&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/8200dd3a4feceece7516f90db0f251ec?s=64&amp;d=mm&amp;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' />						<b class="fn"><a href='http://www.janwillemtulp.com/' rel='external nofollow' class='url'>Jan Willem Tulp</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="/2011/02/18/la-france-qui-exporte/#comment-114">
							<time datetime="2011-02-19T00:04:37+00:00">
								February 19, 2011 at 12:04 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>You&#8217;re right about the data structure, that&#8217;s also my experience so far. In hindsight my previous Protovis projects were not always very effective. I am going to submit my entry for the Visualizing.org contest, and I am using a similar data structure. The result is much cleaner code. I also picked up some of the things you mentioned in your tutorial series, like the way you access parent data with a function with 2 arguments üôÇ</p>
<p>I see your point with the bar charts, and you&#8217;re right that this way it&#8217;s easier to see the change per continent. </p>
<p>The changes you&#8217;ve made to the selected item and to the labels works really well!</p>
<p>Looking forward to see your next project! üôÇ</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/2011/02/18/la-france-qui-exporte/?replytocom=114#respond' onclick='return addComment.moveForm( "div-comment-114", "114", "respond", "661" )' aria-label='Reply to Jan Willem Tulp'>Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-115" class="comment even thread-odd thread-alt depth-1 parent">
			<article id="div-comment-115" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='http://0.gravatar.com/avatar/35881741a47c4bb9e6f1e182e0cadd92?s=32&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/35881741a47c4bb9e6f1e182e0cadd92?s=64&amp;d=mm&amp;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' />						<b class="fn"><a href='http://russiansphinx.blogspot.com/' rel='external nofollow' class='url'>Russian Sphinx</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="/2011/02/18/la-france-qui-exporte/#comment-115">
							<time datetime="2011-02-24T21:47:39+00:00">
								February 24, 2011 at 9:47 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>I like TreeMap of export, I am too lazy to do the same for Russia but I like the idea and I will do something similar.</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/2011/02/18/la-france-qui-exporte/?replytocom=115#respond' onclick='return addComment.moveForm( "div-comment-115", "115", "respond", "661" )' aria-label='Reply to Russian Sphinx'>Reply</a></div>			</article><!-- .comment-body -->
<ol class="children">
		<li id="comment-116" class="comment byuser comment-author-jerome bypostauthor odd alt depth-2">
			<article id="div-comment-116" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='http://0.gravatar.com/avatar/9bb03f0a91eab52fe022450c323810f2?s=32&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/9bb03f0a91eab52fe022450c323810f2?s=64&amp;d=mm&amp;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' />						<b class="fn"><a href='http://jckr.github.io/blog/' rel='external nofollow' class='url'>jerome</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="/2011/02/18/la-france-qui-exporte/#comment-116">
							<time datetime="2011-02-25T02:43:11+00:00">
								February 25, 2011 at 2:43 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Hi Agnieszka, now that the code is written I could do the same for Russia or any country in less time than writing this reply, so if you want this for your blog just let me know</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/2011/02/18/la-france-qui-exporte/?replytocom=116#respond' onclick='return addComment.moveForm( "div-comment-116", "116", "respond", "661" )' aria-label='Reply to jerome'>Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-117" class="pingback even thread-even depth-1">
			<div class="comment-body">
				Pingback: <a href='http://jckr.github.io/blog/?p=764' rel='external nofollow' class='url'>Jerome Cukier &raquo; La carte des cantonales</a> 			</div>
</li><!-- #comment-## -->
		<li id="comment-118" class="pingback odd alt thread-odd thread-alt depth-1">
			<div class="comment-body">
				Pingback: <a href='http://fr.jckr.github.io/blog/2011/03/26/la-carte-des-cantonales/' rel='external nofollow' class='url'>J√©r√¥me Cukier &raquo; La carte des cantonales</a> 			</div>
</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		
	
	
					<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2011/02/18/la-france-qui-exporte/#respond" style="display:none;">Cancel reply</a></small></h3>				<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate>
					<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='661' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="aa4072946b" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="170"/></p>				</form>
					</div><!-- #respond -->
		
</div><!-- #comments -->

		

	<div id="secondary" class="widget-area" role="complementary">
		<aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form></aside>		<aside id="recent-posts-2" class="widget widget_recent_entries">		<h1 class="widget-title">Recent Posts</h1>		<ul>
					<li>
				<a href="/2016/08/17/the-big-leagues/">The big leagues</a>
						</li>
					<li>
				<a href="/2016/08/17/creating-a-react-visualization-web-app/">Creating a React visualization web app</a>
						</li>
					<li>
				<a href="/2016/08/13/beyond-rendering/">Beyond rendering</a>
						</li>
					<li>
				<a href="/2016/08/11/react-components/">React components</a>
						</li>
					<li>
				<a href="/2016/08/10/coding-with-react/">Coding with React</a>
						</li>
				</ul>
		</aside>		<aside id="recent-comments-2" class="widget widget_recent_comments"><h1 class="widget-title">Recent Comments</h1><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link"><a href='http://omeraz.wordpress.com/' rel='external nofollow' class='url'>◊¢◊ï◊û◊® ◊¢◊ñ◊®◊ô◊ê◊ú</a></span> on <a href="/2016/08/17/the-big-leagues/#comment-567">The big leagues</a></li><li class="recentcomments"><span class="comment-author-link">Carlos Ayres</span> on <a href="/2012/05/28/manipulating-data-like-a-boss-with-d3/#comment-312">Manipulating data like a boss with d3</a></li><li class="recentcomments"><span class="comment-author-link"><a href='https://migrate.powertripanalytics.com/game-of-thrones-interactions-among-the-top-30-characters/' rel='external nofollow' class='url'>Game of ThronesInteractions Among the Top 30 Characters &#8211; PowerTrip Analytics</a></span> on <a href="/2013/05/13/making-the-game-of-thrones-visualization/#comment-466">Making the game of thrones visualization</a></li><li class="recentcomments"><span class="comment-author-link"><a href='https://abgoswam.wordpress.com/2016/10/08/d3-getting-started/' rel='external nofollow' class='url'>D3 &#8211; Getting Started | abgoswam&#039;s tech blog</a></span> on <a href="/2012/09/04/getting-to-hello-world-with-d3/#comment-419">Getting to &#8220;Hello world&#8221; with d3</a></li><li class="recentcomments"><span class="comment-author-link"><a href='https://plus.google.com/+BrotoBhattacharjee' rel='external nofollow' class='url'>Broto Bhattacharjee</a></span> on <a href="/2012/09/04/getting-to-hello-world-with-d3/#comment-418">Getting to &#8220;Hello world&#8221; with d3</a></li></ul></aside><aside id="archives-2" class="widget widget_archive"><h1 class="widget-title">Archives</h1>		<ul>
			<li><a href='/2016/08/'>August 2016</a></li>
	<li><a href='/2015/05/'>May 2015</a></li>
	<li><a href='/2015/02/'>February 2015</a></li>
	<li><a href='/2014/10/'>October 2014</a></li>
	<li><a href='/2013/11/'>November 2013</a></li>
	<li><a href='/2013/05/'>May 2013</a></li>
	<li><a href='/2013/03/'>March 2013</a></li>
	<li><a href='/2013/01/'>January 2013</a></li>
	<li><a href='/2012/12/'>December 2012</a></li>
	<li><a href='/2012/11/'>November 2012</a></li>
	<li><a href='/2012/10/'>October 2012</a></li>
	<li><a href='/2012/09/'>September 2012</a></li>
	<li><a href='/2012/07/'>July 2012</a></li>
	<li><a href='/2012/06/'>June 2012</a></li>
	<li><a href='/2012/05/'>May 2012</a></li>
	<li><a href='/2012/04/'>April 2012</a></li>
	<li><a href='/2012/01/'>January 2012</a></li>
	<li><a href='/2011/11/'>November 2011</a></li>
	<li><a href='/2011/10/'>October 2011</a></li>
	<li><a href='/2011/09/'>September 2011</a></li>
	<li><a href='/2011/08/'>August 2011</a></li>
	<li><a href='/2011/07/'>July 2011</a></li>
	<li><a href='/2011/06/'>June 2011</a></li>
	<li><a href='/2011/05/'>May 2011</a></li>
	<li><a href='/2011/04/'>April 2011</a></li>
	<li><a href='/2011/03/'>March 2011</a></li>
	<li><a href='/2011/02/'>February 2011</a></li>
	<li><a href='/2011/01/'>January 2011</a></li>
	<li><a href='/2010/11/'>November 2010</a></li>
	<li><a href='/2010/04/'>April 2010</a></li>
	<li><a href='/2010/03/'>March 2010</a></li>
	<li><a href='/2010/02/'>February 2010</a></li>
	<li><a href='/2010/01/'>January 2010</a></li>
	<li><a href='/2009/12/'>December 2009</a></li>
	<li><a href='/2009/10/'>October 2009</a></li>
	<li><a href='/2009/09/'>September 2009</a></li>
	<li><a href='/2009/08/'>August 2009</a></li>
	<li><a href='/2009/07/'>July 2009</a></li>
	<li><a href='/2009/06/'>June 2009</a></li>
	<li><a href='/2009/05/'>May 2009</a></li>
	<li><a href='/2008/12/'>December 2008</a></li>
	<li><a href='/2008/11/'>November 2008</a></li>
	<li><a href='/2008/10/'>October 2008</a></li>
		</ul>
		</aside><aside id="categories-2" class="widget widget_categories"><h1 class="widget-title">Categories</h1>		<ul>
	<li class="cat-item cat-item-2"><a href="/category/book-review/" >book review</a>
</li>
	<li class="cat-item cat-item-3"><a href="/category/charts/" >charts</a>
</li>
	<li class="cat-item cat-item-4"><a href="/category/conferences/" >conferences</a>
</li>
	<li class="cat-item cat-item-5"><a href="/category/d3/" >d3</a>
</li>
	<li class="cat-item cat-item-6"><a href="/category/dashboards/" >dashboards</a>
</li>
	<li class="cat-item cat-item-7"><a href="/category/data-publishing/" >data publishing</a>
</li>
	<li class="cat-item cat-item-8"><a href="/category/data-visualization/" >data visualization</a>
</li>
	<li class="cat-item cat-item-9"><a href="/category/francais/" >fran√ßais</a>
</li>
	<li class="cat-item cat-item-10"><a href="/category/javascript/" >javascript</a>
</li>
	<li class="cat-item cat-item-11"><a href="/category/presentation/" >presentation</a>
</li>
	<li class="cat-item cat-item-12"><a href="/category/protovis/" >protovis</a>
</li>
	<li class="cat-item cat-item-13"><a href="/category/react/" >react</a>
</li>
	<li class="cat-item cat-item-14"><a href="/category/tips/" >tips</a>
</li>
	<li class="cat-item cat-item-1"><a href="/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-15"><a href="/category/web-sites/" >web sites</a>
</li>
		</ul>
</aside><aside id="meta-2" class="widget widget_meta"><h1 class="widget-title">Meta</h1>			<ul>
						<li><a href="/wp-login.php">Log in</a></li>
			<li><a href="/feed/">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="/comments/feed/">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>			</ul>
			</aside>		<div class="clear">&nbsp;</div>
	</div><!-- #secondary -->
	<footer id="colophon" class="site-footer" role="contentinfo">
	    <a class="subscribe icon-feed" href="/feed/"><span class="tooltip">Subscribe!</span></a>
		<div class="site-info inner">
		    <section class="copyright">
		    			    		<a href="https://github.com/lacymorrow/casper" rel="home">Casper WP</a> by Lacy Morrow		    			    </section>
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</main><!-- /#content -->

<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.9b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.9b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<script type='text/javascript' src='/wp-content/themes/casper/js/main.js?ver=1.0.0'></script>
<script type='text/javascript' src='/wp-includes/js/comment-reply.min.js?ver=4.6.10'></script>
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.10'></script>
<script async="async" type='text/javascript' src='/wp-content/plugins/akismet/_inc/form.js?ver=4.0.3'></script>
<!--stats_footer_test--></body>
</html>
