<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="HandheldFriendly" content="True" />
<meta name="MobileOptimized" content="320" />

<title>August | 2016 | jeromecukier.net</title>

<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="/xmlrpc.php">
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="jeromecukier.net &raquo; Feed" href="/feed/" />
<link rel="alternate" type="application/rss+xml" title="jeromecukier.net &raquo; Comments Feed" href="/comments/feed/" />
<!-- This site uses the Google Analytics by MonsterInsights plugin v7.0.5 - Using Analytics tracking - https://www.monsterinsights.com/ -->
<!-- Note: MonsterInsights is not currently configured on this site. The site owner needs to authenticate with Google Analytics in the MonsterInsights settings panel. -->
<!-- No UA code set -->
<!-- / Google Analytics by MonsterInsights -->
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/localhost:8888\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.10"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='YoutubeShortcodeMargenn-css'  href='/wp-content/plugins/youtube-shortcode/youtube-shortcode.css?ver=4.6.10' type='text/css' media='all' />
<link rel='stylesheet' id='casper-google-fonts-css'  href='//fonts.googleapis.com/css?family=Noto+Serif%3A400%2C700%2C400italic%7COpen+Sans%3A700%2C400&#038;ver=4.6.10' type='text/css' media='all' />
<link rel='stylesheet' id='casper-style-css'  href='/wp-content/themes/casper/style.css?ver=4.6.10' type='text/css' media='all' />
<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.6.10" />

   	<style type="text/css">
					.blog-title a, .blog-description, .social-icons a { color: #222222; }
		
						                
		
							.main-navigation a { color: ; }
		                                            </style>
    		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
			<style type="text/css">
			.site-title a,
		.site-description {
			color: #222222;
		}
		</style>
	<style type="text/css" id="syntaxhighlighteranchor"></style>
</head>

<body class="archive date group-blog">

<header id="masthead" role="banner" class="site-head site-header" style="background-image: url(http://localhost:8888/wp-content/uploads/2018/04/Screenshot-2018-04-09-19.38.59.png);">
    <nav id="site-navigation" class="main-navigation" role="navigation">
        <div>
            <h1 class="menu-toggle">
                <a class="icon-bars" href="#">
                    <span class="hidden">Menu</span>
                </a>
            </h1>
            <a class="skip-link screen-reader-text" href="#content">Skip to content</a>
            <div class="menu"><ul><li ><a href="/">Home</a></li></ul></div>
        </div>
    </nav><!-- #site-navigation -->

    <div class="vertical-row">
        <div class="vertical">
            <div class="site-head-content inner">
                
                <div class="social-icons">
                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                <h1 class="blog-title"><a class="blog-logo" href='/' rel='home'>jeromecukier.net</a></h1>
                <h2 class="blog-description">Just another WordPress site</h2>
            </div>
        </div>
    </div>
</header><!-- #masthead -->

<main id="content" class="content" role="main">

	<section id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">
					Month: <span>August 2016</span>				</h1>
							</header><!-- .page-header -->

						
				
<article id="post-1765" class="post-1765 post type-post status-publish format-standard hentry category-uncategorized">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2016/08/17/the-big-leagues/" rel="bookmark"><time class="entry-date published" datetime="2016-08-17T07:36:39+00:00">August 17, 2016</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/uncategorized/" rel="category tag">Uncategorized</a>			</span>
		        <h1 class="post-title"><a href="/2016/08/17/the-big-leagues/" rel="bookmark">The big leagues</a></h1>
         
    </header>
	<section class="post-content">

		<p>This is the 7th and last post in my <a href="http://wp.me/po630-rq">Visualization with React</a> series. Previous post: <a href="http://wp.me/po630-sp">Creating a React visualization web app</a></p>
<p>We can finally take the little wheels off and create a real React app.<br />
That&#8217;s what we&#8217;ll make:<br />
<img src="http://jeromecukier.net/assets/visualization-with-react/react-weather-app" alt="App screenshot" /><br />
You can <a href="http://www.jeromecukier.net/projects/react-weather/">try the app for yourself here</a>. The code is available on <a href="https://github.com/jckr/react-weather">github</a>. </p>
<p>This time, instead of loading data from a paltry CSV file, we&#8217;ll go live and hit the <a href="http://openweathermap.org/">openweathermap</a> API and get live weather data.</p>
<p>The app may be more complex than anything we&#8217;ve done before, but it&#8217;s really more of the same, so I&#8217;ll be probably quicker. </p>
<p>First, look at the secrets.json file. As you can guess, it can&#8217;t work as is &#8211; if you want to try this at home, you must get your own (free) API key from openweathermap. </p>
<p>Next, let&#8217;s take a look at our constants.js file.<br />
At this stage, you might ask: why not put the API key in that constants file? Well, it&#8217;s good practice to never store your API keys in your code. So, I put it in a separate file.<br />
Constants.js is pretty simple. It has: a url prefix (that of the openweathermap api). If they change it, I can just edit the constants file. The CITY_ID holds the identifier of San Francisco. You can replace it by whatever you want (it&#8217;s not too difficult to find the city_id for any given city at the OWM web site).<br />
Finally, I have a json object called KEYS where I store what I&#8217;m interested in getting from the API. </p>
<p>Let&#8217;s move to the App.js file, which is the top-level react file.</p>
<pre class="brush: plain; title: ; notranslate" title="">
import React, { Component } from 'react';
import './App.css';
import '../node_modules/react-vis/main.css';
import {json} from 'd3-request';
import * as CONSTANTS from './constants';
import secrets from './secrets.json';
const {API} = secrets;
</pre>
<p>Note that I can import my json file like a code file. </p>
<p>We start, unsurprisingly, by creating an App component, and by a constructor method.</p>
<pre class="brush: plain; title: ; notranslate" title="">
class App extends Component {
  constructor(props) {
    super(props);
    this.state = {
      highlighted: null
    };
    this.highlightX = this.highlightX.bind(this);
    this.processResults = this.processResults.bind(this);
  }
</pre>
<p>We initialize the state, and bind two methods. Nothing we haven&#8217;t seen.</p>
<pre class="brush: plain; title: ; notranslate" title="">
  componentWillMount() {
    json(`${CONSTANTS.QUERY_PREFIX}?id=${CONSTANTS.CITY_ID}&amp;appid=${API}&amp;units=imperial`,
      this.processResults);
  }
</pre>
<p>Things get interesting with the componentWillMount method.<br />
We use our d3-request json function to read the url in the first line, which we compose by joining the URL prefix, the city id, the api key, and I&#8217;ve added &#8216;units=imperial&#8217; so that temperatures are in Farenheit. Feel free to change this to units=metric or remove it (in which case temperatures will be in Kelvin, why not).<br />
The second argument of the json function is what is done with the request &#8211; this is our first private method, processResults, which is what comes next.</p>
<pre class="brush: plain; title: ; notranslate" title="">
 processResults(error, queryResults) {
    if (error) {
      this.setState({error});
    }
    const data = CONSTANTS.KEYS.map(key =&gt; ({
      key,
      values: queryResults.list.map((d, i) =&gt; ({
        i,
        x: d.dt * 1000,
        y: d[key.key1] ? d[key.key1][key.key2] || 0 : 0 
      }))
    })).reduce((prev, curr) =&gt; {
      return {...prev, [curr.key.name]: curr.values}
    }, {
      'city-name': (
        queryResults &amp;&amp;
        queryResults.city &amp;&amp;
        queryResults.city.name
      ) || 'Unkown'
    });
    this.setState({data});
  }
</pre>
<p>If the data can&#8217;t load, error will have a value, and we&#8217;ll pass it to the state.<br />
Else, we&#8217;re going to process the result of the query (queryResults) according to the structure that we want (CONSTANTS.KEYS).<br />
Here, I&#8217;m using a sequence of map and reduce.<br />
Map turns an array into another array of the same shape. Reduce turns an array into something else, such as an object as here.<br />
queryResults is an object which has a list property. queryResults.list is an array of nested objects. This is why each entry of CONSTANTS.KEYS specifies two keys.<br />
To simplify, one of these objects could look like this: </p>
<pre class="brush: plain; title: ; notranslate" title="">
{
  &quot;dt&quot;: 1471413600,
  &quot;main&quot;: {
    &quot;temp&quot;: 57.22,
    &quot;temp_min&quot;: 53.32,
    &quot;temp_max&quot;: 57.22,
    &quot;pressure&quot;: 1017.57,
    &quot;sea_level&quot;: 1025.63,
    &quot;grnd_level&quot;: 1017.57,
    &quot;humidity&quot;: 100,
    &quot;temp_kf&quot;: 2.17
  },
  &quot;weather&quot;: [
    {
      &quot;id&quot;: 500,
      &quot;main&quot;: &quot;Rain&quot;,
      &quot;description&quot;: &quot;light rain&quot;,
      &quot;icon&quot;: &quot;10n&quot;
    }
  ],
  &quot;clouds&quot;: {
    &quot;all&quot;: 24
  },
  &quot;wind&quot;: {
    &quot;speed&quot;: 3.42,
    &quot;deg&quot;: 234.501
  },
  &quot;rain&quot;: {
    &quot;3h&quot;: 0.02
  },
  &quot;sys&quot;: {
    &quot;pod&quot;: &quot;n&quot;
  },
  &quot;dt_txt&quot;: &quot;2016-08-17 06:00:00&quot;
}
</pre>
<p>So, if I&#8217;m interested in the temperature, I have to get it from main, then temp. (two keys)<br />
For each entry of CONSTANTS.KEYS, I&#8217;m <em>mapping</em> queryResults to create a time series of objects with three properties: in x, a date in timestamp format (number of milliseconds since 1970). in y, the value I&#8217;m interested in. and in i, the index of that object in the time series.</p>
<p>When I&#8217;m done mapping CONSTANTS.KEYS, I have an array of such time series, or more exactly: an array of objects with a name property (which comes from CONSTANTS.KEYS) and a values property (the array of objects described above). </p>
<p>Finally, I&#8217;m reducing it to an object using reduce.<br />
The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce">reduce method</a> works like this: </p>
<pre class="brush: plain; title: ; notranslate" title="">
myArray.reduce(function(prev, curr) {
  // operation involving the previous result (prev) and the current element of the array (curr)
  return resultOfThatOperation;}, // which becomes prev in the next loop
  initialValueOfReduce) // which will go into prev the first time 
</pre>
<p>What mine does is turn that array into an object. The keys of that object are the name property of each element, and the values are what&#8217;s behind the values property of that object (our time series).<br />
And that final object has an extra property: city-name, the name of the city for which weather is being queried, if it exists. </p>
<p>When this object is created, we send it to the state. </p>
<pre class="brush: plain; title: ; notranslate" title="">
  highlightX(highlighted) {
    this.setState({highlighted});
  }
</pre>
<p>highlightX is our other private method. What it does is send whatever it&#8217;s passed to the state. But since we create it here, it will pass that to the state of App, the top level component. If that state is changed, all the children (ie everything) may be re-rendered.</p>
<p>Finally, we have our render method.<br />
We&#8217;ll skip on the styling &#8211; codewise, we&#8217;ll see that this method calls two components, LargeChart and SmallChart, with similar properties:</p>
<pre class="brush: plain; title: ; notranslate" title="">
&lt;LargeChart
  highlighted={highlighted}
  highlightX={this.highlightX}
  series={data.Temperature}
  title='Temperature'
/&gt;

// ...

&lt;SmallChart
  highlighted={highlighted}
  highlightX={this.highlightX}
  series={data.Pressure}
  title='Pressure'
/&gt;
</pre>
<p>highlighted comes from the state of App.<br />
highlightX is the callback method. We&#8217;ve seen this before &#8211; we give children components the ability to change the state of their parent, and we also pass them the result of that change.<br />
Else, we pass to each component a part of our data object, and a different title. </p>
<p>Let&#8217;s move on to the large chart component: </p>
<pre class="brush: plain; title: ; notranslate" title="">
import React, { Component } from 'react';
import moment from 'moment';
import {
  LineSeries,
  makeWidthFlexible,
  MarkSeries,
  VerticalGridLines,
  XAxis,
  XYPlot,
  YAxis
} from 'react-vis';

const HOUR_IN_MS = 60 * 60 * 1000;
const DAY_IN_MS = 24 * HOUR_IN_MS;

const FlexibleXYPlot = makeWidthFlexible(XYPlot);
</pre>
<p>so far, we&#8217;re importing a bunch of stuff.<br />
the two constants that we create are the numbers of milliseconds in an hour, and in a day, which will be useful in a bit.<br />
FlexibleXYPlot is a special react-vis component that can resize (in width). By using this as opposed to XYPlot with a fixed width, we can make our app layout responsive (<a href="http://www.jeromecukier.net/projects/react-weather/">try resizing the window!</a>) without having to think too hard it.</p>
<pre class="brush: plain; title: ; notranslate" title="">
export default class LargeChart extends Component {
  render() {
  	const {highlighted, highlightX, series} = this.props;
   	const minValue = Math.min(...series.map(d =&gt; d.y));
  	const maxValue = Math.max(...series.map(d =&gt; d.y));

  	const yDomain = [0.98 * minValue, 1.02 * maxValue];
  	const tickValues = series.map(d =&gt; d.x);

    const labelValues = makeLabelValues(series);
</pre>
<p>Eh, we could have made a pure functional component, since this one only has a render method and no state.<br />
First, we come up with the bounds of the domain. We don&#8217;t have to. Note the use of the spread operator for a very concise way to write this.<br />
We create yDomain with a little bit of margin &#8211; we start with 98% of the smallest value, and go to 102% of the maximum value.<br />
If we don&#8217;t define a domain, then react-vis will create it based on the data &#8211; it will start with exactly the smallest value and end with exactly the highest. </p>
<p>tickValues will be all the different x values.<br />
labelValues will be created by a separate function (in the end). We&#8217;ll write a label for every day of our time series at precisely midnight.</p>
<p>Now we&#8217;ll create the chart proper. </p>
<pre class="brush: plain; title: ; notranslate" title="">
&lt;FlexibleXYPlot
    	height={300}
    	margin={{top: 5, bottom: 25, left: 40, right: 0}}
    	onMouseLeave={() =&gt; this.props.highlightX(null)}
    	yDomain={yDomain}
    &gt;
    	&lt;VerticalGridLines 
    		values={labelValues}
    	/&gt;
        &lt;HorizontalGridLines /&gt;
    	&lt;LineSeries 
    		data={series}
    		onNearestX={highlightX}
    		stroke='#11939a'
    		strokeWidth={2}
    	/&gt;
    	{highlighted ? 
    		&lt;LineSeries
    			data={[
    				{x: highlighted &amp;&amp; highlighted.x, y: yDomain[0]},
    				{x: highlighted &amp;&amp; highlighted.x, y: yDomain[1]}
    			]}
    			stroke='rgba(17,147,154,0.7)'
    			strokeWidth={2}
    		/&gt; : null
    	}
       {highlighted ?  
       &lt;MarkSeries
          data={[{
            x: highlighted &amp;&amp; highlighted.x,
            y: highlighted &amp;&amp; series[highlighted.i].y
          }]}
          color='rgba(17,147,154,0.7)'
        /&gt; : null
        }
    	&lt;XAxis 
    		tickSize={4}
    		tickValues={tickValues}
    		labelValues={labelValues}
    		labelFormat={(d) =&gt; moment(new Date(d)).format('MM/DD')}
    	/&gt;
        &lt;YAxis 
        	tickSize={4}
        /&gt;
    	
    &lt;/FlexibleXYPlot&gt;
</pre>
<p>The first interesting thing is the onMouseLeave property of FlexibleXYPlot. If the mouse leaves the chart, we&#8217;ll use our highlightX callback function to pass &#8220;null&#8221; to the state of App.<br />
In other words, when the mouse is not on a chart, the value of highlighted is null. </p>
<p>A bit later, we see that the first LineSeries has an onNearestX property. What it does is that when somebody mouseovers the chart, it sends the underlying datapoint to the state of App. Remember that these datapoints are objects with three property: x, i and y.</p>
<p>So, at a given moment, highlighted is either null, or of the form: {x: (a date in timestamps format), y: (a value), i: (the position of that datapoint in the time series, ie 10 if that&#8217;s the 10th point)}.</p>
<p>Let&#8217;s go on.<br />
There&#8217;s an interesting construct between curly braces. Remember that in JSX, whatever is between curly braces will be evaluated. Here, we have a ternary operator (condition ? true : false). If highlighted exists, then we will create a LineSeries, else nothing.<br />
What this means is that if there&#8217;s a value for highlighted, we are going to draw a vertical line that spans the whole chart, at the level of the mouseover.<br />
We then have a similar construction for a MarkSeries, which, likewise, draws a circle at the same position as the highlighted data point. </p>
<p>Finally, we create the axes. The XAxis has a few interesting properties: tickValues, which we defined above &#8211; all the possible x values, labelValues and labelFormat. labelValues determine <em>where</em> the labels will be drawn. Finally, labelFormat determines <em>what</em> will be drawn, as a function of each value in labelValues.  </p>
<pre class="brush: plain; title: ; notranslate" title="">
export function makeLabelValues(series) {
  const firstDate = new Date(series[0].x);
  const firstDateHour = firstDate.getHours();
  const firstMidnight = series[0].x + (24 - firstDateHour) * HOUR_IN_MS;

  return [0, 1, 2, 3, 4].map(d =&gt; firstMidnight + d * DAY_IN_MS);
}
</pre>
<p>the last part of this module creates those label values. </p>
<p>Our time series has a number of elements (normally 39), every 3 hours. But the first element is probably not the very beginning of a day. We&#8217;d like our labels to be exactly aligned with the start of a day (midnight).<br />
So we are going to figure out what time it is on the first element of the time series, compute when exactly is the next day, and then create an array of 5 values corresponding to the time we just computed, then the time 24 hours after (start of the next day), the time 24 hours after that, etc.<br />
As a result, we&#8217;ll have a list of 5 &#8216;midnights&#8217; exactly a day apart. </p>
<p>Finally, let&#8217;s look at SmallChart. </p>
<p>SmallChart is very similar to LargeChart. The styling is a bit different (these charts are, well, smaller). The Smallchart component also have an onNearestX hook that sends a datapoint to the state of App.<br />
Unlike LargeChart, it doesn&#8217;t draw a vertical line; it just draws a dot on the curve corresponding to the highlighted time.</p>
<p>So, since App sends the same highlighted to all chart components, mousing over any chart makes that dot appear on all charts. How do we know where to draw it?<br />
If I mouseover on a chart, onNearestX will send to its corresponding callback function the underlying datapoint, that has an x and a y property (and possibly others). If I wanted to draw a dot on that same chart, that would be easy &#8211; I already know the x and y coordinates where I would have to draw it. But how can I draw a dot on all the other charts?<br />
This is why I added that i property to the timeseries to begin with. When I mouseover on a point on any chart, the object I send to App&#8217;s state has that i property. In other words, I can know that I&#8217;ve mouseovered the 10th point of the chart (or the 17th, or the 3rd, etc.). When the LargeChart and SmallChart components will draw the dot, they will draw it on top of the 10th (or 17th, or 3rd&#8230; well, the i-th) point of their own chart. </p>
<pre class="brush: plain; title: ; notranslate" title="">
&lt;MarkSeries
  data={[{
    x: highlighted &amp;&amp; highlighted.x,
    y: highlighted &amp;&amp; series[highlighted.i].y
  }]}
  color='rgba(17,147,154,0.7)'
  size='2'
/&gt;
</pre>
<p>That&#8217;s what series[highlighted.i].y means.</p>
<p>And that&#8217;s it! A complete dashboard with linked charts. You can tell that temperature is lower at night, and probably lower when there are clouds, but then again it&#8217;s San Francisco so it&#8217;s probably always 60 more or less.</p>
<p>This project could be much more complex &#8211; we could have added a tooltip like in our previous app&#8230; added extra series&#8230; and arranged info in a lot of different ways. We could also let the user change the city through a text box. Well, you can make your own version! </p>
<p>(if you&#8217;re curious why I haven&#8217;t hosted this app on github, it&#8217;s because we can only access an HTTP version of the OWM API for free, and since github pages are hosted over HTTPS those requests will be blocked.)</p>
<h1>Now, what</h1>
<p>Congratulations for reading that far, you are awesome.<br />
So you want to take your react game to the next level and do amazing visualizations?<br />
You should continue exploring react-vis. I&#8217;ve only used a very basic case. We use it at Uber to create pretty elaborated charts and dashboards.<br />
Our visualization team is also behind three amazing open source libraries which play well with React: <a href="https://github.com/uber/react-map-gl">React-Map-GL</a>, to create maps with MapBox and React; <a href="https://github.com/uber/deck.gl">Deck.gl</a>, to create webGL layers over maps, and <a href="https://github.com/uber/luma.gl">Luma.gl</a>, a WebGL framework. </p>
<p>One of the best features of React is that it has so many existing modules. <a href="https://github.com/chenglou/react-motion">React-motion</a> is, IMO, the best way to handle animation in React as of now, especially when SVG elements are concerned. Check out that <a href="https://medium.com/@nashvail/a-gentle-introduction-to-react-motion-dc50dd9f2459#.6in161dz0">great article</a> by Nash Vail. </p>
<p>The <a href="https://github.com/facebook/react/">React project page</a> is an evident resource. React is alive, keeps adding features, and there is constantly more code out there using react and pushing the envelope. </p>
<p>The <a href="https://github.com/airbnb/javascript">Airbnb style guide</a> is a solid reference for writing good modern javascript. We don&#8217;t follow it at Uber; we have slightly different rules, which are not published. Anyway, the best part of such a system is its consistency, and Airbnb style guide is definitely consistent.</p>
<p><a href="http://react.rocks/">React Rocks!</a> is a great collection of examples and a source of inspiration.</p>
<p>Once your application become complex enough, it&#8217;s difficult to handle states and callbacks everywhere. You can use a store to address this. Right now the state of the art solution is <a href="http://redux.js.org/">redux</a>. The author of Redux, Dan Abramov, gives an <a href="https://egghead.io/courses/getting-started-with-redux">amazing video tutorial</a> which doubles as an excellent showcase for React and ES6.</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-1761" class="post-1761 post type-post status-publish format-standard hentry category-uncategorized">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2016/08/17/creating-a-react-visualization-web-app/" rel="bookmark"><time class="entry-date published" datetime="2016-08-17T07:36:32+00:00">August 17, 2016</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/uncategorized/" rel="category tag">Uncategorized</a>			</span>
		        <h1 class="post-title"><a href="/2016/08/17/creating-a-react-visualization-web-app/" rel="bookmark">Creating a React visualization web app</a></h1>
         
    </header>
	<section class="post-content">

		<p>This is the 6th post in my <a href="http://wp.me/po630-rq">Visualization with React</a> series. Previous post: <a href="http://wp.me/po630-sm">Beyond rendering</a></p>
<p>Playing with codepen is fun, but chances are that you have other ambitions for your visualization projects. In the real world, well, in my day job at least, React is used to create web apps. So, in that last part, we&#8217;re going to create our own web app, load some real data, and use some existing modules to visualize it like pros! In this article, we are going to build this:<br />
<img src="http://jeromecukier.net/assets/visualization-with-react/example-app-screenshot.png" alt="" /><br />
You can try a demo of the app at <a href="https://jckr.github.io/example-react-app/">https://jckr.github.io/example-react-app/</a>.<br />
All the code is at <a href="https://github.com/jckr/example-react-app">https://github.com/jckr/example-react-app</a>.</p>
<p>What&#8217;s the difference between a web app and a web page you may ask? Well, a web page is an html document with some links to scripts or some inline javascript. A web app is a comprehensive system of code files working together, including a server. All of these files are transformed via a build system, which creates a compiled version that runs on the browser. Such transformations can include JSX support, or supporting ES6/ES7 syntax. Your work can be split in many, easy to read, easy to maintain source files, but your browser will just read one single file written in a version of Javascript it can understand. </p>
<p>That may sound like a lot of work to setup. Up to a few weeks ago, the easiest way to get started was to use a web scaffolding tool such as <a href="http://yeoman.io/">Yeoman</a>. Scaffolding means that all the little parts that need to be installed or configured to get that going are taken care of, leaving you with a structure that you can use to build your web app upon.<br />
Facebook recently released &#8216;create-react-app&#8217;, which is a simpler scaffolding tool, aimed at simple React apps.</p>
<p>You will need access to a command line environment, such as Terminal on MacOS or Cygwin on windows, and have nodejs and npm installed. (see <a href="https://nodejs.org/en/">https://nodejs.org/en/</a>). You will need node version 4 and above. You may want to use <a href="https://github.com/creationix/nvm">nvm</a> to easily change versions of node if needed.</p>
<p>Here&#8217;s an illustrated guide to what you need to do to get started:<br />
<img src="http://jeromecukier.net/assets/visualization-with-react/installing-create-react-app.png" alt="" /><br />
First, install create-react-app with the command: npm install create-react-app -g.<br />
<img src="http://jeromecukier.net/assets/visualization-with-react/create-a-new-react-app.png" alt="" /><br />
From the parent directory where you want your app to be, use the command: create-react-app + the name of your app. This will also be the name of the directory this app will be in.<br />
<img src="http://jeromecukier.net/assets/visualization-with-react/start-the-app.png" alt="" /><br />
The above command will copy a bunch of files. When it&#8217;s done, go to the directory of your app and type npm start&#8230;<br />
<img src="http://jeromecukier.net/assets/visualization-with-react/a-new-react-app-created-with-create-react-app.png" alt="" /><br />
And lo and behold, the app will start and a browser window will appear with the results!<br />
From now on, whenever you change one of the source files, the app will reload and reflect the changes.</p>
<p>Remember when we did scatterplots, I never really got into doing the menial work of making gridlines, axes etc. Exactly for this reason &#8211; it can be a lot of manual work.<br />
But now that we are going to build a professional looking web app, we are going to go all the way. </p>
<h2>One component, one file</h2>
<p>The app we are building has 3 components: the App, which is the parent; Scatterplot, which is the chart proper and HintContent, for some fine control about what the tooltip looks like.<br />
There an index.html and an index.js file, which are very simple: </p>
<pre class="brush: xml; title: ; notranslate" title="">
&lt;!doctype html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
    &lt;title&gt;React App&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<pre class="brush: plain; title: ; notranslate" title="">
import React from 'react';
import ReactDOM from 'react-dom';
import App from './App';
import './index.css';

ReactDOM.render(
  &lt;App /&gt;,
  document.getElementById('root')
);
</pre>
<p>There&#8217;s really not much to say about the index.html. All it does it create a div with an id of root, where everything will go.<br />
The index.js ends with the familiar command ReactDOM.render( &#8230; ), which will output our component into the aforementioned root div.</p>
<p>But it starts with a few import statements. What they do is that they link the source files together.<br />
Index starts by importing functionalities from react: React and ReactDOM. This was done in our codepen environment by using the settings.<br />
The next two lines link our index.js file with other files that we control: App and index.css. App contains our highest-level component, and index.css contains the styles.<br />
I&#8217;ve done some changes in index.css for styles I couldn&#8217;t reach with react &#8211; styles of the body, for instance, or some styles of elements created by libraries over which I didn&#8217;t have direct control (more on that later). Else, I&#8217;m using inline styles, in the React tradition.</p>
<p>Let&#8217;s move to our App.js source file, which describes the App component.</p>
<p>Its last line is: </p>
<pre class="brush: plain; title: ; notranslate" title="">
export default App;
</pre>
<p>And this is the line which corresponds to what we had seen earlier in index.js: </p>
<pre class="brush: plain; title: ; notranslate" title="">
import App from './App';
</pre>
<p>With this pair of statements, inside of index.js, App will be equivalent to what it was inside of App.js when exported.<br />
Using this construct, using import and export, files can be kept short, legible and focused on one specific problem.</p>
<p>But let&#8217;s take another look at the first two lines of App.js: </p>
<pre class="brush: plain; title: ; notranslate" title="">
import React, {Component} from 'react';
import {csv} from 'd3-request';
</pre>
<p>What are those curly braces?</p>
<p>If a module (a javascript file which imports or exports) has a <em>default</em> export, then when importing it, you can just use </p>
<pre class="brush: plain; title: ; notranslate" title="">
import WhatEverNameYouWant from 'module'; 
</pre>
<p>Where WhatEverNameYouWant is actually whatever name you want. Typically, it would start by an uppercase letter, but you do you.<br />
But a module can export other things than the default export. In that case, you have to use curly braces. There&#8217;s many articles on the subject such as <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import">this one</a>. I&#8217;m mostly bringing it up so that you see there&#8217;s a difference between using the curly braces or not.</p>
<p>In our source files, we are going to use export default. We are also going to define <em>one component only</em> per source file, which makes the whole import / export deal easier to follow.</p>
<p>create-react-app has no dependencies beyond react &#8211; which means that it doesn&#8217;t need other modules to be installed. But this project does! It needs d3-request and react-vis.<br />
You can install them from the command line, by typing npm install d3-request &#8211;save, and npm install react-vis. </p>
<h2>The App component &#8211; loading and passing data</h2>
<p>Our app component will do two things: load the data, and when the data is loaded, pass it to the Scatterplot component so it can draw a chart.<br />
I&#8217;ve hinted at the componentWillMount lifecycle method as a great place to load data, so let&#8217;s try that!</p>
<pre class="brush: plain; title: ; notranslate" title="">
class App extends Component {
  constructor(props) {
    super(props);
    this.state = {};
  }
</pre>
<p>I&#8217;m starting with the constructor method. The only reason why I do that is to initialize the state to an empty object. If I didn&#8217;t, the state would initially be <em>undefined</em>. And while it&#8217;s not a deal-breaker, I would have to add more tests so that the app doesn&#8217;t break before there&#8217;s anything actually useful in the state.</p>
<pre class="brush: plain; title: ; notranslate" title="">
  componentWillMount() {
    csv('./src/data/birthdeathrates.csv', (error, data) =&gt; {
      if (error) {
        this.setState({loadError: true});
      }
      this.setState({
        data: data.map(d =&gt; ({...d, x: Number(d.birth), y: Number(d.death)}))
      });
    })
  }
</pre>
<p>ComponentWillMount: there we go.<br />
we are using the same data file as before. Here, I&#8217;ve hardcoded it in a string, but that address could totally come from a property passed to App.<br />
Also, note I&#8217;m using csv from d3. That used to be d3.csv, but not anymore because I&#8217;m importing just <em>csv</em> from d3, or more precisely from its sublibrary &#8216;d3-request&#8217;. One of the big changes of d3 v4, also recently released, is that its code is available as smaller chunks. There are other ways to load a csv file, but d3&#8217;s csv method is super convenient and it&#8217;s also a great way to show how to cherrypick one useful part of a large library.</p>
<p>So, we are loading this file. What&#8217;s next? If loading the file raises an error, I am going to signal it via the state (setState({loadError: true});). Else, I am going to pass the content of the file to the state.<br />
Not just the raw contents: I am going to slightly transform it. Inside the csv method, data is an array of objects corresponding to the columns of my file. There are three columns: country, birth and deaths. I have therefore arrays with three properties, and their values is what is being read by csv from the file, as strings.<br />
The map statement turns that object into: a copy of all these properties (that&#8217;s what {&#8230;d does), plus x and y properties which simply convert the birth and deaths properties of each object to numbers (ie &#8220;36.4&#8221; to 36.4).<br />
So, whether this file succeeds or fails to load, I&#8217;m going to change the state of the component. </p>
<p>What values can the state take? </p>
<p>When the component is first created, state is empty.<br />
Then, componentWillMount attempts to load the file. State is still empty. During that very short time, render will fire (more on that soon).<br />
Then, the file will either load or not. If it loads, state will now hold a data property, and since state changes, the component will re-render. If it doesn&#8217;t load, state will have a loadError property and the component will also re-render.</p>
<p>Which takes us to the rendering of the component. You&#8217;ll see that these 3 situations are taken care of.</p>
<pre class="brush: plain; title: ; notranslate" title="">
render() {
    if (this.state.loadError) {
      return &lt;div&gt;couldn't load file&lt;/div&gt;;
    }
    if (!this.state.data) {
      return &lt;div /&gt;;
    }
    return &lt;div style={{
      background: '#fff',
      borderRadius: '3px',
      boxShadow: '0 1 2 0 rgba(0,0,0,0.1)',
      margin: 12,
      padding: 24,
      width: '350px'
    }}&gt;
      &lt;h1&gt;Birth and death rates of selected countries&lt;/h1&gt;
      &lt;h2&gt;per 1,000 inhabitants&lt;/h2&gt;
      &lt;Scatterplot data={this.state.data}/&gt;
    &lt;/div&gt;;
  }
</pre>
<p>if (this.state.loadError) &#8211; that&#8217;s the situation where the data didn&#8217;t load. That&#8217;s also why I did initiate state to an empty object, because if this.state was undefined, this syntax would cause an error. (this.state &#038;&#038; this.state.error) would be ok, but I might as well just initialize the state.</p>
<p>if (!this.state.data) takes care of the situation where the data didn&#8217;t load yet. We <em>also</em> know that there hasn&#8217;t been an error yet, else the first condition would have been triggered. In a professional setting, that&#8217;s where you&#8217;d put a progress bar or a spinner. Loading a 70 line csv isn&#8217;t going to take long though, so that would be over the top, which is why there&#8217;s just an empty div.</p>
<p>Finally, if neither of these conditions are met, we are going to render a card with a Scatterplot element inside. We&#8217;re going to render a little more than <em>just</em> the Scatterplot element &#8211; we&#8217;re styling the div on which it will stand and adding some titling.</p>
<h2>The Scatterplot component: introducing react-vis</h2>
<p><a href="https://github.com/uber/react-vis/">React-vis</a> is the charting library we use at Uber.<br />
The main idea is that we can create charts by composing elements, just like a web page: </p>
<pre class="brush: plain; title: ; notranslate" title="">
&lt;XYPlot
  width={300}
  height={300}&gt;
  &lt;HorizontalGridLines /&gt;
  &lt;LineSeries
    data={[
      {x: 1, y: 10},
      {x: 2, y: 5},
      {x: 3, y: 15}
    ]}/&gt;
  &lt;XAxis /&gt;
  &lt;YAxis /&gt;
&lt;/XYPlot&gt;
</pre>
<p>&#8230; creates a very simple line chart with horizontal gridlines and axes. Don&#8217;t want the gridline? remove the <horizontalgridlines /> part. Want vertical gridlines too? Just add <verticalgridlines /> underneath.<br />
Do you need another line chart? You can add another LineSeries element. Or a VerticalBarSeries. Or a RadialChart (pie or donut charts). And so on and so forth.<br />
React-vis handles all the nitty gritty of making charts, so we don&#8217;t have to.</p>
<p>Let&#8217;s dive into Scatterplot. </p>
<pre class="brush: plain; title: ; notranslate" title="">
import React, {Component} from 'react';
import {
  Hint,
  HorizontalGridLines,
  MarkSeries,
  VerticalGridLines,
  XAxis,
  XYPlot,
  YAxis
} from 'react-vis';
</pre>
<p>scatterplot.js starts by familiar import statements. We only import what we need from &#8216;react-vis&#8217;.</p>
<pre class="brush: plain; title: ; notranslate" title="">
import HintContent from './hint-content.js';
</pre>
<p>Then, we import HintContent &#8211; hint-content.js uses a default export, so no need for curly braces. By the way, that .js extension is not mandatory in the file name.</p>
<pre class="brush: plain; title: ; notranslate" title="">
export default class Scatterplot extends Component {
  constructor(props) {
    super(props);
    this.state = {
      value: null
    };
    this._rememberValue = this._rememberValue.bind(this);
    this._forgetValue = this._forgetValue.bind(this);
  }

  _rememberValue(value) {
    this.setState({value});
  }

  _forgetValue() {
    this.setState({
      value: null
    });
  }
</pre>
<p>We could have made Scatterplot a pure functional component&#8230; if we had passed callback functions for handling mouseover. Those functions could have changed the state of the App component, which would re-render its children &#8211; Scatterplot. Since no component outside of Scatterplot is interested in knowing where the mouse is, that component can have its own state.<br />
We are also adding two private functions. They have to be bound to &#8220;this&#8221; &#8211; we are creating a class, and those functions have to be tied to each instance of that class. The other way  to think about it is: you can add private functions to a React component, but if they use the state, properties or private variables, you <em>will</em> have to bind them to &#8216;this&#8217; in the constructor. </p>
<pre class="brush: plain; title: ; notranslate" title="">
render() {
    const {data} = this.props;
    const {value} = this.state;
    return &lt;div&gt;
      &lt;XYPlot
        margin={{top:5, left: 60, right: 5, bottom: 30}}
        width={320}
        height={290}&gt;
        &lt;VerticalGridLines /&gt;
        &lt;HorizontalGridLines /&gt;
        &lt;XAxis/&gt;
        &lt;YAxis/&gt;
        &lt;MarkSeries
          data={data}
          onValueMouseOver={this._rememberValue}
          onValueMouseOut={this._forgetValue}
          opacity={0.7}
        /&gt;
        {value ?
          &lt;Hint value={value}&gt;
            &lt;HintContent value={value} /&gt;
          &lt;/Hint&gt; :
          null
        }
      &lt;/XYPlot&gt;
      &lt;div style={{
        color: '#c6c6c6',
        fontSize: 11,
        lineHeight: '13px',
        textAlign: 'right',
        transform: 'rotate(-90deg) translate(120px, -160px)'
      }}&gt;Death Rates&lt;/div&gt;
      &lt;div style={{
        color: '#c6c6c6',
        fontSize: 11,
        lineHeight: '13px',
        textAlign: 'right',
        transform: 'translate(-5px,-14px)',
        width: '320px'
      }}&gt;Birth Rates&lt;/div&gt;
    &lt;/div&gt;;
  }
</pre>
<p>What we are returning is a div element. The reason is that at the very end, we are writing the name of the axes on that div. But mostly, that div will hold a XYPlot component, which comes from react-vis. I&#8217;m passing: a margin property, a height and a width. Margin is optional and I&#8217;m using it for control. Height is mandatory, width as well, though react-vis has a responsive component that makes the charts adapt to the width of the page (not used here).<br />
Then, I&#8217;m simply adding: horizontal and vertical gridlines, and horizontal and vertical axes. I&#8217;m using default settings for all of them (full disclosure &#8211; I&#8217;ve changed a few things via the index.css stylesheet). But the way labels and lines are organized is fine by me.<br />
Then, we&#8217;re adding the MarkSeries component, which is all the circles. </p>
<pre class="brush: plain; title: ; notranslate" title="">
 &lt;MarkSeries
  data={data}
  onValueMouseOver={this._rememberValue}
  onValueMouseOut={this._forgetValue}
  opacity={0.7}
/&gt;
</pre>
<p>The data property comes from the properties passed to the Scatterplot component. It needs to have an x and y properties, which is why I transformed our csv file like so. It could also have a size or a color property, but we&#8217;re not going to use these in our example.<br />
I&#8217;m using an opacity property to better show which marks overlap. I could also have made them smaller, but I&#8217;m sticking to the defaults.<br />
Finally, we&#8217;re using the onValueMouseOver and onValueMouseOut properties to pass functions to handle what happens when the user is going to, well, mouse over one of the marks, or remove their mouse cursor from them. Those are our private functions from before:</p>
<pre class="brush: plain; title: ; notranslate" title="">
  _rememberValue(value) {
    this.setState({value});
  }

  _forgetValue() {
    this.setState({
      value: null
    });
  }
</pre>
<p>When a user passes their mouse on a mark, the corresponding datapoint (value) will be passed to the state. And when the user removes their mouse, the value property is reset to null.</p>
<p>finally, right under the MarkSeries component, is where we call our Hint: </p>
<pre class="brush: plain; title: ; notranslate" title="">
  {value ?
    &lt;Hint value={value}&gt;
      &lt;HintContent value={value} /&gt;
    &lt;/Hint&gt; :
    null
   }
</pre>
<p>If value (from the state) is worth something, then we create a Hint component. That one comes from react-vis, and handles positioning of the tooltip plus some default content. But I want to control exactly what I show inside my tooltip, so I&#8217;ve created a component to do just that.<br />
Creating a specialized component like this is great, because it hides this complexity from the Scatterplot component. All that Scatterplot needs to know is that it&#8217;s passing properties to a HintContent component, which returns&#8230; something good.</p>
<p>Because of imports and exports, it&#8217;s generally a good idea to create such small specialized components. </p>
<h2>For the win: the hint content component</h2>
<pre class="brush: plain; title: ; notranslate" title="">
import React from 'react';
export default function HintContent({value}) {
  const {birth, country, death} = value;
  return &lt;div&gt;
    &lt;div style={{
      borderBottom: '1px solid #717171',
      fontWeight: 'bold',
      marginBottom: 5,
      paddingBottom: 5,
      textTransform: 'uppercase'
    }}&gt;{country}&lt;/div&gt;
    {_hintRow({label: 'Birth Rates', value: birth})},
    {_hintRow({label: 'Death Rates', value: death})}
  &lt;/div&gt;;
}

function _hintRow({label, value}) {
  return &lt;div style={{position: 'relative', height: '15px', width: '100%'}}&gt;
    &lt;div style={{position: 'absolute'}}&gt;{label}&lt;/div&gt;
    &lt;div style={{position: 'absolute', right: 0}}&gt;{value}&lt;/div&gt;
  &lt;/div&gt;;
}
</pre>
<p>The HintComponent is a pure functional component and is our default export.<br />
There&#8217;s another function in that module, and we&#8217;re not exporting it. In other words, it won&#8217;t be accessible by other parts of the app. The only place where it can be used is within this file. Traditionally, those start with an underscore.</p>
<p>The only point of the HintComponent is to offer fine control on the appearance of the tooltip (which also receives styles from index.css). But I wanted to control exactly how the various parts of the data point will appear inside.<br />
So, it has 3 rows. The first one contains the name of the country (well, its 3-letter ISO code). I chose to make it bolder and uppercase. Also, it will have a border separating it from the rest of the card.<br />
The next two rows are similar, which is why I created a function to render them as opposed to just retype it.<br />
It&#8217;s a relative div, which takes all the space, with two absolute divs as children. The label one has no position information, so its attached to its top left corner, but the value one has a right attribute of 0, so its attached to its top right corner. So, for each row, the label is going to be left-aligned, and the value, right-aligned. </p>
<p>And that&#8217;s it! </p>
<p>For our <a href="http://wp.me/po630-st">grand finale</a>, we are going to create a more complex application with several charts that interact with one another&#8230;</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-1758" class="post-1758 post type-post status-publish format-standard hentry category-d3 category-data-visualization category-javascript category-react category-tips">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2016/08/13/beyond-rendering/" rel="bookmark"><time class="entry-date published" datetime="2016-08-13T01:41:36+00:00">August 13, 2016</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/d3/" rel="category tag">d3</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/javascript/" rel="category tag">javascript</a>, <a href="/category/react/" rel="category tag">react</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2016/08/13/beyond-rendering/" rel="bookmark">Beyond rendering</a></h1>
         
    </header>
	<section class="post-content">

		<p>This is the 5th post in my <a href="http://wp.me/po630-rq">Visualization with React</a> series. Previous post: <a href="http://wp.me/po630-sg">React components</a></p>
<h1>The lifecycle functions</h1>
<p>I&#8217;m not going to go into great details on this, but a talk on React without mentioning the <a href="https://facebook.github.io/react/docs/component-specs.html">lifecycle functions</a> would not be complete.<br />
React components come with several functions which are fired when certain events occur, such as when the component is first created (&#8216;mounts&#8217;), when it&#8217;s updated or when it&#8217;s removed (&#8216;unmounts&#8217;).<br />
Pure functional components, which we&#8217;ve been mostly using, don&#8217;t have lifecycle functions.<br />
But components with a state can have them.</p>
<p>Some examples of usage of those lifecycle functions include: </p>
<ul>
<li>Before the component is rendered, you can load data. that&#8217;s a job for &#8216;componentWillMount&#8217;.</li>
<li>After a component is rendered, you can animate it, or add an event listener. Use &#8216;componentDidMount&#8217;. </li>
<li>Prevent a component from rendering under certain circumstances, even if it receives new properties or its state changes. Use &#8216;shouldComponentUpdate&#8217;. </li>
<li>After a component receives new props or new state, you can trigger another function before the component updates (&#8216;componentWillUpdate&#8217;) or right after (&#8216;componentDidUpdate&#8217;). </li>
<li>When a component is going to be removed, you can do some cleanups, like deleting event listeners. Use &#8216;componentWillUnmount&#8217;. </li>
</ul>
<p>Oftentimes, you can simply get by by using the default behavior of React components, which re-render only when they receive different properties or when their state changes. But it can be really convenient to have that extra degree of control.</p>
<p>Here is an example of using these lifecycle functions in context.</p>
<p data-height="400" data-theme-id="0" data-slug-hash="Vjxywz" data-default-tab="result" data-user="jckr" data-embed-version="2" class="codepen">See the Pen <a href="http://codepen.io/jckr/pen/Vjxywz/">lifecycle functions example</a> by Jerome Cukier (<a href="http://codepen.io/jckr">@jckr</a>) on <a href="http://codepen.io/">CodePen</a>.</p>
<p>What is going on there?<br />
We&#8217;re adapting our earlier <a href="http://codepen.io/jckr/pen/BzKVJq">scatterplot</a> example, only this time, we are not using pure functional components (which don&#8217;t have those lifecycle functions), but creating classes.<br />
We&#8217;re going to have three classes: Chart, at the highest level; Scatterplot, a child of Chart; and Points.<br />
Chart passes data to Scatterplot. What it passes depends on whether the button is clicked. That button changes the state of Chart (which causes a rerendering of the Scatterplot and the Point elements).<br />
Chart also has a private variable that holds a message we can display on top. We can still use callback functions to change this variable, just like we change the state, but the difference between changing the state and changing a private variable is that changing a private variable doesn&#8217;t cause the children to re-render.<br />
When we first create the scatterplot element, the componentDidMount function is called, and the message is changed to reflect that.<br />
Then, each time we click the button, a different data property is passed to the Scatterplot element. Also, the componentDidUpdate method is triggered, which changes the message.<br />
(changing the state of the parent from a componentDidUpdate method can cause an endless re-rendering loop, this is why I used private variables instead of the state, and there are ways to address this but for the sake of brevity this is the easiest way to deal with that problem).<br />
Now, when a full dataset is passed to the Scatterplot element, many Point elements will be created. I&#8217;ve also added a lifecycle method to these Points: when they are first created, they receive a small animation. To that end, I have also used the componentDidMount method, but this time at the Point level.<br />
Exit animations are also possible, but &#8211; full disclosure &#8211; they are less easy to implement in React than entry animations, or than in D3. So again in the interest of concision I&#8217;ll skip these for now.</p>
<h1>React and D3</h1>
<p>We just saw that with React, we can create a DOM element, then immediately after, call a function to do whatever we want, such as manipulating that element. That function would have access to all the properties and state of that React element.<br />
So what prevents us from combining React and D3? Nothing!<br />
We can create components that are, essentially, an SVG element, then use componentDidMount to perform D3 magic on that element.<br />
Here&#8217;s an example:</p>
<p data-height="600" data-theme-id="0" data-slug-hash="BzxbPY" data-default-tab="result" data-user="jckr" data-embed-version="2" class="codepen">See the Pen <a href="http://codepen.io/jckr/pen/BzxbPY/">mixing react and d3</a> by Jerome Cukier (<a href="http://codepen.io/jckr">@jckr</a>) on <a href="http://codepen.io/">CodePen</a>.</p>
<p>In that example, I have used a bona fide bl.ocks (<a href="https://bl.ocks.org/mbostock/7881887">https://bl.ocks.org/mbostock/7881887</a>) and wrapped it inside a React component. So I can create one, or in the case of that example, several such elements by just passing properties. Those components can perfectly function as black boxes: we give them properties, they give us visualizations that correspond to these parameters. And it doesn&#8217;t have to be D3 &#8211; once a React element has been created, we can use componentDidMount to do all kinds of operations on it. </p>
<p>In the last 2 articles I will present actual data visualization web apps made with React.<br />
In the next post, we&#8217;ll see how to set up a simple web app and we&#8217;ll create our <a href="http://wp.me/po630-sp">first example app</a>. </p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-1752" class="post-1752 post type-post status-publish format-standard hentry category-uncategorized">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2016/08/11/react-components/" rel="bookmark"><time class="entry-date published" datetime="2016-08-11T23:53:04+00:00">August 11, 2016</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/uncategorized/" rel="category tag">Uncategorized</a>			</span>
		        <h1 class="post-title"><a href="/2016/08/11/react-components/" rel="bookmark">React components</a></h1>
         
    </header>
	<section class="post-content">

		<p><script src="//assets.codepen.io/assets/embed/ei.js" async=""></script>This article is part of my series <a href="http://wp.me/po630-rQ">Visualization with React</a>. Previous article: <a href="http://wp.me/po630-s3">Coding with React</a></p>
<p>Using React to create elements out of data is nice, using JSX is hip but until you use your own components, you won&#8217;t use React to the fullest.<br />
So let&#8217;s do that. Fair warning: <strong>that&#8217;s the speed bump</strong>, especially if you&#8217;re not familiar with javascript concepts like &#8216;this&#8217;, which you&#8217;re not really required to master with d3.</p>
<p>In the previous examples, we created an element that held a bunch of elements. We are now going to create a custom Point component, to replace our circles. We&#8217;re going to do more than just replace it: our new component will be able to do more stuff. Each Point element should remember whether it&#8217;s highlighted or not. If it&#8217;s highlighted, it will be displayed in red. Else, it will stay in gray. Clicking on a Point will switch its highlighted status.</p>
<p>The way we are going to maintain that highlighted status is by using the state of the component (remember <a href="http://codepen.io/jckr/pen/mEeRvr">that switch example</a>?).</p>
<p>There are two syntaxes to create components: one uses React.createClass method, and the other uses ES6 classes. I&#8217;m providing this next step using both syntaxes. I don&#8217;t know which one is more common for the time being, but I feel that the ES6 class one will be in the future, so this is the one I personally use.</p>
<p class="codepen" data-height="387" data-theme-id="0" data-slug-hash="BzKxmR" data-default-tab="result" data-user="jckr" data-embed-version="2">See the Pen <a href="http://codepen.io/jckr/pen/BzKxmR/">React scatterplot with custom component &#8211; using es6 class</a> by Jerome Cukier (<a href="http://codepen.io/jckr">@jckr</a>) on <a href="http://codepen.io/">CodePen</a>.</p>
<p>Our custom component is an ES6 class (gasp!) and it&#8217;s based on the existing class, React.Component.<br />
So we declare our custom component like this:</p>
<pre class="brush: plain; title: ; notranslate" title="">
class Point extends React.Component {
... a bunch of stuff which is different from React.Component ...
}
</pre>
<p>Specifically we are going to specify two properties of our new class: constructor and render. Constructor describes what happens when an element of this component is first created, and render is what should be displayed on screen for that element.<br />
Don&#8217;t confuse the component and the elements: the component is the type of things that we are going to create, you can think of it as the mold. The elements are what are created with this component, think of it as casts. Creating the component describes how the elements should be created. Later in the code, we are going to create, or instantiate, the individual elements using the component. In Javascript, as in many other languages, by convention, classes like our component have a name that starts with an upper case.</p>
<p>So let&#8217;s look at the first property.</p>
<pre class="brush: plain; title: ; notranslate" title="">
constructor(props) {
super(props);
this.state = {highlighted: false};
}
</pre>
<p>what&#8217;s the argument of constructor, props? In React world, props is short for properties. Until now, we never really had to manipulate properties inside the component.<br />
In this specific example, we don&#8217;t really do anything with props, so we could write just constructor() {&#8230;}. But it&#8217;s a convention, and if at some point we want to do something with these properties right when the component is first created, we might.<br />
The second line is super(props). What this does is that it passes whatever arguments the constructor had to the constructor of the original React.Component class. You don&#8217;t have to know what happens then, just that it&#8217;s a mandatory step.<br />
The third line introduces us to the state. we assign an object to &#8220;this.state&#8221;.<br />
But what is <a title="Understand Javascript's this with clarity and master it" href="http://javascriptissexy.com/understand-javascripts-this-with-clarity-and-master-it/">this</a>? the 10000 ft view is that it refers to a specific context or scope (the article under the link above is fantastic if you want to know more).<br />
We&#8217;re going to have many Point elements. Each of them can be highlighted or not. Each of them also corresponds to a different data point. Each of them can access and manipulate data that no other can. This is where <em>this</em> comes from. Properties of this (that is, whatever comes after &#8220;this.&#8221;) are going to be private to that element, in other words, not accessible from the outside.<br />
And there are going to be two very important properties: props and state.</p>
<p><strong>this.props</strong> are the properties of the element, which the element cannot change. They come from its parent element.<br />
<strong>this.state</strong> is the state of the element, which the element can change: and when it does, the element will be re-rendered.</p>
<p>Speaking of rendering, let&#8217;s look at the next property of our class: the render method.<br />
That method must render a React element or null.</p>
<p>So:</p>
<pre class="brush: plain; title: ; notranslate" title="">
render() {
  return &lt;circle
  onClick = {
    this.setState({
      highlighted: !this.state.highlighted
    });
  }}
  r = {
    5
  }
  style = {
    {
      fill: this.state.highlighted ? 'red' : '#222',
      opacity: 0.2,
      transition: 'fill .5s'
    }
  }
  /&gt;;
}
</pre>
<p>Our component will create a element. But it could also be another custom component! Let&#8217;s just keep it simple for now.<br />
cx, this time, will be expressed as a calculation based on this.props.birth. (and likewise cy will be computed from this.props.death).<br />
birth and death are the properties that will have to be passed to the component to create an element (which we&#8217;ll see in the end).</p>
<p>we have a new property: onClick. onClick, unsurprisingly, handles click events. So when a user clicks, that will trigger a function which will do the following:</p>
<pre class="brush: plain; title: ; notranslate" title="">
this.setState({
highlighted: !this.state.highlighted
});
</pre>
<p>The intention here is to assign to the highlighted property of the state the value which is opposite to that it currently holds. That value is stored at this.state.highlighted. Remember that originally, we stored {highlighted: false} in this.state, so this.state.highlighted is where it&#8217;s at. And so, !this.state.highlighted is the opposite of the current highlighted status.<br />
this.setState adds the relevant property to the state. So, this construct effectively reverses the value of this.state.highlighted.<br />
Whenever the state changes, the component is automatically re-rendered without any other action required (we can prevent that if needed, but we&#8217;ll see that later).</p>
<p>Finally, let&#8217;s look at what&#8217;s happening towards the end, with our style.<br />
As we&#8217;ve seen several times before, we pass an object to style. Because of the JSX notation, that&#8217;s <em>two</em> sets of curly braces.<br />
The fill property of the style depends on the state. So, if highlighted is true, it&#8217;s going to be red, else it&#8217;s going to be gray. Just as we said.<br />
I&#8217;m also adding to the style a transition property, so that instead of just blinking from red to gray, our component smoothly fades from one color into the other.</p>
<p>So that&#8217;s our class.<br />
The second part of the code is the same with both syntaxes, so let&#8217;s see how we create a component using React.createClass.</p>
<p class="codepen" data-height="387" data-theme-id="0" data-slug-hash="EyKLEz" data-default-tab="js,result" data-user="jckr" data-embed-version="2">See the Pen <a href="http://codepen.io/jckr/pen/EyKLEz/">React scatterplot with custom component &#8211; using createClass</a> by Jerome Cukier (<a href="http://codepen.io/jckr">@jckr</a>) on <a href="http://codepen.io/">CodePen</a>.</p>
<p>So instead of creating a class, we create a variable:</p>
<pre class="brush: plain; title: ; notranslate" title="">
const Point = React.createClass({
... object with properties ...
});
</pre>
<p>So this time, we pass to React.createClass an object that describes the component that we&#8217;re going to create.<br />
As above, we care about two things: that the elements it creates have a state, which starts as not highlighted, and how they should be rendered.<br />
When we use React.createClass, the way to initialize a state is to use a property called getInitialState.<br />
You have to assign to that property a function that returns an object: that object is the initial state.</p>
<pre class="brush: plain; title: ; notranslate" title="">
...
getInitialState: function getInitialState() {
return {highlighted: false};
},
...
</pre>
<p>A word of caution: React.createClass takes an object as an argument, so its properties are separated by commas. There are no commas between the properties of a class, with the first syntax.</p>
<p>The second property of our object is render. Render gets a function that will output a React element or null. The syntax is very close to the above.<br />
getInitialState, like render, are called lifecycle methods. This is because they are called at specific moments of the life of our component. There are more than 2, and they are one of the most interesting parts of React. We&#8217;ll cover them in our next article.</p>
<p>Now let&#8217;s look at the second part of our code. Now that we&#8217;ve got a custom component, what of it?<br />
well, let&#8217;s use it to create elements!</p>
<pre class="brush: plain; title: ; notranslate" title="">
const svg = &lt;svg height={300} width={300}&gt;{
 birthdeathrates.map(d =&gt; &lt;Point birth={d.birth} death={d.death} /&gt;)
}&lt;/svg&gt;;
</pre>
<p>What&#8217;s different here is that line with the element.<br />
Remember that before, we created a element and we specified its cx and cy properties. This time, we don&#8217;t pass cx or cy, instead we just pass a value for birth and a value for death. The component can do the rest!</p>
<h1>Pure functional components</h1>
<p>Our Point component is somewhat complicated because we maintain its state. Because we care about its state, we need to initialize it, we need to capture events that could affect it, and have our output depend on it.<br />
By contrast, if all we had were properties (which, again, do not change), what the component does could be much simpler: it takes an input, and produces an output. The same input produces the same output. Just like each time when you add two numbers, the result is the same if the numbers you add are the same.<br />
In javascript terms, if you had a function that didn&#8217;t use global variables, randomness or external APIs, when you pass the same argument to that function, you get the same result. This is what&#8217;s called a <a title="pure functions in javascript" href="http://www.nicoespeon.com/en/2015/01/pure-functions-javascript/">pure function</a>. Pure functions have a lot of good things going for them, not least their stability and predictability and simplicity.<br />
So let&#8217;s suppose we didn&#8217;t care about the state of our Point component.<br />
React let us write it as a pure functional component.<br />
Here&#8217;s how:</p>
<p class="codepen" data-height="387" data-theme-id="0" data-slug-hash="BzKVJq" data-default-tab="html,result" data-user="jckr" data-embed-version="2">See the Pen <a href="http://codepen.io/jckr/pen/BzKVJq/">React scatterplot with pure functional component</a> by Jerome Cukier (<a href="http://codepen.io/jckr">@jckr</a>) on <a href="http://codepen.io/">CodePen</a>.</p>
<pre class="brush: plain; title: ; notranslate" title="">
function Point({
  birth,
  death
}) {
  return &lt;circle
  cx = {
    birth * 10
  }
  cy = {
    300 - death * 10
  }
  r = {
    5
  }
  style = {
    {
      fill: '#222',
      opacity: 0.2
    }
  }
  /&gt;;
}
</pre>
<p>Our component is now just a function! we pass it an object with properties {birth, death} and you can use them directly in the body of the function. No need for this.props.birth or whatever.<br />
The second part of the code doesn&#8217;t change, the elements are still created exactly the same way.</p>
<h1>Combining components: I&#8217;ll call you back</h1>
<p>In a real world situation, you&#8217;ll probably have many custom components being parts of one another and passing data back and forth.<br />
So, let&#8217;s step up in complexity.<br />
Let&#8217;s use the same dataset, but this time we&#8217;ll make a bar chart.<br />
Initially, we&#8217;ll show birth rates. But we&#8217;ll also add a switch! and if the user touches the switch, we&#8217;ll show death rates instead.<br />
So. Let&#8217;s think this through a little bit.</p>
<p>We&#8217;ll have a Chart component that is going to be at the top level.<br />
That component will have a Switch component as a child.<br />
It will also have several Bar components that will correspond to the actual data. We can make the Bar components out of our birthdeathrates dataset as before.</p>
<pre class="brush: xml; title: ; notranslate" title="">
&lt;Chart&gt;
  &lt;Switch /&gt;
  &lt;Bar /&gt;
  &lt;Bar /&gt;
  &lt;Bar /&gt;
  ...
&lt;/Chart&gt;
</pre>
<p>There will be an event attached to the switch, so that when it&#8217;s clicked, the Bars can change.<br />
Now the real question is: which component&#8217;s state should be changed by the switch?</p>
<p>We&#8217;ve seen how the switch could change its own state. But the Bar components wouldn&#8217;t be able to read it.<br />
Ideally, the switch will trigger some kind of change in the Bar component, but likewise, it cannot reach the state of those.</p>
<p>So: we&#8217;ll have to find a way to get our switch to update the state of the Chart component. When the state of Chart updates, it re-renders. That means that it can pass new properties to its children. It can tell its Bars to use the death property instead of the birth one.<br />
But how to access the state of the parent from one of its children? That&#8217;s possible using callback functions.</p>
<p>If we are within the parent element, we can access its state.<br />
So, we could create a function that would do:</p>
<pre class="brush: plain; title: ; notranslate" title="">
updateMetric(metric) {
  this.setState({metric}); // this.setState({metric: metric}) in short hand notation, possible with babel
}
</pre>
<p>That function would work within our future Chart component. Now what if&#8230; we passed that function to Switch as a property? then, when executed, it would change the state <em>within Chart.</em> That would trigger a re-render, and Chart could pass different props to all of its children.</p>
<p>Let&#8217;s make it work.</p>
<p class="codepen" data-height="387" data-theme-id="0" data-slug-hash="JKXZmN" data-default-tab="js,result" data-user="jckr" data-embed-version="2">See the Pen <a href="http://codepen.io/jckr/pen/JKXZmN/">React bar chart with callback</a> by Jerome Cukier (<a href="http://codepen.io/jckr">@jckr</a>) on <a href="http://codepen.io/">CodePen</a>.</p>
<p>Lots of stuff going on here!</p>
<pre class="brush: plain; title: ; notranslate" title="">
class Chart extends React.Component {
   constructor(props) {
     super(props);
        
     this.state = {
       metric: 'birth',
     };
   }
// ...
</pre>
<p>This is the constructor of our class. We&#8217;ve seen it before, the only special thing is that we give it an initial start here by giving a value to this.state.</p>
<pre class="brush: plain; title: ; notranslate" title="">
render() {
    const metric = this.state.metric;
    const data = this.props.data.sort((a,b) =&gt; b[metric] - a[metric])
      .map((d, i) =&gt; ({...d, rank: i}))
      .sort((a, b) =&gt; b.country &gt; a.country);
</pre>
<p>Here, metric gets the value of whatever we put in the state.<br />
And data is: whatever is passed to the props as data, first sorted by the value of the corresponding metric, then given a rank property which is just its order in that sorted list, and finally sorted alphabetically. So whatever the metric, the same country will always be at the same position in this array, only its rank property, which was computed while the list was sorted, would be different. </p>
<pre class="brush: plain; title: ; notranslate" title="">
    return &lt;div className='chart'&gt;
      {[
       &lt;span className='label'&gt;Birth rate&lt;/span&gt;,
       &lt;Switch metric={metric} updateMetric={(d) =&gt;
            this.setState({metric: d})
       }/&gt;,
       &lt;span className='label'&gt;Death rate&lt;/span&gt;,
       &lt;div&gt;
         {data.map(d =&gt; 
          &lt;Bar country={d.country} value={d[metric]} rank={d.rank}/&gt;
         )}
      &lt;/div&gt;
      ]}
    &lt;/div&gt;; 
</pre>
<p>Nothing that we&#8217;ve never seen before in that render function &#8211; we&#8217;re just creating divs or instances of components that remain to be described, and we pass them props. The only new thing is that updateMetric property of Switch. Instead of passing a value or an array, we pass a function. And in that function, we call this.setState.<br />
Because we are still within the Chart component, this.setState will change the state of a Chart component. But wait: we are actually passing that function to another component, Switch! This component, a child of Chart, receives a function that lets it change the state of its parent.<br />
That&#8217;s the callback function. </p>
<p>Here&#8217;s that Switch component: </p>
<pre class="brush: plain; title: ; notranslate" title="">
function Switch({metric, updateMetric}) {
  return &lt;div className = 'switch__track'
     onClick = {() =&gt; updateMetric(metric === 'birth' ? 'death' : 'birth')}
    &gt;
      &lt;div className = {'switch__thumb ' + metric} /&gt;
    &lt;/div&gt;
};
</pre>
<p>Switch doesn&#8217;t have a state of its own, so we can just use a functional component. Switch receives updateMetric as a property. Switch doesn&#8217;t know anything about this function &#8211; it doesn&#8217;t have to. It doesn&#8217;t need to know that this function will affect its parent. All it does is launch this function when it&#8217;s being clicked &#8211; that&#8217;s what the line with onClick does. </p>
<p>Here&#8217;s another example presented without comments with similar data, with a slightly different ways to order the components.<br />
This time, the top level component is Dashboard, which has 2 Chart components, which each have several Bar components as children. Mousing over Bar components updates the state of the Dashboard components, which re-renders its Charts children and their Bar children.</p>
<p data-height="265" data-theme-id="0" data-slug-hash="RRLWQz" data-default-tab="js,result" data-user="jckr" data-embed-version="2" class="codepen">See the Pen <a href="http://codepen.io/jckr/pen/RRLWQz/">react dual bar chart</a> by Jerome Cukier (<a href="http://codepen.io/jckr">@jckr</a>) on <a href="http://codepen.io/">CodePen</a>.</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-1739" class="post-1739 post type-post status-publish format-standard hentry category-d3 category-data-visualization category-javascript category-react category-tips">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2016/08/10/coding-with-react/" rel="bookmark"><time class="entry-date published" datetime="2016-08-10T21:16:47+00:00">August 10, 2016</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/d3/" rel="category tag">d3</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/javascript/" rel="category tag">javascript</a>, <a href="/category/react/" rel="category tag">react</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2016/08/10/coding-with-react/" rel="bookmark">Coding with React</a></h1>
         
    </header>
	<section class="post-content">

		<p><script src="//assets.codepen.io/assets/embed/ei.js" async=""></script>This article is part of my series <a href="http://wp.me/po630-rQ">Visualization with React</a>. Previous article: <a href="http://wp.me/po630-rX">An ES6 primer</a></p>
<h1>Setting things up in Codepen</h1>
<p>In the last two articles of the series, I&#8217;ll cover how to get a real React coding environment going, but to start dabbling, playgrounds like <a href="https://jsfiddle.net/reactjs/69z2wepo/">jsFiddle</a> or <a href="http://codepen.io/">codepen</a> are great. I&#8217;m partial to codepen. When you create a new pen, you still have a couple of options to set up before you can start creating React code: <img src="http://jeromecukier.net/assets/visualization-with-react/react-settings-in-codepen.png" alt="" /></p>
<p>In the Settings / Javascript / quick-add section (the drop-down at the bottom left) please choose React, then React DOM.</p>
<p>All of the code examples of articles 1, 3, 4, and 5 can be found in this <a href="http://codepen.io/collection/XdEpyp/">codepen collection</a>.</p>
<h1>Creating elements</h1>
<p class="codepen" data-height="265" data-theme-id="0" data-slug-hash="pbjpOm" data-default-tab="result" data-user="jckr" data-embed-version="2">See the Pen <a href="http://codepen.io/jckr/pen/pbjpOm/">React simple scatterplot</a> by Jerome Cukier (<a href="http://codepen.io/jckr">@jckr</a>) on <a href="http://codepen.io/">CodePen</a>.</p>
<p>In this first React example, we&#8217;re going to create a couple of very simple elements and render them. Let&#8217;s start by the end: <code>ReactDOM.render(myDiv, document.querySelector('#root'));</code> We use ReactDOM.render to, well, render something we have created (myDiv) somewhere in our document (on top of what corresponds to the &#8216;#root&#8217; selection. We conveniently have a div with the id &#8220;root&#8221; in the HTML part of the pen). That&#8217;s it! we&#8217;ve output something using React. While the syntax can appear a bit daunting, it really does one simple thing: take what you&#8217;ve made and put it where it should be. But what&#8217;s that myDiv? To find out, let&#8217;s look at the first 2 lines of our code. <code>const mySpan = React.createElement('span', {style: {fontFamily: 'sans-serif'}}, 'hello React world'); const myDiv = React.createElement('div', {className: 'my-div'}, mySpan);</code> Oh, so before there was a myDiv, there was a mySpan. MySpan is a React element, the building brick of the React eco system. To create it, we use React.createElement which is the workhorse of React. React.createElement takes three arguments: the type of React element we are creating, its properties, and its content. The type of element can be any HTML or SVG element, and we&#8217;ll see later that we can also make our own. The second argument is the properties. It&#8217;s an object. In the d3 world, the properties could be what goes in the attr method. So when you create an SVG element like a rect, its properties could include things like x, y, width and height. In d3, style is treated slightly differently. This is also the case in React. When using React.createElement with an HTML or SVG element, that could be styled using CSS, you can use a style property to pass a style object. That style object contains all CSS properties you want to apply to the object, but instead of hyphenating them, they are written in camel case (so font-family, for instance, becomes fontFamily). The third argument is content: it can either be a string, a single React element, or an array of React elements. In the first line (mySpan) we&#8217;ve used a string. So, this first line created a React element which is a span, which contains &#8220;hello React world&#8221;, and which has a simple style applied to it. In the second line, we create a second React element. Again, React.createElement takes three arguments: type of element (now it&#8217;s an HTML div), properties and content. Instead of providing a string, we can pass another React element, such as mySpan that we created above. And that&#8217;s it! we&#8217;ve rendered something using react.</p>
<h1>Creating elements from data</h1>
<p>In the example above, we&#8217;ve used React.createElement with two kind of content: a string and another React element. But I mentioned that there was a third possibility: an array of React elements. If you&#8217;re familiar with d3, you might think: in d3, I could do that from an array of data. The idea in React is pretty similar, only, instead of using select / selectAll / data / enter / append, we can just create our array.</p>
<p class="codepen" data-height="350" data-theme-id="0" data-slug-hash="ezZrOM" data-default-tab="result" data-user="jckr" data-embed-version="2">See the Pen <a href="http://codepen.io/jckr/pen/ezZrOM/">React simple scatterplot</a> by Jerome Cukier (<a href="http://codepen.io/jckr">@jckr</a>) on <a href="http://codepen.io/">CodePen</a>.</p>
<p>One simple way to do that is to use map: <code>myArray.map(d =&gt; React.createElement(...))</code>. This is exactly what we are doing in the snippet of code above. This uses the birthdeathrates dataset, one of the example files provided with R (number of births and deaths per thousand people per year in various countries.) The interestingness happens here:</p>
<pre class="brush: jscript; title: ; notranslate" title="">birthdeathrates.map(
  (d, i) =&gt; React.createElement('div', {
    'key': i,
    'style': {
       background: '#222',
       borderRadius: 5,
       height: 10,
       left: 5 * d.birth,
       top: 300 - 5 * d.death,
       position: 'absolute',
       width: 10,
       opacity: .2}
  })
)</pre>
<p>In the properties that I pass, some depend on the underlying data. This is a mapping so it&#8217;s going to return something for each item of the array. Each item of the array is represented by d, and has the birth, death and country properties. In left and top, we use a calculation based on these properties. And for each item, we get a React element created with these calculations. This isn&#8217;t unlike what we&#8217;d had in d3 if we had written:</p>
<pre class="brush: jscript; title: ; notranslate" title=""> ...
 .selectAll('div')
 .data(birthdeathrates)
 .enter()
 .append('div')
 .style({ ..., left: d =&gt; 5 * d.birth, top: d =&gt; 300 - 5 * d.death, ...})
</pre>
<p>Take note of the key property in the react code. This is necessary when you create many elements using map (well not really necessary but strongly recommended, you&#8217;d get a warning if you don&#8217;t use it). This is used so that if for some reason your parent element has to re-render, each child element will only be re-rendered if needed. If you&#8217;ve followed this far, you are now capable of doing things in React the critical part of what you were doing with d3: creating elements out of data. You might wonder: but does it work for svg? yes, and the logic is exactly the same:</p>
<p class="codepen" data-height="373" data-theme-id="0" data-slug-hash="MeyVLE" data-default-tab="result" data-user="jckr" data-embed-version="2">See the Pen <a href="http://codepen.io/jckr/pen/MeyVLE/">React simple scatterplot</a> by Jerome Cukier (<a href="http://codepen.io/jckr">@jckr</a>) on <a href="http://codepen.io/">CodePen</a>.</p>
<h1>Introducing JSX</h1>
<p data-height="373" data-theme-id="0" data-slug-hash="YWqLwz" data-default-tab="result" data-user="jckr" data-embed-version="2" class="codepen">See the Pen <a href="http://codepen.io/jckr/pen/YWqLwz/">React simple scatterplot JSX</a> by Jerome Cukier (<a href="http://codepen.io/jckr">@jckr</a>) on <a href="http://codepen.io/">CodePen</a>.</p>
<p>At this point you might think: all of this is great, but typing React.createElement all the time is kind of cumbersome. Many people do too, and there are a number of ways to not do that. The most popular, and the one in use at Facebook, is JSX. I personally use <a title="r-dom" href="http://https://github.com/uber/r-dom">r-dom</a> most of the time, but since JSX is definitely the most common way to write React, now that you have a feel for what React.createElement does, it&#8217;s not unreasonable to continue with JSX.</p>
<p>The main idea of JSX is that you&#8217;ll write tags in your javascript. Instead of writing:</p>
<pre class="brush: jscript; title: ; notranslate" title="">
React.createElement('type', {property1: value1, property2: value2, ...}, content)
</pre>
<p>you would write:</p>
<pre class="brush: plain; title: ; notranslate" title="">
&lt;type property1={value1} property2={value2} ...&gt;
content
&lt;/type&gt;
</pre>
<p>So in our previous example, we create an SVG element that has a width and a height property.<br />
We&#8217;d write:</p>
<pre class="brush: jscript; title: ; notranslate" title="">
const svg = &lt;svg height={300} width={300}&gt;
//... content ...
&lt;/svg&gt;
</pre>
<p>Inside the opening tag, we list all the properties and we give them a value. This isn&#8217;t unlike what you&#8217;d see when you watch the source of an HTML file.<br />
The value of the properties go inside curly braces, unless they are a string. For length-type values (ie height, width, top, left, font-size&#8230;) if a number is provided, it&#8217;s assumed it&#8217;s in px.<br />
If the element we create has other elements inside of it, there has to be an opening and a closing tag (ie &lt;element&gt; and &lt;/element&gt;). But if there isn&#8217;t, there can be a single tag (ie &lt;element /&gt;)<br />
Inside our svg, we have a bunch of circle elements. They are of the form:</p>
<pre class="brush: plain; title: ; notranslate" title="">
&lt;circle 
  cx={5 * d.birth}
  cy={300 - 5 * d.death}
  key={i}
  r={5}
  style={{
    fill: '#222',
    opacity: .2
  }}
/&gt;</pre>
<p>inside our curly braces, we can have calculations. And since there are no elements inside our circles, we don&#8217;t have to have both a &lt;cirlce&gt; and a &lt;/circle&gt; tag, although we could; we can have a single &lt;circle /&gt; tag.</p>
<p>That&#8217;s it in a nutshell, more details can be found <a title="here" href="https://facebook.github.io/react/docs/jsx-in-depth.html">here.</a><br />
Now you might think: if I type that in my text editor, I&#8217;m almost certain I&#8217;ll get an error! Indeed, behind the scenes, there has to be some transformation for your browser to understand JSX. This magical operation is called <em>transpilation</em>. Transpilation is just what you&#8217;d hope it is, it turns code written how you like into code that the browser can interpret flawlessly. The flip side is that&#8230; well, you have to transpile your code.<br />
If you work into environments like codepen or JsFiddle, they can take care of this for you. The most common transpiler is Babel. Babel turns your code into ES2015 compliant javascript (that is, before ES6). So the added bonus is that we can use any ES6 feature without wondering whether the user browser supports it or not. Most ES6 features are supported by the latest versions of many browswers, but there&#8217;s no guarantee that your users will run your favorite browser, let alone its latest version.<br />
If you want to do this on your own, you&#8217;ll have to set up a build environment, we&#8217;ll cover this in the last two articles.</p>
<p>&nbsp;</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-1733" class="post-1733 post type-post status-publish format-standard hentry category-data-visualization category-javascript">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2016/08/09/an-es6-primer/" rel="bookmark"><time class="entry-date published" datetime="2016-08-09T22:20:38+00:00">August 9, 2016</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/javascript/" rel="category tag">javascript</a>			</span>
		        <h1 class="post-title"><a href="/2016/08/09/an-es6-primer/" rel="bookmark">An ES6 primer</a></h1>
         
    </header>
	<section class="post-content">

		<p>This article is part of my series <a href="http://wp.me/po630-rQ">Visualization with React</a>. Previous article: <a href="http://wp.me/po630-rM">React and D3 &#8211; similarities and differences</a></p>
<p>In this guide, I will use ES6 notation whenever I would normally do it in my day job. There are many, many differences in ES6 compared to previous versions of javascript and that can be daunting. But in this time and age, a lot of code you can run into is going to be written in ES6, so a cursory knowledge of some of its features can go a long way.<br />
Here are the features I use most often:</p>
<h1>Fat arrows functions</h1>
<p>ES6 introduces a new, more concise way to write functions. Instead of writing:</p>
<pre class="brush: jscript; title: ; notranslate" title="">function add10(d) {return d + 10;}</pre>
<p>one can write:</p>
<pre class="brush: jscript; title: ; notranslate" title="">var add10 = d =&gt; d + 10</pre>
<p>Technically, <a href="http://stackoverflow.com/questions/32535110/what-are-the-differences-if-any-between-es6-arrow-functions-and-functions-boun">those two forms are not completely equivalent</a>. The main difference is if you need to use the context keyword <em>this</em>. But in most cases, fat arrows are a much more concise, and therefore more legible syntax.</p>
<p>To do a function which takes more than 1 argument, wrap them in parentheses like so:</p>
<pre class="brush: jscript; title: ; notranslate" title="">(a, b) =&gt; a + b</pre>
<p>For a function with several statements, you must use curly braces like a regular function, and use return if needs be:</p>
<pre class="brush: jscript; title: ; notranslate" title="">d =&gt; {
  console.log(d);
  return d;
}</pre>
<p>For a function that returns an object, wrap that object in parentheses to avoid confusing it with the previous form:</p>
<pre class="brush: jscript; title: ; notranslate" title="">d =&gt; ({key: d})</pre>
<h1>const and let</h1>
<p>Before ES6, to declare variables, you could only use the var keyword.</p>
<pre class="brush: jscript; title: ; notranslate" title="">var a;
var b = 10;</pre>
<p>In ES6, you can declare variables using const or let. When you use const, the variable cannot be reassigned:</p>
<pre class="brush: jscript; title: ; notranslate" title=""> const a; // error - a must be assigned a value </pre>
<pre class="brush: jscript; title: ; notranslate" title=""> const b = 1;
b = 2; // error - b can no longer be reassigned</pre>
<p>Variables declared with let can be reassigned.</p>
<pre class="brush: jscript; title: ; notranslate" title=""> let a; // ok
a = 10; // ok
a = 20; // still no error</pre>
<p>const and let are more expressive than var, because they specify whether we plan to change the value of a variable or not. They have another advantage: they are scoped. They can be used inside of an if branch, or a for loop, and not be accessible outside of it. Conversely, var are not scoped &#8211; they are available everywhere within the function where they are declared, or globally if declared outside of a function.<br />
So, there&#8217;s no reason to ever use the var keyword in ES6.</p>
<h1>Spread operator</h1>
<p>In ES6,if you have an array inside another array, you can replace that array with its items in sequence using the spread operator. An example would make this clearer:</p>
<pre class="brush: jscript; title: ; notranslate" title="">
const a = [1, ...[2, 3, 4]]; // [1, 2, 3, 4].
</pre>
<p>That may seem like not much but it&#8217;s super versatile and useful. For instance, instead of concatenating two arrays, you can write:</p>
<pre class="brush: jscript; title: ; notranslate" title="">
const a = [1, 2];
const b = [3, 4]
const c = [...a, ...b]; // [1, 2, 3, 4]
</pre>
<p>Interestingly, it works with empty arrays:</p>
<pre class="brush: jscript; title: ; notranslate" title=""> 
const a = [1, 2];
const b = [];
const c = [...a, ...b]; // [1, 2]
</pre>
<p>But not with primitive literals (numbers, etc)</p>
<pre class="brush: jscript; title: ; notranslate" title="">
const a = [1, 2];
const b = 3;
const c = [...a, ...b]; // error
</pre>
<p>Instead of pushing an item to the end of an array, you can also use the spread operator:</p>
<pre class="brush: jscript; title: ; notranslate" title="">
const a = [1, 2];
const b = 3;
const c = [...a, b]; // added benefit - creates a new array instead of changing it in place.
</pre>
<p>Note the difference between these 2.<br />
[&#8230;[1,2], <strong>3</strong>] will work;<br />
[&#8230;[1, 2], <strong>&#8230;3</strong>] will not. </p>
<p>Composing arrays like this can be conditional!</p>
<pre class="brush: jscript; title: ; notranslate" title="">
const a = [1, 2];
const b = 3;
const condition = false;
const c = [...a, ...(condition ? [b] : [])] // [1, 2];
</pre>
<p>What just happened? just like above, but we applied the spread operator to the expression which is in parentheses. If the condition were true, that expression would be equivalent to [b]. But since it&#8217;s false, it is equivalent to an empty array. </p>
<p>An experimental feature of ES7 extends the spread operator to objects.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
const obj = {key: 'a'};
const newObj = {...obj, value: 1}; // {key: 'a', value: 1}
</pre>
<h1>Destructuring assignment</h1>
<p>You can do more stuff with objects in ES6. Destructuring assignment covers a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">number of nifty features</a> but here are the two I use the most.</p>
<pre class="brush: jscript; title: ; notranslate" title="">const obj = {key: 'a', value: 123};
// you can read several properties from an object at once and assign them to variables:
const {key, value} = obj;
console.log(key, value); // 'a', 123</pre>
<p>Before ES6, you had to write a function like this:</p>
<pre class="brush: jscript; title: ; notranslate" title="">function div(num, den) {return num / den;}
div(6, 2); // 3;
div(2, 6); // 0.333333 order of the parameters matters!
div(3); // NaN - can't forget an argument! 
</pre>
<p>In ES6, we can expect the function as argument to take an object and access its properties:</p>
<pre class="brush: jscript; title: ; notranslate" title="">
function div({num, den = 1}) {return num / den;}
div({num: 6, den: 2}); // 3
div({den: 2, num: 6}); // still 3
div({num: 3}); // still 3 - den has a default value
</pre>
<p>Using an object, we don&#8217;t have to remember in what order the function parameters have to be provided.</p>
<h1>Wrapping it all together</h1>
<p>what&#8217;s another form for the last function I wrote?</p>
<pre class="brush: jscript; title: ; notranslate" title="">const div = ({num, den = 1}) =&gt; num / den;</pre>
<p>In the next article in the series, <a href="http://wp.me/po630-s3">Coding with React</a>, we will finally start to write some React code.</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-1722" class="post-1722 post type-post status-publish format-standard hentry category-d3 category-data-visualization category-javascript category-react category-tips">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2016/08/09/d3-and-react-similarities-and-differences/" rel="bookmark"><time class="entry-date published" datetime="2016-08-09T06:13:37+00:00">August 9, 2016</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/d3/" rel="category tag">d3</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/javascript/" rel="category tag">javascript</a>, <a href="/category/react/" rel="category tag">react</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2016/08/09/d3-and-react-similarities-and-differences/" rel="bookmark">D3 and React &#8211; similarities and differences</a></h1>
         
    </header>
	<section class="post-content">

		<p><script src="//assets.codepen.io/assets/embed/ei.js" async=""></script><br />
<a href="http://wp.me/po630-rr">Previous article: Visualization with React</a></p>
<h1>d3, meet cousin React</h1>
<p>Let&#8217;s not sugarcoat it: working with React is more complicated than with plain vanilla javascript. There are a few additional notions which may sound complex. But the good news is that if you come from the d3 world, there are many concepts which are similar. Visualization on the web is, at its core,<strong> transforming a dataset into a representation</strong>. That dataset is probably going to be an array, and at some point the framework will loop through the array and create something for each element of the array. For instance, if you want to make a bar chart, you probably will have at some point an array with one item that corresponds to each bar, which has a value that corresponds to its length. Looping through the array, each item is turned into a rectangle whose height depends on that value. That logic, which is at the core of d3 with <a href="http://www.jeromecukier.net/blog/2013/03/05/d3-tutorial-at-strata-redux/">selections</a>, is also present in React. In d3, <strong>visualizations are essentially hierarchical.</strong> We start from an SVG element (probably), add to it elements like groups, which can hold other elements. To continue with our bar chart example, our chart will have several data marks attached to it (the bars), and there&#8217;s a hierarchical relation between them: the chart contains those marks. Our chart could be part of a dashboard that has several charts, or part of a web page that has other information. At any rate, in the d3 world, everything we create is added to a root element or to elements we create and arranged in a tree-like hierarchy. This is also the case in React, with a difference: the world of React is mostly structured into components. When that of d3 is mostly made of DOM elements like HTML or SVG elements, that of React is made of components. A React component is a part of your end result. It can be as small as a DOM element, or as big as the whole application. And it can have component children. So, components are logical ways to package your application. Components are created with modularity and reusability in mind. For instance, I can create a bar chart component in React, and the next time I have a bar chart to make, I can just reuse the exact same component. I can also create components to make axes or the individual bars in the chart, which my bar chart component will use. But the next time I need a bar chart, I wouldn&#8217;t have to think about it. In contrast, if I want to create another bar chart in d3, I probably have to recreate it from scratch and decide manually what happens to all the SVG or HTML elements that constitute the bar chart.</p>
<h1>You say dAYta, I say da-tah</h1>
<p>One fundamental way in which d3 and React differ is by how they treat data. If you read about React, you may find fancy terms like one-way data binding. In how many ways the data is bound in d3 is not something which is on top of our head when we create visualization so that might sound confusing. In d3, an element can modify the data which is associated to it. I&#8217;ve used it so many times.</p>
<p class="codepen" data-height="265" data-theme-id="0" data-slug-hash="XKmpYo" data-default-tab="result" data-user="jckr" data-embed-version="2">See the Pen <a href="http://codepen.io/jckr/pen/XKmpYo/">React simple scatterplot</a> by Jerome Cukier (<a href="http://codepen.io/jckr">@jckr</a>) on <a href="http://codepen.io/">CodePen</a>.</p>
<p>These bars have been made with a very simple dataset shown below them. If you click on the bars, the underlying data will change and the representation will change as well. In the world of React, when properties are passed to a component, they cannot be changed. That&#8217;s what one-way binding means. Data in React flows unidirectionally. Once it&#8217;s defined, it determines the way all components should be displayed. In certain events, a parent component can pass different properties to its children component and they may be re-rendered (we&#8217;ll see this in just a moment). But the important part is that properties passed to a component can never be changed. You may wonder: why is that even a good thing? React makes it impossible to do things! yes, but in the process it also makes things much safer. If properties can&#8217;t be changed, it also means that they can&#8217;t be altered by something we hadn&#8217;t thought of. Also, it makes it much easier to work on components independently: one team mate could make a bar chart component while her colleague makes a line chart. They don&#8217;t really need to know the inner working of the other component, and they know that nothing unexpected will disturb the way their component function.</p>
<h1>The state of affairs</h1>
<p>Components of React have a really powerful feature which doesn&#8217;t explicitly exist in d3: the state. The state represents the current status of a component. Here&#8217;s a simple switch component:</p>
<p class="codepen" data-height="265" data-theme-id="0" data-slug-hash="mEeRvr" data-default-tab="result" data-user="jckr" data-embed-version="2">See the Pen <a href="http://codepen.io/jckr/pen/mEeRvr/">React simple scatterplot</a> by Jerome Cukier (<a href="http://codepen.io/jckr">@jckr</a>) on <a href="http://codepen.io/">CodePen</a>.</p>
<p>We want to record the fact that the switch can be turned on or off. Here&#8217;s how it should work: First we create our switch component, and it&#8217;s supposed to be off. Then, if the user clicks it, it becomes on if it were off and vice-versa. And it should also be redrawn, to reflect that it&#8217;s been turned on (or off). The state does all that. It records the current status of the component. Technically, it&#8217;s an object with properties, so it can save a lot of information, not just a simple true or false value. The other great thing about the state is that if it changes, then the component is re-rendered. Rendering a component could require rendering children component, and they may be re-rendered as well. So with the state and properties, we have a powerful framework to handle events and whatever may happen to our app. If there&#8217;s an event we care about, it can change the state of a component, then, all of the children components may be re-rendered. And there&#8217;s no other way to redraw them. This is in contrast with plain d3 where anything goes &#8211; anything can change anything, data can be used to render elements, the underlying data can be changed without changing the element, the element can be transformed without changing the underlying data.</p>
<p>State is an important notion in computer science. In d3, it&#8217;s just doesn&#8217;t have a more formal representation than all the variables in your code.</p>
<p>In the next article in the series, <a href="http://wp.me/po630-rX">an ES6 Primer</a>, we will look in some useful ES6 features for React. </p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
				
<article id="post-1726" class="post-1726 post type-post status-publish format-standard hentry category-d3 category-data-visualization category-javascript category-react category-tips">
		    <header class="post-header">
        			<span class="post-meta">
				<span class="posted-on"><a href="/2016/08/09/visualization-with-react/" rel="bookmark"><time class="entry-date published" datetime="2016-08-09T06:07:56+00:00">August 9, 2016</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="/author/jerome/">jerome</a></span></span> on <a href="/category/d3/" rel="category tag">d3</a>, <a href="/category/data-visualization/" rel="category tag">data visualization</a>, <a href="/category/javascript/" rel="category tag">javascript</a>, <a href="/category/react/" rel="category tag">react</a>, <a href="/category/tips/" rel="category tag">tips</a>			</span>
		        <h1 class="post-title"><a href="/2016/08/09/visualization-with-react/" rel="bookmark">Visualization with React</a></h1>
         
    </header>
	<section class="post-content">

		<h1>Some back story&#8230;</h1>
<p>In what seemed a lifetime ago now, I wrote tutorials to help people get started with Protovis as I learned it myself (it is indeed a lifetime away since Protovis is dead and buried for all intents and purposes). And a few years ago, I did the same for d3 as this started to become the most powerful visualization framework and for which documentation was still scarce. I wrote these tutorials to help me learn, but since then I have met many people who found them useful which blew my mind. By documenting my learning, I got noticed by Facebook and travelled 9000 miles to a new life.</p>
<p>At Facebook, I had some loosely-defined data visualization explorer role. While I joined during the infancy of React, I didn&#8217;t feel super comfortable using it then &#8211; I felt more effective writing one-off d3 applications. Eventually, I moved on and am now working at Uber as a fully-fledged <a href="https://eng.uber.com/data-viz-intel/">data visualization engineer</a>. I work almost exclusively with dashboards, which have a pretty elaborate UI.</p>
<p>Like in many other companies, at Uber, we use React for our web applications, including our visualizations, dashboards and maps. Increasingly, React is becoming the lingua franca of visualization: more than a tool that allows one to draw data, a mindset that informs how one should think a visualization. React is no longer a young library &#8211; the initial public release dates back from May 2013, and its very first application at Facebook was visualization (my first Facebook project, pages insights). There&#8217;s already many, many learning resources and tutorials for React. What I&#8217;ll try to do here is to show how React can be used for visualization: hopefully, this will be useful both for people who come from d3 and who&#8217;ve never worked with a web framework before, and for people who are familiar with React but who don&#8217;t know visualization well. That won&#8217;t be a complete and exhaustive guide, more a way to get started with references on how to go further.</p>
<h1>The articles</h1>
<p>I&#8217;ve structured this guide in 7 parts, and I&#8217;ll publish one per day:</p>
<ol>
<li><a href="http://www.jeromecukier.net/blog/2016/08/09/d3-and-react-similarities-and-differences/">React vs D3</a>, where we&#8217;ll explore similarities and differences between these two frameworks.</li>
<li><a href="http://wp.me/po630-rX">An ES6 primer</a>. I have written all the examples in good, sensible, modern ES6 javascript, because as of 2016 this is probably the most common syntax. Without going too deep into the details, I&#8217;ll explain what parts of the language I used for the examples, and how they differ from ES5.</li>
<li>Gentle introduction to <a href="http://wp.me/po630-s3">coding with React</a>, where we&#8217;ll explore the high-level concepts of the framework and see how we can create visual elements from data. We&#8217;ll end on a presentation of JSX, a flavor of Javascript used to write React applications, which I&#8217;ll also use for most of the examples for the same reasons as ES6 &#8211; because it&#8217;s the most widespread way of writing React code today.</li>
<li><a href="http://wp.me/po630-sg">React components</a>, the most important concept in React and the building blocks of React applications.</li>
<li><a href="http://wp.me/po630-sm">Beyond rendering</a>. We&#8217;ll look at the React concept of lifecycle methods, and also how we can use d3 within React components.</li>
<li><a href="http://wp.me/po630-st">Creating a React visualization web app</a> &#8211; using what we&#8217;ve seen, and two libraries &#8211; Facebook&#8217;s <a href="https://github.com/facebookincubator/create-react-app">create-react-app</a> and Uber&#8217;s <a href="https://github.com/uber/react-vis/">React-vis</a>, we&#8217;ll create a small standalone React visualization that can be deployed on its own website.</li>
<li><a href="http://wp.me/po630-st">The big leagues</a> &#8211; in that last part, we&#8217;ll write together a more complex visualization with live data and several components interacting with one another.</li>
</ol>
<h1>The code</h1>
<p>The examples of parts 1-5 can be found on <a href="http://codepen.io/collection/XdEpyp/">codepen</a>. I&#8217;ll add link to examples of part 6 and 7 when they go live.</p>
	    		<div class="clear">&nbsp;</div>
	</section>
</article><!-- #post-## -->
			
			
		
		</main><!-- #main -->
	</section><!-- #primary -->

	<div id="secondary" class="widget-area" role="complementary">
		<aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form></aside>		<aside id="recent-posts-2" class="widget widget_recent_entries">		<h1 class="widget-title">Recent Posts</h1>		<ul>
					<li>
				<a href="/2016/08/17/the-big-leagues/">The big leagues</a>
						</li>
					<li>
				<a href="/2016/08/17/creating-a-react-visualization-web-app/">Creating a React visualization web app</a>
						</li>
					<li>
				<a href="/2016/08/13/beyond-rendering/">Beyond rendering</a>
						</li>
					<li>
				<a href="/2016/08/11/react-components/">React components</a>
						</li>
					<li>
				<a href="/2016/08/10/coding-with-react/">Coding with React</a>
						</li>
				</ul>
		</aside>		<aside id="recent-comments-2" class="widget widget_recent_comments"><h1 class="widget-title">Recent Comments</h1><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link"><a href='http://omeraz.wordpress.com/' rel='external nofollow' class='url'>עומר עזריאל</a></span> on <a href="/2016/08/17/the-big-leagues/#comment-567">The big leagues</a></li><li class="recentcomments"><span class="comment-author-link">Carlos Ayres</span> on <a href="/2012/05/28/manipulating-data-like-a-boss-with-d3/#comment-312">Manipulating data like a boss with d3</a></li><li class="recentcomments"><span class="comment-author-link"><a href='https://migrate.powertripanalytics.com/game-of-thrones-interactions-among-the-top-30-characters/' rel='external nofollow' class='url'>Game of ThronesInteractions Among the Top 30 Characters &#8211; PowerTrip Analytics</a></span> on <a href="/2013/05/13/making-the-game-of-thrones-visualization/#comment-466">Making the game of thrones visualization</a></li><li class="recentcomments"><span class="comment-author-link"><a href='https://abgoswam.wordpress.com/2016/10/08/d3-getting-started/' rel='external nofollow' class='url'>D3 &#8211; Getting Started | abgoswam&#039;s tech blog</a></span> on <a href="/2012/09/04/getting-to-hello-world-with-d3/#comment-419">Getting to &#8220;Hello world&#8221; with d3</a></li><li class="recentcomments"><span class="comment-author-link"><a href='https://plus.google.com/+BrotoBhattacharjee' rel='external nofollow' class='url'>Broto Bhattacharjee</a></span> on <a href="/2012/09/04/getting-to-hello-world-with-d3/#comment-418">Getting to &#8220;Hello world&#8221; with d3</a></li></ul></aside><aside id="archives-2" class="widget widget_archive"><h1 class="widget-title">Archives</h1>		<ul>
			<li><a href='/2016/08/'>August 2016</a></li>
	<li><a href='/2015/05/'>May 2015</a></li>
	<li><a href='/2015/02/'>February 2015</a></li>
	<li><a href='/2014/10/'>October 2014</a></li>
	<li><a href='/2013/11/'>November 2013</a></li>
	<li><a href='/2013/05/'>May 2013</a></li>
	<li><a href='/2013/03/'>March 2013</a></li>
	<li><a href='/2013/01/'>January 2013</a></li>
	<li><a href='/2012/12/'>December 2012</a></li>
	<li><a href='/2012/11/'>November 2012</a></li>
	<li><a href='/2012/10/'>October 2012</a></li>
	<li><a href='/2012/09/'>September 2012</a></li>
	<li><a href='/2012/07/'>July 2012</a></li>
	<li><a href='/2012/06/'>June 2012</a></li>
	<li><a href='/2012/05/'>May 2012</a></li>
	<li><a href='/2012/04/'>April 2012</a></li>
	<li><a href='/2012/01/'>January 2012</a></li>
	<li><a href='/2011/11/'>November 2011</a></li>
	<li><a href='/2011/10/'>October 2011</a></li>
	<li><a href='/2011/09/'>September 2011</a></li>
	<li><a href='/2011/08/'>August 2011</a></li>
	<li><a href='/2011/07/'>July 2011</a></li>
	<li><a href='/2011/06/'>June 2011</a></li>
	<li><a href='/2011/05/'>May 2011</a></li>
	<li><a href='/2011/04/'>April 2011</a></li>
	<li><a href='/2011/03/'>March 2011</a></li>
	<li><a href='/2011/02/'>February 2011</a></li>
	<li><a href='/2011/01/'>January 2011</a></li>
	<li><a href='/2010/11/'>November 2010</a></li>
	<li><a href='/2010/04/'>April 2010</a></li>
	<li><a href='/2010/03/'>March 2010</a></li>
	<li><a href='/2010/02/'>February 2010</a></li>
	<li><a href='/2010/01/'>January 2010</a></li>
	<li><a href='/2009/12/'>December 2009</a></li>
	<li><a href='/2009/10/'>October 2009</a></li>
	<li><a href='/2009/09/'>September 2009</a></li>
	<li><a href='/2009/08/'>August 2009</a></li>
	<li><a href='/2009/07/'>July 2009</a></li>
	<li><a href='/2009/06/'>June 2009</a></li>
	<li><a href='/2009/05/'>May 2009</a></li>
	<li><a href='/2008/12/'>December 2008</a></li>
	<li><a href='/2008/11/'>November 2008</a></li>
	<li><a href='/2008/10/'>October 2008</a></li>
		</ul>
		</aside><aside id="categories-2" class="widget widget_categories"><h1 class="widget-title">Categories</h1>		<ul>
	<li class="cat-item cat-item-2"><a href="/category/book-review/" >book review</a>
</li>
	<li class="cat-item cat-item-3"><a href="/category/charts/" >charts</a>
</li>
	<li class="cat-item cat-item-4"><a href="/category/conferences/" >conferences</a>
</li>
	<li class="cat-item cat-item-5"><a href="/category/d3/" >d3</a>
</li>
	<li class="cat-item cat-item-6"><a href="/category/dashboards/" >dashboards</a>
</li>
	<li class="cat-item cat-item-7"><a href="/category/data-publishing/" >data publishing</a>
</li>
	<li class="cat-item cat-item-8"><a href="/category/data-visualization/" >data visualization</a>
</li>
	<li class="cat-item cat-item-9"><a href="/category/francais/" >français</a>
</li>
	<li class="cat-item cat-item-10"><a href="/category/javascript/" >javascript</a>
</li>
	<li class="cat-item cat-item-11"><a href="/category/presentation/" >presentation</a>
</li>
	<li class="cat-item cat-item-12"><a href="/category/protovis/" >protovis</a>
</li>
	<li class="cat-item cat-item-13"><a href="/category/react/" >react</a>
</li>
	<li class="cat-item cat-item-14"><a href="/category/tips/" >tips</a>
</li>
	<li class="cat-item cat-item-1"><a href="/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-15"><a href="/category/web-sites/" >web sites</a>
</li>
		</ul>
</aside><aside id="meta-2" class="widget widget_meta"><h1 class="widget-title">Meta</h1>			<ul>
						<li><a href="/wp-login.php">Log in</a></li>
			<li><a href="/feed/">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="/comments/feed/">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>			</ul>
			</aside>		<div class="clear">&nbsp;</div>
	</div><!-- #secondary -->
	<footer id="colophon" class="site-footer" role="contentinfo">
	    <a class="subscribe icon-feed" href="/feed/"><span class="tooltip">Subscribe!</span></a>
		<div class="site-info inner">
		    <section class="copyright">
		    			    		<a href="https://github.com/lacymorrow/casper" rel="home">Casper WP</a> by Lacy Morrow		    			    </section>
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</main><!-- /#content -->

<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.9b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPlain.js?ver=3.0.9b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.9b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.9b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://localhost:8888/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://localhost:8888/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<script type='text/javascript' src='/wp-content/themes/casper/js/main.js?ver=1.0.0'></script>
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.10'></script>
<!--stats_footer_test--></body>
</html>
